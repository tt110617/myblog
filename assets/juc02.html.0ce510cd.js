import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{o,c,a as n,b as p,d as t,e as s,r as l}from"./app.6a2d513d.js";const u={},i=t(`<h1 id="\u4E8C\u3001\u7BA1\u7A0B\u548C\u5185\u5B58" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u7BA1\u7A0B\u548C\u5185\u5B58" aria-hidden="true">#</a> \u4E8C\u3001\u7BA1\u7A0B\u548C\u5185\u5B58</h1><h2 id="_4-\u5171\u4EAB\u6A21\u578B\u4E4B\u7BA1\u7A0B" tabindex="-1"><a class="header-anchor" href="#_4-\u5171\u4EAB\u6A21\u578B\u4E4B\u7BA1\u7A0B" aria-hidden="true">#</a> 4.\u5171\u4EAB\u6A21\u578B\u4E4B\u7BA1\u7A0B</h2><h3 id="_4-1-\u7EBF\u7A0B\u51FA\u73B0\u95EE\u9898\u7684\u6839\u672C\u539F\u56E0\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4-1-\u7EBF\u7A0B\u51FA\u73B0\u95EE\u9898\u7684\u6839\u672C\u539F\u56E0\u5206\u6790" aria-hidden="true">#</a> 4.1 \u7EBF\u7A0B\u51FA\u73B0\u95EE\u9898\u7684\u6839\u672C\u539F\u56E0\u5206\u6790</h3><p>\u7EBF\u7A0B\u51FA\u73B0\u95EE\u9898\u7684\u6839\u672C\u539F\u56E0\u662F\u56E0\u4E3A\u7EBF\u7A0B\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C\u5BFC\u81F4\u7EBF\u7A0B\u91CC\u7684\u6307\u4EE4\u6CA1\u6709\u6267\u884C\u5B8C\u5C31\u5207\u6362\u6267\u884C\u5176\u5B83\u7EBF\u7A0B\u4E86\uFF0C\u4E0B\u9762\u4E3E\u4E00\u4E2A\u4F8B\u5B50</p><p>\u4E24\u4E2A\u7EBF\u7A0B\u5BF9\u521D\u59CB\u503C\u4E3A 0 \u7684\u9759\u6001\u53D8\u91CF\u4E00\u4E2A\u505A\u81EA\u589E\uFF0C\u4E00\u4E2A\u505A\u81EA\u51CF\uFF0C\u5404\u505A 5000 \u6B21\uFF0C\u7ED3\u679C\u662F 0 \u5417\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> t2 <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            count<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count\u7684\u503C\u662F{}&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u7684\u7ED3\u679C\u53EF\u80FD\u662F\u6B63\u6570\u3001\u8D1F\u6570\u3001\u96F6\u3002\u4E3A\u4EC0\u4E48\u5462\uFF1F\u56E0\u4E3A Java \u4E2D\u5BF9\u9759\u6001\u53D8\u91CF\u7684\u81EA\u589E\uFF0C\u81EA\u51CF\u5E76\u4E0D\u662F\u539F\u5B50\u64CD\u4F5C\uFF0C\u8981\u5F7B\u5E95\u7406\u89E3\uFF0C\u5FC5\u987B\u4ECE\u5B57\u8282\u7801\u6765\u8FDB\u884C\u5206\u6790</p><p>\u4F8B\u5982\u5BF9\u4E8E i++ \u800C\u8A00\uFF08i \u4E3A\u9759\u6001\u53D8\u91CF\uFF09\uFF0C\u5B9E\u9645\u4F1A\u4EA7\u751F\u5982\u4E0B\u7684 JVM \u5B57\u8282\u7801\u6307\u4EE4\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>getstatic i <span class="token comment">// \u83B7\u53D6\u9759\u6001\u53D8\u91CFi\u7684\u503C</span>
iconst_1 <span class="token comment">// \u51C6\u5907\u5E38\u91CF1</span>
iadd <span class="token comment">// \u81EA\u589E</span>
putstatic i <span class="token comment">// \u5C06\u4FEE\u6539\u540E\u7684\u503C\u5B58\u5165\u9759\u6001\u53D8\u91CFi</span>
    
getstatic i <span class="token comment">// \u83B7\u53D6\u9759\u6001\u53D8\u91CFi\u7684\u503C</span>
iconst_1 <span class="token comment">// \u51C6\u5907\u5E38\u91CF1</span>
isub <span class="token comment">// \u81EA\u51CF</span>
putstatic i <span class="token comment">// \u5C06\u4FEE\u6539\u540E\u7684\u503C\u5B58\u5165\u9759\u6001\u53D8\u91CFi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230 <code>count++</code> \u548C <code>count--</code> \u64CD\u4F5C\u5B9E\u9645\u90FD\u662F\u9700\u8981\u8FD9\u4E2A4\u4E2A\u6307\u4EE4\u5B8C\u6210\u7684\uFF0C\u90A3\u4E48\u8FD9\u91CC\u95EE\u9898\u5C31\u6765\u4E86\uFF01Java \u7684\u5185\u5B58\u6A21\u578B\u5982\u4E0B\uFF0C\u5B8C\u6210\u9759\u6001\u53D8\u91CF\u7684\u81EA\u589E\uFF0C\u81EA\u51CF\u9700\u8981\u5728\u4E3B\u5B58\u548C\u5DE5\u4F5C\u5185\u5B58\u4E2D\u8FDB\u884C\u6570\u636E\u4EA4\u6362\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603371.png" alt="1583569253392"></p><p>\u5982\u679C\u4EE3\u7801\u662F\u6B63\u5E38\u6309\u987A\u5E8F\u8FD0\u884C\u7684\uFF0C\u90A3\u4E48count\u7684\u503C\u4E0D\u4F1A\u8BA1\u7B97\u9519</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603436.png" alt="1583569326977"></p><p>\u51FA\u73B0\u8D1F\u6570\u7684\u60C5\u51B5\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603026.png" alt="1583569380639"></p><p>\u51FA\u73B0\u6B63\u6570\u7684\u60C5\u51B5\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603519.png" alt="1583569416016"></p><h4 id="\u95EE\u9898\u7684\u8FDB\u4E00\u6B65\u63CF\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u95EE\u9898\u7684\u8FDB\u4E00\u6B65\u63CF\u8FF0" aria-hidden="true">#</a> \u95EE\u9898\u7684\u8FDB\u4E00\u6B65\u63CF\u8FF0</h4><h5 id="\u4E34\u754C\u533A" tabindex="-1"><a class="header-anchor" href="#\u4E34\u754C\u533A" aria-hidden="true">#</a> \u4E34\u754C\u533A</h5><ol><li><p>\u4E00\u4E2A\u7A0B\u5E8F\u8FD0\u884C\u591A\u7EBF\u7A0B\u672C\u8EAB\u662F\u6CA1\u6709\u95EE\u9898\u7684</p></li><li><p>\u95EE\u9898\u51FA\u73B0\u5728\u591A\u4E2A\u7EBF\u7A0B\u5171\u4EAB\u8D44\u6E90\u7684\u65F6\u5019</p><ol><li>\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u5BF9\u5171\u4EAB\u8D44\u6E90\u8FDB\u884C\u8BFB\u64CD\u4F5C\u672C\u8EAB\u4E5F\u6CA1\u6709\u95EE\u9898</li><li>\u95EE\u9898\u51FA\u73B0\u5728 <strong>\u5BF9\u5171\u4EAB\u8D44\u6E90\u540C\u65F6\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C</strong> \u65F6\u5C31\u6709\u95EE\u9898\u4E86</li></ol></li><li><p>\u5148\u5B9A\u4E49\u4E00\u4E2A\u53EB\u505A\u4E34\u754C\u533A\u7684\u6982\u5FF5\uFF1A\u4E00\u6BB5\u4EE3\u7801\u5185\u5982\u679C\u5B58\u5728 <strong>\u5BF9\u5171\u4EAB\u8D44\u6E90\u7684\u591A\u7EBF\u7A0B\u8BFB\u5199\u64CD\u4F5C</strong>\uFF0C\u90A3\u4E48\u79F0\u8FD9\u6BB5\u4EE3\u7801\u4E3A <strong>\u4E34\u754C\u533A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	<span class="token comment">// \u4E34\u754C\u533A</span>
    counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	<span class="token comment">// \u4E34\u754C\u533A</span>
    counter<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h5 id="\u7ADE\u6001\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u7ADE\u6001\u6761\u4EF6" aria-hidden="true">#</a> \u7ADE\u6001\u6761\u4EF6</h5><p>\u591A\u4E2A\u7EBF\u7A0B\u5728\u4E34\u754C\u533A\u6267\u884C\uFF0C\u90A3\u4E48\u7531\u4E8E\u4EE3\u7801\u6307\u4EE4\u7684\u6267\u884C\u4E0D\u786E\u5B9A\u800C\u5BFC\u81F4\u7684\u7ED3\u679C\u95EE\u9898\uFF0C\u79F0\u4E3A\u7ADE\u6001\u6761\u4EF6</p><h3 id="_4-2-synchronized-\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_4-2-synchronized-\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 4.2 synchronized \u89E3\u51B3\u65B9\u6848</h3><p>\u4E3A\u4E86\u907F\u514D\u4E34\u754C\u533A\u4E2D\u7684\u7ADE\u6001\u6761\u4EF6\u53D1\u751F\uFF0C\u7531\u591A\u79CD\u624B\u6BB5\u53EF\u4EE5\u8FBE\u5230</p><ul><li>\u963B\u585E\u5F0F\u89E3\u51B3\u65B9\u6848\uFF1Asynchronized \uFF0CLock</li><li>\u975E\u963B\u585E\u5F0F\u89E3\u51B3\u65B9\u6848\uFF1A\u539F\u5B50\u53D8\u91CF</li></ul><p>\u73B0\u5728\u8BA8\u8BBA\u4F7F\u7528synchronized\u6765\u8FDB\u884C\u89E3\u51B3\uFF0C\u5373\u4FD7\u79F0\u7684\u5BF9\u8C61\u9501\uFF0C<strong>\u5B83\u91C7\u7528\u4E92\u65A5\u7684\u65B9\u5F0F\u8BA9\u540C\u4E00\u65F6\u523B\u81F3\u591A\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6301\u6709\u5BF9\u8C61\u9501\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u5982\u679C\u60F3\u83B7\u53D6\u8FD9\u4E2A\u9501\u5C31\u4F1A\u963B\u585E\u4F4F</strong>\uFF0C\u8FD9\u6837\u5C31\u80FD\u4FDD\u8BC1\u62E5\u6709\u9501\u7684\u7EBF\u7A0B\u53EF\u4EE5\u5B89\u5168\u7684\u6267\u884C\u4E34\u754C\u533A\u5185\u7684\u4EE3\u7801\uFF0C\u4E0D\u7528\u62C5\u5FC3\u7EBF\u7A0B\u4E0A\u4E0B\u6587\u5207\u6362</p><blockquote><p>\u6CE8\u610F \u867D\u7136 java \u4E2D\u4E92\u65A5\u548C\u540C\u6B65\u90FD\u53EF\u4EE5\u91C7\u7528 synchronized \u5173\u952E\u5B57\u6765\u5B8C\u6210\uFF0C\u4F46\u5B83\u4EEC\u8FD8\u662F\u6709\u533A\u522B\u7684\uFF1A</p><ul><li>\u4E92\u65A5\u662F\u4FDD\u8BC1\u4E34\u754C\u533A\u7684\u7ADE\u6001\u6761\u4EF6\u53D1\u751F\uFF0C\u540C\u4E00\u65F6\u523B\u53EA\u80FD\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u4E34\u754C\u533A\u7684\u4EE3\u7801</li><li>\u540C\u6B65\u662F\u7531\u4E8E\u7EBF\u7A0B\u6267\u884C\u7684\u5148\u540E\uFF0C\u987A\u5E8F\u4E0D\u540C\u4F46\u662F\u9700\u8981\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u5176\u5B83\u7EBF\u7A0B\u8FD0\u884C\u5230\u67D0\u4E2A\u70B9\u3002</li></ul></blockquote><h4 id="synchronized" tabindex="-1"><a class="header-anchor" href="#synchronized" aria-hidden="true">#</a> synchronized</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>\u5BF9\u8C61<span class="token punctuation">)</span> <span class="token comment">// \u7EBF\u7A0B1\u83B7\u5F97\u9501\uFF0C \u90A3\u4E48\u7EBF\u7A0B2\u7684\u72B6\u6001\u662F(blocked)</span>
<span class="token punctuation">{</span>
 \u4E34\u754C\u533A
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u5B9E\u4F8B\u7A0B\u5E8F\u4F7F\u7528synchronized\u540E\u5982\u4E0B\uFF0C\u8BA1\u7B97\u51FA\u7684\u7ED3\u679C\u662F\u6B63\u786E\uFF01</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                counter<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                counter<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7528\u65F6\u5E8F\u56FE\u6765\u8868\u793A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209131939111.png" alt="image-20220913193919035"></p><h4 id="\u601D\u8003" tabindex="-1"><a class="header-anchor" href="#\u601D\u8003" aria-hidden="true">#</a> \u601D\u8003</h4><p>synchronized \u5B9E\u9645\u662F\u7528\u5BF9\u8C61\u9501\u4FDD\u8BC1\u4E86\u4E34\u754C\u533A\u5185\u4EE3\u7801\u7684\u539F\u5B50\u6027\uFF0C\u4E34\u754C\u533A\u5185\u7684\u4EE3\u7801\u5BF9\u5916\u662F\u4E0D\u53EF\u5206\u5272\u7684\uFF0C\u4E0D\u4F1A\u88AB\u7EBF\u7A0B\u5207\u6362\u6240\u6253\u65AD\u3002</p><p>\u4E3A\u4E86\u52A0\u6DF1\u7406\u89E3\uFF0C\u8BF7\u601D\u8003\u4E0B\u9762\u7684\u95EE\u9898</p><ul><li>\u5982\u679C\u628A synchronized(obj) \u653E\u5728 for \u5FAA\u73AF\u7684\u5916\u9762\uFF0C\u5982\u4F55\u7406\u89E3\uFF1F-- \u539F\u5B50\u6027</li><li>\u5982\u679C t1 synchronized(obj1) \u800C t2 synchronized(obj2) \u4F1A\u600E\u6837\u8FD0\u4F5C\uFF1F-- \u9501\u5BF9\u8C61</li><li>\u5982\u679C t1 synchronized(obj) \u800C t2 \u6CA1\u6709\u52A0\u4F1A\u600E\u4E48\u6837\uFF1F\u5982\u4F55\u7406\u89E3\uFF1F-- \u9501\u5BF9\u8C61</li></ul><h4 id="\u9762\u5411\u5BF9\u8C61\u6539\u8FDB" tabindex="-1"><a class="header-anchor" href="#\u9762\u5411\u5BF9\u8C61\u6539\u8FDB" aria-hidden="true">#</a> \u9762\u5411\u5BF9\u8C61\u6539\u8FDB</h4><p>\u628A\u9700\u8981\u4FDD\u62A4\u7684\u5171\u4EAB\u53D8\u91CF\u653E\u5165\u4E00\u4E2A\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Room</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Room</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span> <span class="token punctuation">,</span> room<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u65B9\u6CD5\u4E0A\u7684-synchronized" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6CD5\u4E0A\u7684-synchronized" aria-hidden="true">#</a> \u65B9\u6CD5\u4E0A\u7684 synchronized</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u7B49\u4EF7\u4E8E</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//------------------------------------------------------------------------------------------------</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7B49\u4EF7\u4E8E</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u4E0D\u52A0-synchronized-\u7684\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u52A0-synchronized-\u7684\u65B9\u6CD5" aria-hidden="true">#</a> \u4E0D\u52A0 synchronized \u7684\u65B9\u6CD5</h5><p>\u4E0D\u52A0 synchronzied \u7684\u65B9\u6CD5\u5C31\u597D\u6BD4\u4E0D\u9075\u5B88\u89C4\u5219\u7684\u4EBA\uFF0C\u4E0D\u53BB\u8001\u5B9E\u6392\u961F\uFF08\u597D\u6BD4\u7FFB\u7A97\u6237\u8FDB\u53BB\u7684\uFF09</p><h5 id="\u6240\u8C13\u7684-\u7EBF\u7A0B\u516B\u9501" tabindex="-1"><a class="header-anchor" href="#\u6240\u8C13\u7684-\u7EBF\u7A0B\u516B\u9501" aria-hidden="true">#</a> \u6240\u8C13\u7684\u201C\u7EBF\u7A0B\u516B\u9501\u201D</h5><p>\u5176\u5B9E\u5C31\u662F\u8003\u5BDF synchronized \u9501\u4F4F\u7684\u662F\u54EA\u4E2A\u5BF9\u8C61 \u60C5\u51B51\uFF1A12 \u6216 21</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B52\uFF1A1s\u540E12\uFF0C\u6216 2 1s\u540E 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B53\uFF1A3 1s 12 \u6216 23 1s 1 \u6216 32 1s 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B54\uFF1A2 1s \u540E 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Number</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n2<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B55\uFF1A2 1s \u540E 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B56\uFF1A1s \u540E 12\uFF0C \u6216 2 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B57\uFF1A2 1s \u540E 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Number</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n2<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u60C5\u51B58\uFF1A1s \u540E 12\uFF0C \u6216 2 1s\u540E 1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Number</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> n2<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4-3-\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" aria-hidden="true">#</a> 4.3 \u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790</h3><h4 id="_4-3-1-\u6210\u5458\u53D8\u91CF\u548C\u9759\u6001\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4-3-1-\u6210\u5458\u53D8\u91CF\u548C\u9759\u6001\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" aria-hidden="true">#</a> 4.3.1 \u6210\u5458\u53D8\u91CF\u548C\u9759\u6001\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u5206\u6790</h4><ul><li>\u5982\u679C\u6CA1\u6709\u53D8\u91CF\u6CA1\u6709\u5728\u7EBF\u7A0B\u95F4\u5171\u4EAB\uFF0C\u90A3\u4E48\u53D8\u91CF\u662F\u5B89\u5168\u7684</li><li>\u5982\u679C\u53D8\u91CF\u5728\u7EBF\u7A0B\u95F4\u5171\u4EAB <ul><li>\u5982\u679C\u53EA\u6709\u8BFB\u64CD\u4F5C\uFF0C\u5219\u7EBF\u7A0B\u5B89\u5168</li><li>\u5982\u679C\u6709\u8BFB\u5199\u64CD\u4F5C\uFF0C\u5219\u8FD9\u6BB5\u4EE3\u7801\u662F\u4E34\u754C\u533A\uFF0C\u9700\u8981\u8003\u8651\u7EBF\u7A0B\u5B89\u5168</li></ul></li></ul><h4 id="_4-3-2-\u5C40\u90E8\u53D8\u91CF\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4-3-2-\u5C40\u90E8\u53D8\u91CF\u7EBF\u7A0B\u5B89\u5168\u5206\u6790" aria-hidden="true">#</a> 4.3.2 \u5C40\u90E8\u53D8\u91CF\u7EBF\u7A0B\u5B89\u5168\u5206\u6790</h4><ul><li>\u5C40\u90E8\u53D8\u91CF\u3010\u5C40\u90E8\u53D8\u91CF\u88AB\u521D\u59CB\u5316\u4E3A\u57FA\u672C\u6570\u636E\u7C7B\u578B\u3011\u662F\u5B89\u5168\u7684</li><li>\u5C40\u90E8\u53D8\u91CF\u5F15\u7528\u7684\u5BF9\u8C61\u672A\u5FC5\u662F\u5B89\u5168\u7684 <ul><li>\u5982\u679C\u5C40\u90E8\u53D8\u91CF\u5F15\u7528\u7684\u5BF9\u8C61\u6CA1\u6709\u5F15\u7528\u7EBF\u7A0B\u5171\u4EAB\u7684\u5BF9\u8C61\uFF0C\u90A3\u4E48\u662F\u7EBF\u7A0B\u5B89\u5168\u7684</li><li>\u5982\u679C\u5C40\u90E8\u53D8\u91CF\u5F15\u7528\u7684\u5BF9\u8C61\u5F15\u7528\u4E86\u4E00\u4E2A\u7EBF\u7A0B\u5171\u4EAB\u7684\u5BF9\u8C61\uFF0C\u90A3\u4E48\u8981\u8003\u8651\u7EBF\u7A0B\u5B89\u5168\u7684</li></ul></li></ul><h5 id="\u7EBF\u7A0B\u5B89\u5168\u7684\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u5B89\u5168\u7684\u60C5\u51B5" aria-hidden="true">#</a> \u7EBF\u7A0B\u5B89\u5168\u7684\u60C5\u51B5</h5><p>\u5C40\u90E8\u53D8\u91CF\u3010\u5C40\u90E8\u53D8\u91CF\u88AB\u521D\u59CB\u5316\u4E3A\u57FA\u672C\u6570\u636E\u7C7B\u578B\u3011\u662F\u5B89\u5168\u7684\uFF0C\u793A\u4F8B\u5982\u4E0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
     i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BCF\u4E2A\u7EBF\u7A0B\u8C03\u7528 test1() \u65B9\u6CD5\u65F6\u5C40\u90E8\u53D8\u91CF i\uFF0C\u4F1A\u5728\u6BCF\u4E2A\u7EBF\u7A0B\u7684\u6808\u5E27\u5185\u5B58\u4E2D\u88AB\u521B\u5EFA\u591A\u4EFD\uFF0C\u56E0\u6B64\u4E0D\u5B58\u5728\u5171\u4EAB</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
		stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
    		<span class="token number">0</span><span class="token operator">:</span> bipush <span class="token number">10</span>
        	<span class="token number">2</span><span class="token operator">:</span> istore_0
            <span class="token number">3</span><span class="token operator">:</span> iinc <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
            <span class="token number">6</span><span class="token operator">:</span> <span class="token keyword">return</span>
        <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
			line <span class="token number">10</span><span class="token operator">:</span> <span class="token number">0</span>
    		line <span class="token number">11</span><span class="token operator">:</span> <span class="token number">3</span>
        	line <span class="token number">12</span><span class="token operator">:</span> <span class="token number">6</span>
        <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
			<span class="token class-name">Start</span> <span class="token class-name">Length</span> <span class="token class-name">Slot</span> <span class="token class-name">Name</span> <span class="token class-name">Signature</span>
    		  <span class="token number">3</span>     <span class="token number">4</span>      <span class="token number">0</span>    i     <span class="token class-name">I</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u56FE</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603991.png" alt="1583587166210"></p><h5 id="\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\u60C5\u51B5" aria-hidden="true">#</a> \u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\u60C5\u51B5</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test15</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UnsafeTest</span> unsafeTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnsafeTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                unsafeTest<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;\u7EBF\u7A0B&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">UnsafeTest</span><span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arrayList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u4E0D\u5B89\u5168\u539F\u56E0\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u5B89\u5168\u539F\u56E0\u5206\u6790" aria-hidden="true">#</a> \u4E0D\u5B89\u5168\u539F\u56E0\u5206\u6790</h6><p>\u65E0\u8BBA\u54EA\u4E2A\u7EBF\u7A0B\u4E2D\u7684 method2 \u548Cmethod3 \u5F15\u7528\u7684\u90FD\u662F\u540C\u4E00\u4E2A\u5BF9\u8C61\u4E2D\u7684 list \u6210\u5458\u53D8\u91CF\uFF1A\u4E00\u4E2A ArrayList \uFF0C\u5728\u6DFB\u52A0\u4E00\u4E2A\u5143\u7D20\u7684\u65F6\u5019\uFF0C\u5B83\u53EF\u80FD\u4F1A\u6709\u4E24\u6B65\u6765\u5B8C\u6210\uFF1A</p><ol><li>\u7B2C\u4E00\u6B65\uFF0C\u5728 arrayList[Size] \u7684\u4F4D\u7F6E\u5B58\u653E\u6B64\u5143\u7D20\uFF1B \u7B2C\u4E8C\u6B65\u589E\u5927 Size \u7684\u503C\u3002</li><li>\u5728\u5355\u7EBF\u7A0B\u8FD0\u884C\u7684\u60C5\u51B5\u4E0B\uFF0C\u5982\u679C Size = 0\uFF0C\u6DFB\u52A0\u4E00\u4E2A\u5143\u7D20\u540E\uFF0C\u6B64\u5143\u7D20\u5728\u4F4D\u7F6E 0\uFF0C\u800C\u4E14 Size=1\uFF1B\u800C\u5982\u679C\u662F\u5728\u591A\u7EBF\u7A0B\u60C5\u4E0B\uFF0C\u6BD4\u5982\u6709\u4E24\u4E2A\u7EBF\u7A0B\uFF0C\u7EBF\u7A0B A \u5148\u5C06\u5143\u7D20\u5B58\u653E\u5728\u4F4D\u7F6E 0\u3002\u4F46\u662F\u6B64\u65F6 CPU \u8C03\u7EBF\u7A0BA\u6682\u505C\uFF0C\u7EBF\u7A0B B \u5F97\u5230\u8FD0\u884C\u7684\u673A\u4F1A\u3002\u7EBF\u7A0BB\u4E5F\u5411\u6B64 ArrayList \u6DFB\u52A0\u5143\u7D20\uFF0C\u56E0\u4E3A\u6B64\u65F6 Size \u4ECD\u7B49\u4E8E 0 \uFF08\u6CE8\u610F\u54E6\uFF0C\u6211\u4EEC\u5047\u8BBE\u7684\u662F\u6DFB\u52A0\u4E00\u4E2A\u5143\u7D20\u662F\u8981\u4E24\u4E2A\u6B65\u9AA4\u54E6\uFF0C\u800C\u7EBF\u7A0BA\u4EC5\u4EC5\u5B8C\u6210\u4E86\u6B65\u9AA41\uFF09\uFF0C\u6240\u4EE5\u7EBF\u7A0BB\u4E5F\u5C06\u5143\u7D20\u5B58\u653E\u5728\u4F4D\u7F6E0\u3002\u7136\u540E\u7EBF\u7A0BA\u548C\u7EBF\u7A0BB\u90FD\u7EE7\u7EED\u8FD0\u884C\uFF0C\u90FD\u589E\u52A0 Size \u7684\u503C\u3002 \u90A3\u597D\uFF0C\u73B0\u5728\u6211\u4EEC\u6765\u770B\u770B ArrayList \u7684\u60C5\u51B5\uFF0C\u5143\u7D20\u5B9E\u9645\u4E0A\u53EA\u6709\u4E00\u4E2A\uFF0C\u5B58\u653E\u5728\u4F4D\u7F6E 0\uFF0C\u800C Size \u5374\u7B49\u4E8E 2\u3002\u8FD9\u5C31\u662F\u201C<strong>\u7EBF\u7A0B\u4E0D\u5B89\u5168</strong>\u201D\u4E86\u3002</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603475.png" alt="1583589268096"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603581.png" alt="1583587571334"></p><h6 id="\u89E3\u51B3\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u89E3\u51B3\u65B9\u6CD5" aria-hidden="true">#</a> \u89E3\u51B3\u65B9\u6CD5</h6><p>\u53EF\u4EE5\u5C06list\u4FEE\u6539\u6210\u5C40\u90E8\u53D8\u91CF\uFF0C\u90A3\u4E48\u5C31\u4E0D\u4F1A\u6709\u4E0A\u8FF0\u95EE\u9898\u4E86</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> safeTest<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">method2</span><span class="token punctuation">(</span>arrayList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method3</span><span class="token punctuation">(</span>arrayList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span> arrayList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span> arrayList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arrayList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u6790\uFF1A</p><ul><li>list \u662F\u5C40\u90E8\u53D8\u91CF\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u8C03\u7528\u65F6\u4F1A\u521B\u5EFA\u5176\u4E0D\u540C\u5B9E\u4F8B\uFF0C\u6CA1\u6709\u5171\u4EAB</li><li>\u800C method2 \u7684\u53C2\u6570\u662F\u4ECE method1 \u4E2D\u4F20\u9012\u8FC7\u6765\u7684\uFF0C\u4E0E method1 \u4E2D\u5F15\u7528\u540C\u4E00\u4E2A\u5BF9\u8C61</li><li>method3 \u7684\u53C2\u6570\u5206\u6790\u4E0E method2 \u76F8\u540C</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209132033390.png" alt="image-20220913203334289"></p><p>\u65B9\u6CD5\u8BBF\u95EE\u4FEE\u9970\u7B26\u5E26\u6765\u7684\u601D\u8003\uFF0C\u5982\u679C\u628A method2 \u548C method3 \u7684\u65B9\u6CD5\u4FEE\u6539\u4E3A public \u4F1A\u4E0D\u4F1A\u5BFC\u81F4\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\uFF1F</p><p>\u60C5\u51B51\uFF1A\u6709\u5176\u5B83\u7EBF\u7A0B\u8C03\u7528 method2 \u548C method3\uFF1B-- \u7EBF\u7A0B\u5B89\u5168(\u5916\u90E8\u4F20\u8FDB\u6765\u7684 list \u4E0E method1 \u4E2D\u7684 list \u5BF9\u8C61\u4E0D\u76F8\u540C)</p><p>\u60C5\u51B52\uFF1A\u5728\u60C5\u51B51 \u7684\u57FA\u7840\u4E0A\uFF0C\u4E3A ThreadSafe \u7C7B\u6DFB\u52A0\u5B50\u7C7B\uFF0C\u5B50\u7C7B\u8986\u76D6 method2 \u6216 method3 \u65B9\u6CD5\uFF0C\u5373\u5982\u4E0B\u6240\u793A\uFF1A-- \u7EBF\u7A0B\u4E0D\u5B89\u5168(list \u5BF9\u8C61\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5171\u4EAB)</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ThreadSafe</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">method2</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ThreadSafeSubClass</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadSafe</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-\u5E38\u89C1\u7EBF\u7A0B\u5B89\u5168\u7C7B" tabindex="-1"><a class="header-anchor" href="#_4-3-3-\u5E38\u89C1\u7EBF\u7A0B\u5B89\u5168\u7C7B" aria-hidden="true">#</a> 4.3.3 \u5E38\u89C1\u7EBF\u7A0B\u5B89\u5168\u7C7B</h4><ol><li>String\uFF08final\u4FEE\u9970\uFF0C\u4E0D\u53EF\u53D8\uFF09</li><li>Integer\uFF08final\u4FEE\u9970\uFF0C\u4E0D\u53EF\u53D8\uFF09</li><li>StringBuffer\uFF08\u65B9\u6CD5\u4E0A\u7528 synchronized \u4FEE\u9970\uFF09</li><li>Random</li><li>Vector</li><li>Hashtable</li><li>java.util.concurrent \u5305\u4E0B\u7684\u7C7B</li></ol><p>\u8FD9\u91CC\u8BF4\u5B83\u4EEC\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u662F\u6307\uFF0C<strong>\u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528\u5B83\u4EEC\u540C\u4E00\u4E2A\u5B9E\u4F8B\u7684\u67D0\u4E2A\u65B9\u6CD5\u65F6\uFF0C\u662F\u7EBF\u7A0B\u5B89\u5168\u7684</strong>\u3002\u4E5F\u53EF\u4EE5\u7406\u89E3\u4E3A\u5B83\u4EEC\u7684\u6BCF\u4E2A\u65B9\u6CD5\u662F\u539F\u5B50\u7684</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hashtable</span> table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
 	table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
 	table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u7EBF\u7A0B\u5B89\u5168\u7C7B\u65B9\u6CD5\u7684\u7EC4\u5408" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u5B89\u5168\u7C7B\u65B9\u6CD5\u7684\u7EC4\u5408" aria-hidden="true">#</a> \u7EBF\u7A0B\u5B89\u5168\u7C7B\u65B9\u6CD5\u7684\u7EC4\u5408</h5><p>\u4F46\u6CE8\u610F\u5B83\u4EEC\u591A\u4E2A\u65B9\u6CD5\u7684\u7EC4\u5408\u4E0D\u662F\u539F\u5B50\u7684\uFF0C\u89C1\u4E0B\u9762\u5206\u6790</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hashtable</span> table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u7EBF\u7A0B1\uFF0C\u7EBF\u7A0B2</span>
<span class="token keyword">if</span><span class="token punctuation">(</span> table<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209132048026.png" alt="image-20220913204851923"></p><h5 id="\u4E0D\u53EF\u53D8\u7C7B\u7684\u7EBF\u7A0B\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u53EF\u53D8\u7C7B\u7684\u7EBF\u7A0B\u5B89\u5168" aria-hidden="true">#</a> \u4E0D\u53EF\u53D8\u7C7B\u7684\u7EBF\u7A0B\u5B89\u5168</h5><p><code>String</code>\u548C<code>Integer</code>\u7C7B\u90FD\u662F\u4E0D\u53EF\u53D8\u7684\u7C7B\uFF0C\u56E0\u4E3A\u5176\u7C7B\u5185\u90E8\u72B6\u6001\u662F\u4E0D\u53EF\u6539\u53D8\u7684\uFF0C\u56E0\u6B64\u5B83\u4EEC\u7684\u65B9\u6CD5\u90FD\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF0C\u6709\u540C\u5B66\u6216\u8BB8\u6709\u7591\u95EE\uFF0C<code>String</code> \u6709 <code>replace</code>\uFF0C<code>substring</code> \u7B49\u65B9\u6CD5\u3010\u53EF\u4EE5\u3011\u6539\u53D8\u503C\u554A\uFF0C\u5176\u5B9E\u8C03\u7528\u8FD9\u4E9B\u65B9\u6CD5\u8FD4\u56DE\u7684\u5DF2\u7ECF\u662F\u4E00\u4E2A <strong>\u65B0\u521B\u5EFA\u7684\u5BF9\u8C61\u4E86</strong>\uFF01</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">substring</span><span class="token punctuation">(</span><span class="token keyword">int</span> beginIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> endIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beginIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StringIndexOutOfBoundsException</span><span class="token punctuation">(</span>beginIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>endIndex <span class="token operator">&gt;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StringIndexOutOfBoundsException</span><span class="token punctuation">(</span>endIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> subLen <span class="token operator">=</span> endIndex <span class="token operator">-</span> beginIndex<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subLen <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StringIndexOutOfBoundsException</span><span class="token punctuation">(</span>subLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>beginIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>endIndex <span class="token operator">==</span> value<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span>
                <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> beginIndex<span class="token punctuation">,</span> subLen<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8FD4\u56DE\u4E86\u65B0\u521B\u5EFA\u7684\u5BF9\u8C61</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u793A\u4F8B\u5206\u6790-\u662F\u5426\u7EBF\u7A0B\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u5206\u6790-\u662F\u5426\u7EBF\u7A0B\u5B89\u5168" aria-hidden="true">#</a> \u793A\u4F8B\u5206\u6790-\u662F\u5426\u7EBF\u7A0B\u5B89\u5168</h5><p>\u5206\u6790\u7EBF\u7A0B\u662F\u5426\u5B89\u5168\uFF0C\u5148\u5BF9\u7C7B\u7684\u6210\u5458\u53D8\u91CF\uFF0C\u7C7B\u53D8\u91CF\uFF0C\u5C40\u90E8\u53D8\u91CF\u8FDB\u884C\u8003\u8651\uFF0C\u5982\u679C\u53D8\u91CF\u4F1A\u5728\u5404\u4E2A\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB\uFF0C\u90A3\u4E48\u5C31\u5F97\u8003\u8651\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\u4E86\uFF0C\u5982\u679C\u53D8\u91CFA\u5F15\u7528\u7684\u662F\u7EBF\u7A0B\u5B89\u5168\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u5E76\u4E14\u53EA\u8C03\u7528\u8BE5\u7EBF\u7A0B\u5B89\u5168\u7C7B\u7684\u4E00\u4E2A\u65B9\u6CD5\uFF0C\u90A3\u4E48\u8BE5\u53D8\u91CFA\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u3002</p><p>\u4F8B1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token class-name">String</span> S1 <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> S2 <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token class-name">Date</span> D1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token keyword">final</span> <span class="token class-name">Date</span> D2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u4E0D\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4F7F\u7528\u4E0A\u8FF0\u53D8\u91CF</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B2</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BB0\u5F55\u8C03\u7528\u6B21\u6570</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">// \u6210\u5458\u53D8\u91CF\uFF0C\u4E0D\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B3</p><p>\u6B64\u7C7B\u4E0D\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF0C<code>MyAspect</code>\u5207\u9762\u7C7B\u53EA\u6709\u4E00\u4E2A\u5B9E\u4F8B\uFF0C\u6210\u5458\u53D8\u91CF <code>start</code> \u4F1A\u88AB\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168\uFF1F</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* *(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* *(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cost time:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B4</p><p>\u6B64\u4F8B\u662F\u5178\u578B\u7684\u4E09\u5C42\u6A21\u578B\u8C03\u7528\uFF0C<code>MyServlet</code> <code>UserServiceImpl</code> <code>UserDaoImpl</code>\u7C7B\u90FD\u53EA\u6709\u4E00\u4E2A\u5B9E\u4F8B\uFF0C<code>UserDaoImpl</code>\u7C7B\u4E2D\u6CA1\u6709\u6210\u5458\u53D8\u91CF\uFF0C<code>update</code>\u65B9\u6CD5\u91CC\u7684\u53D8\u91CF\u5F15\u7528\u7684\u5BF9\u8C61\u4E0D\u662F\u7EBF\u7A0B\u5171\u4EAB\u7684\uFF0C\u6240\u4EE5\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF1B<code>UserServiceImpl</code>\u7C7B\u4E2D\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u5B89\u5168\u7684<code>UserDaoImpl</code>\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u90A3\u4E48<code>UserServiceImpl</code>\u7C7B\u4E5F\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF0C\u540C\u7406 <code>MyServlet</code>\u4E5F\u662F\u7EBF\u7A0B\u5B89\u5168\u7684</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// \u5B89\u5168</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B5</p><p>\u8DDF\u793A\u4F8B\u4E8C\u5927\u4F53\u76F8\u4F3C\uFF0C<code>UserDaoImpl</code>\u7C7B\u4E2D\u6709\u6210\u5458\u53D8\u91CF\uFF0C\u90A3\u4E48\u591A\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u5BF9\u6210\u5458\u53D8\u91CF<code>conn</code> \u540C\u65F6\u8FDB\u884C\u64CD\u4F5C\uFF0C\u6545\u662F\u4E0D\u5B89\u5168\u7684</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B6</p><p>\u8DDF\u793A\u4F8B\u4E09\u5927\u4F53\u76F8\u4F3C\uFF0C<code>UserServiceImpl</code>\u7C7B\u7684update\u65B9\u6CD5\u4E2D UserDao\u662F\u4F5C\u4E3A\u5C40\u90E8\u53D8\u91CF\u5B58\u5728\u7684\uFF0C\u6240\u4EE5\u6BCF\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\u7684\u65F6\u5019\u90FD\u4F1A\u65B0\u5EFA\u6709\u4E00\u4E2A<code>UserDao</code>\u5BF9\u8C61\uFF0C\u65B0\u5EFA\u7684\u5BF9\u8C61\u662F\u7EBF\u7A0B\u72EC\u6709\u7684\uFF0C\u6240\u4EE5\u662F\u7EBF\u7A0B\u5B89\u5168\u7684</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B7</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u662F\u5426\u5B89\u5168</span>
        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
        <span class="token function">foo</span><span class="token punctuation">(</span>sdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span> sdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D foo \u7684\u884C\u4E3A\u662F\u4E0D\u786E\u5B9A\u7684\uFF0C\u53EF\u80FD\u5BFC\u81F4\u4E0D\u5B89\u5168\u7684\u53D1\u751F\uFF0C\u88AB\u79F0\u4E4B\u4E3A<strong>\u5916\u661F\u65B9\u6CD5</strong>\uFF0C\u56E0\u4E3Afoo\u65B9\u6CD5\u53EF\u4EE5\u88AB\u91CD\u5199\uFF0C\u5BFC\u81F4\u7EBF\u7A0B\u4E0D\u5B89\u5168\u3002\u5728String\u7C7B\u4E2D\u5C31\u8003\u8651\u5230\u4E86\u8FD9\u4E00\u70B9\uFF0CString\u7C7B\u58F0\u660E\u4E3A<code>final</code>\uFF0C\u5B50\u7C7B\u4E0D\u80FD\u91CD\u5199\u5B83\u7684\u65B9\u6CD5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span> sdf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> dateStr <span class="token operator">=</span> <span class="token string">&quot;1999-10-11 00:00:00&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>dateStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-\u4E60\u9898\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4-4-\u4E60\u9898\u5206\u6790" aria-hidden="true">#</a> 4.4 \u4E60\u9898\u5206\u6790</h3><h4 id="\u5356\u7968\u7EC3\u4E60" tabindex="-1"><a class="header-anchor" href="#\u5356\u7968\u7EC3\u4E60" aria-hidden="true">#</a> \u5356\u7968\u7EC3\u4E60</h4><p>\u6D4B\u8BD5\u4E0B\u9762\u4EE3\u7801\u662F\u5426\u5B58\u5728\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\uFF0C\u5E76\u5C1D\u8BD5\u6539\u6B63</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExerciseSell</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketWindow</span> ticketWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7528\u6765\u5B58\u50A8\u4E70\u51FA\u53BB\u591A\u5C11\u5F20\u7968</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sellCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5206\u6790\u8FD9\u91CC\u7684\u7ADE\u6001\u6761\u4EF6</span>
                <span class="token keyword">int</span> count <span class="token operator">=</span> ticketWindow<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sellCount<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4E70\u51FA\u53BB\u7684\u7968\u6C42\u548C</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;selled count:{}&quot;</span><span class="token punctuation">,</span>sellCount<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5269\u4F59\u7968\u6570</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;remainder count:{}&quot;</span><span class="token punctuation">,</span> ticketWindow<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Random \u4E3A\u7EBF\u7A0B\u5B89\u5168</span>
    <span class="token keyword">static</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u968F\u673A 1~5</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TicketWindow</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
            <span class="token keyword">return</span> amount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u6D4B\u8BD5\u7684\u65F6\u5019\u62A5\u9519\u4E86</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> /L %n <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,10<span class="token punctuation">)</span> <span class="token keyword">do</span> java -cp <span class="token string">&quot;.;C:\\Users\\manyh\\.m2<span class="token entity" title="\\r">\\r</span>epository<span class="token entity" title="\\c">\\c</span>h\\qos\\logback\\logbackclassic<span class="token entity" title="\\1">\\1</span>.2.3\\logback-classic-1.2.3.jar;C:\\Users\\manyh\\.m2<span class="token entity" title="\\r">\\r</span>epository<span class="token entity" title="\\c">\\c</span>h\\qos\\logback\\logbackcore<span class="token entity" title="\\1">\\1</span>.2.3\\logback-core-1.2.3.jar;C:\\Users\\manyh\\.m2<span class="token entity" title="\\r">\\r</span>epository\\org\\slf4j\\slf4japi<span class="token entity" title="\\1">\\1</span>.7.25\\slf4j-api-1.7.25.jar&quot;</span> cn.itcast.n4.exercise.ExerciseSell
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u4EE3\u7801\u662F\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\uFF0C\u6539\u6B63</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TicketWindow</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// \u52A0\u9501</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
            <span class="token keyword">return</span> amount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8F6C\u8D26\u7EC3\u4E60" tabindex="-1"><a class="header-anchor" href="#\u8F6C\u8D26\u7EC3\u4E60" aria-hidden="true">#</a> \u8F6C\u8D26\u7EC3\u4E60</h4><p>\u6D4B\u8BD5\u4E0B\u9762\u4EE3\u7801\u662F\u5426\u5B58\u5728\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\uFF0C\u5E76\u5C1D\u8BD5\u6539\u6B63</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExerciseTransfer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Account</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                a<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                b<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u770B\u8F6C\u8D262000\u6B21\u540E\u7684\u603B\u91D1\u989D</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;total:{}&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Random \u4E3A\u7EBF\u7A0B\u5B89\u5168</span>
    <span class="token keyword">static</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u968F\u673A 1~100</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> money<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">&gt;</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            target<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\u6539\u6B63\u884C\u4E0D\u884C\uFF0C\u4E3A\u4EC0\u4E48\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">&gt;</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        target<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u53EF\u4EE5\uFF0C\u56E0\u4E3A\u53EA\u9501\u4F4F\u4E86 this \u5BF9\u8C61\uFF0Ctarget \u5BF9\u8C61\u6CA1\u6709\u9501\u4F4F</p><p>\u6539\u6B63</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// \u9501\u4F4F\u7C7B\u5B57\u8282\u7801\u5BF9\u8C61</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">&gt;=</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            target<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-monitor-\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_4-5-monitor-\u6982\u5FF5" aria-hidden="true">#</a> 4.5 Monitor \u6982\u5FF5</h3><h4 id="java-\u5BF9\u8C61\u5934" tabindex="-1"><a class="header-anchor" href="#java-\u5BF9\u8C61\u5934" aria-hidden="true">#</a> Java \u5BF9\u8C61\u5934</h4><p>\u4EE5 32 \u4F4D\u865A\u62DF\u673A\u4E3A\u4F8B,\u666E\u901A\u5BF9\u8C61\u7684\u5BF9\u8C61\u5934\u7ED3\u6784\u5982\u4E0B\uFF0C\u5176\u4E2D\u7684Klass Word\u4E3A\u6307\u9488\uFF0C\u6307\u5411\u5BF9\u5E94\u7684Class\u5BF9\u8C61\uFF1B</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603236.png" alt="1583651065372"></p><p>\u6570\u7EC4\u5BF9\u8C61</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603232.png" alt="1583651088663"></p><p>\u5176\u4E2D Mark Word \u7ED3\u6784\u4E3A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209141436176.png" alt="image-20220914143638078"></p><p>\u6240\u4EE5\u4E00\u4E2A\u5BF9\u8C61\u7684\u7ED3\u6784\u5982\u4E0B\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603792.png" alt="1583678624634"></p><h4 id="monitor-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#monitor-\u539F\u7406" aria-hidden="true">#</a> Monitor \u539F\u7406</h4><p>Monitor\u88AB\u7FFB\u8BD1\u4E3A\u76D1\u89C6\u5668\u6216\u8005\u8BF4\u7BA1\u7A0B</p><p>\u6BCF\u4E2Ajava\u5BF9\u8C61\u90FD\u53EF\u4EE5\u5173\u8054\u4E00\u4E2AMonitor\uFF0C\u5982\u679C\u4F7F\u7528<code>synchronized</code>\u7ED9\u5BF9\u8C61\u4E0A\u9501\uFF08\u91CD\u91CF\u7EA7\uFF09\uFF0C\u8BE5\u5BF9\u8C61\u5934\u7684Mark Word\u4E2D\u5C31\u88AB\u8BBE\u7F6E\u4E3A\u6307\u5411Monitor\u5BF9\u8C61\u7684\u6307\u9488</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603180.png" alt="1583652360228"></p><ul><li>\u521A\u5F00\u59CB\u65F6Monitor\u4E2D\u7684Owner\u4E3Anull</li><li>\u5F53Thread-2 \u6267\u884Csynchronized(obj){}\u4EE3\u7801\u65F6\u5C31\u4F1A\u5C06Monitor\u7684\u6240\u6709\u8005Owner \u8BBE\u7F6E\u4E3A Thread-2\uFF0C\u4E0A\u9501\u6210\u529F\uFF0CMonitor\u4E2D\u540C\u4E00\u65F6\u523B\u53EA\u80FD\u6709\u4E00\u4E2AOwner</li><li>\u5F53Thread-2 \u5360\u636E\u9501\u65F6\uFF0C\u5982\u679C\u7EBF\u7A0BThread-3\uFF0CThread-4\u4E5F\u6765\u6267\u884Csynchronized(obj){}\u4EE3\u7801\uFF0C\u5C31\u4F1A\u8FDB\u5165EntryList\u4E2D\u53D8\u6210BLOCKED\u72B6\u6001</li><li>Thread-2 \u6267\u884C\u5B8C\u540C\u6B65\u4EE3\u7801\u5757\u7684\u5185\u5BB9\uFF0C\u7136\u540E\u5524\u9192 EntryList \u4E2D\u7B49\u5F85\u7684\u7EBF\u7A0B\u6765\u7ADE\u4E89\u9501\uFF0C\u7ADE\u4E89\u65F6\u662F\u975E\u516C\u5E73\u7684</li><li>\u56FE\u4E2D WaitSet \u4E2D\u7684 Thread-0\uFF0CThread-1 \u662F\u4E4B\u524D\u83B7\u5F97\u8FC7\u9501\uFF0C\u4F46\u6761\u4EF6\u4E0D\u6EE1\u8DB3\u8FDB\u5165 WAITING \u72B6\u6001\u7684\u7EBF\u7A0B\uFF0C\u540E\u9762\u8BB2wait-notify \u65F6\u4F1A\u5206\u6790</li></ul><blockquote><p>\u6CE8\u610F\uFF1Asynchronized \u5FC5\u987B\u662F\u8FDB\u5165\u540C\u4E00\u4E2A\u5BF9\u8C61\u7684 monitor \u624D\u6709\u4E0A\u8FF0\u7684\u6548\u679C\u4E0D\u52A0 synchronized \u7684\u5BF9\u8C61\u4E0D\u4F1A\u5173\u8054\u76D1\u89C6\u5668\uFF0C\u4E0D\u9075\u4ECE\u4EE5\u4E0A\u89C4\u5219</p></blockquote><h4 id="synchronized\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#synchronized\u539F\u7406" aria-hidden="true">#</a> synchronized\u539F\u7406</h4><p>\u4EE3\u7801\u5982\u4E0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53CD\u7F16\u8BD1\u540E\u7684\u90E8\u5206\u5B57\u8282\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
<span class="token class-name">Code</span><span class="token operator">:</span>
stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">0</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// &lt;- lock\u5F15\u7528 \uFF08synchronized\u5F00\u59CB\uFF09</span>
<span class="token number">3</span><span class="token operator">:</span> dup
<span class="token number">4</span><span class="token operator">:</span> astore_1 <span class="token comment">// lock\u5F15\u7528 -&gt; slot 1\uFF08\u4E3A\u4E86\u7B49\u4E0B\u91CD\u7F6E MarkWord\uFF09</span>
<span class="token number">5</span><span class="token operator">:</span> monitorenter <span class="token comment">// \u5C06 lock \u5BF9\u8C61 MarkWord \u7F6E\u4E3A Monitor \u6307\u9488</span>
<span class="token number">6</span><span class="token operator">:</span> getstatic ##<span class="token number">3</span> <span class="token comment">// &lt;- i</span>
<span class="token number">9</span><span class="token operator">:</span> iconst_1 <span class="token comment">// \u51C6\u5907\u5E38\u6570 1</span>
<span class="token number">10</span><span class="token operator">:</span> iadd <span class="token comment">// +1</span>
<span class="token number">11</span><span class="token operator">:</span> putstatic ##<span class="token number">3</span> <span class="token comment">// -&gt; i</span>
<span class="token number">14</span><span class="token operator">:</span> aload_1 <span class="token comment">// &lt;- lock\u5F15\u7528</span>
<span class="token number">15</span><span class="token operator">:</span> monitorexit <span class="token comment">// \u5C06 lock \u5BF9\u8C61 MarkWord \u91CD\u7F6E, \u5524\u9192 EntryList</span>
<span class="token number">16</span><span class="token operator">:</span> <span class="token keyword">goto</span> <span class="token number">24</span>
<span class="token number">19</span><span class="token operator">:</span> astore_2 <span class="token comment">// e -&gt; slot 2</span>
<span class="token number">20</span><span class="token operator">:</span> aload_1 <span class="token comment">// &lt;- lock\u5F15\u7528</span>
<span class="token number">21</span><span class="token operator">:</span> monitorexit <span class="token comment">// \u5C06 lock\u5BF9\u8C61 MarkWord \u91CD\u7F6E, \u5524\u9192 EntryList</span>
<span class="token number">22</span><span class="token operator">:</span> aload_2 <span class="token comment">// &lt;- slot 2 (e)</span>
<span class="token number">23</span><span class="token operator">:</span> athrow <span class="token comment">// throw e</span>
<span class="token number">24</span><span class="token operator">:</span> <span class="token keyword">return</span>
<span class="token class-name">Exception</span> table<span class="token operator">:</span>
from <span class="token keyword">to</span> <span class="token namespace">target</span> type
<span class="token number">6</span> <span class="token number">16</span> <span class="token number">19</span> any	 <span class="token comment">// \u76D1\u89C6 6 - 16\u884C\uFF0C\u6709\u5F02\u5E38\u53D1\u751F\uFF0C\u8DF3\u8F6C\u5230 19 \u884C</span>
<span class="token number">19</span> <span class="token number">22</span> <span class="token number">19</span> any
<span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
line <span class="token number">8</span><span class="token operator">:</span> <span class="token number">0</span>
line <span class="token number">9</span><span class="token operator">:</span> <span class="token number">6</span>
line <span class="token number">10</span><span class="token operator">:</span> <span class="token number">14</span>
line <span class="token number">11</span><span class="token operator">:</span> <span class="token number">24</span>
<span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
<span class="token class-name">Start</span> <span class="token class-name">Length</span> <span class="token class-name">Slot</span> <span class="token class-name">Name</span> <span class="token class-name">Signature</span>
<span class="token number">0</span> <span class="token number">25</span> <span class="token number">0</span> args <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">2</span>
frame_type <span class="token operator">=</span> <span class="token number">255</span> <span class="token comment">/* full_frame */</span>
offset_delta <span class="token operator">=</span> <span class="token number">19</span>
locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> <span class="token string">&quot;[Ljava/lang/String;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span> <span class="token punctuation">]</span>
stack <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Throwable</span> <span class="token punctuation">]</span>
frame_type <span class="token operator">=</span> <span class="token number">250</span> <span class="token comment">/* chop */</span>
offset_delta <span class="token operator">=</span> <span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F\uFF1A\u65B9\u6CD5\u7EA7\u522B\u7684 synchronized \u4E0D\u4F1A\u5728\u5B57\u8282\u7801\u6307\u4EE4\u4E2D\u6709\u6240\u4F53\u73B0</p></blockquote><h4 id="\u5C0F\u6545\u4E8B" tabindex="-1"><a class="header-anchor" href="#\u5C0F\u6545\u4E8B" aria-hidden="true">#</a> \u5C0F\u6545\u4E8B</h4><p>\u6545\u4E8B\u89D2\u8272</p><ul><li>\u8001\u738B - JVM</li><li>\u5C0F\u5357 - \u7EBF\u7A0B</li><li>\u5C0F\u5973 - \u7EBF\u7A0B</li><li>\u623F\u95F4 - \u5BF9\u8C61</li><li>\u623F\u95F4\u95E8\u4E0A - \u9632\u76D7\u9501 - Monitor</li><li>\u623F\u95F4\u95E8\u4E0A - \u5C0F\u5357\u4E66\u5305 - \u8F7B\u91CF\u7EA7\u9501</li><li>\u623F\u95F4\u95E8\u4E0A - \u523B\u4E0A\u5C0F\u5357\u5927\u540D - \u504F\u5411\u9501</li><li>\u6279\u91CF\u91CD\u523B\u540D - \u4E00\u4E2A\u7C7B\u7684\u504F\u5411\u9501\u64A4\u9500\u5230\u8FBE 20 \u9608\u503C</li><li>\u4E0D\u80FD\u523B\u540D\u5B57 - \u6279\u91CF\u64A4\u9500\u8BE5\u7C7B\u5BF9\u8C61\u7684\u504F\u5411\u9501\uFF0C\u8BBE\u7F6E\u8BE5\u7C7B\u4E0D\u53EF\u504F\u5411</li></ul><p>\u5C0F\u5357\u8981\u4F7F\u7528\u623F\u95F4\u4FDD\u8BC1\u8BA1\u7B97\u4E0D\u88AB\u5176\u5B83\u4EBA\u5E72\u6270\uFF08\u539F\u5B50\u6027\uFF09\uFF0C\u6700\u521D\uFF0C\u4ED6\u7528\u7684\u662F\u9632\u76D7\u9501\uFF0C\u5F53\u4E0A\u4E0B\u6587\u5207\u6362\u65F6\uFF0C\u9501\u4F4F\u95E8\u3002\u8FD9\u6837\uFF0C\u5373\u4F7F\u4ED6\u79BB\u5F00\u4E86\uFF0C\u522B\u4EBA\u4E5F\u8FDB\u4E0D\u4E86\u95E8\uFF0C\u4ED6\u7684\u5DE5\u4F5C\u5C31\u662F\u5B89\u5168\u7684\u3002</p><p>\u4F46\u662F\uFF0C\u5F88\u591A\u60C5\u51B5\u4E0B\u6CA1\u4EBA\u8DDF\u4ED6\u6765\u7ADE\u4E89\u623F\u95F4\u7684\u4F7F\u7528\u6743\u3002\u5C0F\u5973\u662F\u8981\u7528\u623F\u95F4\uFF0C\u4F46\u4F7F\u7528\u7684\u65F6\u95F4\u4E0A\u662F\u9519\u5F00\u7684\uFF0C\u5C0F\u5357\u767D\u5929\u7528\uFF0C\u5C0F\u5973\u665A\u4E0A\u7528\u3002\u6BCF\u6B21\u4E0A\u9501\u592A\u9EBB\u70E6\u4E86\uFF0C\u6709\u6CA1\u6709\u66F4\u7B80\u5355\u7684\u529E\u6CD5\u5462\uFF1F</p><p>\u5C0F\u5357\u548C\u5C0F\u5973\u5546\u91CF\u4E86\u4E00\u4E0B\uFF0C\u7EA6\u5B9A\u4E0D\u9501\u95E8\u4E86\uFF0C\u800C\u662F\u8C01\u7528\u623F\u95F4\uFF0C\u8C01\u628A\u81EA\u5DF1\u7684\u4E66\u5305\u6302\u5728\u95E8\u53E3\uFF0C\u4F46\u4ED6\u4EEC\u7684\u4E66\u5305\u6837\u5F0F\u90FD\u4E00\u6837\uFF0C\u56E0\u6B64\u6BCF\u6B21\u8FDB\u95E8\u524D\u5F97\u7FFB\u7FFB\u4E66\u5305\uFF0C\u770B\u8BFE\u672C\u662F\u8C01\u7684\uFF0C\u5982\u679C\u662F\u81EA\u5DF1\u7684\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u8FDB\u95E8\uFF0C\u8FD9\u6837\u7701\u7684\u4E0A\u9501\u89E3\u9501\u4E86\u3002\u4E07\u4E00\u4E66\u5305\u4E0D\u662F\u81EA\u5DF1\u7684\uFF0C\u90A3\u4E48\u5C31\u5728\u95E8\u5916\u7B49\uFF0C\u5E76\u901A\u77E5\u5BF9\u65B9\u4E0B\u6B21\u7528\u9501\u95E8\u7684\u65B9\u5F0F\u3002</p><p>\u540E\u6765\uFF0C\u5C0F\u5973\u56DE\u8001\u5BB6\u4E86\uFF0C\u5F88\u957F\u4E00\u6BB5\u65F6\u95F4\u90FD\u4E0D\u4F1A\u7528\u8FD9\u4E2A\u623F\u95F4\u3002\u5C0F\u5357\u6BCF\u6B21\u8FD8\u662F\u6302\u4E66\u5305\uFF0C\u7FFB\u4E66\u5305\uFF0C\u867D\u7136\u6BD4\u9501\u95E8\u7701\u4E8B\u4E86\uFF0C\u4F46\u4ECD\u7136\u89C9\u5F97\u9EBB\u70E6\u3002</p><p>\u4E8E\u662F\uFF0C\u5C0F\u5357\u5E72\u8106\u5728\u95E8\u4E0A\u523B\u4E0A\u4E86\u81EA\u5DF1\u7684\u540D\u5B57\uFF1A\u3010\u5C0F\u5357\u4E13\u5C5E\u623F\u95F4\uFF0C\u5176\u5B83\u4EBA\u52FF\u7528\u3011\uFF0C\u4E0B\u6B21\u6765\u7528\u623F\u95F4\u65F6\uFF0C\u53EA\u8981\u540D\u5B57\u8FD8\u5728\uFF0C\u90A3\u4E48\u8BF4\u660E\u6CA1\u4EBA\u6253\u6270\uFF0C\u8FD8\u662F\u53EF\u4EE5\u5B89\u5168\u5730\u4F7F\u7528\u623F\u95F4\u3002\u5982\u679C\u8FD9\u671F\u95F4\u6709\u5176\u5B83\u4EBA\u8981\u7528\u8FD9\u4E2A\u623F\u95F4\uFF0C\u90A3\u4E48\u7531\u4F7F\u7528\u8005\u5C06\u5C0F\u5357\u523B\u7684\u540D\u5B57\u64E6\u6389\uFF0C\u5347\u7EA7\u4E3A\u6302\u4E66\u5305\u7684\u65B9\u5F0F\u3002</p><p>\u540C\u5B66\u4EEC\u90FD\u653E\u5047\u56DE\u8001\u5BB6\u4E86\uFF0C\u5C0F\u5357\u5C31\u81A8\u80C0\u4E86\uFF0C\u5728 20 \u4E2A\u623F\u95F4\u523B\u4E0A\u4E86\u81EA\u5DF1\u7684\u540D\u5B57\uFF0C\u60F3\u8FDB\u54EA\u4E2A\u8FDB\u54EA\u4E2A\u3002\u540E\u6765\u4ED6\u81EA\u5DF1\u653E\u5047\u56DE\u8001\u5BB6\u4E86\uFF0C\u8FD9\u65F6\u5C0F\u5973\u56DE\u6765\u4E86\uFF08\u5979\u4E5F\u8981\u7528\u8FD9\u4E9B\u623F\u95F4\uFF09\uFF0C\u7ED3\u679C\u5C31\u662F\u5F97\u4E00\u4E2A\u4E2A\u5730\u64E6\u6389\u5C0F\u5357\u523B\u7684\u540D\u5B57\uFF0C\u5347\u7EA7\u4E3A\u6302\u4E66\u5305\u7684\u65B9\u5F0F\u3002\u8001\u738B\u89C9\u5F97\u8FD9\u6210\u672C\u6709\u70B9\u9AD8\uFF0C\u63D0\u51FA\u4E86\u4E00\u79CD\u6279\u91CF\u91CD\u523B\u540D\u7684\u65B9\u6CD5\uFF0C\u4ED6\u8BA9\u5C0F\u5973\u4E0D\u7528\u6302\u4E66\u5305\u4E86\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u95E8\u4E0A\u523B\u4E0A\u81EA\u5DF1\u7684\u540D\u5B57</p><p>\u540E\u6765\uFF0C\u523B\u540D\u7684\u73B0\u8C61\u8D8A\u6765\u8D8A\u9891\u7E41\uFF0C\u8001\u738B\u53D7\u4E0D\u4E86\u4E86\uFF1A\u7B97\u4E86\uFF0C\u8FD9\u4E9B\u623F\u95F4\u90FD\u4E0D\u80FD\u523B\u540D\u4E86\uFF0C\u53EA\u80FD\u6302\u4E66\u5305</p><h4 id="synchronized-\u539F\u7406\u8FDB\u9636" tabindex="-1"><a class="header-anchor" href="#synchronized-\u539F\u7406\u8FDB\u9636" aria-hidden="true">#</a> synchronized \u539F\u7406\u8FDB\u9636</h4><h5 id="\u8F7B\u91CF\u7EA7\u9501" tabindex="-1"><a class="header-anchor" href="#\u8F7B\u91CF\u7EA7\u9501" aria-hidden="true">#</a> \u8F7B\u91CF\u7EA7\u9501</h5><p>\u8F7B\u91CF\u7EA7\u9501\u7684\u4F7F\u7528\u573A\u666F\u662F\uFF1A\u5982\u679C\u4E00\u4E2A\u5BF9\u8C61\u867D\u7136\u6709\u591A\u4E2A\u7EBF\u7A0B\u8981\u5BF9\u5B83\u8FDB\u884C\u52A0\u9501\uFF0C\u4F46\u662F\u52A0\u9501\u7684\u65F6\u95F4\u662F\u9519\u5F00\u7684\uFF08\u4E5F\u5C31\u662F\u6CA1\u6709\u4EBA\u53EF\u4EE5\u7ADE\u4E89\u7684\uFF09\uFF0C\u90A3\u4E48\u53EF\u4EE5\u4F7F\u7528\u8F7B\u91CF\u7EA7\u9501\u6765\u8FDB\u884C\u4F18\u5316\u3002</p><p>\u8F7B\u91CF\u7EA7\u9501\u5BF9\u4F7F\u7528\u8005\u662F\u900F\u660E\u7684\uFF0C\u5373\u8BED\u6CD5\u4ECD\u7136\u662F<code>synchronized</code>\uFF0C\u5047\u8BBE\u6709\u4E24\u4E2A\u65B9\u6CD5\u540C\u6B65\u5757\uFF0C\u5229\u7528\u540C\u4E00\u4E2A\u5BF9\u8C61\u52A0\u9501</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// \u540C\u6B65\u5757 A</span>
         <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// \u540C\u6B65\u5757 B</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u6BCF\u6B21\u6307\u5411\u5230synchronized\u4EE3\u7801\u5757\u65F6\uFF0C\u90FD\u4F1A\u521B\u5EFA\u9501\u8BB0\u5F55\uFF08Lock Record\uFF09\u5BF9\u8C61\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u4F1A\u5305\u62EC\u4E00\u4E2A\u9501\u8BB0\u5F55\u7684\u7ED3\u6784\uFF0C\u9501\u8BB0\u5F55\u5185\u90E8\u53EF\u4EE5\u50A8\u5B58\u5BF9\u8C61\u7684 Mark Word \u548C\u5BF9\u8C61\u5F15\u7528reference</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603792.png" alt="1583755737580"></p></li><li><p>\u8BA9\u9501\u8BB0\u5F55\u4E2D\u7684Object reference\u6307\u5411\u5BF9\u8C61\uFF0C\u5E76\u4E14\u5C1D\u8BD5\u7528cas(compare and sweep\uFF0C\u4FDD\u8BC1\u4E86\u4EA4\u6362\u8FC7\u7A0B\u7684\u539F\u5B50\u6027)\u66FF\u6362Object\u5BF9\u8C61\u7684Mark Word \uFF0C\u5C06Mark Word \u7684\u503C\u5B58\u5165\u9501\u8BB0\u5F55\u4E2D</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603797.png" alt="1583755888236"></p></li><li><p>\u5982\u679Ccas\u66FF\u6362\u6210\u529F\uFF0C\u90A3\u4E48\u5BF9\u8C61\u7684\u5BF9\u8C61\u5934\u50A8\u5B58\u7684\u5C31\u662F <strong>\u9501\u8BB0\u5F55\u7684\u5730\u5740\u548C\u72B6\u600100</strong>\uFF0C\u8868\u793A\u7531\u8BE5\u7EBF\u7A0B\u7ED9\u5BF9\u8C61\u52A0\u9501\uFF0C\u5982\u4E0B\u6240\u793A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603420.png" alt="1583755964276"></p></li><li><p>\u5982\u679Ccas\u5931\u8D25\uFF0C\u6709\u4E24\u79CD\u60C5\u51B5</p><ul><li>\u5982\u679C\u662F\u5176\u5B83\u7EBF\u7A0B\u5DF2\u7ECF\u6301\u6709\u4E86\u8BE5Object\u7684\u8F7B\u91CF\u7EA7\u9501\uFF0C\u90A3\u4E48\u8868\u793A\u6709\u7ADE\u4E89\uFF0C\u5C06\u8FDB\u5165\u9501\u81A8\u80C0\u9636\u6BB5</li><li>\u5982\u679C\u662F\u81EA\u5DF1\u7684\u7EBF\u7A0B\u5DF2\u7ECF\u6267\u884C\u4E86synchronized\u8FDB\u884C\u52A0\u9501\uFF0C\u90A3\u4E48\u90A3\u4E48\u518D\u6DFB\u52A0\u4E00\u6761 Lock Record \u4F5C\u4E3A\u91CD\u5165\u7684\u8BA1\u6570</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209141624899.png" alt="image-20220914162438799"></p></li><li><p>\u5F53\u7EBF\u7A0B\u9000\u51FAsynchronized\u4EE3\u7801\u5757\u7684\u65F6\u5019\uFF0C</p><ul><li>\u5982\u679C\u83B7\u53D6\u7684\u662F\u53D6\u503C\u4E3A null \u7684\u9501\u8BB0\u5F55 \uFF0C\u8868\u793A\u6709\u91CD\u5165\uFF0C\u8FD9\u65F6\u91CD\u7F6E\u9501\u8BB0\u5F55\uFF0C\u8868\u793A\u91CD\u5165\u8BA1\u6570\u51CF\u4E00</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603486.png" alt="1583756357835"></p><ul><li><p>\u5F53\u7EBF\u7A0B\u9000\u51FAsynchronized\u4EE3\u7801\u5757\u7684\u65F6\u5019\uFF0C\u5982\u679C\u83B7\u53D6\u7684\u9501\u8BB0\u5F55\u53D6\u503C\u4E0D\u4E3A null\uFF0C\u90A3\u4E48\u4F7F\u7528cas\u5C06Mark Word\u7684\u503C\u6062\u590D\u7ED9\u5BF9\u8C61</p><ul><li><p>\u6210\u529F\u5219\u89E3\u9501\u6210\u529F</p></li><li><p>\u5931\u8D25\uFF0C\u5219\u8BF4\u660E\u8F7B\u91CF\u7EA7\u9501\u8FDB\u884C\u4E86\u9501\u81A8\u80C0\u6216\u5DF2\u7ECF\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\uFF0C\u8FDB\u5165\u91CD\u91CF\u7EA7\u9501\u89E3\u9501\u6D41\u7A0B</p></li></ul></li></ul></li></ol><h5 id="\u9501\u81A8\u80C0" tabindex="-1"><a class="header-anchor" href="#\u9501\u81A8\u80C0" aria-hidden="true">#</a> \u9501\u81A8\u80C0</h5><p>\u5982\u679C\u5728\u5C1D\u8BD5\u52A0\u8F7B\u91CF\u7EA7\u9501\u7684\u8FC7\u7A0B\u4E2D\uFF0Ccas\u64CD\u4F5C\u65E0\u6CD5\u6210\u529F\uFF0C\u8FD9\u662F\u6709\u4E00\u79CD\u60C5\u51B5\u5C31\u662F\u5176\u5B83\u7EBF\u7A0B\u5DF2\u7ECF\u4E3A\u8FD9\u4E2A\u5BF9\u8C61\u52A0\u4E0A\u4E86\u8F7B\u91CF\u7EA7\u9501\uFF0C\u8FD9\u662F\u5C31\u8981\u8FDB\u884C\u9501\u81A8\u80C0\uFF0C\u5C06\u8F7B\u91CF\u7EA7\u9501\u53D8\u6210\u91CD\u91CF\u7EA7\u9501\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u540C\u6B65\u5757</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u5F53 Thread-1 \u8FDB\u884C\u8F7B\u91CF\u7EA7\u52A0\u9501\u65F6\uFF0CThread-0 \u5DF2\u7ECF\u5BF9\u8BE5\u5BF9\u8C61\u52A0\u4E86\u8F7B\u91CF\u7EA7\u9501</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603111.png" alt="1583757433691"></p></li><li><p>\u8FD9\u65F6 Thread-1 \u52A0\u8F7B\u91CF\u7EA7\u9501\u5931\u8D25\uFF0C\u8FDB\u5165\u9501\u81A8\u80C0\u6D41\u7A0B</p><ul><li><p>\u5373\u4E3AObject\u5BF9\u8C61\u7533\u8BF7Monitor\u9501\uFF0C\u8BA9Object\u6307\u5411\u91CD\u91CF\u7EA7\u9501\u5730\u5740</p></li><li><p>\u7136\u540E\u81EA\u5DF1\u8FDB\u5165Monitor \u7684EntryList \u53D8\u6210BLOCKED\u72B6\u6001</p></li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603143.png" alt="1583757586447"></p></li><li><p>\u5F53Thread-0 \u9000\u51FAsynchronized\u540C\u6B65\u5757\u65F6\uFF0C\u4F7F\u7528cas\u5C06Mark Word\u7684\u503C\u6062\u590D\u7ED9\u5BF9\u8C61\u5934\uFF0C\u5931\u8D25\uFF0C\u90A3\u4E48\u4F1A\u8FDB\u5165\u91CD\u91CF\u7EA7\u9501\u7684\u89E3\u9501\u8FC7\u7A0B\uFF0C\u5373\u6309\u7167Monitor\u7684\u5730\u5740\u627E\u5230Monitor\u5BF9\u8C61\uFF0C\u5C06Owner\u8BBE\u7F6E\u4E3Anull\uFF0C\u5524\u9192EntryList \u4E2D\u7684Thread-1\u7EBF\u7A0B</p></li></ol><h5 id="\u81EA\u65CB\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#\u81EA\u65CB\u4F18\u5316" aria-hidden="true">#</a> \u81EA\u65CB\u4F18\u5316</h5><p>\u91CD\u91CF\u7EA7\u9501\u7ADE\u4E89\u7684\u65F6\u5019\uFF0C\u8FD8\u53EF\u4EE5\u4F7F\u7528\u81EA\u65CB\u6765\u8FDB\u884C\u4F18\u5316\uFF0C<strong>\u5982\u679C\u5F53\u524D\u7EBF\u7A0B\u81EA\u65CB\u6210\u529F\uFF08\u5373\u5728\u81EA\u65CB\u7684\u65F6\u5019\u6301\u9501\u7684\u7EBF\u7A0B\u91CA\u653E\u4E86\u9501\uFF09\uFF0C\u90A3\u4E48\u5F53\u524D\u7EBF\u7A0B\u5C31\u53EF\u4EE5\u4E0D\u7528\u8FDB\u884C\u4E0A\u4E0B\u6587\u5207\u6362\u5C31\u83B7\u5F97\u4E86\u9501</strong></p><ol><li><p>\u81EA\u65CB\u91CD\u8BD5\u6210\u529F\u7684\u60C5\u51B5</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603546.png" alt="1583758113724"></p></li><li><p>\u81EA\u65CB\u91CD\u8BD5\u5931\u8D25\u7684\u60C5\u51B5\uFF0C\u81EA\u65CB\u4E86\u4E00\u5B9A\u6B21\u6570\u8FD8\u662F\u6CA1\u6709\u7B49\u5230\u6301\u9501\u7684\u7EBF\u7A0B\u91CA\u653E\u9501</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603480.png" alt="1583758136650"></p></li></ol><ul><li>\u81EA\u65CB\u4F1A\u5360\u7528 CPU \u65F6\u95F4\uFF0C\u5355\u6838 CPU \u81EA\u65CB\u5C31\u662F\u6D6A\u8D39\uFF0C<strong>\u591A\u6838 CPU \u81EA\u65CB\u624D\u80FD\u53D1\u6325\u4F18\u52BF</strong>\u3002</li><li>\u5728 Java 6 \u4E4B\u540E\u81EA\u65CB\u9501\u662F <strong>\u81EA\u9002\u5E94</strong> \u7684\uFF0C\u6BD4\u5982\u5BF9\u8C61\u521A\u521A\u7684\u4E00\u6B21\u81EA\u65CB\u64CD\u4F5C\u6210\u529F\u8FC7\uFF0C\u90A3\u4E48\u8BA4\u4E3A\u8FD9\u6B21\u81EA\u65CB\u6210\u529F\u7684\u53EF\u80FD\u6027\u4F1A\u9AD8\uFF0C\u5C31\u591A\u81EA\u65CB\u51E0\u6B21\uFF1B\u53CD\u4E4B\uFF0C\u5C31\u5C11\u81EA\u65CB\u751A\u81F3\u4E0D\u81EA\u65CB\uFF0C\u603B\u4E4B\uFF0C\u6BD4\u8F83\u667A\u80FD\u3002</li><li>Java 7 \u4E4B\u540E\u4E0D\u80FD\u63A7\u5236\u662F\u5426\u5F00\u542F\u81EA\u65CB\u529F\u80FD</li></ul><h5 id="\u504F\u5411\u9501" tabindex="-1"><a class="header-anchor" href="#\u504F\u5411\u9501" aria-hidden="true">#</a> \u504F\u5411\u9501</h5><p>\u5728\u8F7B\u91CF\u7EA7\u7684\u9501\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u53D1\u73B0\uFF0C\u5982\u679C\u540C\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u540C\u4E00\u4E2A\u5BF9\u8C61\u8FDB\u884C\u91CD\u5165\u9501\u65F6\uFF0C\u4E5F\u9700\u8981\u6267\u884CCAS\u64CD\u4F5C\uFF0C\u8FD9\u662F\u6709\u70B9\u8017\u65F6\u6EF4\uFF0C\u90A3\u4E48java6\u5F00\u59CB\u5F15\u5165\u4E86\u504F\u5411\u9501\u7684\u4E1C\u4E1C\uFF0C\u53EA\u6709\u7B2C\u4E00\u6B21\u4F7F\u7528CAS\u65F6\u5C06\u5BF9\u8C61\u7684Mark Word\u5934\u8BBE\u7F6E\u4E3A\u5165\u9501\u7EBF\u7A0BID\uFF0C<strong>\u4E4B\u540E\u8FD9\u4E2A\u5165\u9501\u7EBF\u7A0B\u518D\u8FDB\u884C\u91CD\u5165\u9501\u65F6\uFF0C\u53D1\u73B0\u7EBF\u7A0BID\u662F\u81EA\u5DF1\u7684\uFF0C\u90A3\u4E48\u5C31\u4E0D\u7528\u518D\u8FDB\u884CCAS\u4E86</strong>\u3002\u4EE5\u540E\u53EA\u8981\u4E0D\u53D1\u751F\u7ADE\u4E89\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u5C31\u5F52\u8BE5\u7EBF\u7A0B\u6240\u6709</p><p>\u4F8B\u5982\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u540C\u6B65\u5757 A</span>
        <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u540C\u6B65\u5757 B</span>
        <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u540C\u6B65\u5757 C</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209141647199.png" alt="image-20220914164729073"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209141647953.png" alt="image-20220914164734871"></p><h6 id="\u504F\u5411\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u504F\u5411\u72B6\u6001" aria-hidden="true">#</a> \u504F\u5411\u72B6\u6001</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209141704868.png" alt="image-20220914170449748"></p><p>\u4E00\u4E2A\u5BF9\u8C61\u7684\u521B\u5EFA\u8FC7\u7A0B</p><ol><li>\u5982\u679C\u5F00\u542F\u4E86\u504F\u5411\u9501\uFF08\u9ED8\u8BA4\u662F\u5F00\u542F\u7684\uFF09\uFF0C\u90A3\u4E48\u5BF9\u8C61\u521A\u521B\u5EFA\u4E4B\u540E\uFF0CMark Word \u6700\u540E\u4E09\u4F4D\u7684\u503C101\uFF0C\u5E76\u4E14\u8FD9\u662F\u5B83\u7684Thread\uFF0Cepoch\uFF0Cage\u90FD\u662F0\uFF0C\u5728\u52A0\u9501\u7684\u65F6\u5019\u8FDB\u884C\u8BBE\u7F6E\u8FD9\u4E9B\u7684\u503C.</li><li>\u504F\u5411\u9501\u9ED8\u8BA4\u662F\u5EF6\u8FDF\u7684\uFF0C\u4E0D\u4F1A\u5728\u7A0B\u5E8F\u542F\u52A8\u7684\u65F6\u5019\u7ACB\u523B\u751F\u6548\uFF0C\u5982\u679C\u60F3\u907F\u514D\u5EF6\u8FDF\uFF0C\u53EF\u4EE5\u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570\u6765\u7981\u7528\u5EF6\u8FDF\uFF1A<code>-XX:BiasedLockingStartupDelay=0</code>\u6765\u7981\u7528\u5EF6\u8FDF</li><li>\u5982\u679C\u6CA1\u6709\u5F00\u542F\u504F\u5411\u9501\uFF0C\u90A3\u4E48\u5BF9\u8C61\u521B\u5EFA\u540E\uFF0Cmarkword \u503C\u4E3A 0x01 \u5373\u6700\u540E 3 \u4F4D\u4E3A 001\uFF0C\u8FD9\u65F6\u5B83\u7684 hashcode\u3001age \u90FD\u4E3A 0\uFF0C\u7B2C\u4E00\u6B21\u7528\u5230 hashcode \u65F6\u624D\u4F1A\u8D4B\u503C</li></ol><p>\u5BFC\u5165\u4F9D\u8D56</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5DE5\u5177\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JolUtils</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">toPrintableSimple</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getHeader64Bit</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getHeader64Bit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getHeader64Bit</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">VirtualMachine</span> vm <span class="token operator">=</span> VM<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> word <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">toBinary</span><span class="token punctuation">(</span><span class="token punctuation">(</span>word <span class="token operator">&gt;&gt;</span> i <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// very ineffective, so what?</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">toBinary</span><span class="token punctuation">(</span><span class="token keyword">long</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toBinaryString</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> deficit <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">-</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> deficit<span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1\uFF09 \u6D4B\u8BD5\u5EF6\u8FDF\u7279\u6027</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>2\uFF09 \u6D4B\u8BD5\u504F\u5411\u9501</p><p>\u5229\u7528 jol \u7B2C\u4E09\u65B9\u5DE5\u5177\u6765\u67E5\u770B\u5BF9\u8C61\u5934\u4FE1\u606F\uFF08\u6CE8\u610F\u8FD9\u91CC\u6211\u6269\u5C55\u4E86 jol \u8BA9\u5B83\u8F93\u51FA\u66F4\u4E3A\u7B80\u6D01\uFF09</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u524D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u540E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">19</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">33.960</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\u9ED8\u8BA4\u5F00\u542F</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">37.095</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D 
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">11110010</span> <span class="token number">11001011</span> <span class="token number">01001101</span> <span class="token number">00011000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\uFF0C\u8BBE\u7F6E thread id</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">37.095</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u540E
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">11110010</span> <span class="token number">11001011</span> <span class="token number">01001101</span> <span class="token number">00011000</span> <span class="token number">00000101</span> <span class="token comment">// \u4FDD\u7559 thread id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F</p><p>\u5904\u4E8E\u504F\u5411\u9501\u7684\u5BF9\u8C61\u89E3\u9501\u540E\uFF0C\u7EBF\u7A0B id \u4ECD\u5B58\u50A8\u4E8E\u5BF9\u8C61\u5934\u4E2D</p></blockquote><p>3\uFF09\u6D4B\u8BD5\u7981\u7528</p><p>\u5728\u4E0A\u9762\u6D4B\u8BD5\u4EE3\u7801\u8FD0\u884C\u65F6\u5728\u6DFB\u52A0 VM \u53C2\u6570 -XX:-UseBiasedLocking \u7981\u7528\u504F\u5411\u9501</p><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">19</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">37.446</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">40.662</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">10110000</span> <span class="token number">01111100</span> <span class="token number">11101111</span> <span class="token number">11110111</span> <span class="token number">10010000</span> <span class="token comment">// \u8F7B\u91CF\u7EA7\u9501</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">40.662</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u540E 
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4\uFF09\u6D4B\u8BD5 hashCode</p><p>\u6B63\u5E38\u72B6\u6001\u5BF9\u8C61\u4E00\u5F00\u59CB\u662F\u6CA1\u6709 hashCode \u7684\uFF0C\u7B2C\u4E00\u6B21\u8C03\u7528\u624D\u751F\u6210</p><h6 id="\u64A4\u9500\u504F\u5411\u9501-hashcode\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u64A4\u9500\u504F\u5411\u9501-hashcode\u65B9\u6CD5" aria-hidden="true">#</a> \u64A4\u9500\u504F\u5411\u9501-hashcode\u65B9\u6CD5</h6><p>\u6D4B\u8BD5 <code>hashCode</code>\uFF1A\u5F53\u8C03\u7528\u5BF9\u8C61\u7684hashcode\u65B9\u6CD5\u7684\u65F6\u5019\u5C31\u4F1A\u64A4\u9500\u8FD9\u4E2A\u5BF9\u8C61\u7684\u504F\u5411\u9501\uFF0C\u56E0\u4E3A\u4F7F\u7528\u504F\u5411\u9501\u65F6\u6CA1\u6709\u4F4D\u7F6E\u5B58 <code>hashcode</code> \u7684\u503C\u4E86</p><p>\u4E3A\u4EC0\u4E48\u5728 \u8F7B\u91CF\u7EA7\u9501 \u548C \u91CD\u91CF\u7EA7\u9501 \u4E0A\u5C31\u6CA1\u6709\u95EE\u9898\uFF1F</p><ul><li>\u8F7B\u91CF\u7EA7\u9501\u4F1A\u5728 \u9501\u8BB0\u5F55 \u4E2D\u8BB0\u5F55 hashCode</li><li>\u91CD\u91CF\u7EA7\u9501\u4F1A\u5728 Monitor \u4E2D\u8BB0\u5F55 hashCode</li></ul><p>\u6D4B\u8BD5\u4EE3\u7801\u5982\u4E0B\uFF0C\u4F7F\u7528\u865A\u62DF\u673A\u53C2\u6570\uFF0C\u786E\u4FDD\u6211\u4EEC\u7684\u7A0B\u5E8F\u6700\u5F00\u59CB\u4F7F\u7528\u4E86\u504F\u5411\u9501\uFF01\u4F46\u662F\u7ED3\u679C\u663E\u793A\u7A0B\u5E8F\u8FD8\u662F\u4F7F\u7528\u4E86\u8F7B\u91CF\u7EA7\u9501\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4F1A\u7981\u7528\u8FD9\u4E2A\u5BF9\u8C61\u7684\u504F\u5411\u9501</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u524D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u540E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">19</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">06.856</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00100111</span> <span class="token number">00001000</span> <span class="token number">00100111</span> <span class="token number">01000110</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">12.184</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01100110</span> <span class="token number">10000100</span> <span class="token number">10111111</span> <span class="token number">11101111</span> <span class="token number">11010000</span> <span class="token comment">// \u8F7B\u91CF\u7EA7\u9501</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">12.184</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u540E
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00100111</span> <span class="token number">00001000</span> <span class="token number">00100111</span> <span class="token number">01000110</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u64A4\u9500\u504F\u5411\u9501-\u5176\u5B83\u7EBF\u7A0B\u4F7F\u7528\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u64A4\u9500\u504F\u5411\u9501-\u5176\u5B83\u7EBF\u7A0B\u4F7F\u7528\u5BF9\u8C61" aria-hidden="true">#</a> \u64A4\u9500\u504F\u5411\u9501-\u5176\u5B83\u7EBF\u7A0B\u4F7F\u7528\u5BF9\u8C61</h6><p>\u5F53\u6709\u5176\u5B83\u7EBF\u7A0B\u4F7F\u7528\u504F\u5411\u9501\u5BF9\u8C61\u65F6\uFF0C\u4F1A\u5C06\u504F\u5411\u9501\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u524D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u540E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">TestBiased</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">TestBiased</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">TestBiased</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TestBiased</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u7B49\u5F85 t1 \u5524\u9192</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u524D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u540E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">01.180</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\u9ED8\u8BA4\u5F00\u542F</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">04.484</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">01101011</span> <span class="token number">11001000</span> <span class="token number">11001011</span> <span class="token number">10001000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\uFF0C\u8BBE\u7F6E thread id</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">04.484</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u540E
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">01101011</span> <span class="token number">11001000</span> <span class="token number">11001011</span> <span class="token number">10001000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">04.484</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">01101011</span> <span class="token number">11001000</span> <span class="token number">11001011</span> <span class="token number">10001000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">04.485</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01010100</span> <span class="token number">01011111</span> <span class="token number">01111111</span> <span class="token number">11110100</span> <span class="token number">01010000</span> <span class="token comment">// \u504F\u5411\u9501\u64A4\u9500\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">04.485</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u540E
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token comment">// \u6B63\u5E38</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u64A4\u9500-\u8C03\u7528-wait-notify" tabindex="-1"><a class="header-anchor" href="#\u64A4\u9500-\u8C03\u7528-wait-notify" aria-hidden="true">#</a> \u64A4\u9500-\u8C03\u7528 wait/notify</h6><p>\u4F1A\u4F7F\u5BF9\u8C61\u7684\u9501\u53D8\u6210\u91CD\u91CF\u7EA7\u9501\uFF0C\u56E0\u4E3A\u91CD\u91CF\u7EA7\u9501\u624D\u652F\u6301wait/notify\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u524D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized \u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    d<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;notify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                d<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">19</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">29.341</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u524D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\u9ED8\u8BA4\u5F00\u542F</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">32.690</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">synchronized</span> \u4E2D
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10000100</span> <span class="token number">01111000</span> <span class="token number">10100000</span> <span class="token number">10101000</span> <span class="token number">00000101</span> <span class="token comment">// \u504F\u5411\u9501\uFF0C\u8BBE\u7F6E thread id</span>
<span class="token number">19</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">35.351</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> notify
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10000100</span> <span class="token number">01110110</span> <span class="token number">01010101</span> <span class="token number">01111111</span> <span class="token number">10001010</span> <span class="token comment">// \u504F\u5411\u9501\u5347\u7EA7\u4E3A \u91CD\u91CF\u7EA7\u9501</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u6279\u91CF\u91CD\u504F\u5411" tabindex="-1"><a class="header-anchor" href="#\u6279\u91CF\u91CD\u504F\u5411" aria-hidden="true">#</a> \u6279\u91CF\u91CD\u504F\u5411</h6><p>\u5982\u679C\u5BF9\u8C61\u867D\u7136\u88AB\u591A\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u4F46\u6CA1\u6709\u7ADE\u4E89\uFF0C\u8FD9\u65F6\u504F\u5411\u4E86\u7EBF\u7A0B T1 \u7684\u5BF9\u8C61\u4ECD\u6709\u673A\u4F1A\u91CD\u65B0\u504F\u5411 T2\uFF0C\u91CD\u504F\u5411\u4F1A\u91CD\u7F6E\u5BF9\u8C61\u7684 Thread ID</p><p>\u5F53\u64A4\u9500\u504F\u5411\u9501\u9608\u503C <strong>\u8D85\u8FC7 20 \u6B21</strong> \u540E\uFF0Cjvm \u4F1A\u8FD9\u6837\u89C9\u5F97\uFF0C\u6211\u662F\u4E0D\u662F\u504F\u5411\u9519\u4E86\u5462\uFF0C\u4E8E\u662F\u4F1A\u5728\u7ED9\u8FD9\u4E9B\u5BF9\u8C61\u52A0\u9501\u65F6\u91CD\u65B0\u504F\u5411\u81F3\u52A0\u9501\u7EBF\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dog</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u52A0\u504F\u5411\u9501</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    list<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u7B49\u5F85 t1 \u7EBF\u7A0B\u5524\u9192</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;===============&gt; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 20:04:14.183 c.TestBiased [t1] - 19	00000000 00000000 00000010 01100000 11100001 01111100 01001000 00000101</span>
            <span class="token comment">// 20:04:14.187 c.TestBiased [t2] - 19	00000000 00000000 00000010 01100000 11100001 01111100 01001000 00000101</span>
            <span class="token comment">// \u6CE8\u610F\uFF1A\u7EBF\u7A0Bid \u53D1\u751F\u6539\u53D8\uFF0C\u504F\u5411\u9501\u504F\u5411t2</span>
            <span class="token comment">// 20:04:14.187 c.TestBiased [t2] - 19	00000000 00000000 00000010 01100000 11100001 01111100 01010001 00000101</span>
            <span class="token comment">// 20:04:14.187 c.TestBiased [t2] - 19	00000000 00000000 00000010 01100000 11100001 01111100 01010001 00000101</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;=============&gt; \u5F00\u59CB\u6279\u91CF\u91CD\u504F\u5411\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Dog</span> d <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u504F\u5411\u9501\u64A4\u9500\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501\uFF0C\u9608\u503C\u4E3A 20\uFF0C\u4E4B\u540E\u53EF\u91CD\u504F\u5411</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.185</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.185</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.185</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.185</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.186</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01111001</span> <span class="token number">01100101</span> <span class="token number">10001111</span> <span class="token number">11110010</span> <span class="token number">11010000</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> \u5F00\u59CB\u6279\u91CF\u91CD\u504F\u5411\u9501
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span> <span class="token comment">// \u6CE8\u610F\uFF1A\u7EBF\u7A0Bid \u53D1\u751F\u6539\u53D8\uFF0C\u504F\u5411\u9501\u504F\u5411t2</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.187</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01001000</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">14.188</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">01100000</span> <span class="token number">11100001</span> <span class="token number">01111100</span> <span class="token number">01010001</span> <span class="token number">00000101</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u6279\u91CF\u64A4\u9500" tabindex="-1"><a class="header-anchor" href="#\u6279\u91CF\u64A4\u9500" aria-hidden="true">#</a> \u6279\u91CF\u64A4\u9500</h6><p>\u5F53\u64A4\u9500\u504F\u5411\u9501\u9608\u503C\u8D85\u8FC7 40 \u6B21\u540E\uFF0Cjvm \u4F1A\u8FD9\u6837\u89C9\u5F97\uFF0C\u81EA\u5DF1\u786E\u5B9E\u504F\u5411\u9519\u4E86\uFF0C\u6839\u672C\u5C31\u4E0D\u8BE5\u504F\u5411\u3002\u4E8E\u662F\u6574\u4E2A\u7C7B\u7684\u6240\u6709\u5BF9\u8C61\u90FD\u4F1A\u53D8\u4E3A\u4E0D\u53EF\u504F\u5411\u7684\uFF0C\u65B0\u5EFA\u7684\u5BF9\u8C61\u4E5F\u662F\u4E0D\u53EF\u504F\u5411\u7684</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestBiased&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBiased</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6DFB\u52A0\u865A\u62DF\u673A\u53C2\u6570 -XX:BiasedLockingStartupDelay=0</span>
    <span class="token keyword">static</span> <span class="token class-name">Thread</span> t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dog</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> loopNumber <span class="token operator">=</span> <span class="token number">39</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Dog</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u7ED939\u4E2A\u5BF9\u8C61\u52A0\u504F\u5411\u9501</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;===============&gt; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u8FBE\u5230\u9608\u503C 20\uFF0C\u6279\u91CF\u91CD\u504F\u5411 t2</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;============&gt; \u6279\u91CF\u91CD\u504F\u5411 t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Dog</span> d <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u64A4\u9500 t1 \u7EBF\u7A0B\u52A0\u7684\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A \u8F7B\u91CF\u7EA7\u9501</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// t2 \u6267\u884C\u7ED3\u675F\uFF0C\u524D 20 \u4E2A\u5BF9\u8C61\u52A0\u7684\u662F \u8F7B\u91CF\u7EA7\u9501\uFF0C\u540E 19 \u4E2A\u5BF9\u8C61\u52A0\u7684\u662F\u504F\u5411\u9501\uFF0C\u504F\u5411 t2</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;===============&gt; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Dog</span> d <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;============&gt; \u5F00\u59CB\u64A4\u9500\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u524D 20 \u4E2A\u5BF9\u8C61\u5DF2\u7ECF\u662F\u4E0D\u53EF\u504F\u5411\u7684\u4E86\uFF0C\u6240\u4EE5\u52A0\u7684\u662F\u8F7B\u91CF\u7EA7\u9501</span>
                    <span class="token comment">// \u540E 19 \u4E2A\u5BF9\u8C61\u52A0\u7684\u662F \u504F\u5411\u9501\uFF0C\u504F\u5411 t2\uFF0C\u6240\u4EE5\u64A4\u9500\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// t1 \u64A4\u9500\u4E86 19 \u4E2A\uFF0C t2 \u64A4\u9500\u4E86 20 \u4E2A</span>
        <span class="token comment">// \u65B0\u5EFA\u7B2C 40 \u4E2A\u5BF9\u8C61\uFF0C\u662F\u4E0D\u53EF\u504F\u5411\u7684\uFF0C\u8FBE\u5230\u9608\u503C</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u65B0\u5EFA\u7B2C 40 \u4E2A\u5BF9\u8C61\uFF0C\u662F\u4E0D\u53EF\u504F\u5411\u7684 {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">JolUtils</span><span class="token punctuation">.</span><span class="token function">toPrintableSimple</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.374</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.376</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.376</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.376</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.376</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.377</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> \u5F00\u59CB\u64A4\u9500\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.378</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.379</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.380</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.381</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11011111</span> <span class="token number">11110010</span> <span class="token number">00001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> \u8FBE\u5230\u9608\u503C <span class="token number">20</span>\uFF0C\u6279\u91CF\u91CD\u504F\u5411 t2
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.382</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01101000</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> \u5F00\u59CB\u52A0\u8F7B\u91CF\u7EA7\u9501
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.383</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">4</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">6</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">7</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">8</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.384</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">9</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">11</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">12</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.385</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">13</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">14</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">15</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">16</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">17</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">18</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> \u5F00\u59CB\u64A4\u9500\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">19</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">20</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">21</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.386</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">22</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">23</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">25</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">27</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.387</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">28</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">29</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">30</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">31</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">32</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">33</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">34</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">35</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.388</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">36</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">37</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000010</span> <span class="token number">10010101</span> <span class="token number">00000000</span> <span class="token number">10010010</span> <span class="token number">01110001</span> <span class="token number">00000101</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">11000111</span> <span class="token number">01000010</span> <span class="token number">11101111</span> <span class="token number">11101111</span> <span class="token number">10001000</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>t3<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">38</span>	<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
<span class="token number">21</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">02.389</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token operator">-</span> \u8FBE\u5230\u9608\u503C <span class="token number">40</span>\uFF0C\u65B0\u5EFA\u7B2C <span class="token number">40</span> \u4E2A\u5BF9\u8C61\uFF0C\u662F\u4E0D\u53EF\u504F\u5411\u7684 
    								<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> loopNumber <span class="token operator">=</span> <span class="token number">38</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">21</span><span class="token operator">:</span><span class="token number">06</span><span class="token operator">:</span><span class="token number">38.954</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestBiased</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token operator">-</span> \u65B0\u5EFA\u7B2C <span class="token number">39</span> \u4E2A\u5BF9\u8C61 <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000001</span> <span class="token number">00000101</span> <span class="token comment">//\u53EF\u504F\u5411</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,247),k=n("p",null,"\u53C2\u8003\u8D44\u6599",-1),r={href:"https://github.com/farmerjohngit/myblog/issues/12",target:"_blank",rel:"noopener noreferrer"},d=s("https://github.com/farmerjohngit/myblog/issues/12"),m={href:"https://www.cnblogs.com/LemonFive/p/11246086.html",target:"_blank",rel:"noopener noreferrer"},b=s("https://www.cnblogs.com/LemonFive/p/11246086.html"),v={href:"https://www.cnblogs.com/LemonFive/p/11248248.html",target:"_blank",rel:"noopener noreferrer"},g=s("https://www.cnblogs.com/LemonFive/p/11248248.html"),y=t(`<h6 id="\u9501\u6D88\u9664" tabindex="-1"><a class="header-anchor" href="#\u9501\u6D88\u9664" aria-hidden="true">#</a> \u9501\u6D88\u9664</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Fork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@BenchmarkMode</span><span class="token punctuation">(</span><span class="token class-name">Mode<span class="token punctuation">.</span>AverageTime</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Warmup</span><span class="token punctuation">(</span>iterations<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Measurement</span><span class="token punctuation">(</span>iterations<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@OutputTimeUnit</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBenchmark</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Benchmark</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        x<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// JIT \u5373\u65F6\u7F16\u8BD1\u5668\u505A\u4E86\u4F18\u5316</span>
    <span class="token comment">// \u5224\u65AD\u5C40\u90E8\u53D8\u91CF o \u4E0D\u4F1A\u9003\u79BB\u65B9\u6CD5\u7684\u4F5C\u7528\u8303\u56F4\uFF0C\u5373\u4E0D\u4F1A\u88AB\u5171\u4EAB\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u52A0\u9501</span>
    <span class="token annotation punctuation">@Benchmark</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            x<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C <code>java -jar benchmarks.jar</code></p><p>\u5F97\u5230\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Benchmark</span> <span class="token class-name">Mode</span> <span class="token class-name">Samples</span> <span class="token class-name">Score</span> <span class="token class-name">Score</span> error <span class="token class-name">Units</span>
<span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>i<span class="token punctuation">.</span></span>MyBenchmark</span><span class="token punctuation">.</span>a avgt <span class="token number">5</span> <span class="token number">1.542</span> <span class="token number">0.056</span> ns<span class="token operator">/</span>op
<span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>i<span class="token punctuation">.</span></span>MyBenchmark</span><span class="token punctuation">.</span>b avgt <span class="token number">5</span> <span class="token number">1.518</span> <span class="token number">0.091</span> ns<span class="token operator">/</span>op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7981\u7528\u9501\u6D88\u9664 <code>java -XX:-EliminateLocks -jar benchmarks.jar</code></p><p>\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Benchmark</span> <span class="token class-name">Mode</span> <span class="token class-name">Samples</span> <span class="token class-name">Score</span> <span class="token class-name">Score</span> error <span class="token class-name">Units</span>
<span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>i<span class="token punctuation">.</span></span>MyBenchmark</span><span class="token punctuation">.</span>a avgt <span class="token number">5</span> <span class="token number">1.507</span> <span class="token number">0.108</span> ns<span class="token operator">/</span>op
<span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>i<span class="token punctuation">.</span></span>MyBenchmark</span><span class="token punctuation">.</span>b avgt <span class="token number">5</span> <span class="token number">16.976</span> <span class="token number">1.572</span> ns<span class="token operator">/</span>op <span class="token comment">// \u53EF\u4EE5\u770B\u89C1\uFF0C\u52A0\u9501\u7684\u7EBF\u7A0B\u6267\u884C\u65F6\u95F4\u8F83\u957F</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u9501\u7C97\u5316</p><p>\u5BF9\u76F8\u540C\u5BF9\u8C61\u591A\u6B21\u52A0\u9501\uFF0C\u5BFC\u81F4\u7EBF\u7A0B\u53D1\u751F\u591A\u6B21\u91CD\u5165\uFF0C\u53EF\u4EE5\u4F7F\u7528\u9501\u7C97\u5316\u65B9\u5F0F\u6765\u4F18\u5316\uFF0C\u8FD9\u4E0D\u540C\u4E8E\u4E4B\u524D\u8BB2\u7684\u7EC6\u5206\u9501\u7684\u7C92\u5EA6\u3002</p></blockquote><h3 id="_4-6-wait-notify" tabindex="-1"><a class="header-anchor" href="#_4-6-wait-notify" aria-hidden="true">#</a> 4.6 wait &amp; notify</h3><h4 id="_4-6-1-\u5C0F\u6545\u4E8B-\u4E3A\u4EC0\u4E48\u9700\u8981-wait" tabindex="-1"><a class="header-anchor" href="#_4-6-1-\u5C0F\u6545\u4E8B-\u4E3A\u4EC0\u4E48\u9700\u8981-wait" aria-hidden="true">#</a> 4.6.1 \u5C0F\u6545\u4E8B - \u4E3A\u4EC0\u4E48\u9700\u8981 wait</h4><ul><li>\u7531\u4E8E\u6761\u4EF6\u4E0D\u6EE1\u8DB3\uFF0C\u5C0F\u5357\u4E0D\u80FD\u7EE7\u7EED\u8FDB\u884C\u8BA1\u7B97</li><li>\u4F46\u5C0F\u5357\u5982\u679C\u4E00\u76F4\u5360\u7528\u7740\u9501\uFF0C\u5176\u5B83\u4EBA\u5C31\u5F97\u4E00\u76F4\u963B\u585E\uFF0C\u6548\u7387\u592A\u4F4E</li></ul><p>\u200B <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142118635.png" alt="image-20220914211845531"></p><ul><li>\u4E8E\u662F\u8001\u738B\u5355\u5F00\u4E86\u4E00\u95F4\u4F11\u606F\u5BA4\uFF08\u8C03\u7528 wait \u65B9\u6CD5\uFF09\uFF0C\u8BA9\u5C0F\u5357\u5230\u4F11\u606F\u5BA4\uFF08WaitSet\uFF09\u7B49\u7740\u53BB\u4E86\uFF0C\u4F46\u8FD9\u65F6\u9501\u91CA\u653E\u5F00\uFF0C\u5176\u5B83\u4EBA\u53EF\u4EE5\u7531\u8001\u738B\u968F\u673A\u5B89\u6392\u8FDB\u5C4B</li><li>\u76F4\u5230\u5C0FM\u5C06\u70DF\u9001\u6765\uFF0C\u5927\u53EB\u4E00\u58F0 [ \u4F60\u7684\u70DF\u5230\u4E86 ] \uFF08\u8C03\u7528 notify \u65B9\u6CD5\uFF09</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142119683.png" alt="image-20220914211909579"></p><ul><li>\u5C0F\u5357\u4E8E\u662F\u53EF\u4EE5\u79BB\u5F00\u4F11\u606F\u5BA4\uFF0C\u91CD\u65B0\u8FDB\u5165\u7ADE\u4E89\u9501\u7684\u961F\u5217</li></ul><p>\u200B <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142119961.png" alt="image-20220914211936861"></p><h4 id="_4-6-2-wait-notify-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-6-2-wait-notify-\u539F\u7406" aria-hidden="true">#</a> 4.6.2 wait notify \u539F\u7406</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142121779.png" alt="image-20220914212158671"></p><ul><li>Owner \u7EBF\u7A0B\u53D1\u73B0\u6761\u4EF6\u4E0D\u6EE1\u8DB3\uFF0C\u8C03\u7528 wait \u65B9\u6CD5\uFF0C\u5373\u53EF\u8FDB\u5165 WaitSet \u53D8\u4E3A WAITING \u72B6\u6001</li><li>BLOCKED \u548C WAITING \u7684\u7EBF\u7A0B\u90FD\u5904\u4E8E\u963B\u585E\u72B6\u6001\uFF0C\u4E0D\u5360\u7528 CPU \u65F6\u95F4\u7247</li><li>BLOCKED \u7EBF\u7A0B\u4F1A\u5728 Owner \u7EBF\u7A0B\u91CA\u653E\u9501\u65F6\u5524\u9192</li><li>WAITING \u7EBF\u7A0B\u4F1A\u5728 Owner \u7EBF\u7A0B\u8C03\u7528 notify \u6216 notifyAll \u65F6\u5524\u9192\uFF0C\u4F46\u5524\u9192\u540E\u5E76\u4E0D\u610F\u5473\u8005\u7ACB\u523B\u83B7\u5F97\u9501\uFF0C\u4ECD\u9700\u8FDB\u5165 EntryList \u91CD\u65B0\u7ADE\u4E89</li></ul><h4 id="_4-6-3-api-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_4-6-3-api-\u4ECB\u7ECD" aria-hidden="true">#</a> 4.6.3 API \u4ECB\u7ECD</h4><ul><li>obj.wait() \u8BA9\u8FDB\u5165 object \u76D1\u89C6\u5668\u7684\u7EBF\u7A0B\u5230 waitSet \u7B49\u5F85</li><li>obj.notify() \u5728 object \u4E0A\u6B63\u5728 waitSet \u7B49\u5F85\u7684\u7EBF\u7A0B\u4E2D\u6311\u4E00\u4E2A\u5524\u9192</li><li>obj.notifyAll() \u8BA9 object \u4E0A\u6B63\u5728 waitSet \u7B49\u5F85\u7684\u7EBF\u7A0B\u5168\u90E8\u5524\u9192</li></ul><p>\u5B83\u4EEC\u90FD\u662F\u7EBF\u7A0B\u4E4B\u95F4\u8FDB\u884C\u534F\u4F5C\u7684\u624B\u6BB5\uFF0C\u90FD\u5C5E\u4E8E Object \u5BF9\u8C61\u7684\u65B9\u6CD5\u3002<strong>\u5FC5\u987B\u83B7\u5F97\u6B64\u5BF9\u8C61\u7684\u9501\uFF0C\u624D\u80FD\u8C03\u7528\u8FD9\u51E0\u4E2A\u65B9\u6CD5</strong></p><p>\u6CA1\u6709\u83B7\u53D6\u9501\u8C03\u7528</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test03</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u62A5\u9519</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142133405.png" alt="image-20220914213323301"></p><h5 id="notify-\u548C-notifyall-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#notify-\u548C-notifyall-\u7684\u533A\u522B" aria-hidden="true">#</a> notify() \u548C notifyAll() \u7684\u533A\u522B</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8BA9\u7EBF\u7A0B\u5728obj\u4E0A\u4E00\u76F4\u7B49\u5F85\u4E0B\u53BB</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5176\u5B83\u4EE3\u7801....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8BA9\u7EBF\u7A0B\u5728obj\u4E0A\u4E00\u76F4\u7B49\u5F85\u4E0B\u53BB</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5176\u5B83\u4EE3\u7801....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4E3B\u7EBF\u7A0B\u4E24\u79D2\u540E\u6267\u884C</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5524\u9192 obj \u4E0A\u5176\u5B83\u7EBF\u7A0B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5524\u9192obj\u4E0A\u4E00\u4E2A\u7EBF\u7A0B</span>
            <span class="token comment">// obj.notifyAll(); // \u5524\u9192obj\u4E0A\u6240\u6709\u7B49\u5F85\u7EBF\u7A0B</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>notify()\uFF1A\u53EA\u5524\u9192\u5176\u4E2D\u4E00\u4E2A\u7EBF\u7A0B</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142135223.png" alt="image-20220914213554118"></p><p>notifyAll()\uFF1A\u5524\u9192\u5168\u90E8\u7684\u7EBF\u7A0B</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209142136223.png" alt="image-20220914213644126"></p><h5 id="wait-\u548C-wait-long-timeout-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#wait-\u548C-wait-long-timeout-\u7684\u533A\u522B" aria-hidden="true">#</a> wait() \u548C wait(long timeout) \u7684\u533A\u522B</h5><ul><li>wait() \u4F1A\u65E0\u9650\u7B49\u5F85\u76F4\u5230\u88AB\u5524\u9192</li><li>wait(long timeout) \u5728 timeout \u65F6\u95F4\u5185\u6CA1\u6709\u88AB\u5524\u9192\u7684\u8BDD\u4F1A\u88AB\u81EA\u52A8\u5524\u9192</li></ul><h4 id="_4-6-4-wait-notify-\u7684\u6B63\u786E\u59FF\u52BF" tabindex="-1"><a class="header-anchor" href="#_4-6-4-wait-notify-\u7684\u6B63\u786E\u59FF\u52BF" aria-hidden="true">#</a> 4.6.4 wait notify \u7684\u6B63\u786E\u59FF\u52BF</h4><h5 id="sleep-long-n-\u548C-wait-long-n-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#sleep-long-n-\u548C-wait-long-n-\u7684\u533A\u522B" aria-hidden="true">#</a> sleep(long n) \u548C wait(long n) \u7684\u533A\u522B</h5><ol><li>sleep\u662FThread\u65B9\u6CD5\uFF0C\u800Cwait\u662FObject\u7684\u65B9\u6CD5</li><li>sleep\u4E0D\u9700\u8981\u5F3A\u5236\u548Csynchronize\u914D\u5408\u4F7F\u7528\uFF0C\u4F46wait\u9700\u8981\u548Csynchronize\u4E00\u8D77\u7528</li><li><strong>sleep\u5728\u7761\u7720\u7684\u540C\u65F6\uFF0C\u4E0D\u4F1A\u91CA\u653E\u5BF9\u8C61\u9501\u7684\uFF0C\u4F46wait\u5728\u7B49\u5F85\u7684\u65F6\u5019\u4F1A\u91CA\u653E\u5BF9\u8C61\u9501</strong></li><li>\u4ED6\u4EEC\u7684\u72B6\u6001\u90FD\u662F <code>TIMED_WAITING</code></li></ol><h5 id="step-1" tabindex="-1"><a class="header-anchor" href="#step-1" aria-hidden="true">#</a> step 1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">boolean</span> hasTakeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u601D\u8003\u4E0B\u9762\u7684\u89E3\u51B3\u65B9\u6848\u597D\u4E0D\u597D\uFF0C\u4E3A\u4EC0\u4E48\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5357&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5176\u5B83\u4EBA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8FD9\u91CC\u80FD\u4E0D\u80FD\u52A0 synchronized (room)\uFF1F</span>
    hasCigarette <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u70DF\u5230\u4E86\u5662\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u70DF\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">49.883</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">49.887</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">50.882</span> <span class="token punctuation">[</span>\u9001\u70DF\u7684<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u70DF\u5230\u4E86\u5662\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.887</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.887</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.887</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.887</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.888</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.888</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">51.888</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5176\u5B83\u5E72\u6D3B\u7684\u7EBF\u7A0B\uFF0C\u90FD\u8981\u4E00\u76F4\u963B\u585E\uFF0C\u6548\u7387\u592A\u4F4E</li><li>\u5C0F\u5357\u7EBF\u7A0B\u5FC5\u987B\u7761\u8DB3 2s \u540E\u624D\u80FD\u9192\u6765\uFF0C\u5C31\u7B97\u70DF\u63D0\u524D\u9001\u5230\uFF0C\u4E5F\u65E0\u6CD5\u7ACB\u523B\u9192\u6765</li><li>\u52A0\u4E86 synchronized (room) \u540E\uFF0C\u5C31\u597D\u6BD4\u5C0F\u5357\u5728\u91CC\u9762\u53CD\u9501\u4E86\u95E8\u7761\u89C9\uFF0C\u70DF\u6839\u672C\u6CA1\u6CD5\u9001\u8FDB\u95E8\uFF0Cmain \u6CA1\u52A0 synchronized \u5C31\u597D\u50CF main \u7EBF\u7A0B\u662F\u7FFB\u7A97\u6237\u8FDB\u6765\u7684</li><li>\u89E3\u51B3\u65B9\u6CD5\uFF0C\u4F7F\u7528 wait - notify \u673A\u5236</li></ul><h5 id="step-2" tabindex="-1"><a class="header-anchor" href="#step-2" aria-hidden="true">#</a> step 2</h5><p>\u601D\u8003\u4E0B\u9762\u7684\u5B9E\u73B0\u884C\u5417\uFF0C\u4E3A\u4EC0\u4E48\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5357&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5176\u5B83\u4EBA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hasCigarette <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u70DF\u5230\u4E86\u5662\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        room<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u70DF\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.489</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.493</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.493</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.493</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.494</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.494</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">42.494</span> <span class="token punctuation">[</span>\u5176\u5B83\u4EBA<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">43.490</span> <span class="token punctuation">[</span>\u9001\u70DF\u7684<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u70DF\u5230\u4E86\u5662\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">43.490</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">43.490</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u89E3\u51B3\u4E86\u5176\u5B83\u5E72\u6D3B\u7684\u7EBF\u7A0B\u963B\u585E\u7684\u95EE\u9898</li><li>\u4F46\u5982\u679C\u6709\u5176\u5B83\u7EBF\u7A0B\u4E5F\u5728\u7B49\u5F85\u6761\u4EF6\u5462\uFF1F</li></ul><h5 id="step-3" tabindex="-1"><a class="header-anchor" href="#step-3" aria-hidden="true">#</a> step 3</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u5E72\u6210\u6D3B...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5357&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5916\u5356\u9001\u5230\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u5916\u5356\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5916\u5356\u9001\u5230\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u5E72\u6210\u6D3B...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5973&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hasTakeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5916\u5356\u5230\u4E86\u5662\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        room<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u5916\u5356\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">12.173</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">12.176</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">12.176</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u9001\u5230\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">12.176</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u5916\u5356\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">13.174</span> <span class="token punctuation">[</span>\u9001\u5916\u5356\u7684<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u5230\u4E86\u5662\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">13.174</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">13.174</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u5E72\u6210\u6D3B<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>notify \u53EA\u80FD\u968F\u673A\u5524\u9192\u4E00\u4E2A WaitSet \u4E2D\u7684\u7EBF\u7A0B\uFF0C\u8FD9\u65F6\u5982\u679C\u6709\u5176\u5B83\u7EBF\u7A0B\u4E5F\u5728\u7B49\u5F85\uFF0C\u90A3\u4E48\u5C31\u53EF\u80FD\u5524\u9192\u4E0D\u4E86\u6B63\u786E\u7684\u7EBF\u7A0B\uFF0C\u79F0\u4E4B\u4E3A\u3010<strong>\u865A\u5047\u5524\u9192</strong>\u3011</li><li>\u89E3\u51B3\u65B9\u6CD5\uFF0C\u6539\u4E3A notifyAll</li></ul><h5 id="step-4" tabindex="-1"><a class="header-anchor" href="#step-4" aria-hidden="true">#</a> step 4</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hasTakeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5916\u5356\u5230\u4E86\u5662\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        room<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u5916\u5356\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">23.978</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">23.982</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">23.982</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u9001\u5230\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">23.982</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u5916\u5356\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">24.979</span> <span class="token punctuation">[</span>\u9001\u5916\u5356\u7684<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u5230\u4E86\u5662\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">24.979</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u9001\u5230\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">24.980</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">24.980</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">24.980</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u5E72\u6210\u6D3B<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u7528 notifyAll \u4EC5\u89E3\u51B3\u67D0\u4E2A\u7EBF\u7A0B\u7684\u5524\u9192\u95EE\u9898\uFF0C\u4F46\u4F7F\u7528 if + wait \u5224\u65AD\u4EC5\u6709\u4E00\u6B21\u673A\u4F1A\uFF0C\u4E00\u65E6\u6761\u4EF6\u4E0D\u6210\u7ACB\uFF0C\u5C31\u6CA1\u6709\u91CD\u65B0\u5224\u65AD\u7684\u673A\u4F1A\u4E86</li><li>\u89E3\u51B3\u65B9\u6CD5\uFF0C\u7528 while + wait\uFF0C\u5F53\u6761\u4EF6\u4E0D\u6210\u7ACB\uFF0C\u518D\u6B21 wait</li></ul><h5 id="step-5" tabindex="-1"><a class="header-anchor" href="#step-5" aria-hidden="true">#</a> step 5</h5><p>\u5C06 if \u6539\u4E3A while</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6539\u52A8\u540E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">34.322</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6709\u70DF\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">34.326</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">34.326</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u9001\u5230\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">34.326</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u5916\u5356\uFF0C\u5148\u6B47\u4F1A\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">35.323</span> <span class="token punctuation">[</span>\u9001\u5916\u5356\u7684<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u5230\u4E86\u5662\uFF01
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">35.324</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u5916\u5356\u9001\u5230\u6CA1\uFF1F<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span>
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">35.324</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86
<span class="token number">20</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">35.324</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestCorrectPosture</span> <span class="token operator">-</span> \u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01

<span class="token comment">// \u7A0B\u5E8F\u7EE7\u7EED\u6267\u884C\uFF0Cwait()\u7B49\u5F85</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>\u6761\u4EF6\u4E0D\u6210\u7ACB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u5E72\u6D3B</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u53E6\u4E00\u4E2A\u7EBF\u7A0B</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u540C\u6B65\u6A21\u5F0F\u4E4B\u4FDD\u62A4\u6027\u6682\u505C" tabindex="-1"><a class="header-anchor" href="#\u540C\u6B65\u6A21\u5F0F\u4E4B\u4FDD\u62A4\u6027\u6682\u505C" aria-hidden="true">#</a> \u540C\u6B65\u6A21\u5F0F\u4E4B\u4FDD\u62A4\u6027\u6682\u505C</h5><h6 id="_1-\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_1-\u5B9A\u4E49" aria-hidden="true">#</a> 1.\u5B9A\u4E49</h6><p>\u5373 Guarded Suspension\uFF0C<strong>\u7528\u5728\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u7ED3\u679C</strong>\uFF0C\u8981\u70B9\uFF1A</p><ol><li>\u6709\u4E00\u4E2A\u7ED3\u679C\u9700\u8981\u4ECE\u4E00\u4E2A\u7EBF\u7A0B\u4F20\u9012\u5230\u53E6\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u8BA9\u4ED6\u4EEC\u5173\u8054\u540C\u4E00\u4E2A GuardedObject</li><li>\u5982\u679C\u6709\u7ED3\u679C\u4E0D\u65AD\u4ECE\u4E00\u4E2A\u7EBF\u7A0B\u5230\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u90A3\u4E48\u53EF\u4EE5\u4F7F\u7528\u6D88\u606F\u961F\u5217\uFF08\u89C1\u751F\u4EA7\u8005/\u6D88\u8D39\u8005\uFF09</li><li>JDK \u4E2D\uFF0Cjoin \u7684\u5B9E\u73B0\u3001Future \u7684\u5B9E\u73B0\uFF0C\u91C7\u7528\u7684\u5C31\u662F\u6B64\u6A21\u5F0F</li><li>\u56E0\u4E3A\u8981\u7B49\u5F85\u53E6\u4E00\u65B9\u7684\u7ED3\u679C\uFF0C\u56E0\u6B64\u5F52\u7C7B\u5230\u540C\u6B65\u6A21\u5F0F</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603481.png" alt="1594473284105"></p><h6 id="_2-\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-\u5B9E\u73B0" aria-hidden="true">#</a> 2.\u5B9E\u73B0</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test04&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test04</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B49\u5F85\u7ED3\u679C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> guardedObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ED3\u679C\u7684\u5927\u5C0F{}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E0B\u8F7D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Downloader</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                guardedObject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GuardedObject</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7ED3\u679C</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> response<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u4F7F\u7528 while \u907F\u514D\u865A\u5047\u5524\u9192</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>response <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4EA7\u751F\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">Object</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151424643.png" alt="image-20220915142415544"></p><blockquote><p>\u4F7F\u7528 join() \u4E5F\u53EF\u4EE5\u8FBE\u5230\u76F8\u540C\u7684\u6548\u679C\uFF0C\u4E3A\u4EC0\u4E48\u8981\u7528 \u4FDD\u62A4\u5F0F\u6682\u505C \u5462\uFF1F</p><p>1.\u4F7F\u7528 join() \u5FC5\u987B\u7B49\u5F85 t2 \u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\uFF0C\u800C t2 \u7EBF\u7A0B\u5728\u6267\u884C\u5B8C\u4E0B\u8F7D\u540E\u53EF\u4EE5\u505A\u5176\u4ED6\u4E8B\u60C5\uFF0C\u4E0D\u4E00\u5B9A\u4F1A\u7ACB\u9A6C\u7ED3\u675F\uFF0C\u4FDD\u62A4\u5F0F\u6682\u505C\u53EF\u4EE5\u5728\u4E0B\u8F7D\u5B8C\u6210\u540E\u7ACB\u523B\u5524\u9192 t1</p><p>2.\u4F7F\u7528 join() \u7684\u8BDD\u7ED3\u679C response \u5FC5\u987B\u662F \u5168\u5C40\u5171\u4EAB\u7684\uFF0C\u800C\u4F7F\u7528 \u4FDD\u62A4\u5F0F\u6682\u505C <strong>\u53EF\u4EE5\u4F7F\u7528\u5C40\u90E8\u53D8\u91CF</strong>\u3002</p></blockquote><h6 id="_3-\u5E26\u8D85\u65F6\u7248-guardedobject" tabindex="-1"><a class="header-anchor" href="#_3-\u5E26\u8D85\u65F6\u7248-guardedobject" aria-hidden="true">#</a> 3.\u5E26\u8D85\u65F6\u7248 GuardedObject</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6DFB\u52A0\u8D85\u65F6\u6548\u679C</span>
<span class="token keyword">class</span> <span class="token class-name">GuardedObject</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7ED3\u679C</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> response<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15:00:00</span>
            <span class="token comment">// \u7ECF\u5386\u7684\u65F6\u95F4</span>
            <span class="token keyword">long</span> passedTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4F7F\u7528 while \u907F\u514D\u865A\u5047\u5524\u9192</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>response <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> waitTime <span class="token operator">=</span> timeout <span class="token operator">-</span> passedTime<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>waitTime <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15:00:01 \u865A\u5047\u5524\u9192</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                passedTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">;</span> <span class="token comment">// 15:00:02</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4EA7\u751F\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">Object</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\u6CA1\u6709\u8D85\u65F6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test04&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test04</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B49\u5F85\u7ED3\u679C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> response <span class="token operator">=</span> guardedObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ED3\u679C\u662F{}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E0B\u8F7D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            guardedObject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A1s \u4E4B\u540E\u4E0B\u8F7D\u5B8C\u6BD5</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151446363.png" alt="image-20220915144629261"></p><p>\u6D4B\u8BD5\u8D85\u65F6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test04&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test04</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B49\u5F85\u7ED3\u679C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> response <span class="token operator">=</span> guardedObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ED3\u679C\u662F{}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E0B\u8F7D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            guardedObject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A2s\u4E4B\u540E\u8D85\u65F6\u8FD4\u56DE</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151448092.png" alt="image-20220915144815001"></p><p>\u6D4B\u8BD5\u865A\u5047\u5524\u9192</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test04</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B49\u5F85\u7ED3\u679C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> response <span class="token operator">=</span> guardedObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ED3\u679C\u662F{}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E0B\u8F7D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            guardedObject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A2s\u4E4B\u540E\u8D85\u65F6\u8FD4\u56DE</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151454387.png" alt="image-20220915145419296"></p><h6 id="_4-join-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-join-\u539F\u7406" aria-hidden="true">#</a> 4.join \u539F\u7406</h6><ul><li>GuardedObject\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u4E0D\u9700\u8981\u7ED3\u675F</li><li>join()\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u7ED3\u675F</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token function">join</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// \u4E0D\u5408\u6CD5\u7684\u65F6\u95F4</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u4E00\u76F4\u7B49\u5F85</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8D85\u65F6\u7248 GuardedObject</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_5-\u591A\u4EFB\u52A1\u7248-guardedobject" tabindex="-1"><a class="header-anchor" href="#_5-\u591A\u4EFB\u52A1\u7248-guardedobject" aria-hidden="true">#</a> 5.\u591A\u4EFB\u52A1\u7248 GuardedObject</h6><p>\u56FE\u4E2D Futures \u5C31\u597D\u6BD4\u5C45\u6C11\u697C\u4E00\u5C42\u7684\u4FE1\u7BB1\uFF08\u6BCF\u4E2A\u4FE1\u7BB1\u6709\u623F\u95F4\u7F16\u53F7\uFF09\uFF0C\u5DE6\u4FA7\u7684 t0\uFF0Ct2\uFF0Ct4 \u5C31\u597D\u6BD4\u7B49\u5F85\u90AE\u4EF6\u7684\u5C45\u6C11\uFF0C\u53F3\u4FA7\u7684 t1\uFF0Ct3\uFF0Ct5 \u5C31\u597D\u6BD4\u90AE\u9012\u5458</p><p>\u5982\u679C\u9700\u8981\u5728\u591A\u4E2A\u7C7B\u4E4B\u95F4\u4F7F\u7528 GuardedObject \u5BF9\u8C61\uFF0C\u4F5C\u4E3A\u53C2\u6570\u4F20\u9012\u4E0D\u662F\u5F88\u65B9\u4FBF\uFF0C\u56E0\u6B64\u8BBE\u8BA1\u4E00\u4E2A\u7528\u6765\u89E3\u8026\u7684\u4E2D\u95F4\u7C7B\uFF0C\u8FD9\u6837\u4E0D\u4EC5\u80FD\u591F\u89E3\u8026\u3010\u7ED3\u679C\u7B49\u5F85\u8005\u3011\u548C\u3010\u7ED3\u679C\u751F\u4EA7\u8005\u3011\uFF0C\u8FD8\u80FD\u591F\u540C\u65F6\u652F\u6301\u591A\u4E2A\u4EFB\u52A1\u7684\u7BA1\u7406\u3002</p><p>\u548C\u751F\u4EA7\u8005\u6D88\u8D39\u8005\u6A21\u5F0F\u7684\u533A\u522B\u5C31\u662F\uFF1A\u8FD9\u4E2A\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u4E4B\u95F4\u662F\u4E00\u4E00\u5BF9\u5E94\u7684\u5173\u7CFB\uFF0C\u4F46\u662F\u751F\u4EA7\u8005\u6D88\u8D39\u8005\u6A21\u5F0F\u5E76\u4E0D\u662F\u3002rpc\u6846\u67B6\u7684\u8C03\u7528\u4E2D\u5C31\u4F7F\u7528\u5230\u4E86\u8FD9\u79CD\u6A21\u5F0F\u3002</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603565.png" alt="1594518049426"></p><p>\u65B0\u589E id \u7528\u6765\u6807\u8BC6 Guarded Object</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6DFB\u52A0\u8D85\u65F6\u6548\u679C</span>
<span class="token keyword">class</span> <span class="token class-name">GuardedObject</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u6807\u8BC6 GuardedObject</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token comment">// \u7ED3\u679C</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> response<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u83B7\u53D6\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15:00:00</span>
            <span class="token comment">// \u7ECF\u5386\u7684\u65F6\u95F4</span>
            <span class="token keyword">long</span> passedTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4F7F\u7528 while \u907F\u514D\u865A\u5047\u5524\u9192</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>response <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> waitTime <span class="token operator">=</span> timeout <span class="token operator">-</span> passedTime<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>waitTime <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15:00:01 \u865A\u5047\u5524\u9192</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                passedTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">;</span> <span class="token comment">// 15:00:02</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4EA7\u751F\u7ED3\u679C</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">Object</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E2D\u95F4\u89E3\u8026\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Mailboxes</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7EBF\u7A0B\u5B89\u5168</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// \u52A0\u9501\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">GuardedObject</span> <span class="token function">getGuardedObject</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u53EA\u4F7F\u7528\u4E00\u6B21</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">GuardedObject</span> <span class="token function">createGuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuardedObject</span><span class="token punctuation">(</span><span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>guardedObject<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> guardedObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> guardedObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E1A\u52A1\u76F8\u5173\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token class-name">Mailboxes</span><span class="token punctuation">.</span><span class="token function">createGuardedObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F00\u59CB\u6536\u4FE1 id {}&quot;</span><span class="token punctuation">,</span> guardedObject<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> mail <span class="token operator">=</span> guardedObject<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6536\u5230\u4FE1 id {}\uFF0Cmail {}&quot;</span><span class="token punctuation">,</span> guardedObject<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mail<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Postman&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Postman</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mail<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Postman</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> mail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mail <span class="token operator">=</span> mail<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GuardedObject</span> guardedObject <span class="token operator">=</span> <span class="token class-name">Mailboxes</span><span class="token punctuation">.</span><span class="token function">getGuardedObject</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u9001\u4FE1 id{} \u5185\u5BB9{}&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> mail<span class="token punctuation">)</span><span class="token punctuation">;</span>
        guardedObject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test04&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test04</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> id <span class="token operator">:</span> <span class="token class-name">Mailboxes</span><span class="token punctuation">.</span><span class="token function">getIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Postman</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;\u5185\u5BB9&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p>\u200B <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151548895.png" alt="image-20220915154825762"></p><h5 id="\u5F02\u6B65\u6A21\u5F0F\u4E4B\u751F\u4EA7\u8005-\u6D88\u8D39\u8005" tabindex="-1"><a class="header-anchor" href="#\u5F02\u6B65\u6A21\u5F0F\u4E4B\u751F\u4EA7\u8005-\u6D88\u8D39\u8005" aria-hidden="true">#</a> \u5F02\u6B65\u6A21\u5F0F\u4E4B\u751F\u4EA7\u8005/\u6D88\u8D39\u8005</h5><h6 id="_1-\u5B9A\u4E49-1" tabindex="-1"><a class="header-anchor" href="#_1-\u5B9A\u4E49-1" aria-hidden="true">#</a> 1.\u5B9A\u4E49</h6>`,114),w=n("li",null,"\u4E0E\u524D\u9762\u7684\u4FDD\u62A4\u6027\u6682\u505C\u4E2D\u7684 GuardObject \u4E0D\u540C\uFF0C\u4E0D\u9700\u8981\u4EA7\u751F\u7ED3\u679C\u548C\u6D88\u8D39\u7ED3\u679C\u7684\u7EBF\u7A0B\u4E00\u4E00\u5BF9\u5E94",-1),h=n("li",null,"\u6D88\u8D39\u961F\u5217\u53EF\u4EE5\u7528\u6765\u5E73\u8861\u751F\u4EA7\u548C\u6D88\u8D39\u7684\u7EBF\u7A0B\u8D44\u6E90",-1),f=n("li",null,"\u751F\u4EA7\u8005\u4EC5\u8D1F\u8D23\u4EA7\u751F\u7ED3\u679C\u6570\u636E\uFF0C\u4E0D\u5173\u5FC3\u6570\u636E\u8BE5\u5982\u4F55\u5904\u7406\uFF0C\u800C\u6D88\u8D39\u8005\u4E13\u5FC3\u5904\u7406\u7ED3\u679C\u6570\u636E",-1),T=n("li",null,"\u6D88\u606F\u961F\u5217\u662F\u6709\u5BB9\u91CF\u9650\u5236\u7684\uFF0C\u6EE1\u65F6\u4E0D\u4F1A\u518D\u52A0\u5165\u6570\u636E\uFF0C\u7A7A\u65F6\u4E0D\u4F1A\u518D\u6D88\u8017\u6570\u636E",-1),q=s("JDK \u4E2D\u5404\u79CD"),j={href:"https://blog.csdn.net/yanpenglei/article/details/79556591",target:"_blank",rel:"noopener noreferrer"},S=s("\u963B\u585E\u961F\u5217"),x=s("\uFF0C\u91C7\u7528\u7684\u5C31\u662F\u8FD9\u79CD\u6A21\u5F0F"),B=t(`<p>\u201C\u5F02\u6B65\u201D\u7684\u610F\u601D\u5C31\u662F\u751F\u4EA7\u8005\u4EA7\u751F\u6D88\u606F\u4E4B\u540E\u6D88\u606F\u6CA1\u6709\u88AB\u7ACB\u523B\u6D88\u8D39\uFF0C\u800C\u201C\u540C\u6B65\u6A21\u5F0F\u201D\u4E2D\uFF0C\u6D88\u606F\u5728\u4EA7\u751F\u4E4B\u540E\u88AB\u7ACB\u523B\u6D88\u8D39\u4E86\u3002</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603553.png" alt="1594524622020"></p><p>\u6211\u4EEC\u5199\u4E00\u4E2A\u7EBF\u7A0B\u95F4\u901A\u4FE1\u7684\u6D88\u606F\u961F\u5217\uFF0C\u8981\u6CE8\u610F\u533A\u522B\uFF0C\u50CFrabbit mq\u7B49\u6D88\u606F\u6846\u67B6\u662F\u8FDB\u7A0B\u95F4\u901A\u4FE1\u7684\u3002</p><h6 id="_2-\u5B9E\u73B0-1" tabindex="-1"><a class="header-anchor" href="#_2-\u5B9E\u73B0-1" aria-hidden="true">#</a> 2.\u5B9E\u73B0</h6><p>\u6D88\u606F\u961F\u5217\u548C\u6D88\u606F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6D88\u606F\u961F\u5217</span>
<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.MessageQueue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MessageQueue</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5B58\u653E\u6D88\u606F\u7684\u961F\u5217\u96C6\u5408</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5BB9\u91CF</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> capcity<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capcity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capcity <span class="token operator">=</span> capcity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u53D6\u6D88\u606F</span>
    <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u961F\u5217\u4E3A\u7A7A, \u6D88\u8D39\u8005\u7EBF\u7A0B\u7B49\u5F85&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    list<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5DF2\u6D88\u8D39\u6D88\u606F {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> message<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5B58\u653E\u6D88\u606F</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> capcity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u961F\u5217\u5DF2\u6EE1, \u751F\u4EA7\u8005\u7EBF\u7A0B\u7B49\u5F85&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    list<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            list<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5DF2\u751F\u4EA7\u6D88\u606F {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u6D88\u606F</span>
<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Message&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> message<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">Object</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Message{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, message=&quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\uFF1A3\u4E2A\u751F\u4EA7\u8005\u5BF9\u5E941\u4E2A\u6D88\u8D39\u8005</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test05&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test05</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageQueue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> id <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                queue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;\u6D88\u606F&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u751F\u4EA7\u8005&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                queue<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u6D88\u8D39\u8005&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151718333.png" alt="image-20220915171829162"></p><h3 id="_4-7-park-unpack" tabindex="-1"><a class="header-anchor" href="#_4-7-park-unpack" aria-hidden="true">#</a> 4.7 park &amp; unpack</h3><h4 id="_4-7-1-\u57FA\u672C\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_4-7-1-\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a> 4.7.1 \u57FA\u672C\u4F7F\u7528</h4><p>\u5B83\u4EEC\u662F LockSupport \u7C7B\u4E2D\u7684\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6682\u505C\u5F53\u524D\u7EBF\u7A0B</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u6062\u590D\u67D0\u4E2A\u7EBF\u7A0B\u7684\u8FD0\u884C</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148 park \u518D unpark</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>hread t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;start...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;park...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;resume...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;unpark...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">18</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">52.585</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> start<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">53.589</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> park<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">54.583</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token operator">-</span> unpark<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">54.583</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> resume<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148 unpark \u518D park</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;start...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;park...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;resume...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;unpark...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">18</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">50.765</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> start<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">51.764</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token operator">-</span> unpark<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">52.769</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> park<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">52.769</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestParkUnpark</span> <span class="token punctuation">[</span>t1<span class="token punctuation">]</span> <span class="token operator">-</span> resume<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-7-2-\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_4-7-2-\u7279\u70B9" aria-hidden="true">#</a> 4.7.2 \u7279\u70B9</h4><p>\u4E0E Object \u7684 wait &amp; notify \u76F8\u6BD4</p><ul><li>wait\uFF0Cnotify \u548C notifyAll \u5FC5\u987B\u914D\u5408 Object Monitor \u4E00\u8D77\u4F7F\u7528\uFF0C\u800C park\uFF0Cunpark \u4E0D\u5FC5</li><li>park &amp; unpark \u662F\u4EE5\u7EBF\u7A0B\u4E3A\u5355\u4F4D\u6765\u3010\u963B\u585E\u3011\u548C\u3010\u5524\u9192\u3011\u7EBF\u7A0B\uFF0C\u800C notify \u53EA\u80FD\u968F\u673A\u5524\u9192\u4E00\u4E2A\u7B49\u5F85\u7EBF\u7A0B\uFF0CnotifyAll \u662F\u5524\u9192\u6240\u6709\u7B49\u5F85\u7EBF\u7A0B\uFF0C\u5C31\u4E0D\u90A3\u4E48\u3010\u7CBE\u786E\u3011</li><li>park &amp; unpark \u53EF\u4EE5\u5148 unpark\uFF0C\u800C wait &amp; notify \u4E0D\u80FD\u5148 notify</li></ul><h4 id="_4-7-3-park-unpark-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-7-3-park-unpark-\u539F\u7406" aria-hidden="true">#</a> 4.7.3 park unpark \u539F\u7406</h4><p>\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u7684\u4E00\u4E2A Parker \u5BF9\u8C61\uFF0C\u7531\u4E09\u90E8\u5206\u7EC4\u6210 <code>_counter\uFF0C _cond \u548C _mutex</code></p><ol><li>\u6253\u4E2A\u6BD4\u55BB\u7EBF\u7A0B\u5C31\u50CF\u4E00\u4E2A\u65C5\u4EBA\uFF0CParker \u5C31\u50CF\u4ED6\u968F\u8EAB\u643A\u5E26\u7684\u80CC\u5305\uFF0C\u6761\u4EF6\u53D8\u91CF _ cond\u5C31\u597D\u6BD4\u80CC\u5305\u4E2D\u7684\u5E10\u7BF7\u3002_counter \u5C31\u597D\u6BD4\u80CC\u5305\u4E2D\u7684\u5907\u7528\u5E72\u7CAE\uFF080 \u4E3A\u8017\u5C3D\uFF0C1 \u4E3A\u5145\u8DB3\uFF09</li><li>\u8C03\u7528 park \u5C31\u662F\u8981\u770B\u9700\u4E0D\u9700\u8981\u505C\u4E0B\u6765\u6B47\u606F <ol><li>\u5982\u679C\u5907\u7528\u5E72\u7CAE\u8017\u5C3D\uFF0C\u90A3\u4E48\u94BB\u8FDB\u5E10\u7BF7\u6B47\u606F</li><li>\u5982\u679C\u5907\u7528\u5E72\u7CAE\u5145\u8DB3\uFF0C\u90A3\u4E48\u4E0D\u9700\u505C\u7559\uFF0C\u7EE7\u7EED\u524D\u8FDB</li></ol></li><li>\u8C03\u7528 unpark\uFF0C\u5C31\u597D\u6BD4\u4EE4\u5E72\u7CAE\u5145\u8DB3 <ol><li>\u5982\u679C\u8FD9\u65F6\u7EBF\u7A0B\u8FD8\u5728\u5E10\u7BF7\uFF0C\u5C31\u5524\u9192\u8BA9\u4ED6\u7EE7\u7EED\u524D\u8FDB</li><li>\u5982\u679C\u8FD9\u65F6\u7EBF\u7A0B\u8FD8\u5728\u8FD0\u884C\uFF0C\u90A3\u4E48\u4E0B\u6B21\u4ED6\u8C03\u7528 park \u65F6\uFF0C\u4EC5\u662F\u6D88\u8017\u6389\u5907\u7528\u5E72\u7CAE\uFF0C\u4E0D\u9700\u505C\u7559\u7EE7\u7EED\u524D\u8FDB <ul><li>\u56E0\u4E3A\u80CC\u5305\u7A7A\u95F4\u6709\u9650\uFF0C\u591A\u6B21\u8C03\u7528 unpark \u4EC5\u4F1A\u8865\u5145\u4E00\u4EFD\u5907\u7528\u5E72\u7CAE</li></ul></li></ol></li></ol><p>\u53EF\u4EE5\u4E0D\u770B\u4F8B\u5B50\uFF0C\u76F4\u63A5\u770B\u5B9E\u73B0\u8FC7\u7A0B</p><h5 id="\u5148\u8C03\u7528park\u518D\u8C03\u7528upark\u7684\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5148\u8C03\u7528park\u518D\u8C03\u7528upark\u7684\u8FC7\u7A0B" aria-hidden="true">#</a> \u5148\u8C03\u7528park\u518D\u8C03\u7528upark\u7684\u8FC7\u7A0B</h5><p>\u5148\u8C03\u7528park</p><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 Unsafe.park() \u65B9\u6CD5</li><li>\u68C0\u67E5 _counter \uFF0C\u672C\u60C5\u51B5\u4E3A 0\uFF0C\u8FD9\u65F6\uFF0C\u83B7\u5F97 _mutex \u4E92\u65A5\u9501(mutex\u5BF9\u8C61\u6709\u4E2A\u7B49\u5F85\u961F\u5217 _cond)</li><li>\u7EBF\u7A0B\u8FDB\u5165 _cond \u6761\u4EF6\u53D8\u91CF\u963B\u585E</li><li>\u8BBE\u7F6E _counter = 0</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603958.png" alt="1594531894163"></p><p>\u8C03\u7528upark</p><ol><li>\u8C03\u7528 Unsafe.unpark(Thread_0) \u65B9\u6CD5\uFF0C\u8BBE\u7F6E _counter \u4E3A 1</li><li>\u5524\u9192 _cond \u6761\u4EF6\u53D8\u91CF\u4E2D\u7684 Thread_0</li><li>Thread_0 \u6062\u590D\u8FD0\u884C</li><li>\u8BBE\u7F6E _counter \u4E3A 0</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603194.png" alt="1594532057205"></p><h5 id="\u5148\u8C03\u7528upark\u518D\u8C03\u7528park\u7684\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5148\u8C03\u7528upark\u518D\u8C03\u7528park\u7684\u8FC7\u7A0B" aria-hidden="true">#</a> \u5148\u8C03\u7528upark\u518D\u8C03\u7528park\u7684\u8FC7\u7A0B</h5><ol><li>\u8C03\u7528 Unsafe.unpark(Thread_0) \u65B9\u6CD5\uFF0C\u8BBE\u7F6E _counter \u4E3A 1</li><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 Unsafe.park() \u65B9\u6CD5</li><li>\u68C0\u67E5 _counter \uFF0C\u672C\u60C5\u51B5\u4E3A 1\uFF0C\u8FD9\u65F6\u7EBF\u7A0B\u65E0\u9700\u963B\u585E\uFF0C\u7EE7\u7EED\u8FD0\u884C</li><li>\u8BBE\u7F6E _counter \u4E3A 0</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603271.png" alt="1594532135616"></p><h3 id="_4-8-\u7EBF\u7A0B\u72B6\u6001\u8F6C\u6362" tabindex="-1"><a class="header-anchor" href="#_4-8-\u7EBF\u7A0B\u72B6\u6001\u8F6C\u6362" aria-hidden="true">#</a> 4.8 \u7EBF\u7A0B\u72B6\u6001\u8F6C\u6362</h3><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603303.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151749028.png" alt="image-20220915174923889"></p><p>\u5047\u8BBE\u6709\u7EBF\u7A0B Thread t</p><h4 id="\u60C5\u51B5\u4E00-new-runnable" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E00-new-runnable" aria-hidden="true">#</a> \u60C5\u51B5\u4E00\uFF1ANEW --&gt; RUNNABLE</h4><p>\u5F53\u8C03\u7528 t.start() \u65B9\u6CD5\u65F6\uFF0C\u7531 NEW --&gt; RUNNABLE</p><h4 id="\u60C5\u51B5\u4E8C-runnable-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E8C-runnable-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u4E8C\uFF1ARUNNABLE &lt;--&gt; WAITING</h4><p>\u7EBF\u7A0B\u7528synchronized(obj)\u83B7\u53D6\u4E86\u5BF9\u8C61\u9501\u540E</p><ol><li>\u8C03\u7528obj.wait()\u65B9\u6CD5\u65F6\uFF0Ct \u7EBF\u7A0B\u4ECE RUNNABLE --&gt; WAITING</li><li>\u8C03\u7528obj.notify()\uFF0Cobj.notifyAll()\uFF0Ct.interrupt()\u65F6 <ol><li>\u7ADE\u4E89\u9501\u6210\u529F\uFF0Ct \u7EBF\u7A0B\u4ECEWAITING --&gt; RUNNABLE</li><li>\u7ADE\u4E89\u9501\u5931\u8D25\uFF0Ct \u7EBF\u7A0B\u4ECEWAITING --&gt; BLOCKED</li></ol></li></ol><p>\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5176\u5B83\u4EE3\u7801....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5176\u5B83\u4EE3\u7801....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5524\u9192 obj \u4E0A\u5176\u5B83\u7EBF\u7A0B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// obj.notify(); // \u5524\u9192obj\u4E0A\u4E00\u4E2A\u7EBF\u7A0B</span>
            obj<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5524\u9192obj\u4E0A\u6240\u6709\u7B49\u5F85\u7EBF\u7A0B</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>main \u7EBF\u7A0B\u6267\u884C\u5230 notifyAll() \u65B9\u6CD5\uFF0Ct1\u3001t2 \u6267\u884C\u4E86 wait() \u65B9\u6CD5\u5904\u4E8E WAITING \u72B6\u6001</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151754873.png" alt="image-20220915175448737"></p><p>\u5524\u9192\u7EBF\u7A0B</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151756565.png" alt="image-20220915175631443"></p><p>main \u7EBF\u7A0B\u91CA\u653E\u9501\uFF0C\u53EF\u770B\u5230 t2 \u7EBF\u7A0B\u83B7\u53D6\u5230\u9501\uFF0C\u5904\u4E8E RUNNABLE \u72B6\u6001\uFF0Ct1 \u7EBF\u7A0B\u8FD8\u662F\u5904\u4E8E BLOCKED(IDEA \u663E\u793A MONITOR) \u72B6\u6001</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151757054.png" alt="image-20220915175703933"></p><p>t2 \u7EBF\u7A0B\u91CA\u653E\u9501\uFF0Ct1 \u7EBF\u7A0B\u83B7\u53D6\u5230\u9501\uFF0C\u53EF\u4EE5\u770B\u5230 t1\u3001t2 \u7EBF\u7A0B\u90FD\u5904\u4E8E RUNNABLE \u72B6\u6001</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209151759811.png" alt="image-20220915175939671"></p><h4 id="\u60C5\u51B5\u4E09-runnable-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E09-runnable-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u4E09\uFF1ARUNNABLE &lt;--&gt; WAITING</h4><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 LockSupport.park() \u65B9\u6CD5\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u4ECE RUNNABLE --&gt; WAITING</li><li>\u8C03\u7528 LockSupport.unpark(\u76EE\u6807\u7EBF\u7A0B) \u6216\u8C03\u7528\u4E86\u7EBF\u7A0B \u7684 interrupt() \uFF0C\u4F1A\u8BA9\u76EE\u6807\u7EBF\u7A0B\u4ECE WAITING --&gt; RUNNABLE</li></ol><h4 id="\u60C5\u51B5\u56DB-runnable-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u56DB-runnable-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u56DB\uFF1ARUNNABLE &lt;--&gt; WAITING</h4><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 t.join() \u65B9\u6CD5\u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE RUNNABLE --&gt; WAITING \u6CE8\u610F\u662F\u5F53\u524D\u7EBF\u7A0B\u5728t \u7EBF\u7A0B\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\u4E0A\u7B49\u5F85</li><li>t \u7EBF\u7A0B\u8FD0\u884C\u7ED3\u675F\uFF0C\u6216\u8C03\u7528\u4E86\u5F53\u524D\u7EBF\u7A0B\u7684 interrupt() \u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE WAITING --&gt; RUNNABLE</li></ol><h4 id="\u60C5\u51B5\u4E94-runnable-timed-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E94-runnable-timed-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u4E94\uFF1ARUNNABLE &lt;--&gt; TIMED_WAITING</h4><p>t \u7EBF\u7A0B\u7528 synchronized(obj) \u83B7\u53D6\u4E86\u5BF9\u8C61\u9501\u540E</p><ol><li>\u8C03\u7528 obj.wait(long n) \u65B9\u6CD5\u65F6\uFF0Ct \u7EBF\u7A0B\u4ECE RUNNABLE --&gt; TIMED_WAITING</li><li>t \u7EBF\u7A0B\u7B49\u5F85\u65F6\u95F4\u8D85\u8FC7\u4E86 n \u6BEB\u79D2\uFF0C\u6216\u8C03\u7528 obj.notify() \uFF0C obj.notifyAll() \uFF0C t.interrupt() \u65F6 <ol><li>\u7ADE\u4E89\u9501\u6210\u529F\uFF0Ct \u7EBF\u7A0B\u4ECE TIMED_WAITING --&gt; RUNNABLE</li><li>\u7ADE\u4E89\u9501\u5931\u8D25\uFF0Ct \u7EBF\u7A0B\u4ECE TIMED_WAITING --&gt; BLOCKED</li></ol></li></ol><h4 id="\u60C5\u51B5\u516D-runnable-timed-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u516D-runnable-timed-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u516D\uFF1ARUNNABLE &lt;--&gt; TIMED_WAITING</h4><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 t.join(long n) \u65B9\u6CD5\u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE RUNNABLE --&gt; TIMED_WAITING \u6CE8\u610F\u662F\u5F53\u524D\u7EBF\u7A0B\u5728t \u7EBF\u7A0B\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\u4E0A\u7B49\u5F85</li><li>\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85\u65F6\u95F4\u8D85\u8FC7\u4E86 n \u6BEB\u79D2\uFF0C\u6216t \u7EBF\u7A0B\u8FD0\u884C\u7ED3\u675F\uFF0C\u6216\u8C03\u7528\u4E86\u5F53\u524D\u7EBF\u7A0B\u7684 interrupt() \u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE TIMED_WAITING --&gt; RUNNABLE</li></ol><h4 id="\u60C5\u51B5\u4E03-runnable-timed-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E03-runnable-timed-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u4E03\uFF1ARUNNABLE &lt;--&gt; TIMED_WAITING</h4><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 Thread.sleep(long n) \uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE RUNNABLE --&gt; TIMED_WAITING</li><li>\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85\u65F6\u95F4\u8D85\u8FC7\u4E86 n \u6BEB\u79D2\u6216\u8C03\u7528\u4E86\u7EBF\u7A0B \u7684 interrupt() \uFF0C\u5F53\u524D\u7EBF\u7A0B\u4ECE TIMED_WAITING --&gt; RUNNABLE</li></ol><h4 id="\u60C5\u51B5\u516B-runnable-timed-waiting" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u516B-runnable-timed-waiting" aria-hidden="true">#</a> \u60C5\u51B5\u516B\uFF1ARUNNABLE &lt;--&gt; TIMED_WAITING</h4><ol><li>\u5F53\u524D\u7EBF\u7A0B\u8C03\u7528 LockSupport.parkNanos(long nanos) \u6216 LockSupport.parkUntil(long millis) \u65F6\uFF0C\u5F53\u524D\u7EBF \u7A0B\u4ECE RUNNABLE --&gt; TIMED_WAITING</li><li>\u8C03\u7528 LockSupport.unpark(\u76EE\u6807\u7EBF\u7A0B) \u6216\u8C03\u7528\u4E86\u7EBF\u7A0B \u7684 interrupt() \uFF0C\u6216\u662F\u7B49\u5F85\u8D85\u65F6\uFF0C\u4F1A\u8BA9\u76EE\u6807\u7EBF\u7A0B\u4ECE TIMED_WAITING--&gt; RUNNABLE</li></ol><h4 id="\u60C5\u51B5\u4E5D-runnable-blocked" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u4E5D-runnable-blocked" aria-hidden="true">#</a> \u60C5\u51B5\u4E5D\uFF1ARUNNABLE &lt;--&gt; BLOCKED</h4><ol><li>t \u7EBF\u7A0B\u7528 synchronized(obj) \u83B7\u53D6\u4E86\u5BF9\u8C61\u9501\u65F6\u5982\u679C\u7ADE\u4E89\u5931\u8D25\uFF0C\u4ECE RUNNABLE --&gt; BLOCKED</li><li>\u6301 obj \u9501\u7EBF\u7A0B\u7684\u540C\u6B65\u4EE3\u7801\u5757\u6267\u884C\u5B8C\u6BD5\uFF0C\u4F1A\u5524\u9192\u8BE5\u5BF9\u8C61\u4E0A\u6240\u6709 BLOCKED \u7684\u7EBF\u7A0B\u91CD\u65B0\u7ADE\u4E89\uFF0C\u5982\u679C\u5176\u4E2D t \u7EBF\u7A0B\u7ADE\u4E89\u6210\u529F\uFF0C\u4ECE BLOCKED --&gt; RUNNABLE \uFF0C\u5176\u5B83\u5931\u8D25\u7684\u7EBF\u7A0B\u4ECD\u7136 BLOCKED</li></ol><h4 id="\u60C5\u51B5\u5341-runnable-terminated" tabindex="-1"><a class="header-anchor" href="#\u60C5\u51B5\u5341-runnable-terminated" aria-hidden="true">#</a> \u60C5\u51B5\u5341\uFF1ARUNNABLE &lt;--&gt; TERMINATED</h4><p>\u5F53\u524D\u7EBF\u7A0B\u6240\u6709\u4EE3\u7801\u8FD0\u884C\u5B8C\u6BD5\uFF0C\u8FDB\u5165TERMINATED</p><h3 id="_4-9-\u591A\u628A\u9501" tabindex="-1"><a class="header-anchor" href="#_4-9-\u591A\u628A\u9501" aria-hidden="true">#</a> 4.9 \u591A\u628A\u9501</h3><p>\u4E00\u95F4\u5927\u5C4B\u5B50\u6709\u4E24\u4E2A\u529F\u80FD\uFF1A\u7761\u89C9\u3001\u5B66\u4E60\uFF0C\u4E92\u4E0D\u76F8\u5E72\u3002</p><p>\u73B0\u5728\u5C0F\u5357\u8981\u5B66\u4E60\uFF0C\u5C0F\u5973\u8981\u7761\u89C9\uFF0C\u4F46\u5982\u679C\u53EA\u7528\u4E00\u95F4\u5C4B\u5B50\uFF08\u4E00\u4E2A\u5BF9\u8C61\u9501\uFF09\u7684\u8BDD\uFF0C\u90A3\u4E48\u5E76\u53D1\u5EA6\u5F88\u4F4E</p><p>\u89E3\u51B3\u65B9\u6CD5\u662F\u51C6\u5907\u591A\u4E2A\u623F\u95F4\uFF08\u591A\u4E2A\u5BF9\u8C61\u9501\uFF09</p><p>\u4F8B\u5982</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BigRoom</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;sleeping 2 \u5C0F\u65F6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;study 1 \u5C0F\u65F6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">BigRoom</span> bigRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    bigRoom<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;\u5C0F\u5357&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    bigRoom<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;\u5C0F\u5973&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67D0\u6B21\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">12</span><span class="token operator">:</span><span class="token number">13</span><span class="token operator">:</span><span class="token number">54.471</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>BigRoom</span> <span class="token operator">-</span> study <span class="token number">1</span> \u5C0F\u65F6
<span class="token number">12</span><span class="token operator">:</span><span class="token number">13</span><span class="token operator">:</span><span class="token number">55.476</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>BigRoom</span> <span class="token operator">-</span> sleeping <span class="token number">2</span> \u5C0F\u65F6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6539\u8FDB</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BigRoom</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> studyRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> bedRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>bedRoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;sleeping 2 \u5C0F\u65F6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>studyRoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;study 1 \u5C0F\u65F6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67D0\u6B21\u6267\u884C\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">12</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">35.069</span> <span class="token punctuation">[</span>\u5C0F\u5357<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>BigRoom</span> <span class="token operator">-</span> study <span class="token number">1</span> \u5C0F\u65F6
<span class="token number">12</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">35.069</span> <span class="token punctuation">[</span>\u5C0F\u5973<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>BigRoom</span> <span class="token operator">-</span> sleeping <span class="token number">2</span> \u5C0F\u65F6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u9501\u7684\u7C92\u5EA6\u7EC6\u5206</p><ul><li>\u597D\u5904\uFF0C\u662F\u53EF\u4EE5\u589E\u5F3A\u5E76\u53D1\u5EA6</li><li>\u574F\u5904\uFF0C\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u9700\u8981\u540C\u65F6\u83B7\u5F97\u591A\u628A\u9501\uFF0C\u5C31\u5BB9\u6613\u53D1\u751F\u6B7B\u9501</li></ul><h3 id="_4-10-\u6D3B\u8DC3\u6027" tabindex="-1"><a class="header-anchor" href="#_4-10-\u6D3B\u8DC3\u6027" aria-hidden="true">#</a> 4.10 \u6D3B\u8DC3\u6027</h3><p>\u6D3B\u8DC3\u6027\u76F8\u5173\u7684\u4E00\u7CFB\u5217\u95EE\u9898\u90FD\u53EF\u4EE5\u7528ReentrantLock\u8FDB\u884C\u89E3\u51B3\u3002</p><h4 id="_4-10-1-\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#_4-10-1-\u6B7B\u9501" aria-hidden="true">#</a> 4.10.1 \u6B7B\u9501</h4><p>\u6709\u8FD9\u6837\u7684\u60C5\u51B5\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u9700\u8981\u540C\u65F6\u83B7\u53D6\u591A\u628A\u9501\uFF0C\u8FD9\u65F6\u5C31\u5BB9\u6613\u53D1\u751F\u6B7B\u9501</p><ul><li>t1 \u7EBF\u7A0B\u83B7\u5F97A\u5BF9\u8C61\u9501\uFF0C\u63A5\u4E0B\u6765\u60F3\u83B7\u53D6B\u5BF9\u8C61\u7684\u9501\uFF1B</li><li>t2 \u7EBF\u7A0B\u83B7\u5F97B\u5BF9\u8C61\u9501\uFF0C\u63A5\u4E0B\u6765\u60F3\u83B7\u53D6A\u5BF9\u8C61\u7684\u9501\u4F8B\u3002</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> <span class="token class-name">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> <span class="token class-name">B</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;lock A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;lock B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u64CD\u4F5C...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;lock B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;lock A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u64CD\u4F5C...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A\u53D1\u751F\u6B7B\u9501</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152148366.png" alt="image-20220915214819220"></p><h4 id="_4-10-2-\u68C0\u6D4B\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#_4-10-2-\u68C0\u6D4B\u6B7B\u9501" aria-hidden="true">#</a> 4.10.2 \u68C0\u6D4B\u6B7B\u9501</h4><p>\u68C0\u6D4B\u6B7B\u9501\u53EF\u4EE5\u4F7F\u7528 jconsole \u5DE5\u5177\uFF1B\u6216\u8005\u4F7F\u7528 jps \u5B9A\u4F4D\u8FDB\u7A0B id\uFF0C\u518D\u7528 jstack \u5B9A\u4F4D\u6B7B\u9501\uFF1A</p><p>\u4E0B\u9762\u4F7F\u7528jstack\u5DE5\u5177\u8FDB\u884C\u6F14\u793A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>PS <span class="token class-name">D</span><span class="token operator">:</span>\\study\\\u8D44\u6599<span class="token operator">-</span>\u5E76\u53D1\u7F16\u7A0B\\concurrent\\case_java8<span class="token operator">&gt;</span> jps
<span class="token number">42320</span>
<span class="token number">50372</span> <span class="token class-name">Jps</span>
<span class="token number">36808</span> <span class="token class-name">Launcher</span>
<span class="token number">28124</span> <span class="token class-name">RemoteMavenServer36</span>
<span class="token number">58252</span> <span class="token class-name">TestDeadLock</span>
    
PS <span class="token class-name">D</span><span class="token operator">:</span>\\study\\\u8D44\u6599<span class="token operator">-</span>\u5E76\u53D1\u7F16\u7A0B\\concurrent\\case_java8<span class="token operator">&gt;</span> jstack <span class="token number">58252</span>
<span class="token comment">// ......</span>
<span class="token class-name">Found</span> one <span class="token class-name">Java</span><span class="token operator">-</span>level deadlock<span class="token operator">:</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token string">&quot;t2&quot;</span><span class="token operator">:</span>
  waiting <span class="token keyword">to</span> <span class="token namespace">lock</span> monitor <span class="token number">0x0000019c4cab8368</span> <span class="token punctuation">(</span>object <span class="token number">0x000000076cb98a70</span><span class="token punctuation">,</span> a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  which is held by <span class="token string">&quot;t1&quot;</span>
<span class="token string">&quot;t1&quot;</span><span class="token operator">:</span>
  waiting <span class="token keyword">to</span> <span class="token namespace">lock</span> monitor <span class="token number">0x0000019c4caba5c8</span> <span class="token punctuation">(</span>object <span class="token number">0x000000076cb98a80</span><span class="token punctuation">,</span> a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  which is held by <span class="token string">&quot;t2&quot;</span>

<span class="token class-name">Java</span> stack information <span class="token keyword">for</span> the threads listed above<span class="token operator">:</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token string">&quot;t2&quot;</span><span class="token operator">:</span>
        at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>n4<span class="token punctuation">.</span>deadlock<span class="token punctuation">.</span></span>TestDeadLock</span><span class="token punctuation">.</span>lambda$test1$<span class="token function">1</span><span class="token punctuation">(</span><span class="token class-name">TestDeadLock</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> waiting <span class="token keyword">to</span> <span class="token namespace">lock</span> <span class="token generics"><span class="token punctuation">&lt;</span>0x000000076cb98a70<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0x000000076cb98a80<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>n4<span class="token punctuation">.</span>deadlock<span class="token punctuation">.</span></span>TestDeadLock</span>$$<span class="token class-name">Lambda</span>$<span class="token number">2</span><span class="token operator">/</span><span class="token number">226170135.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
<span class="token string">&quot;t1&quot;</span><span class="token operator">:</span>
        at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>n4<span class="token punctuation">.</span>deadlock<span class="token punctuation">.</span></span>TestDeadLock</span><span class="token punctuation">.</span>lambda$test1$<span class="token function">0</span><span class="token punctuation">(</span><span class="token class-name">TestDeadLock</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> waiting <span class="token keyword">to</span> <span class="token namespace">lock</span> <span class="token generics"><span class="token punctuation">&lt;</span>0x000000076cb98a80<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0x000000076cb98a70<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>n4<span class="token punctuation">.</span>deadlock<span class="token punctuation">.</span></span>TestDeadLock</span>$$<span class="token class-name">Lambda</span>$<span class="token number">1</span><span class="token operator">/</span><span class="token number">627185331.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>

<span class="token class-name">Found</span> <span class="token number">1</span> deadlock<span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jconsole</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152151021.png" alt="image-20220915215129873"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152151264.png" alt="image-20220915215139052"></p><h4 id="_4-10-3-\u54F2\u5B66\u5BB6\u5C31\u9910\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-10-3-\u54F2\u5B66\u5BB6\u5C31\u9910\u95EE\u9898" aria-hidden="true">#</a> 4.10.3 \u54F2\u5B66\u5BB6\u5C31\u9910\u95EE\u9898</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603309.png" alt="1594553609905"></p><p>\u6709\u4E94\u4F4D\u54F2\u5B66\u5BB6\uFF0C\u56F4\u5750\u5728\u5706\u684C\u65C1\u3002</p><ul><li>\u4ED6\u4EEC\u53EA\u505A\u4E24\u4EF6\u4E8B\uFF0C\u601D\u8003\u548C\u5403\u996D\uFF0C\u601D\u8003\u4E00\u4F1A\u5403\u53E3\u996D\uFF0C\u5403\u5B8C\u996D\u540E\u63A5\u7740\u601D\u8003\u3002</li><li>\u5403\u996D\u65F6\u8981\u7528\u4E24\u6839\u7B77\u5B50\u5403\uFF0C\u684C\u4E0A\u5171\u6709 5 \u6839\u7B77\u5B50\uFF0C\u6BCF\u4F4D\u54F2\u5B66\u5BB6\u5DE6\u53F3\u624B\u8FB9\u5404\u6709\u4E00\u6839\u7B77\u5B50\u3002</li><li>\u5982\u679C\u7B77\u5B50\u88AB\u8EAB\u8FB9\u7684\u4EBA\u62FF\u7740\uFF0C\u81EA\u5DF1\u5C31\u5F97\u7B49\u5F85</li></ul><p>\u7B77\u5B50\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;\u7B77\u5B50{&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u54F2\u5B66\u5BB6\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Philosopher&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Philosopher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token class-name">Chopstick</span> left<span class="token punctuation">;</span>
    <span class="token class-name">Chopstick</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5C1D\u8BD5\u83B7\u5F97\u5DE6\u624B\u7B77\u5B50</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5C1D\u8BD5\u83B7\u5F97\u53F3\u624B\u7B77\u5B50</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDeadLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Chopstick</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u82CF\u683C\u62C9\u5E95&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u67CF\u62C9\u56FE&quot;</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E9A\u91CC\u58EB\u591A\u5FB7&quot;</span><span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u8D6B\u62C9\u514B\u5229\u7279&quot;</span><span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u963F\u57FA\u7C73\u5FB7&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">12</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">15.575</span> <span class="token punctuation">[</span>\u82CF\u683C\u62C9\u5E95<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>Philosopher</span> <span class="token operator">-</span> eating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">12</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">15.575</span> <span class="token punctuation">[</span>\u4E9A\u91CC\u58EB\u591A\u5FB7<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>Philosopher</span> <span class="token operator">-</span> eating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">12</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">16.580</span> <span class="token punctuation">[</span>\u963F\u57FA\u7C73\u5FB7<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>Philosopher</span> <span class="token operator">-</span> eating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">12</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">17.580</span> <span class="token punctuation">[</span>\u963F\u57FA\u7C73\u5FB7<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>Philosopher</span> <span class="token operator">-</span> eating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// \u5361\u5728\u8FD9\u91CC, \u4E0D\u5411\u4E0B\u8FD0\u884C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 jconsole \u68C0\u6D4B\u6B7B\u9501\uFF0C\u53D1\u73B0</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-------------------------------------------------------------------------
\u540D\u79F0: \u963F\u57FA\u7C73\u5FB7
\u72B6\u6001: cn.itcast.Chopstick@1540e19d <span class="token punctuation">(</span>\u7B77\u5B501<span class="token punctuation">)</span> \u4E0A\u7684BLOCKED, \u62E5\u6709\u8005: \u82CF\u683C\u62C9\u5E95
\u603B\u963B\u6B62\u6570: <span class="token number">2</span>, \u603B\u7B49\u5F85\u6570: <span class="token number">1</span>
\u5806\u6808\u8DDF\u8E2A:
cn.itcast.Philosopher.run<span class="token punctuation">(</span>TestDinner.java:48<span class="token punctuation">)</span>
- \u5DF2\u9501\u5B9A cn.itcast.Chopstick@6d6f6e28 <span class="token punctuation">(</span>\u7B77\u5B505<span class="token punctuation">)</span>
-------------------------------------------------------------------------
\u540D\u79F0: \u82CF\u683C\u62C9\u5E95
\u72B6\u6001: cn.itcast.Chopstick@677327b6 <span class="token punctuation">(</span>\u7B77\u5B502<span class="token punctuation">)</span> \u4E0A\u7684BLOCKED, \u62E5\u6709\u8005: \u67CF\u62C9\u56FE
\u603B\u963B\u6B62\u6570: <span class="token number">2</span>, \u603B\u7B49\u5F85\u6570: <span class="token number">1</span>
\u5806\u6808\u8DDF\u8E2A:
cn.itcast.Philosopher.run<span class="token punctuation">(</span>TestDinner.java:48<span class="token punctuation">)</span>
- \u5DF2\u9501\u5B9A cn.itcast.Chopstick@1540e19d <span class="token punctuation">(</span>\u7B77\u5B501<span class="token punctuation">)</span>
-------------------------------------------------------------------------
\u540D\u79F0: \u67CF\u62C9\u56FE
\u72B6\u6001: cn.itcast.Chopstick@14ae5a5 <span class="token punctuation">(</span>\u7B77\u5B503<span class="token punctuation">)</span> \u4E0A\u7684BLOCKED, \u62E5\u6709\u8005: \u4E9A\u91CC\u58EB\u591A\u5FB7
\u603B\u963B\u6B62\u6570: <span class="token number">2</span>, \u603B\u7B49\u5F85\u6570: <span class="token number">0</span>
\u5806\u6808\u8DDF\u8E2A:
cn.itcast.Philosopher.run<span class="token punctuation">(</span>TestDinner.java:48<span class="token punctuation">)</span>
- \u5DF2\u9501\u5B9A cn.itcast.Chopstick@677327b6 <span class="token punctuation">(</span>\u7B77\u5B502<span class="token punctuation">)</span>
-------------------------------------------------------------------------
\u540D\u79F0: \u4E9A\u91CC\u58EB\u591A\u5FB7
\u72B6\u6001: cn.itcast.Chopstick@7f31245a <span class="token punctuation">(</span>\u7B77\u5B504<span class="token punctuation">)</span> \u4E0A\u7684BLOCKED, \u62E5\u6709\u8005: \u8D6B\u62C9\u514B\u5229\u7279
\u603B\u963B\u6B62\u6570: <span class="token number">1</span>, \u603B\u7B49\u5F85\u6570: <span class="token number">1</span>
\u5806\u6808\u8DDF\u8E2A:
cn.itcast.Philosopher.run<span class="token punctuation">(</span>TestDinner.java:48<span class="token punctuation">)</span>
- \u5DF2\u9501\u5B9A cn.itcast.Chopstick@14ae5a5 <span class="token punctuation">(</span>\u7B77\u5B503<span class="token punctuation">)</span>
-------------------------------------------------------------------------
\u540D\u79F0: \u8D6B\u62C9\u514B\u5229\u7279
\u72B6\u6001: cn.itcast.Chopstick@6d6f6e28 <span class="token punctuation">(</span>\u7B77\u5B505<span class="token punctuation">)</span> \u4E0A\u7684BLOCKED, \u62E5\u6709\u8005: \u963F\u57FA\u7C73\u5FB7
\u603B\u963B\u6B62\u6570: <span class="token number">2</span>, \u603B\u7B49\u5F85\u6570: <span class="token number">0</span>
\u5806\u6808\u8DDF\u8E2A:
cn.itcast.Philosopher.run<span class="token punctuation">(</span>TestDinner.java:48<span class="token punctuation">)</span>
- \u5DF2\u9501\u5B9A cn.itcast.Chopstick@7f31245a <span class="token punctuation">(</span>\u7B77\u5B504<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u5373\u7EBF\u7A0B\u6301\u6709\u4E00\u6839\u7B77\u5B50\u65F6\uFF0C\u4ED6\u4EEC\u90FD\u5728\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u91CA\u653E\u9501\uFF0C\u56E0\u6B64\u9020\u6210\u4E86\u6B7B\u9501\u3002</p><p>\u8FD9\u79CD\u7EBF\u7A0B\u6CA1\u6709\u6309\u9884\u671F\u7ED3\u675F\uFF0C\u6267\u884C\u4E0D\u4E0B\u53BB\u7684\u60C5\u51B5\uFF0C\u5F52\u7C7B\u4E3A\u3010\u6D3B\u8DC3\u6027\u3011\u95EE\u9898\uFF0C\u9664\u4E86\u6B7B\u9501\u4EE5\u5916\uFF0C\u8FD8\u6709\u6D3B\u9501\u548C\u9965\u997F\u8005\u4E24\u79CD\u60C5\u51B5</p><h4 id="_4-10-4-\u6D3B\u9501" tabindex="-1"><a class="header-anchor" href="#_4-10-4-\u6D3B\u9501" aria-hidden="true">#</a> 4.10.4 \u6D3B\u9501</h4><p>\u6D3B\u9501\u51FA\u73B0\u5728\u4E24\u4E2A\u7EBF\u7A0B\u4E92\u76F8\u6539\u53D8\u5BF9\u65B9\u7684\u7ED3\u675F\u6761\u4EF6\uFF0C\u6700\u540E\u8C01\u4E5F\u65E0\u6CD5\u7ED3\u675F\uFF0C\u4F8B\u5982</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TestLiveLock&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLiveLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u671F\u671B\u51CF\u5230 0 \u9000\u51FA\u5FAA\u73AF</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token operator">--</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u671F\u671B\u8D85\u8FC7 20 \u9000\u51FA\u5FAA\u73AF</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-10-5-\u9965\u997F" tabindex="-1"><a class="header-anchor" href="#_4-10-5-\u9965\u997F" aria-hidden="true">#</a> 4.10.5 \u9965\u997F</h4><p>\u5F88\u591A\u6559\u7A0B\u4E2D\u628A\u9965\u997F\u5B9A\u4E49\u4E3A\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u7531\u4E8E\u4F18\u5148\u7EA7\u592A\u4F4E\uFF0C\u59CB\u7EC8\u5F97\u4E0D\u5230 CPU \u8C03\u5EA6\u6267\u884C\uFF0C\u4E5F\u4E0D\u80FD\u591F\u7ED3\u675F\uFF0C\u9965\u997F\u7684\u60C5\u51B5\u4E0D\u6613\u6F14\u793A\uFF0C\u8BB2\u8BFB\u5199\u9501\u65F6\u4F1A\u6D89\u53CA\u9965\u997F\u95EE\u9898\u4E0B\u9762\u6211\u8BB2\u4E00\u4E0B\u4E00\u4E2A\u7EBF\u7A0B\u9965\u997F\u7684\u4F8B\u5B50</p><p>\u5148\u6765\u770B\u770B\u4F7F\u7528\u987A\u5E8F\u52A0\u9501\u7684\u65B9\u5F0F\u89E3\u51B3\u4E4B\u524D\u7684\u6B7B\u9501\u95EE\u9898\uFF0C\u5C31\u662F\u4E24\u4E2A\u7EBF\u7A0B\u5BF9\u4E24\u4E2A\u4E0D\u540C\u7684\u5BF9\u8C61\u52A0\u9501\u7684\u65F6\u5019\u90FD\u4F7F\u7528\u76F8\u540C\u7684\u987A\u5E8F\u8FDB\u884C\u52A0\u9501\u3002</p><p>\u4F46\u662F\u4F1A\u4EA7\u751F\u9965\u997F\u95EE\u9898</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603330.png" alt="202201021516316"></p><p>\u987A\u5E8F\u52A0\u9501\u7684\u89E3\u51B3\u65B9\u6848</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603068.png" alt="1594558499871"></p><h3 id="_4-11-reentrantlock" tabindex="-1"><a class="header-anchor" href="#_4-11-reentrantlock" aria-hidden="true">#</a> 4.11 ReentrantLock</h3><p>\u76F8\u5BF9\u4E8E synchronized \u5B83\u5177\u5907\u5982\u4E0B\u7279\u70B9</p><ol><li>\u53EF\u4E2D\u65AD</li><li>\u53EF\u4EE5\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4</li><li>\u53EF\u4EE5\u8BBE\u7F6E\u4E3A\u516C\u5E73\u9501(\u53EF\u4EE5\u9632\u6B62\u7EBF\u7A0B\u9965\u997F\uFF0C\u5148\u5230\u5148\u5F97)</li><li>\u652F\u6301\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF(\u5BF9\u4E0D\u6EE1\u8DB3\u6761\u4EF6\u7684\u7EBF\u7A0B\u53EF\u4EE5\u653E\u5230\u4E0D\u540C\u7684 waitSet \u96C6\u5408\u4E2D\u7B49\u5F85)</li></ol><p>\u4E0E synchronized \u4E00\u6837\uFF0C\u90FD\u652F\u6301\u53EF\u91CD\u5165</p><p>\u57FA\u672C\u8BED\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u83B7\u53D6\u9501</span>
reentrantLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E34\u754C\u533A</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u91CA\u653E\u9501</span>
    reentrantLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u53EF\u91CD\u5165" tabindex="-1"><a class="header-anchor" href="#\u53EF\u91CD\u5165" aria-hidden="true">#</a> \u53EF\u91CD\u5165</h4><p>\u53EF\u91CD\u5165\u662F\u6307\u540C\u4E00\u4E2A\u7EBF\u7A0B\u5982\u679C\u9996\u6B21\u83B7\u5F97\u4E86\u8FD9\u628A\u9501\uFF0C\u90A3\u4E48\u56E0\u4E3A\u5B83\u662F\u8FD9\u628A\u9501\u7684\u62E5\u6709\u8005\uFF0C\u56E0\u6B64\u6709\u6743\u5229\u518D\u6B21\u83B7\u53D6\u8FD9\u628A\u9501\u3002</p><p>\u5982\u679C\u662F\u4E0D\u53EF\u91CD\u5165\u9501\uFF0C\u90A3\u4E48\u7B2C\u4E8C\u6B21\u83B7\u5F97\u9501\u65F6\uFF0C\u81EA\u5DF1\u4E5F\u4F1A\u88AB\u9501\u6321\u4F4F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">11.862</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestReentrant</span> <span class="token operator">-</span> execute method1
<span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">11.865</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestReentrant</span> <span class="token operator">-</span> execute method2
<span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">11.865</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>TestReentrant</span> <span class="token operator">-</span> execute method3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u53EF\u6253\u65AD" tabindex="-1"><a class="header-anchor" href="#\u53EF\u6253\u65AD" aria-hidden="true">#</a> \u53EF\u6253\u65AD</h4><p>\u53EF\u6253\u65AD\u4E5F\u662F\u4E00\u79CD\u907F\u514D\u6B7B\u9501\u7684\u505A\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test06&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test07</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5C1D\u8BD5\u83B7\u53D6\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u6CA1\u6709\u7ADE\u4E89\uFF0C\u76F4\u63A5\u83B7\u53D6\u5230\u9501</span>
                <span class="token comment">// \u6709\u7ADE\u4E89\uFF0C\u8FDB\u5165\u963B\u585E\u961F\u5217\uFF0C\u53EF\u88AB\u5176\u4ED6\u7EBF\u7A0B\u6253\u65AD</span>
                lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u53EF\u6253\u65AD\u7684\u9501</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u9501\u88AB\u6253\u65AD\uFF0C\u8FD4\u56DE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u5230\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152225142.png" alt="image-20220915222545006"></p><h4 id="\u9501\u8D85\u65F6" tabindex="-1"><a class="header-anchor" href="#\u9501\u8D85\u65F6" aria-hidden="true">#</a> \u9501\u8D85\u65F6</h4><p>\u7ACB\u523B\u5931\u8D25</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test06&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test07</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5C1D\u8BD5\u83B7\u53D6\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> tryLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tryLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u9501\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// \u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u9700\u8981\u5F80\u4E0B\u9762\u6267\u884C</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u5230\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152233992.png" alt="image-20220915223310825"></p><p>\u8D85\u65F6\u5931\u8D25</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test06&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test07</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5C1D\u8BD5\u83B7\u53D6\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> tryLock <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                tryLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tryLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u7B49\u5F85 1s \u540E\u5931\u8D25\uFF0C\u8FD4\u56DE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// \u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u9700\u8981\u5F80\u4E0B\u9762\u6267\u884C</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u88AB\u6253\u65AD\uFF0C\u8FD4\u56DE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u5230\u9501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152235064.png" alt="image-20220915223511924"></p><p>\u4F7F\u7528\u9501\u8D85\u65F6\u89E3\u51B3\u54F2\u5B66\u5BB6\u5C31\u9910\u6B7B\u9501\u95EE\u9898\uFF1ATest33.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test23&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test23</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Chopstick</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u82CF\u683C\u62C9\u5E95&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u67CF\u62C9\u56FE&quot;</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E9A\u91CC\u58EB\u591A\u5FB7&quot;</span><span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u8D6B\u62C9\u514B\u5229\u7279&quot;</span><span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;\u963F\u57FA\u7C73\u5FB7&quot;</span><span class="token punctuation">,</span> c5<span class="token punctuation">,</span> c1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Philosopher&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Philosopher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token class-name">Chopstick</span> left<span class="token punctuation">;</span>
    <span class="token class-name">Chopstick</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5C1D\u8BD5\u83B7\u53D6\u5DE6\u624B\u7B77\u5B50</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u5C1D\u8BD5\u83B7\u53D6\u53F3\u624B\u7B77\u5B50</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                            right<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    left<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;\u7B77\u5B50{&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u516C\u5E73\u9501" tabindex="-1"><a class="header-anchor" href="#\u516C\u5E73\u9501" aria-hidden="true">#</a> \u516C\u5E73\u9501</h4><p>synchronized\u9501\u4E2D\uFF0C\u5728entrylist\u7B49\u5F85\u7684\u9501\u5728\u7ADE\u4E89\u65F6\u4E0D\u662F\u6309\u7167\u5148\u5230\u5148\u5F97\u6765\u83B7\u53D6\u9501\u7684\uFF0C\u6240\u4EE5\u8BF4synchronized\u9501\u65F6\u4E0D\u516C\u5E73\u7684\uFF1B</p><p>ReentranLock\u9501\u9ED8\u8BA4\u662F\u4E0D\u516C\u5E73\u7684\uFF0C\u4F46\u662F\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E\u5B9E\u73B0\u516C\u5E73\u9501\u3002</p><p>\u6784\u9020\u65B9\u6CD5\uFF0Ctrue \u8868\u793A\u516C\u5E73\u9501</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u672C\u610F\u662F\u4E3A\u4E86\u89E3\u51B3\u4E4B\u524D\u63D0\u5230\u7684\u9965\u997F\u95EE\u9898\uFF0C\u4F46\u662F <strong>\u516C\u5E73\u9501\u4E00\u822C\u6CA1\u6709\u5FC5\u8981\uFF0C\u4F1A\u964D\u4F4E\u5E76\u53D1\u5EA6</strong>\uFF0C\u4F7F\u7528trylock\u4E5F\u53EF\u4EE5\u5B9E\u73B0\u3002</p><h4 id="\u6761\u4EF6\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u6761\u4EF6\u53D8\u91CF" aria-hidden="true">#</a> \u6761\u4EF6\u53D8\u91CF</h4><p>synchronized \u4E2D\u4E5F\u6709\u6761\u4EF6\u53D8\u91CF\uFF0C\u5C31\u662F\u6211\u4EEC\u8BB2\u539F\u7406\u65F6\u90A3\u4E2A waitSet \u4F11\u606F\u5BA4\uFF0C\u5F53\u6761\u4EF6\u4E0D\u6EE1\u8DB3\u65F6\u8FDB\u5165 waitSet \u7B49\u5F85 ReentrantLock \u7684\u6761\u4EF6\u53D8\u91CF\u6BD4 synchronized \u5F3A\u5927\u4E4B\u5904\u5728\u4E8E\uFF0C\u5B83\u662F\u652F\u6301\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF\u7684\uFF0C\u8FD9\u5C31\u597D\u6BD4</p><ol><li>synchronized \u662F\u90A3\u4E9B\u4E0D\u6EE1\u8DB3\u6761\u4EF6\u7684\u7EBF\u7A0B\u90FD\u5728\u4E00\u95F4\u4F11\u606F\u5BA4\u7B49\u6D88\u606F</li><li>\u800C ReentrantLock \u652F\u6301\u591A\u95F4\u4F11\u606F\u5BA4\uFF0C\u6709\u4E13\u95E8\u7B49\u70DF\u7684\u4F11\u606F\u5BA4\u3001\u4E13\u95E8\u7B49\u65E9\u9910\u7684\u4F11\u606F\u5BA4\u3001\u5524\u9192\u65F6\u4E5F\u662F\u6309\u4F11\u606F\u5BA4\u6765\u5524\u9192</li></ol><p>\u4F7F\u7528\u8981\u70B9\uFF1A</p><ol><li>await \u524D\u9700\u8981\u83B7\u5F97\u9501</li><li>await \u6267\u884C\u540E\uFF0C\u4F1A\u91CA\u653E\u9501\uFF0C\u8FDB\u5165 conditionObject \u7B49\u5F85</li><li>await \u7684\u7EBF\u7A0B\u88AB\u5524\u9192\uFF08\u6216\u6253\u65AD\u3001\u6216\u8D85\u65F6\uFF09\u53D6\u91CD\u65B0\u7ADE\u4E89 lock \u9501\uFF0C\u6267\u884C\u5524\u9192\u7684\u7EBF\u7A0B\u5FC5\u987B\u5148\u83B7\u5F97\u9501</li><li>\u7ADE\u4E89 lock \u9501\u6210\u529F\u540E\uFF0C\u4ECE await \u540E\u7EE7\u7EED\u6267\u884C</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test08&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test08</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> ROOM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasTakeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7B49\u5F85\u70DF\u7684\u4F11\u606F\u5BA4</span>
    <span class="token keyword">static</span> <span class="token class-name">Condition</span> cigaretteWaitSet <span class="token operator">=</span> ROOM<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7B49\u5F85\u5916\u5356\u7684\u4F11\u606F\u5BA4</span>
    <span class="token keyword">static</span> <span class="token class-name">Condition</span> takeUpWaitSet <span class="token operator">=</span> ROOM<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u70DF\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u70DF\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        cigaretteWaitSet<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5357&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u5916\u5356\u9001\u5230\u6CA1\uFF1F[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                w <span class="token punctuation">(</span><span class="token operator">!</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CA1\u5916\u5356\uFF0C\u5148\u6B47\u4F1A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        takeUpWaitSet<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u4EE5\u5F00\u59CB\u5E72\u6D3B\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5C0F\u5973&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u5916\u5356\u5230\u4E86</span>
                hasTakeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                takeUpWaitSet<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u5916\u5356\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                hasCigarette <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                cigaretteWaitSet<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                ROOM<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9001\u9999\u70DF\u7684&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209152306733.png" alt="image-20220915230626598"></p><h4 id="\u540C\u6B65\u6A21\u5F0F\u4E4B\u987A\u5E8F\u63A7\u5236" tabindex="-1"><a class="header-anchor" href="#\u540C\u6B65\u6A21\u5F0F\u4E4B\u987A\u5E8F\u63A7\u5236" aria-hidden="true">#</a> \u540C\u6B65\u6A21\u5F0F\u4E4B\u987A\u5E8F\u63A7\u5236</h4><h5 id="_1-\u56FA\u5B9A\u8FD0\u884C\u987A\u5E8F" tabindex="-1"><a class="header-anchor" href="#_1-\u56FA\u5B9A\u8FD0\u884C\u987A\u5E8F" aria-hidden="true">#</a> 1.\u56FA\u5B9A\u8FD0\u884C\u987A\u5E8F</h5><p>\u6BD4\u5982\uFF0C\u5FC5\u987B\u5148 2 \u540E 1 \u6253\u5370</p><h6 id="_1-1-wait-notify-\u7248" tabindex="-1"><a class="header-anchor" href="#_1-1-wait-notify-\u7248" aria-hidden="true">#</a> 1.1 wait notify \u7248</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test09&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test09</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_1-2-park-unpark-\u7248" tabindex="-1"><a class="header-anchor" href="#_1-2-park-unpark-\u7248" aria-hidden="true">#</a> 1.2 park unpark \u7248</h6><p>park \u548C unpark \u65B9\u6CD5\u6BD4\u8F83\u7075\u6D3B\uFF0C\u4ED6\u4FE9\u8C01\u5148\u8C03\u7528\uFF0C\u8C01\u540E\u8C03\u7528\u65E0\u6240\u8C13\u3002\u5E76\u4E14\u662F\u4EE5\u7EBF\u7A0B\u4E3A\u5355\u4F4D\u8FDB\u884C\u300E\u6682\u505C\u300F\u548C\u300E\u6062\u590D\u300F\uFF0C\u4E0D\u9700\u8981\u300E\u540C\u6B65\u5BF9\u8C61\u300F\u548C\u300E\u8FD0\u884C\u6807\u8BB0\u300F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test10&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test10</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-\u4EA4\u66FF\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#_2-\u4EA4\u66FF\u8F93\u51FA" aria-hidden="true">#</a> 2.\u4EA4\u66FF\u8F93\u51FA</h5><p>\u7EBF\u7A0B 1 \u8F93\u51FA a 5 \u6B21\uFF0C\u7EBF\u7A0B 2 \u8F93\u51FA b 5 \u6B21\uFF0C\u7EBF\u7A0B 3 \u8F93\u51FA c 5 \u6B21\u3002\u73B0\u5728\u8981\u6C42\u8F93\u51FA abcabcabcabcabc \u600E\u4E48\u5B9E\u73B0</p><h6 id="_2-1-wait-notify-\u7248" tabindex="-1"><a class="header-anchor" href="#_2-1-wait-notify-\u7248" aria-hidden="true">#</a> 2.1 wait notify \u7248</h6><p>\u6DFB\u52A0\u7B49\u5F85\u6807\u8BB0\uFF0C\u5E76\u521D\u59CB\u5316\u4E3A 1\uFF0C\u56E0\u6B64 a \u4F1A\u5148\u6267\u884C\uFF0C\u6253\u5370\u5E76\u8BBE\u7F6E\u7B49\u5F85\u6807\u8BB0\u4E3A 2\uFF0C\u4E0B\u4E00\u4E2A\u8F6E\u5230 b \u6267\u884C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8F93\u51FA   \u7B49\u5F85\u6807\u8BB0    \u4E0B\u4E2A\u6807\u8BB0
 * a        1           2
 * b        2           3
 * b        3           1
 */</span>
<span class="token keyword">class</span> <span class="token class-name">WaitNotify</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> flag<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> loopNumber<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">WaitNotify</span><span class="token punctuation">(</span><span class="token keyword">int</span> flag<span class="token punctuation">,</span> <span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> flag<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loopNumber <span class="token operator">=</span> loopNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// a        1           2</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> waitFlag<span class="token punctuation">,</span> <span class="token keyword">int</span> nextFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>flag <span class="token operator">!=</span> waitFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                flag <span class="token operator">=</span> nextFlag<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test11&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test11</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WaitNotify</span> waitNotify <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WaitNotify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            waitNotify<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            waitNotify<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            waitNotify<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-2-lock-\u6761\u4EF6\u53D8\u91CF\u7248" tabindex="-1"><a class="header-anchor" href="#_2-2-lock-\u6761\u4EF6\u53D8\u91CF\u7248" aria-hidden="true">#</a> 2.2 Lock \u6761\u4EF6\u53D8\u91CF\u7248</h6><p>\u8BBE\u7F6E\u4E09\u95F4\u4F11\u606F\u5BA4\uFF0C\u4E00\u5F00\u59CB\u8BA9 a,b,c \u90FD\u8FDB\u5165\u4F11\u606F\u5BA4\u7B49\u5F85\uFF0C\u7136\u540E\u7531\u4E3B\u7EBF\u7A0B\u5524\u9192 a\uFF0C\u518D\u8BA9 a \u5524\u9192 b...</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.AwaitSignal&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AwaitSignal</span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> loopNumber<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AwaitSignal</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loopNumber <span class="token operator">=</span> loopNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// a    \u5F53\u524D\u4F11\u606F\u5BA4   \u4E0B\u4E00\u4E2A\u88AB\u5524\u9192\u7684\u4F11\u606F\u5BA4</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">Condition</span> current<span class="token punctuation">,</span> <span class="token class-name">Condition</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u83B7\u53D6\u9501</span>
            <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u4E00\u5F00\u59CB\u8BA9\u6240\u6709\u7EBF\u7A0B\u8FDB\u5165\u4F11\u606F\u5BA4\u7B49\u5F85</span>
                current<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u5524\u9192\u4E0B\u4E00\u95F4\u4F11\u606F\u5BA4</span>
                next<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test12&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test12</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AwaitSignal</span> awaitSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AwaitSignal</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> a <span class="token operator">=</span> awaitSignal<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> b <span class="token operator">=</span> awaitSignal<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> c <span class="token operator">=</span> awaitSignal<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            awaitSignal<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            awaitSignal<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            awaitSignal<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4E3B\u7EBF\u7A0B\u5524\u9192 a</span>
        awaitSignal<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            a<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            awaitSignal<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-3-park-unpark-\u7248" tabindex="-1"><a class="header-anchor" href="#_2-3-park-unpark-\u7248" aria-hidden="true">#</a> 2.3 Park Unpark \u7248</h6><p>\u601D\u8DEF\u8DDF 2.2 \u7C7B\u4F3C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ParkUnpark</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> loopNumber<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ParkUnpark</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loopNumber <span class="token operator">=</span> loopNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">Thread</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test13&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test13</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">Thread</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Thread</span> t2<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Thread</span> t3<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ParkUnpark</span> pu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParkUnpark</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            pu<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            pu<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            pu<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u672C\u7AE0\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u672C\u7AE0\u5C0F\u7ED3" aria-hidden="true">#</a> \u672C\u7AE0\u5C0F\u7ED3</h3><p>\u672C\u7AE0\u6211\u4EEC\u9700\u8981\u91CD\u70B9\u638C\u63E1\u7684\u662F</p><ol><li>\u5206\u6790\u591A\u7EBF\u7A0B\u8BBF\u95EE\u5171\u4EAB\u8D44\u6E90\u65F6\uFF0C\u54EA\u4E9B\u4EE3\u7801\u7247\u6BB5\u5C5E\u4E8E\u4E34\u754C\u533A(\u6709\u591A\u4E2A\u7EBF\u7A0B\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C)</li><li>\u4F7F\u7528 synchronized \u4E92\u65A5(\u9632\u6B62\u6307\u4EE4\u4EA4\u9519\uFF0C\u4FDD\u8BC1\u4E34\u754C\u533A\u7684\u539F\u5B50\u6027)\u89E3\u51B3\u4E34\u754C\u533A\u7684\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898 <ol><li>\u638C\u63E1 synchronized \u9501\u5BF9\u8C61\u8BED\u6CD5</li><li>\u638C\u63E1 synchronzied \u52A0\u8F7D\u6210\u5458\u65B9\u6CD5(\u9501\u5BF9\u8C61)\u548C\u9759\u6001\u65B9\u6CD5(\u9501\u7C7B\u5BF9\u8C61)\u8BED\u6CD5</li><li>\u638C\u63E1 wait/notify \u540C\u6B65(\u67D0\u4E2A\u7EBF\u7A0B\u4E0D\u6EE1\u8DB3\u6761\u4EF6\u65F6\uFF0C\u7B49\u5F85\uFF0C\u7B49\u6EE1\u8DB3\u6761\u4EF6\u65F6\u518D\u6267\u884C)\u65B9\u6CD5</li></ol></li><li>\u4F7F\u7528 lock \u4E92\u65A5\u89E3\u51B3\u4E34\u754C\u533A\u7684\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898 \u638C\u63E1 lock \u7684\u4F7F\u7528\u7EC6\u8282\uFF1A<strong>\u53EF\u6253\u65AD\u3001\u9501\u8D85\u65F6\u3001\u516C\u5E73\u9501\u3001\u6761\u4EF6\u53D8\u91CF</strong></li><li>\u5B66\u4F1A\u5206\u6790\u53D8\u91CF\u7684\u7EBF\u7A0B\u5B89\u5168\u6027\u3001\u638C\u63E1\u5E38\u89C1\u7EBF\u7A0B\u5B89\u5168\u7C7B\u7684\u4F7F\u7528</li><li>\u4E86\u89E3\u7EBF\u7A0B\u6D3B\u8DC3\u6027\u95EE\u9898\uFF1A\u6B7B\u9501\u3001\u6D3B\u9501\u3001\u9965\u997F(\u9664\u6D3B\u9501\u5916\uFF0C\u5176\u4ED6\u95EE\u9898\u90FD\u53EF\u4EE5\u7528 ReentrantLock \u89E3\u51B3)</li><li>\u5E94\u7528\u65B9\u9762 <ol><li><strong>\u4E92\u65A5\uFF1A\u4F7F\u7528 synchronized \u6216 Lock \u8FBE\u5230\u5171\u4EAB\u8D44\u6E90\u4E92\u65A5\u6548\u679C\uFF0C\u5B9E\u73B0\u539F\u5B50\u6027\u6548\u679C\uFF0C\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u3002</strong></li><li><strong>\u540C\u6B65\uFF1A\u4F7F\u7528 wait/notify \u6216 Lock \u7684\u6761\u4EF6\u53D8\u91CF\u6765\u8FBE\u5230\u7EBF\u7A0B\u95F4\u901A\u4FE1\u6548\u679C\u3002</strong></li></ol></li><li>\u539F\u7406\u65B9\u9762 <ol><li>monitor\u3001synchronized \u3001wait/notify \u539F\u7406</li><li>synchronized \u8FDB\u9636\u539F\u7406</li><li>park &amp; unpark \u539F\u7406</li></ol></li><li>\u6A21\u5F0F\u65B9\u9762 <ol><li>\u540C\u6B65\u6A21\u5F0F\u4E4B\u4FDD\u62A4\u6027\u6682\u505C(\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u4E00\u4E00\u5BF9\u5E94\u7684\u5173\u7CFB)</li><li>\u5F02\u6B65\u6A21\u5F0F\u4E4B\u751F\u4EA7\u8005\u6D88\u8D39\u8005(\u7ED3\u679C\u4EA7\u751F\u8005\u548C\u7ED3\u679C\u4F7F\u7528\u8005\u4E0D\u662F\u4E00\u4E00\u5BF9\u5E94\u7684\u5173\u7CFB\uFF0C\u6BD4\u5982\u591A\u4E2A\u751F\u4EA7\u8005\u5BF9\u5E94\u4E00\u4E2A\u6D88\u8D39\u8005)</li><li>\u540C\u6B65\u6A21\u5F0F\u4E4B\u987A\u5E8F\u63A7\u5236(\u63A7\u5236\u7EBF\u7A0B\u7684\u987A\u5E8F\u6267\u884C\uFF0C\u4EA4\u66FF\u6267\u884C)</li></ol></li></ol><h2 id="_5-\u5171\u4EAB\u6A21\u578B\u4E4B\u5185\u5B58" tabindex="-1"><a class="header-anchor" href="#_5-\u5171\u4EAB\u6A21\u578B\u4E4B\u5185\u5B58" aria-hidden="true">#</a> 5.\u5171\u4EAB\u6A21\u578B\u4E4B\u5185\u5B58</h2><p>\u4E0A\u4E00\u7AE0\u8BB2\u89E3\u7684 Monitor \u4E3B\u8981\u5173\u6CE8\u7684\u662F\u8BBF\u95EE\u5171\u4EAB\u53D8\u91CF\u65F6\uFF0C\u4FDD\u8BC1\u4E34\u754C\u533A\u4EE3\u7801\u7684\u539F\u5B50\u6027\u3002\u8FD9\u4E00\u7AE0\u6211\u4EEC\u8FDB\u4E00\u6B65\u6DF1\u5165\u5B66\u4E60\u5171\u4EAB\u53D8\u91CF\u5728\u591A\u7EBF\u7A0B\u95F4\u7684\u3010\u53EF\u89C1\u6027\u3011\u95EE\u9898\u4E0E\u591A\u6761\u6307\u4EE4\u6267\u884C\u65F6\u7684\u3010\u6709\u5E8F\u6027\u3011\u95EE\u9898</p><h3 id="_5-1-java-\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_5-1-java-\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> 5.1 Java \u5185\u5B58\u6A21\u578B</h3><p>JMM \u5373 Java Memory Model\uFF0C\u5B83\u4ECEjava\u5C42\u9762\u5B9A\u4E49\u4E86\u4E3B\u5B58(\u7EBF\u7A0B\u5171\u4EAB)\u3001\u5DE5\u4F5C\u5185\u5B58(\u7EBF\u7A0B\u79C1\u6709)\u62BD\u8C61\u6982\u5FF5\uFF0C\u5E95\u5C42\u5BF9\u5E94\u7740 CPU \u5BC4\u5B58\u5668\u3001\u7F13\u5B58\u3001\u786C\u4EF6\u5185\u5B58\u3001CPU \u6307\u4EE4\u4F18\u5316\u7B49\u3002JMM \u4F53\u73B0\u5728\u4EE5\u4E0B\u51E0\u4E2A\u65B9\u9762</p><ol><li>\u539F\u5B50\u6027 - \u4FDD\u8BC1\u6307\u4EE4\u4E0D\u4F1A\u53D7\u5230\u7EBF\u7A0B\u4E0A\u4E0B\u6587\u5207\u6362\u7684\u5F71\u54CD</li><li>\u53EF\u89C1\u6027 - \u4FDD\u8BC1\u6307\u4EE4\u4E0D\u4F1A\u53D7 cpu \u7F13\u5B58\u7684\u5F71\u54CD</li><li>\u6709\u5E8F\u6027 - \u4FDD\u8BC1\u6307\u4EE4\u4E0D\u4F1A\u53D7 cpu \u6307\u4EE4\u5E76\u884C\u4F18\u5316\u7684\u5F71\u54CD</li></ol><h3 id="_5-2-\u53EF\u89C1\u6027" tabindex="-1"><a class="header-anchor" href="#_5-2-\u53EF\u89C1\u6027" aria-hidden="true">#</a> 5.2 \u53EF\u89C1\u6027</h3><h4 id="\u9000\u4E0D\u51FA\u7684\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#\u9000\u4E0D\u51FA\u7684\u5FAA\u73AF" aria-hidden="true">#</a> \u9000\u4E0D\u51FA\u7684\u5FAA\u73AF</h4><p>\u5148\u6765\u770B\u4E00\u4E2A\u73B0\u8C61\uFF0Cmain \u7EBF\u7A0B\u5BF9 run \u53D8\u91CF\u7684\u4FEE\u6539\u5BF9\u4E8E t \u7EBF\u7A0B\u4E0D\u53EF\u89C1\uFF0C\u5BFC\u81F4\u4E86 t \u7EBF\u7A0B\u65E0\u6CD5\u505C\u6B62\uFF1ATest1.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test14</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> run <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// ....</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        run <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// \u7EBF\u7A0Bt\u4E0D\u4F1A\u5982\u9884\u60F3\u7684\u505C\u4E0B\u6765</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4EC0\u4E48\u5462\uFF1F\u5206\u6790\u4E00\u4E0B\uFF1A</p><ol><li><p>\u521D\u59CB\u72B6\u6001\uFF0C t \u7EBF\u7A0B\u521A\u5F00\u59CB\u4ECE\u4E3B\u5185\u5B58\u8BFB\u53D6\u4E86 run \u7684\u503C\u5230\u5DE5\u4F5C\u5185\u5B58\u3002</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209161745290.png" alt="1594646434877"></p></li><li><p>\u56E0\u4E3At1\u7EBF\u7A0B\u9891\u7E41\u5730\u4ECE\u4E3B\u5B58\u4E2D\u8BFB\u53D6run\u7684\u503C\uFF0Cjit\u5373\u65F6\u7F16\u8BD1\u5668\u4F1A\u5C06run\u7684\u503C\u7F13\u5B58\u81F3\u81EA\u5DF1\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u9AD8\u901F\u7F13\u5B58\u4E2D\uFF0C\u51CF\u5C11\u5BF9\u4E3B\u5B58\u4E2Drun\u7684\u8BBF\u95EE\u4EE5\u63D0\u9AD8\u6548\u7387</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603575.png" alt="1594646562777"></p></li><li><p>1 \u79D2\u4E4B\u540E\uFF0Cmain \u7EBF\u7A0B\u4FEE\u6539\u4E86 run \u7684\u503C\uFF0C\u5E76\u540C\u6B65\u81F3\u4E3B\u5B58\uFF0C\u800C t \u662F\u4ECE\u81EA\u5DF1\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u9AD8\u901F\u7F13\u5B58\u4E2D\u8BFB\u53D6\u8FD9\u4E2A\u53D8\u91CF\u7684\u503C\uFF0C\u7ED3\u679C\u6C38\u8FDC\u662F\u65E7\u503C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603585.png" alt="1594646581590"></p></li></ol><h4 id="\u89E3\u51B3\u65B9\u6CD5-1" tabindex="-1"><a class="header-anchor" href="#\u89E3\u51B3\u65B9\u6CD5-1" aria-hidden="true">#</a> \u89E3\u51B3\u65B9\u6CD5</h4><h5 id="\u65B9\u6CD51-volatile" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6CD51-volatile" aria-hidden="true">#</a> \u65B9\u6CD51-volatile</h5><p>volatile\uFF08\u8868\u793A\u6613\u53D8\u5173\u952E\u5B57\u7684\u610F\u601D\uFF09\uFF0C\u5B83\u53EF\u4EE5\u7528\u6765\u4FEE\u9970\u6210\u5458\u53D8\u91CF\u548C\u9759\u6001\u6210\u5458\u53D8\u91CF\uFF0C\u4ED6\u53EF\u4EE5\u907F\u514D\u7EBF\u7A0B\u4ECE\u81EA\u5DF1\u7684\u5DE5\u4F5C\u7F13\u5B58\u4E2D\u67E5\u627E\u53D8\u91CF\u7684\u503C\uFF0C\u5FC5\u987B\u5230\u4E3B\u5B58\u4E2D\u83B7\u53D6\u5B83\u7684\u503C\uFF0C\u7EBF\u7A0B\u64CD\u4F5C volatile \u53D8\u91CF\u90FD\u662F\u76F4\u63A5\u64CD\u4F5C\u4E3B\u5B58</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> run <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="\u65B9\u6CD52-synchronized" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6CD52-synchronized" aria-hidden="true">#</a> \u65B9\u6CD52-synchronized</h5><p>\u4F7F\u7528synchronized\u5173\u952E\u5B57\u4E5F\u6709\u76F8\u540C\u7684\u6548\u679C\uFF01</p><p>\u5728Java\u5185\u5B58\u6A21\u578B\u4E2D\uFF0Csynchronized\u89C4\u5B9A\uFF0C\u7EBF\u7A0B\u5728\u52A0\u9501\u65F6\uFF0C\u5148\u6E05\u7A7A\u5DE5\u4F5C\u5185\u5B58--&gt;\u5728\u4E3B\u5185\u5B58\u4E2D\u62F7\u8D1D\u6700\u65B0\u53D8\u91CF\u7684\u526F\u672C\u5230\u5DE5\u4F5C\u5185\u5B58--&gt;\u6267\u884C\u5B8C\u4EE3\u7801--&gt;\u5C06\u66F4\u6539\u540E\u7684\u5171\u4EAB\u53D8\u91CF\u7684\u503C\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D--&gt;\u91CA\u653E\u4E92\u65A5\u9501\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test14</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">boolean</span> run <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>run<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            run <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u53EF\u89C1\u6027-vs-\u539F\u5B50\u6027" tabindex="-1"><a class="header-anchor" href="#\u53EF\u89C1\u6027-vs-\u539F\u5B50\u6027" aria-hidden="true">#</a> \u53EF\u89C1\u6027 vs \u539F\u5B50\u6027</h4><p>\u524D\u9762\u4F8B\u5B50\u4F53\u73B0\u7684\u5B9E\u9645\u5C31\u662F\u53EF\u89C1\u6027\uFF0C<strong>\u5B83\u4FDD\u8BC1\u7684\u662F\u5728\u591A\u4E2A\u7EBF\u7A0B\u4E4B\u95F4\u4E00\u4E2A\u7EBF\u7A0B\u5BF9 volatile \u53D8\u91CF\u7684\u4FEE\u6539\u5BF9\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u89C1\uFF0C\u800C\u4E0D\u80FD\u4FDD\u8BC1\u539F\u5B50\u6027</strong>\uFF0C\u4EC5\u7528\u5728 <strong>\u4E00\u4E2A\u5199\u7EBF\u7A0B\uFF0C\u591A\u4E2A\u8BFB\u7EBF\u7A0B</strong>\u7684\u60C5\u51B5\u3002</p><p>\u4E0A\u4F8B\u4ECE\u5B57\u8282\u7801\u7406\u89E3\u662F\u8FD9\u6837\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>getstatic run <span class="token comment">// \u7EBF\u7A0B t \u83B7\u53D6 run true</span>
getstatic run <span class="token comment">// \u7EBF\u7A0B t \u83B7\u53D6 run true</span>
getstatic run <span class="token comment">// \u7EBF\u7A0B t \u83B7\u53D6 run true</span>
getstatic run <span class="token comment">// \u7EBF\u7A0B t \u83B7\u53D6 run true</span>
putstatic run <span class="token comment">// \u7EBF\u7A0B main \u4FEE\u6539 run \u4E3A false\uFF0C \u4EC5\u6B64\u4E00\u6B21</span>
getstatic run <span class="token comment">// \u7EBF\u7A0B t \u83B7\u53D6 run false </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BD4\u8F83\u4E00\u4E0B\u4E4B\u524D\u6211\u4EEC\u5C06\u7EBF\u7A0B\u5B89\u5168\u65F6\u4E3E\u7684\u4F8B\u5B50\uFF1A\u4E24\u4E2A\u7EBF\u7A0B\u4E00\u4E2A i++ \u4E00\u4E2A i-- \uFF0C\u53EA\u80FD\u4FDD\u8BC1\u770B\u5230\u6700\u65B0\u503C\uFF0C\u4E0D\u80FD\u89E3\u51B3\u6307\u4EE4\u4EA4\u9519</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u5047\u8BBEi\u7684\u521D\u59CB\u503C\u4E3A0</span>
getstatic i <span class="token comment">// \u7EBF\u7A0B2-\u83B7\u53D6\u9759\u6001\u53D8\u91CFi\u7684\u503C \u7EBF\u7A0B\u5185i=0</span>
    
getstatic i <span class="token comment">// \u7EBF\u7A0B1-\u83B7\u53D6\u9759\u6001\u53D8\u91CFi\u7684\u503C \u7EBF\u7A0B\u5185i=0</span>
iconst_1 <span class="token comment">// \u7EBF\u7A0B1-\u51C6\u5907\u5E38\u91CF1</span>
iadd <span class="token comment">// \u7EBF\u7A0B1-\u81EA\u589E \u7EBF\u7A0B\u5185i=1</span>
putstatic i <span class="token comment">// \u7EBF\u7A0B1-\u5C06\u4FEE\u6539\u540E\u7684\u503C\u5B58\u5165\u9759\u6001\u53D8\u91CFi \u9759\u6001\u53D8\u91CFi=1</span>
    
iconst_1 <span class="token comment">// \u7EBF\u7A0B2-\u51C6\u5907\u5E38\u91CF1</span>
isub <span class="token comment">// \u7EBF\u7A0B2-\u81EA\u51CF \u7EBF\u7A0B\u5185i=-1</span>
putstatic i <span class="token comment">// \u7EBF\u7A0B2-\u5C06\u4FEE\u6539\u540E\u7684\u503C\u5B58\u5165\u9759\u6001\u53D8\u91CFi \u9759\u6001\u53D8\u91CFi=-1 </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F\uFF1A</p><p>synchronized \u8BED\u53E5\u5757\u65E2\u53EF\u4EE5\u4FDD\u8BC1\u4EE3\u7801\u5757\u7684\u539F\u5B50\u6027\uFF0C\u4E5F\u540C\u65F6\u4FDD\u8BC1\u4EE3\u7801\u5757\u5185\u53D8\u91CF\u7684\u53EF\u89C1\u6027\u3002\u4F46\u7F3A\u70B9\u662Fsynchronized \u662F\u5C5E\u4E8E\u91CD\u91CF\u7EA7\u64CD\u4F5C\uFF0C\u6027\u80FD\u76F8\u5BF9\u66F4\u4F4E\u3002</p></blockquote><p>\u5982\u679C\u5728\u524D\u9762\u793A\u4F8B\u7684\u6B7B\u5FAA\u73AF\u4E2D\u52A0\u5165 System.out.println() \u4F1A\u53D1\u73B0\u5373\u4F7F\u4E0D\u52A0 volatile \u4FEE\u9970\u7B26\uFF0C\u7EBF\u7A0B t \u4E5F\u80FD\u6B63\u786E\u770B\u5230\u5BF9 run \u53D8\u91CF\u7684\u4FEE\u6539\u4E86\uFF0C\u60F3\u4E00\u60F3\u4E3A\u4EC0\u4E48\uFF1F</p><p>\u56E0\u4E3A println \u65B9\u6CD5\u91CC\u9762\u6709synchronized\u4FEE\u9970\uFF0C\u4FDD\u8BC1\u4E86\u53EF\u89C1\u6027\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6A21\u5F0F\u4E4B\u4E24\u9636\u6BB5\u7EC8\u6B62" tabindex="-1"><a class="header-anchor" href="#\u6A21\u5F0F\u4E4B\u4E24\u9636\u6BB5\u7EC8\u6B62" aria-hidden="true">#</a> \u6A21\u5F0F\u4E4B\u4E24\u9636\u6BB5\u7EC8\u6B62</h4><p>\u4F7F\u7528 volatile \u5173\u952E\u5B57\u6765\u6539\u8FDB\u4E24\u9636\u6BB5\u7EC8\u6B62\u6A21\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.Test02&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test02</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">TwoParseTermination</span> twoParseTermination <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TwoParseTermination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        twoParseTermination<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u505C\u6B62\u76D1\u63A7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        twoParseTermination<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TwoPhaseTermination&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">TwoParseTermination</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> minitor<span class="token punctuation">;</span>
    <span class="token comment">// \u505C\u6B62\u6807\u8BB0</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// \u4FDD\u8BC1\u53EF\u89C1\u6027</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        minitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6599\u7406\u540E\u4E8B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u76D1\u63A7\u529F\u80FD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        minitor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        minitor<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6253\u65AD\u53EF\u4EE5\u4F7F\u5904\u4E8E\u7761\u7720\u7684\u8FDB\u7A0B\u7ACB\u523B\u7ED3\u675F</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209162250676.png" alt="image-20220916225005587"></p><h4 id="\u6A21\u5F0F\u4E4B-balking" tabindex="-1"><a class="header-anchor" href="#\u6A21\u5F0F\u4E4B-balking" aria-hidden="true">#</a> \u6A21\u5F0F\u4E4B Balking</h4><p>Balking \uFF08\u72B9\u8C6B\uFF09\u6A21\u5F0F\u7528\u5728\u4E00\u4E2A\u7EBF\u7A0B\u53D1\u73B0\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u6216\u672C\u7EBF\u7A0B\u5DF2\u7ECF\u505A\u4E86\u67D0\u4E00\u4EF6\u76F8\u540C\u7684\u4E8B\uFF0C\u90A3\u4E48\u672C\u7EBF\u7A0B\u5C31\u65E0\u9700\u518D\u505A\u4E86\uFF0C\u76F4\u63A5\u7ED3\u675F\u8FD4\u56DE\u3002</p><p>\u524D\u9762\u7684\u4EE3\u7801\u6709\u4EC0\u4E48\u95EE\u9898\uFF1F</p><p>\u4E00\u65E6\u6211\u4EEC\u8C03\u7528\u4E24\u6B21\u76D1\u63A7\u7EBF\u7A0B\uFF0C\u6BCF\u79D2\u5C31\u4F1A\u6267\u884C\u4E24\u6B21\u76D1\u63A7\uFF0C\u51FA\u73B0\u4E86\u4E0D\u5FC5\u8981\u7684\u76D1\u63A7</p><p>\u4F18\u5316\uFF1A\u6DFB\u52A0\u7EBF\u7A0B\u5F00\u59CB\u7684\u6807\u8BB0\uFF0C\u5F53\u76D1\u63A7\u7EBF\u7A0B\u5DF2\u7ECF\u542F\u52A8\u65F6\uFF0C\u5C31\u4E0D\u9700\u8981\u518D\u6B21\u542F\u52A8\u76D1\u63A7\u7EBF\u7A0B\u4E86</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;c.TwoPhaseTermination&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">TwoParseTermination</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> minitor<span class="token punctuation">;</span>
    <span class="token comment">// \u505C\u6B62\u7684\u6807\u8BB0</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// \u4FDD\u8BC1\u53EF\u89C1\u6027</span>
    <span class="token comment">// \u542F\u52A8\u7684\u6807\u8BB0</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u52A0\u9501\u4FDD\u8BC1\u539F\u5B50\u6027</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        minitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6599\u7406\u540E\u4E8B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u76D1\u63A7\u529F\u80FD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        minitor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        minitor<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6253\u65AD\u53EF\u4EE5\u4F7F\u5904\u4E8E\u7761\u7720\u7684\u8FDB\u7A0B\u7ACB\u523B\u7ED3\u675F</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4ED6\u5E94\u7528-\u76D1\u63A7\u7EBF\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitorService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> stop<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> starting<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Thread</span> monitorThread<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u7F29\u5C0F\u540C\u6B65\u8303\u56F4\uFF0C\u63D0\u5347\u6027\u80FD</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BE5\u76D1\u63A7\u7EBF\u7A0B\u5DF2\u542F\u52A8?({})&quot;</span><span class="token punctuation">,</span> starting<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>starting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            starting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u7531\u4E8E\u4E4B\u524D\u7684 balking \u6A21\u5F0F\uFF0C\u4EE5\u4E0B\u4EE3\u7801\u53EA\u53EF\u80FD\u88AB\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\uFF0C\u56E0\u6B64\u65E0\u9700\u4E92\u65A5</span>
        monitorThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// \u8FD9\u91CC\u7684\u76D1\u63A7\u7EBF\u7A0B\u53EA\u4F1A\u542F\u52A8\u4E00\u4E2A\uFF0C\u56E0\u6B64\u53EA\u9700\u8981\u7528 volatile \u4FDD\u8BC1 starting \u7684\u53EF\u89C1\u6027</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u76D1\u63A7\u7EBF\u7A0B\u5DF2\u505C\u6B62...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            starting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// \u8FD9\u6BB5\u4EE3\u7801\u6CA1\u6709\u52A0\u540C\u6B65\u4EE3\u7801\u5757\uFF0C\u5728\u76D1\u63A7\u7EBF\u7A0B\u4E2D\u4FEE\u6539\uFF0C\u9700\u8981\u7528 volatile \u4FEE\u9970\u6765\u4FDD\u8BC1\u5BF9 tomcat \u7EBF\u7A0B\u7684\u53EF\u89C1\u6027</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u76D1\u63A7\u7EBF\u7A0B\u5DF2\u542F\u52A8...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitorThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Info</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setFree</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MonitorController</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">long</span> seconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4E0D\u52A0\u6253\u65AD\u9700\u8981\u7B49\u5230\u4E0B\u4E00\u6B21 sleep \u7ED3\u675F\u624D\u80FD\u9000\u51FA\u5FAA\u73AF\uFF0C\u8FD9\u91CC\u662F\u4E3A\u4E86\u66F4\u5FEB\u7ED3\u675F</span>
        monitorThread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u524D\u7AEF\u9875\u9762\u591A\u6B21\u70B9\u51FB\u6309\u94AE\u8C03\u7528 start \u65F6</p><p>\u8F93\u51FA</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209162306388.png" alt="image-20220916230646320"></p><p>\u5B83\u8FD8\u7ECF\u5E38\u7528\u6765\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u5355\u4F8B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u6BD4\u4E00\u4E0B\u4FDD\u62A4\u6027\u6682\u505C\u6A21\u5F0F\uFF1A\u4FDD\u62A4\u6027\u6682\u505C\u6A21\u5F0F\u7528\u5728\u4E00\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u5F53\u6761\u4EF6\u4E0D\u6EE1\u8DB3\u65F6\u7EBF\u7A0B\u7B49\u5F85\u3002</p><h3 id="_5-3-\u6709\u5E8F\u6027" tabindex="-1"><a class="header-anchor" href="#_5-3-\u6709\u5E8F\u6027" aria-hidden="true">#</a> 5.3 \u6709\u5E8F\u6027</h3><p>JVM \u4F1A\u5728\u4E0D\u5F71\u54CD\u6B63\u786E\u6027\u7684\u524D\u63D0\u4E0B\uFF0C\u53EF\u4EE5\u8C03\u6574\u8BED\u53E5\u7684\u6267\u884C\u987A\u5E8F\uFF0C\u601D\u8003\u4E0B\u9762\u4E00\u6BB5\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> j<span class="token punctuation">;</span>
<span class="token comment">// \u5728\u67D0\u4E2A\u7EBF\u7A0B\u5185\u6267\u884C\u5982\u4E0B\u8D4B\u503C\u64CD\u4F5C</span>
i <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
j <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u81F3\u4E8E\u662F\u5148\u6267\u884C i \u8FD8\u662F \u5148\u6267\u884C j \uFF0C\u5BF9\u6700\u7EC8\u7684\u7ED3\u679C\u4E0D\u4F1A\u4EA7\u751F\u5F71\u54CD\u3002\u6240\u4EE5\uFF0C\u4E0A\u9762\u4EE3\u7801\u771F\u6B63\u6267\u884C\u65F6\uFF0C\u65E2\u53EF\u4EE5\u662F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>i <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
j <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u53EF\u4EE5\u662F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>j <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
i <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u79CD\u7279\u6027\u79F0\u4E4B\u4E3A\u300E<strong>\u6307\u4EE4\u91CD\u6392</strong>\u300F\uFF0C\u591A\u7EBF\u7A0B\u4E0B\u300E\u6307\u4EE4\u91CD\u6392\u300F\u4F1A\u5F71\u54CD\u6B63\u786E\u6027\u3002\u4E3A\u4EC0\u4E48\u8981\u6709\u91CD\u6392\u6307\u4EE4\u8FD9\u9879\u4F18\u5316\u5462\uFF1F\u4ECE CPU \u6267\u884C\u6307\u4EE4\u7684\u539F\u7406\u6765\u7406\u89E3\u4E00\u4E0B\u5427</p><h4 id="\u539F\u7406\u4E4B\u6307\u4EE4\u7EA7\u5E76\u884C" tabindex="-1"><a class="header-anchor" href="#\u539F\u7406\u4E4B\u6307\u4EE4\u7EA7\u5E76\u884C" aria-hidden="true">#</a> \u539F\u7406\u4E4B\u6307\u4EE4\u7EA7\u5E76\u884C</h4><h5 id="_1-\u9C7C\u7F50\u5934\u7684\u6545\u4E8B" tabindex="-1"><a class="header-anchor" href="#_1-\u9C7C\u7F50\u5934\u7684\u6545\u4E8B" aria-hidden="true">#</a> 1.\u9C7C\u7F50\u5934\u7684\u6545\u4E8B</h5><p>\u52A0\u5DE5\u4E00\u6761\u9C7C\u9700\u8981 50 \u5206\u949F\uFF0C\u53EA\u80FD\u4E00\u6761\u9C7C\u3001\u4E00\u6761\u9C7C\u987A\u5E8F\u52A0\u5DE5...</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171451770.png" alt="image-20220917145127677"></p><p>\u53EF\u4EE5\u5C06\u6BCF\u4E2A\u9C7C\u7F50\u5934\u7684\u52A0\u5DE5\u6D41\u7A0B\u7EC6\u5206\u4E3A 5 \u4E2A\u6B65\u9AA4\uFF1A</p><ul><li>\u53BB\u9CDE\u6E05\u6D17 10\u5206\u949F</li><li>\u84B8\u716E\u6CA5\u6C34 10\u5206\u949F</li><li>\u52A0\u6CE8\u6C64\u6599 10\u5206\u949F</li><li>\u6740\u83CC\u51FA\u9505 10\u5206\u949F</li><li>\u771F\u7A7A\u5C01\u7F50 10\u5206\u949F</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171452086.png" alt="image-20220917145211997"></p><p>\u5373\u4F7F\u53EA\u6709\u4E00\u4E2A\u5DE5\u4EBA\uFF0C\u6700\u7406\u60F3\u7684\u60C5\u51B5\u662F\uFF1A\u4ED6\u80FD\u591F\u5728 10 \u5206\u949F\u5185\u540C\u65F6\u505A\u597D\u8FD9 5 \u4EF6\u4E8B\uFF0C\u56E0\u4E3A\u5BF9\u7B2C\u4E00\u6761\u9C7C\u7684\u771F\u7A7A\u88C5\u7F50\uFF0C\u4E0D\u4F1A\u5F71\u54CD\u5BF9\u7B2C\u4E8C\u6761\u9C7C\u7684\u6740\u83CC\u51FA\u9505...</p><h5 id="_2-\u6307\u4EE4\u91CD\u6392\u5E8F\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_2-\u6307\u4EE4\u91CD\u6392\u5E8F\u4F18\u5316" aria-hidden="true">#</a> 2.\u6307\u4EE4\u91CD\u6392\u5E8F\u4F18\u5316</h5><p>\u4E8B\u5B9E\u4E0A\uFF0C\u73B0\u4EE3\u5904\u7406\u5668\u4F1A\u8BBE\u8BA1\u4E3A\u4E00\u4E2A\u65F6\u949F\u5468\u671F\u5B8C\u6210\u4E00\u6761\u6267\u884C\u65F6\u95F4\u6700\u957F\u7684 CPU \u6307\u4EE4\u3002\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u505A\u5462\uFF1F\u53EF\u4EE5\u60F3\u5230\u6307\u4EE4\u8FD8\u53EF\u4EE5\u518D\u5212\u5206\u6210\u4E00\u4E2A\u4E2A\u66F4\u5C0F\u7684\u9636\u6BB5\uFF0C\u4F8B\u5982\uFF0C\u6BCF\u6761\u6307\u4EE4\u90FD\u53EF\u4EE5\u5206\u4E3A\uFF1A \u53D6\u6307\u4EE4 - \u6307\u4EE4\u8BD1\u7801 - \u6267\u884C\u6307\u4EE4 - \u5185\u5B58\u8BBF\u95EE - \u6570\u636E\u5199\u56DE \u8FD9 5 \u4E2A\u9636\u6BB5</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171452344.png" alt="image-20220917145251264"></p><p>\u5728\u4E0D\u6539\u53D8\u7A0B\u5E8F\u7ED3\u679C\u7684\u524D\u63D0\u4E0B\uFF0C\u8FD9\u4E9B\u6307\u4EE4\u7684\u5404\u4E2A\u9636\u6BB5\u53EF\u4EE5\u901A\u8FC7 <strong>\u91CD\u6392\u5E8F</strong> \u548C <strong>\u7EC4\u5408</strong> \u6765\u5B9E\u73B0 <strong>\u6307\u4EE4\u7EA7\u5E76\u884C</strong>\uFF0C\u8FD9\u4E00\u6280\u672F\u5728 80&#39;s \u4E2D\u53F6\u5230 90&#39;s \u4E2D\u53F6\u5360\u636E\u4E86\u8BA1\u7B97\u67B6\u6784\u7684\u91CD\u8981\u5730\u4F4D\u3002</p><blockquote><p>\u63D0\u793A</p><p>\u5206\u9636\u6BB5\uFF0C\u5206\u5DE5\u662F\u63D0\u5347\u6548\u7387\u7684\u5173\u952E\uFF01</p></blockquote><p>\u6307\u4EE4\u91CD\u6392\u7684\u524D\u63D0\u662F\uFF0C\u91CD\u6392\u6307\u4EE4\u4E0D\u80FD\u5F71\u54CD\u7ED3\u679C\uFF0C\u4F8B\u5982</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">// \u53EF\u4EE5\u91CD\u6392\u7684\u4F8B\u5B50</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u4EE41</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u4EE42</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> a <span class="token operator">+</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u4E0D\u80FD\u91CD\u6392\u7684\u4F8B\u5B50</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u4EE41</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u4EE42</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8BE1\u5F02\u7ED3\u679C" tabindex="-1"><a class="header-anchor" href="#\u8BE1\u5F02\u7ED3\u679C" aria-hidden="true">#</a> \u8BE1\u5F02\u7ED3\u679C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// volatile \u4FEE\u9970\u7684\u53D8\u91CF\uFF0C\u53EF\u4EE5\u7981\u7528\u6307\u4EE4\u91CD\u6392 volatile boolean ready = false; \u53EF\u4EE5\u9632\u6B62\u53D8\u91CF\u4E4B\u524D\u7684\u4EE3\u7801\u88AB\u91CD\u6392\u5E8F</span>
<span class="token keyword">boolean</span> ready <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 

<span class="token comment">// \u7EBF\u7A0B1 \u6267\u884C\u6B64\u65B9\u6CD5</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor1</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> num <span class="token operator">+</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7EBF\u7A0B2 \u6267\u884C\u6B64\u65B9\u6CD5</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor2</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u522B\u6267\u884C\u4E0A\u9762\u4E24\u4E2A\u7EBF\u7A0B</p><p>I_Result \u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u6709\u4E00\u4E2A\u5C5E\u6027 r1 \u7528\u6765\u4FDD\u5B58\u7ED3\u679C\uFF0C\u95EE\u53EF\u80FD\u7684\u7ED3\u679C\u6709\u51E0\u79CD\uFF1F</p><p>\u6709\u540C\u5B66\u8FD9\u4E48\u5206\u6790</p><p>\u60C5\u51B51\uFF1A\u7EBF\u7A0B1 \u5148\u6267\u884C\uFF0C\u8FD9\u65F6 ready = false\uFF0C\u6240\u4EE5\u8FDB\u5165 else \u5206\u652F\u7ED3\u679C\u4E3A 1</p><p>\u60C5\u51B52\uFF1A\u7EBF\u7A0B2 \u5148\u6267\u884C num = 2\uFF0C\u4F46\u6CA1\u6765\u5F97\u53CA\u6267\u884C ready = true\uFF0C\u7EBF\u7A0B1 \u6267\u884C\uFF0C\u8FD8\u662F\u8FDB\u5165 else \u5206\u652F\uFF0C\u7ED3\u679C\u4E3A1</p><p>\u60C5\u51B53\uFF1A\u7EBF\u7A0B2 \u6267\u884C\u5230 ready = true\uFF0C\u7EBF\u7A0B1 \u6267\u884C\uFF0C\u8FD9\u56DE\u8FDB\u5165 if \u5206\u652F\uFF0C\u7ED3\u679C\u4E3A 4\uFF08\u56E0\u4E3A num \u5DF2\u7ECF\u6267\u884C\u8FC7\u4E86\uFF09</p><p>\u4F46\u6211\u544A\u8BC9\u4F60\uFF0C\u7ED3\u679C\u8FD8\u6709\u53EF\u80FD\u662F 0 \uFF0C\u4FE1\u4E0D\u4FE1\u5427\uFF01\u8FD9\u79CD\u60C5\u51B5\u4E0B\u662F\uFF1A\u7EBF\u7A0B2 \u6267\u884C ready = true\uFF0C\u5207\u6362\u5230\u7EBF\u7A0B1\uFF0C\u8FDB\u5165 if \u5206\u652F\uFF0C\u76F8\u52A0\u4E3A 0\uFF0C\u518D\u5207\u56DE\u7EBF\u7A0B2 \u6267\u884C num = 2\u3002</p><p>\u8FD9\u79CD\u73B0\u8C61\u53EB\u505A <strong>\u6307\u4EE4\u91CD\u6392</strong>\uFF0C\u662F JIT \u7F16\u8BD1\u5668\u5728\u8FD0\u884C\u65F6\u7684\u4E00\u4E9B\u4F18\u5316\uFF0C\u8FD9\u4E2A\u73B0\u8C61\u9700\u8981\u901A\u8FC7\u5927\u91CF\u6D4B\u8BD5\u624D\u80FD\u590D\u73B0</p>`,283),I=s("\u53EF\u4EE5\u4F7F\u7528jcstress\u5DE5\u5177\u8FDB\u884C\u6D4B\u8BD5 "),N={href:"https://wiki.openjdk.java.net/display/CodeTools/jcstress",target:"_blank",rel:"noopener noreferrer"},C=s("https://wiki.openjdk.java.net/display/CodeTools/jcstress"),z=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mvn archetype:generate -DinteractiveMode<span class="token operator">=</span>false -DarchetypeGroupId<span class="token operator">=</span>org.openjdk.jcstress -
<span class="token assign-left variable">DarchetypeArtifactId</span><span class="token operator">=</span>jcstress-java-test-archetype -DarchetypeVersion<span class="token operator">=</span><span class="token number">0.5</span> -DgroupId<span class="token operator">=</span>cn.itcast -
<span class="token assign-left variable">DartifactId</span><span class="token operator">=</span>ordering -Dversion<span class="token operator">=</span><span class="token number">1.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFA maven \u9879\u76EE\uFF0C\u63D0\u4F9B\u5982\u4E0B\u6D4B\u8BD5\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@JCStressTest</span>
<span class="token annotation punctuation">@Outcome</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> expect <span class="token operator">=</span> <span class="token class-name">Expect</span><span class="token punctuation">.</span>ACCEPTABLE<span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Outcome</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> expect <span class="token operator">=</span> <span class="token class-name">Expect</span><span class="token punctuation">.</span>ACCEPTABLE_INTERESTING<span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">&quot;!!!!&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@State</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrencyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> ready <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Actor</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor1</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> num <span class="token operator">+</span> num<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Actor</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor2</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6253\u5305\uFF0C\u5728 target \u76EE\u5F55\u4E0B\u6267\u884C\u547D\u4EE4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mvn clean <span class="token function">install</span>
java -jar jcstress.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F1A\u8F93\u51FA\u6211\u4EEC\u611F\u5174\u8DA3\u7684\u7ED3\u679C\uFF0C\u6458\u5F55\u5176\u4E2D\u4E00\u6B21\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> INTERESTING tests
    <span class="token class-name">Some</span> interesting behaviors <span class="token class-name"><span class="token namespace">observed<span class="token punctuation">.</span></span> This</span> is <span class="token keyword">for</span> the plain curiosity<span class="token punctuation">.</span>
        
    <span class="token number">2</span> matching test results<span class="token punctuation">.</span>
        <span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">test<span class="token punctuation">.</span></span>ConcurrencyTest</span>
      <span class="token punctuation">(</span>JVM args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">-</span><span class="token class-name">TieredCompilation</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token class-name">Observed</span> state <span class="token class-name">Occurrences</span> <span class="token class-name">Expectation</span> <span class="token class-name">Interpretation</span>
        <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">729</span> ACCEPTABLE_INTERESTING <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
        <span class="token number">1</span> <span class="token number">42</span><span class="token punctuation">,</span><span class="token number">617</span><span class="token punctuation">,</span><span class="token number">915</span> ACCEPTABLE ok
        <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">146</span><span class="token punctuation">,</span><span class="token number">627</span> ACCEPTABLE ok
        
       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">test<span class="token punctuation">.</span></span>ConcurrencyTest</span>
      <span class="token punctuation">(</span>JVM args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token class-name">Observed</span> state <span class="token class-name">Occurrences</span> <span class="token class-name">Expectation</span> <span class="token class-name">Interpretation</span>
        <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">652</span> ACCEPTABLE_INTERESTING <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
        <span class="token number">1</span> <span class="token number">46</span><span class="token punctuation">,</span><span class="token number">460</span><span class="token punctuation">,</span><span class="token number">657</span> ACCEPTABLE ok
        <span class="token number">4</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">571</span><span class="token punctuation">,</span><span class="token number">072</span> ACCEPTABLE ok
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u51FA\u73B0\u7ED3\u679C\u4E3A 0 \u7684\u60C5\u51B5\u6709 638 \u6B21\uFF0C\u867D\u7136\u6B21\u6570\u76F8\u5BF9\u5F88\u5C11\uFF0C\u4F46\u6BD5\u7ADF\u662F\u51FA\u73B0\u4E86\u3002</p><p>\u4E0A\u9762\u4EC5\u662F\u4ECE\u4EE3\u7801\u5C42\u9762\u4F53\u73B0\u51FA\u4E86\u6709\u5E8F\u6027\u95EE\u9898\uFF0C\u4E0B\u9762\u5728\u8BB2\u5230 double-checked locking \u95EE\u9898\u65F6\u8FD8\u4F1A\u4ECEjava\u5B57\u8282\u7801\u7684\u5C42\u9762\u4E86\u89E3\u6709\u5E8F\u6027\u7684\u95EE\u9898\u3002</p><p>\u91CD\u6392\u5E8F\u4E5F\u9700\u8981\u9075\u5B88\u4E00\u5B9A\u89C4\u5219\uFF1A</p><ol><li>\u91CD\u6392\u5E8F\u64CD\u4F5C\u4E0D\u4F1A\u5BF9\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u7684\u64CD\u4F5C\u8FDB\u884C\u91CD\u6392\u5E8F\u3002\u6BD4\u5982\uFF1Aa=1;b=a; \u8FD9\u4E2A\u6307\u4EE4\u5E8F\u5217\uFF0C\u7531\u4E8E\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4F9D\u8D56\u4E8E\u7B2C\u4E00\u4E2A\u64CD\u4F5C\uFF0C\u6240\u4EE5\u5728\u7F16\u8BD1\u65F6\u548C\u5904\u7406\u5668\u8FD0\u884C\u65F6\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u91CD\u6392\u5E8F\u3002</li><li>\u91CD\u6392\u5E8F\u662F\u4E3A\u4E86\u4F18\u5316\u6027\u80FD\uFF0C\u4F46\u662F\u4E0D\u7BA1\u600E\u4E48\u91CD\u6392\u5E8F\uFF0C\u5355\u7EBF\u7A0B\u4E0B\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u80FD\u88AB\u6539\u53D8\u3002\u6BD4\u5982\uFF1Aa=1;b=2;c=a+b\u8FD9\u4E09\u4E2A\u64CD\u4F5C\uFF0C\u7B2C\u4E00\u6B65\uFF08a=1)\u548C\u7B2C\u4E8C\u6B65(b=2)\u7531\u4E8E\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u6240\u4EE5\u53EF\u80FD\u4F1A\u53D1\u751F\u91CD\u6392\u5E8F\uFF0C\u4F46\u662Fc=a+b\u8FD9\u4E2A\u64CD\u4F5C\u662F\u4E0D\u4F1A\u88AB\u91CD\u6392\u5E8F\u7684\uFF0C\u56E0\u4E3A\u9700\u8981\u4FDD\u8BC1\u6700\u7EC8\u7684\u7ED3\u679C\u4E00\u5B9A\u662Fc=a+b=3\u3002</li></ol><p>\u91CD\u6392\u5E8F\u5728\u5355\u7EBF\u7A0B\u6A21\u5F0F\u4E0B\u662F\u4E00\u5B9A\u4F1A\u4FDD\u8BC1\u6700\u7EC8\u7ED3\u679C\u7684\u6B63\u786E\u6027\uFF0C\u4F46\u662F\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u95EE\u9898\u5C31\u51FA\u6765\u4E86\u3002</p><p>\u89E3\u51B3\u65B9\u6CD5\uFF1A<code>volatile</code> \u4FEE\u9970\u7684\u53D8\u91CF\uFF0C\u53EF\u4EE5\u7981\u7528\u6307\u4EE4\u91CD\u6392</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@JCStressTest</span>
<span class="token annotation punctuation">@Outcome</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> expect <span class="token operator">=</span> <span class="token class-name">Expect</span><span class="token punctuation">.</span>ACCEPTABLE<span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Outcome</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> expect <span class="token operator">=</span> <span class="token class-name">Expect</span><span class="token punctuation">.</span>ACCEPTABLE_INTERESTING<span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">&quot;!!!!&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@State</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrencyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> ready <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Actor</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor1</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> num <span class="token operator">+</span> num<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Actor</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor2</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// ready \u4F7F\u7528 volatile \u4FEE\u9970\uFF0C\u53EF\u4EE5\u9632\u6B62\u4E0A\u9762\u7684\u4EE3\u7801\u53D1\u751F\u6307\u4EE4\u91CD\u6392</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="volatile-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#volatile-\u539F\u7406" aria-hidden="true">#</a> volatile \u539F\u7406</h4><p>volatile \u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406\u662F <strong>\u5185\u5B58\u5C4F\u969C</strong>\uFF0CMemory Barrier\uFF08Memory Fence\uFF09</p><ol><li><strong>\u5BF9 volatile \u53D8\u91CF\u7684\u5199\u6307\u4EE4\u540E\u4F1A\u52A0\u5165\u5199\u5C4F\u969C</strong></li><li><strong>\u5BF9 volatile \u53D8\u91CF\u7684\u8BFB\u6307\u4EE4\u524D\u4F1A\u52A0\u5165\u8BFB\u5C4F\u969C</strong></li></ol><h5 id="\u5982\u4F55\u4FDD\u8BC1\u53EF\u89C1\u6027" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1\u53EF\u89C1\u6027" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1\u53EF\u89C1\u6027</h5><ol><li>\u5199\u5C4F\u969C\uFF08sfence\uFF09\u4FDD\u8BC1\u5728\u8BE5\u5C4F\u969C\u4E4B\u524D\u7684\uFF0C\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u6539\u52A8\uFF0C\u90FD\u540C\u6B65\u5230\u4E3B\u5B58\u5F53\u4E2D</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor2</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// ready\u662F\u88ABvolatile\u4FEE\u9970\u7684 \uFF0C\u8D4B\u503C\u5E26\u5199\u5C4F\u969C</span>
   <span class="token comment">// \u5199\u5C4F\u969C</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u800C\u8BFB\u5C4F\u969C\uFF08lfence\uFF09\u4FDD\u8BC1\u5728\u8BE5\u5C4F\u969C\u4E4B\u540E\uFF0C\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u8BFB\u53D6\uFF0C\u52A0\u8F7D\u7684\u662F\u4E3B\u5B58\u4E2D\u6700\u65B0\u6570\u636E</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor1</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BFB\u5C4F\u969C</span>
    <span class="token comment">// ready\u662F\u88ABvolatile\u4FEE\u9970\u7684 \uFF0C\u8BFB\u53D6\u503C\u5E26\u8BFB\u5C4F\u969C</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> num <span class="token operator">+</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603868.png" alt="1594698374315"></p><h5 id="\u5982\u4F55\u4FDD\u8BC1\u6709\u5E8F\u6027" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1\u6709\u5E8F\u6027" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1\u6709\u5E8F\u6027</h5><ol><li><p>\u5199\u5C4F\u969C\u4F1A\u786E\u4FDD\u6307\u4EE4\u91CD\u6392\u5E8F\u65F6\uFF0C\u4E0D\u4F1A\u5C06\u5199\u5C4F\u969C\u4E4B\u524D\u7684\u4EE3\u7801\u6392\u5728\u5199\u5C4F\u969C\u4E4B\u540E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor2</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//  ready\u662F\u88ABvolatile\u4FEE\u9970\u7684\uFF0C\u8D4B\u503C\u5E26\u5199\u5C4F\u969C</span>
    <span class="token comment">// \u5199\u5C4F\u969C</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u8BFB\u5C4F\u969C\u4F1A\u786E\u4FDD\u6307\u4EE4\u91CD\u6392\u5E8F\u65F6\uFF0C\u4E0D\u4F1A\u5C06\u8BFB\u5C4F\u969C\u4E4B\u540E\u7684\u4EE3\u7801\u6392\u5728\u8BFB\u5C4F\u969C\u4E4B\u524D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actor1</span><span class="token punctuation">(</span><span class="token class-name">I_Result</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BFB\u5C4F\u969C</span>
    <span class="token comment">// ready\u662F\u88ABvolatile\u4FEE\u9970\u7684 \uFF0C\u8BFB\u53D6\u503C\u5E26\u8BFB\u5C4F\u969C</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> num <span class="token operator">+</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>r1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603907.png" alt="1594698559052"></p></li></ol><p>\u8FD8\u662F\u90A3\u53E5\u8BDD\uFF0C\u4E0D\u80FD\u89E3\u51B3 <strong>\u6307\u4EE4\u4EA4\u9519</strong>\uFF1A</p><ol><li>\u5199\u5C4F\u969C\u4EC5\u4EC5\u662F\u4FDD\u8BC1\u4E4B\u540E\u7684\u8BFB\u80FD\u591F\u8BFB\u5230\u6700\u65B0\u7684\u7ED3\u679C\uFF0C\u4F46\u4E0D\u80FD\u4FDD\u8BC1\u5176\u5B83\u7EBF\u7A0B\u7684\u8BFB\u8DD1\u5230\u5B83\u524D\u9762\u53BB</li><li>\u800C\u6709\u5E8F\u6027\u7684\u4FDD\u8BC1\u4E5F\u53EA\u662F\u4FDD\u8BC1\u4E86\u672C\u7EBF\u7A0B\u5185\u76F8\u5173\u4EE3\u7801\u4E0D\u88AB\u91CD\u6392\u5E8F(\u4E0D\u80FD\u89E3\u51B3\u4E0D\u540C\u7EBF\u7A0B\u95F4\u7684\u6307\u4EE4\u4EA4\u9519)</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209121603392.png" alt="1594698671628"></p><h5 id="double-checked-locking-\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#double-checked-locking-\u95EE\u9898" aria-hidden="true">#</a> double-checked locking \u95EE\u9898</h5><p>\u4EE5\u8457\u540D\u7684 double-checked locking \u5355\u4F8B\u6A21\u5F0F\u4E3A\u4F8B\uFF0C\u8FD9\u662Fvolatile\u6700\u5E38\u4F7F\u7528\u7684\u5730\u65B9\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u6700\u5F00\u59CB\u7684\u5355\u4F8B\u6A21\u5F0F\u662F\u8FD9\u6837\u7684</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9996\u6B21\u8BBF\u95EE\u4F1A\u540C\u6B65\uFF0C\u800C\u4E4B\u540E\u7684\u4F7F\u7528\u90FD\u9700\u8981\u8FDB\u5165synchronized</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t1</span>
                INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u4F46\u662F\u4E0A\u9762\u7684\u4EE3\u7801\u5757\u7684\u6548\u7387\u662F\u6709\u95EE\u9898\u7684\uFF0C\u56E0\u4E3A\u5373\u4F7F\u5DF2\u7ECF\u4EA7\u751F\u4E86\u5355\u5B9E\u4F8B\u4E4B\u540E\uFF0C\u4E4B\u540E\u8C03\u7528\u4E86getInstance()\u65B9\u6CD5\u4E4B\u540E\u8FD8\u662F\u4F1A\u52A0\u9501\uFF0C\u8FD9\u4F1A\u4E25\u91CD\u5F71\u54CD\u6027\u80FD\uFF01</span>
<span class="token comment">// \u56E0\u6B64\u5C31\u6709\u4E86\u6A21\u5F0F\u5982\u4E0B double-checked locking \u53CC\u91CD\u68C0\u67E5\u9501</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t2</span>
            <span class="token comment">// \u9996\u6B21\u8BBF\u95EE\u4F1A\u540C\u6B65\uFF0C\u800C\u4E4B\u540E\u7684\u4F7F\u7528\u6CA1\u6709 synchronized</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t1</span>
                    INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u4F46\u662F\u4E0A\u9762\u7684if(INSTANCE == null)\u5224\u65AD\u4EE3\u7801\u6CA1\u6709\u5728\u540C\u6B65\u4EE3\u7801\u5757synchronized\u4E2D\uFF0C\u4E0D\u80FD\u4EAB\u6709synchronized\u4FDD\u8BC1\u7684\u539F\u5B50\u6027\uFF0C\u53EF\u89C1\u6027\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F\uFF1A</p><p>\u4F7F\u7528synchronized\u5E76\u4E0D\u80FD\u89E3\u51B3\u6709\u5E8F\u6027\u95EE\u9898\uFF0C\u4F46\u662F\u5982\u679C\u662F\u8BE5\u53D8\u91CF\u6574\u4E2A\u90FD\u5728synchronized\u4EE3\u7801\u5757\u7684\u4FDD\u62A4\u8303\u56F4\u5185\uFF0C\u90A3\u4E48\u53D8\u91CF\u5C31\u4E0D\u4F1A\u88AB\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u64CD\u4F5C\uFF0C\u4E5F\u4E0D\u7528\u8003\u8651\u6709\u5E8F\u6027\u95EE\u9898\uFF01\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\u76F8\u5F53\u4E8E\u89E3\u51B3\u4E86\u91CD\u6392\u5E8F\u95EE\u9898\uFF01</p><p>\u7B2C\u4E00\u4E2A\u4EE3\u7801\u7247\u6BB5\u4E2D\u7684instance\u53D8\u91CF\u90FD\u5728synchronized\u4EE3\u7801\u5757\u4E2D\uFF0C\u7B2C\u4E8C\u4E2A\u4EE3\u7801\u7247\u6BB5\u4E2Dinstance\u4E0D\u5168\u5728synchronized\u4E2D\u6240\u4EE5\u4EA7\u751F\u4E86\u95EE\u9898\u3002</p></blockquote><p>\u4EE5\u4E0A\u7684\u5B9E\u73B0\u7279\u70B9\u662F\uFF1A</p><ol><li>\u61D2\u60F0\u5B9E\u4F8B\u5316</li><li>\u9996\u6B21\u4F7F\u7528 getInstance() \u624D\u4F7F\u7528 synchronized \u52A0\u9501\uFF0C\u540E\u7EED\u4F7F\u7528\u65F6\u65E0\u9700\u52A0\u9501</li><li>\u6709\u9690\u542B\u7684\uFF0C\u4F46\u5F88\u5173\u952E\u7684\u4E00\u70B9\uFF1A\u7B2C\u4E00\u4E2A if \u4F7F\u7528\u4E86 INSTANCE \u53D8\u91CF\uFF0C\u662F\u5728\u540C\u6B65\u5757\u4E4B\u5916</li></ol><p>\u4F46\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u4E0A\u9762\u7684\u4EE3\u7801\u662F\u6709\u95EE\u9898\u7684\uFF0CgetInstance \u65B9\u6CD5\u5BF9\u5E94\u7684\u5B57\u8282\u7801\u4E3A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">0</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">3</span><span class="token operator">:</span> ifnonnull <span class="token number">37</span>
<span class="token comment">// ldc\u662F\u83B7\u5F97\u7C7B\u5BF9\u8C61</span>
<span class="token number">6</span><span class="token operator">:</span> ldc ##<span class="token number">3</span> <span class="token comment">// class cn/itcast/n5/Singleton</span>
<span class="token comment">// \u590D\u5236\u64CD\u4F5C\u6570\u6808\u6808\u9876\u7684\u503C\u653E\u5165\u6808\u9876, \u5C06\u7C7B\u5BF9\u8C61\u7684\u5F15\u7528\u5730\u5740\u590D\u5236\u4E86\u4E00\u4EFD</span>
<span class="token number">8</span><span class="token operator">:</span> dup
<span class="token comment">// \u64CD\u4F5C\u6570\u6808\u6808\u9876\u7684\u503C\u5F39\u51FA\uFF0C\u5373\u5C06\u5BF9\u8C61\u7684\u5F15\u7528\u5730\u5740\u5B58\u5230\u5C40\u90E8\u53D8\u91CF\u8868\u4E2D</span>
<span class="token comment">// \u5C06\u7C7B\u5BF9\u8C61\u7684\u5F15\u7528\u5730\u5740\u5B58\u50A8\u4E86\u4E00\u4EFD\uFF0C\u662F\u4E3A\u4E86\u5C06\u6765\u89E3\u9501\u7528</span>
<span class="token number">9</span><span class="token operator">:</span> astore_0
<span class="token number">10</span><span class="token operator">:</span> monitorenter <span class="token comment">// \u52A0\u9501</span>
<span class="token number">11</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">14</span><span class="token operator">:</span> ifnonnull <span class="token number">27</span>
<span class="token comment">// \u65B0\u5EFA\u4E00\u4E2A\u5B9E\u4F8B</span>
<span class="token number">17</span><span class="token operator">:</span> <span class="token keyword">new</span> ##<span class="token number">3</span> <span class="token comment">// class cn/itcast/n5/Singleton</span>
<span class="token comment">// \u590D\u5236\u4E86\u4E00\u4E2A\u5B9E\u4F8B\u7684\u5F15\u7528</span>
<span class="token number">20</span><span class="token operator">:</span> dup
<span class="token comment">// \u901A\u8FC7\u8FD9\u4E2A\u590D\u5236\u7684\u5F15\u7528\u8C03\u7528\u5B83\u7684\u6784\u9020\u65B9\u6CD5</span>
<span class="token number">21</span><span class="token operator">:</span> invokespecial ##<span class="token number">4</span> <span class="token comment">// Method &quot;&lt;init&gt;&quot;:()V</span>
<span class="token comment">// \u6700\u5F00\u59CB\u7684\u8FD9\u4E2A\u5F15\u7528\u7528\u6765\u8FDB\u884C\u8D4B\u503C\u64CD\u4F5C</span>
<span class="token number">24</span><span class="token operator">:</span> putstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">27</span><span class="token operator">:</span> aload_0 <span class="token comment">// \u52A0\u8F7D\u7C7B\u5BF9\u8C61</span>
<span class="token number">28</span><span class="token operator">:</span> monitorexit <span class="token comment">// \u89E3\u9501</span>
<span class="token number">29</span><span class="token operator">:</span> <span class="token keyword">goto</span> <span class="token number">37</span>
<span class="token number">32</span><span class="token operator">:</span> astore_1
<span class="token number">33</span><span class="token operator">:</span> aload_0
<span class="token number">34</span><span class="token operator">:</span> monitorexit
<span class="token number">35</span><span class="token operator">:</span> aload_1
<span class="token number">36</span><span class="token operator">:</span> athrow
<span class="token number">37</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">40</span><span class="token operator">:</span> areturn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D</p><ol><li>17 \u8868\u793A\u521B\u5EFA\u5BF9\u8C61\uFF0C\u5C06\u5BF9\u8C61\u5F15\u7528\u5165\u6808 // new Singleton</li><li>20 \u8868\u793A\u590D\u5236\u4E00\u4EFD\u5BF9\u8C61\u5F15\u7528 // \u590D\u5236\u4E86\u5F15\u7528\u5730\u5740</li><li>21 \u8868\u793A\u5229\u7528\u4E00\u4E2A\u5BF9\u8C61\u5F15\u7528\uFF0C\u8C03\u7528\u6784\u9020\u65B9\u6CD5 // \u6839\u636E\u590D\u5236\u7684\u5F15\u7528\u5730\u5740\u8C03\u7528\u6784\u9020\u65B9\u6CD5</li><li>24 \u8868\u793A\u5229\u7528\u4E00\u4E2A\u5BF9\u8C61\u5F15\u7528\uFF0C\u8D4B\u503C\u7ED9 static INSTANCE</li></ol><p>\u4E5F\u8BB8 jvm \u4F1A\u4F18\u5316\u4E3A\uFF1A\u5148\u6267\u884C 24\uFF0C\u518D\u6267\u884C 21\u3002\u5982\u679C\u4E24\u4E2A\u7EBF\u7A0B t1\uFF0Ct2 \u6309\u5982\u4E0B\u65F6\u95F4\u5E8F\u5217\u6267\u884C\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171546814.png" alt="image-20220917154641713"></p><p>\u5173\u952E\u5728\u4E8E 0: getstatic \u8FD9\u884C\u4EE3\u7801\u5728 monitor \u63A7\u5236\u4E4B\u5916\uFF0C\u5B83\u5C31\u50CF\u4E4B\u524D\u4E3E\u4F8B\u4E2D\u4E0D\u5B88\u89C4\u5219\u7684\u4EBA\uFF0C\u53EF\u4EE5\u8D8A\u8FC7 monitor \u8BFB\u53D6INSTANCE \u53D8\u91CF\u7684\u503C</p><p>\u8FD9\u65F6 t1 \u8FD8\u672A\u5B8C\u5168\u5C06\u6784\u9020\u65B9\u6CD5\u6267\u884C\u5B8C\u6BD5\uFF0C\u5982\u679C\u5728\u6784\u9020\u65B9\u6CD5\u4E2D\u8981\u6267\u884C\u5F88\u591A\u521D\u59CB\u5316\u64CD\u4F5C\uFF0C\u90A3\u4E48 t2 \u62FF\u5230\u7684\u662F\u5C06\u662F\u4E00\u4E2A\u672A\u521D\u59CB\u5316\u5B8C\u6BD5\u7684\u5355\u4F8B</p><p>\u5BF9 INSTANCE \u4F7F\u7528 volatile \u4FEE\u9970\u5373\u53EF\uFF0C\u53EF\u4EE5\u7981\u7528\u6307\u4EE4\u91CD\u6392\uFF0C\u4F46\u8981\u6CE8\u610F\u5728 JDK 5 \u4EE5\u4E0A\u7684\u7248\u672C\u7684 volatile \u624D\u4F1A\u771F\u6B63\u6709\u6548</p><h5 id="double-checked-locking-\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#double-checked-locking-\u89E3\u51B3" aria-hidden="true">#</a> double-checked locking \u89E3\u51B3</h5><p>\u52A0volatile\u5C31\u884C\u4E86</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u6CA1\u521B\u5EFA\uFF0C\u624D\u4F1A\u8FDB\u5165\u5185\u90E8\u7684 synchronized\u4EE3\u7801\u5757</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t2</span>
                <span class="token comment">// \u4E5F\u8BB8\u6709\u5176\u5B83\u7EBF\u7A0B\u5DF2\u7ECF\u521B\u5EFA\u5B9E\u4F8B\uFF0C\u6240\u4EE5\u518D\u5224\u65AD\u4E00\u6B21</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t1</span>
                    INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B57\u8282\u7801\u4E0A\u770B\u4E0D\u51FA\u6765 volatile \u6307\u4EE4\u7684\u6548\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// -------------------------------------&gt; \u52A0\u5165\u5BF9 INSTANCE \u53D8\u91CF\u7684\u8BFB\u5C4F\u969C</span>
<span class="token number">0</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">3</span><span class="token operator">:</span> ifnonnull <span class="token number">37</span>
<span class="token number">6</span><span class="token operator">:</span> ldc ##<span class="token number">3</span> <span class="token comment">// class cn/itcast/n5/Singleton</span>
<span class="token number">8</span><span class="token operator">:</span> dup
<span class="token number">9</span><span class="token operator">:</span> astore_0
<span class="token number">10</span><span class="token operator">:</span> monitorenter <span class="token comment">// -----------------------&gt; \u4FDD\u8BC1\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027</span>
<span class="token number">11</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">14</span><span class="token operator">:</span> ifnonnull <span class="token number">27</span>
<span class="token number">17</span><span class="token operator">:</span> <span class="token keyword">new</span> ##<span class="token number">3</span> <span class="token comment">// class cn/itcast/n5/Singleton</span>
<span class="token number">20</span><span class="token operator">:</span> dup
<span class="token number">21</span><span class="token operator">:</span> invokespecial ##<span class="token number">4</span> <span class="token comment">// Method &quot;&lt;init&gt;&quot;:()V</span>
<span class="token number">24</span><span class="token operator">:</span> putstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token comment">// -------------------------------------&gt; \u52A0\u5165\u5BF9 INSTANCE \u53D8\u91CF\u7684\u5199\u5C4F\u969C</span>
<span class="token number">27</span><span class="token operator">:</span> aload_0
<span class="token number">28</span><span class="token operator">:</span> monitorexit <span class="token comment">// ------------------------&gt; \u4FDD\u8BC1\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027</span>
<span class="token number">29</span><span class="token operator">:</span> <span class="token keyword">goto</span> <span class="token number">37</span>
<span class="token number">32</span><span class="token operator">:</span> astore_1
<span class="token number">33</span><span class="token operator">:</span> aload_0
<span class="token number">34</span><span class="token operator">:</span> monitorexit
<span class="token number">35</span><span class="token operator">:</span> aload_1
<span class="token number">36</span><span class="token operator">:</span> athrow
<span class="token number">37</span><span class="token operator">:</span> getstatic ##<span class="token number">2</span> <span class="token comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span>
<span class="token number">40</span><span class="token operator">:</span> areturn<span class="token operator">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u9762\u7684\u6CE8\u91CA\u5185\u5BB9\u6240\u793A\uFF0C\u8BFB\u5199 volatile \u53D8\u91CF\u64CD\u4F5C\uFF08\u5373getstatic\u64CD\u4F5C\u548Cputstatic\u64CD\u4F5C\uFF09\u65F6\u4F1A\u52A0\u5165\u5185\u5B58\u5C4F\u969C\uFF08Memory Barrier\uFF08Memory Fence\uFF09\uFF09\uFF0C\u4FDD\u8BC1\u4E0B\u9762\u4E24\u70B9\uFF1A</p><ol><li>\u53EF\u89C1\u6027 <ol><li>\u5199\u5C4F\u969C\uFF08sfence\uFF09\u4FDD\u8BC1\u5728\u8BE5\u5C4F\u969C\u4E4B\u524D\u7684 t1 \u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u6539\u52A8\uFF0C\u90FD\u540C\u6B65\u5230\u4E3B\u5B58\u5F53\u4E2D</li><li>\u800C\u8BFB\u5C4F\u969C\uFF08lfence\uFF09\u4FDD\u8BC1\u5728\u8BE5\u5C4F\u969C\u4E4B\u540E t2 \u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u8BFB\u53D6\uFF0C\u52A0\u8F7D\u7684\u662F\u4E3B\u5B58\u4E2D\u6700\u65B0\u6570\u636E</li></ol></li><li>\u6709\u5E8F\u6027 <ol><li>\u5199\u5C4F\u969C\u4F1A\u786E\u4FDD\u6307\u4EE4\u91CD\u6392\u5E8F\u65F6\uFF0C\u4E0D\u4F1A\u5C06\u5199\u5C4F\u969C\u4E4B\u524D\u7684\u4EE3\u7801\u6392\u5728\u5199\u5C4F\u969C\u4E4B\u540E</li><li>\u8BFB\u5C4F\u969C\u4F1A\u786E\u4FDD\u6307\u4EE4\u91CD\u6392\u5E8F\u65F6\uFF0C\u4E0D\u4F1A\u5C06\u8BFB\u5C4F\u969C\u4E4B\u540E\u7684\u4EE3\u7801\u6392\u5728\u8BFB\u5C4F\u969C\u4E4B\u524D</li></ol></li><li>\u66F4\u5E95\u5C42\u662F\u8BFB\u5199\u53D8\u91CF\u65F6\u4F7F\u7528 lock \u6307\u4EE4\u6765\u591A\u6838 CPU \u4E4B\u95F4\u7684\u53EF\u89C1\u6027\u4E0E\u6709\u5E8F\u6027</li></ol><p>\u60C5\u51B5\u4E00\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171543526.png" alt=""></p><p>\u60C5\u51B5\u4E8C\uFF1A</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/202209171545450.png" alt="image-20220917154511327"></p><h4 id="happens-before" tabindex="-1"><a class="header-anchor" href="#happens-before" aria-hidden="true">#</a> happens-before</h4><p>\u4E0B\u9762\u8BF4\u7684\u53D8\u91CF\u90FD\u662F\u6307\u6210\u5458\u53D8\u91CF\u6216\u9759\u6001\u6210\u5458\u53D8\u91CF</p><ol><li><p>\u7EBF\u7A0B\u89E3\u9501 m \u4E4B\u524D\u5BF9\u53D8\u91CF\u7684\u5199\uFF0C\u5BF9\u4E8E\u63A5\u4E0B\u6765\u5BF9 m \u52A0\u9501\u7684\u5176\u5B83\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB\u53EF\u89C1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">Object</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7EBF\u7A0B\u5BF9 volatile \u53D8\u91CF\u7684\u5199\uFF0C\u5BF9\u63A5\u4E0B\u6765\u5176\u5B83\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB\u53EF\u89C1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7EBF\u7A0B start \u524D\u5BF9\u53D8\u91CF\u7684\u5199\uFF0C\u5BF9\u8BE5\u7EBF\u7A0B\u5F00\u59CB\u540E\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB\u53EF\u89C1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7EBF\u7A0B\u7ED3\u675F\u524D\u5BF9\u53D8\u91CF\u7684\u5199\uFF0C\u5BF9\u5176\u5B83\u7EBF\u7A0B\u5F97\u77E5\u5B83\u7ED3\u675F\u540E\u7684\u8BFB\u53EF\u89C1\uFF08\u6BD4\u5982\u5176\u5B83\u7EBF\u7A0B\u8C03\u7528 t1.isAlive() \u6216 t1.join()\u7B49\u5F85\u5B83\u7ED3\u675F\uFF09</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7EBF\u7A0B t1 \u6253\u65AD t2\uFF08interrupt\uFF09\u524D\u5BF9\u53D8\u91CF\u7684\u5199\uFF0C\u5BF9\u4E8E\u5176\u4ED6\u7EBF\u7A0B\u5F97\u77E5 t2 \u88AB\u6253\u65AD\u540E\u5BF9\u53D8\u91CF\u7684\u8BFB\u53EF\u89C1\uFF08\u901A\u8FC7 t2.interrupted \u6216 t2.isInterrupted\uFF09</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>t2<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5BF9\u53D8\u91CF\u9ED8\u8BA4\u503C\uFF080\uFF0Cfalse\uFF0Cnull\uFF09\u7684\u5199\uFF0C\u5BF9\u5176\u5B83\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB\u53EF\u89C1</p></li><li><p>\u5177\u6709\u4F20\u9012\u6027\uFF0C\u5982\u679C x hb-&gt; y \u5E76\u4E14 y hb-&gt; z \u90A3\u4E48\u6709 x hb-&gt; z \uFF0C\u914D\u5408 volatile \u7684\u9632\u6307\u4EE4\u91CD\u6392\uFF0C\u6709\u4E0B\u9762\u7684\u4F8B\u5B50</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// x=20 \u5BF9 t2 \u53EF\u89C1, \u540C\u65F6 y=10 \u4E5F\u5BF9 t2 \u53EF\u89C1</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="\u603B\u7ED3-1" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3-1" aria-hidden="true">#</a> \u603B\u7ED3</h4><p>volatile\u4E3B\u8981\u7528\u5728\u4E00\u4E2A\u7EBF\u6216\u591A\u4E2A\u7EBF\u7A0B\u8BFB\u65F6\u6765\u4FDD\u8BC1\u53EF\u89C1\u6027\uFF0C\u548C double-checked locking \u6A21\u5F0F\u4E2D\u4FDD\u8BC1synchronized\u4EE3\u7801\u5757\u5916\u7684\u5171\u4EAB\u53D8\u91CF\u7684\u91CD\u6392\u5E8F\u95EE\u9898</p><h4 id="\u4E60\u9898" tabindex="-1"><a class="header-anchor" href="#\u4E60\u9898" aria-hidden="true">#</a> \u4E60\u9898</h4><h5 id="balking-\u6A21\u5F0F\u4E60\u9898" tabindex="-1"><a class="header-anchor" href="#balking-\u6A21\u5F0F\u4E60\u9898" aria-hidden="true">#</a> balking \u6A21\u5F0F\u4E60\u9898</h5><p>\u5E0C\u671B doInit() \u65B9\u6CD5\u4EC5\u88AB\u8C03\u7528\u4E00\u6B21\uFF0C\u4E0B\u9762\u7684\u5B9E\u73B0\u662F\u5426\u6709\u95EE\u9898\uFF0C\u4E3A\u4EC0\u4E48\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestVolatile</span> <span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> initialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">doInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>volatile \u4E0D\u80FD\u4FDD\u8BC1\u539F\u5B50\u6027</p><p>\u89E3\u51B3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestVolatile</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> initialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>initialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">doInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u7EBF\u7A0B\u5B89\u5168\u5355\u4F8B\u4E60\u9898" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u5B89\u5168\u5355\u4F8B\u4E60\u9898" aria-hidden="true">#</a> \u7EBF\u7A0B\u5B89\u5168\u5355\u4F8B\u4E60\u9898</h5><p>\u5355\u4F8B\u6A21\u5F0F\u6709\u5F88\u591A\u5B9E\u73B0\u65B9\u6CD5\uFF0C\u997F\u6C49\u3001\u61D2\u6C49\u3001\u9759\u6001\u5185\u90E8\u7C7B\u3001\u679A\u4E3E\u7C7B\uFF0C\u8BD5\u5206\u6790\u6BCF\u79CD\u5B9E\u73B0\u4E0B\u83B7\u53D6\u5355\u4F8B\u5BF9\u8C61\uFF08\u5373\u8C03\u7528getInstance\uFF09\u65F6\u7684\u7EBF\u7A0B\u5B89\u5168\uFF0C\u5E76\u601D\u8003\u6CE8\u91CA\u4E2D\u7684\u95EE\u9898</p><p>\u997F\u6C49\u5F0F\uFF1A\u7C7B\u52A0\u8F7D\u5C31\u4F1A\u5BFC\u81F4\u8BE5\u5355\u5B9E\u4F8B\u5BF9\u8C61\u88AB\u521B\u5EFA</p><p>\u61D2\u6C49\u5F0F\uFF1A\u7C7B\u52A0\u8F7D\u4E0D\u4F1A\u5BFC\u81F4\u8BE5\u5355\u5B9E\u4F8B\u5BF9\u8C61\u88AB\u521B\u5EFA\uFF0C\u800C\u662F\u9996\u6B21\u4F7F\u7528\u8BE5\u5BF9\u8C61\u65F6\u624D\u4F1A\u521B\u5EFA</p><p>\u5B9E\u73B01\uFF1A \u997F\u6C49\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u95EE\u98981\uFF1A\u4E3A\u4EC0\u4E48\u52A0 final\uFF0C\u9632\u6B62\u5B50\u7C7B\u7EE7\u627F\u540E\u66F4\u6539</span>
<span class="token comment">// \u95EE\u98982\uFF1A\u5982\u679C\u5B9E\u73B0\u4E86\u5E8F\u5217\u5316\u63A5\u53E3, \u8FD8\u8981\u505A\u4EC0\u4E48\u6765\u9632\u6B62\u53CD\u5E8F\u5217\u5316\u7834\u574F\u5355\u4F8B\uFF1F\u5982\u679C\u8FDB\u884C\u53CD\u5E8F\u5217\u5316\u7684\u65F6\u5019\u4F1A\u751F\u6210\u65B0\u7684\u5BF9\u8C61\uFF0C\u8FD9\u6837\u8DDF\u5355\u4F8B\u6A21\u5F0F\u751F\u6210\u7684\u5BF9\u8C61\u662F\u4E0D\u540C\u7684\u3002\u8981\u89E3\u51B3\u76F4\u63A5\u52A0\u4E0A readResolve() \u65B9\u6CD5\u5C31\u884C\u4E86\uFF0C\u5982\u4E0B\u6240\u793A</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u95EE\u98983\uFF1A\u4E3A\u4EC0\u4E48\u8BBE\u7F6E\u4E3A\u79C1\u6709? \u653E\u5F03\u5176\u5B83\u7C7B\u4E2D\u4F7F\u7528new\u751F\u6210\u65B0\u7684\u5B9E\u4F8B\u3002\u662F\u5426\u80FD\u9632\u6B62\u53CD\u5C04\u521B\u5EFA\u65B0\u7684\u5B9E\u4F8B?\u4E0D\u80FD\u3002</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// \u95EE\u98984\uFF1A\u8FD9\u6837\u521D\u59CB\u5316\u662F\u5426\u80FD\u4FDD\u8BC1\u5355\u4F8B\u5BF9\u8C61\u521B\u5EFA\u65F6\u7684\u7EBF\u7A0B\u5B89\u5168? \u80FD\uFF0C\u8FD9\u662F\u9759\u6001\u53D8\u91CF\uFF0C\u662Fjvm\u5728\u7C7B\u52A0\u8F7D\u9636\u6BB5\u5C31\u8FDB\u884C\u4E86\u521D\u59CB\u5316\uFF0Cjvm\u4FDD\u8BC1\u4E86\u6B64\u64CD\u4F5C\u7684\u7EBF\u7A0B\u5B89\u5168\u6027</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u95EE\u98985\uFF1A\u4E3A\u4EC0\u4E48\u63D0\u4F9B\u9759\u6001\u65B9\u6CD5\u800C\u4E0D\u662F\u76F4\u63A5\u5C06 INSTANCE \u8BBE\u7F6E\u4E3A public, \u8BF4\u51FA\u4F60\u77E5\u9053\u7684\u7406\u7531\u3002</span>
    <span class="token comment">// 1.\u63D0\u4F9B\u66F4\u597D\u7684\u5C01\u88C5\u6027\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u61D2\u52A0\u8F7D\uFF1B2.\u63D0\u4F9B\u8303\u578B\u7684\u652F\u6301</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B02\uFF1A \u997F\u6C49\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u95EE\u98981\uFF1A\u679A\u4E3E\u5355\u4F8B\u662F\u5982\u4F55\u9650\u5236\u5B9E\u4F8B\u4E2A\u6570\u7684\uFF1A\u521B\u5EFA\u679A\u4E3E\u7C7B\u7684\u65F6\u5019\u5C31\u5DF2\u7ECF\u5B9A\u4E49\u597D\u4E86\uFF0C\u6BCF\u4E2A\u679A\u4E3E\u5E38\u91CF\u5176\u5B9E\u5C31\u662F\u679A\u4E3E\u7C7B\u7684\u4E00\u4E2A\u9759\u6001\u6210\u5458\u53D8\u91CF  </span>
<span class="token comment">//								  public final static enum Lcn/itcast/test/Singleton; INSTANCE</span>
<span class="token comment">// \u95EE\u98982\uFF1A\u679A\u4E3E\u5355\u4F8B\u5728\u521B\u5EFA\u65F6\u662F\u5426\u6709\u5E76\u53D1\u95EE\u9898\uFF1A\u6CA1\u6709\uFF0C\u8FD9\u662F\u9759\u6001\u6210\u5458\u53D8\u91CF\uFF0C\u7531\u7C7B\u52A0\u8F7D\u5668\u52A0\u8F7D</span>
<span class="token comment">// \u95EE\u98983\uFF1A\u679A\u4E3E\u5355\u4F8B\u80FD\u5426\u88AB\u53CD\u5C04\u7834\u574F\u5355\u4F8B\uFF1A\u4E0D\u80FD</span>
<span class="token comment">// \u95EE\u98984\uFF1A\u679A\u4E3E\u5355\u4F8B\u80FD\u5426\u88AB\u53CD\u5E8F\u5217\u5316\u7834\u574F\u5355\u4F8B\uFF1A\u679A\u4E3E\u7C7B\u9ED8\u8BA4\u5B9E\u73B0\u4E86\u5E8F\u5217\u5316\u63A5\u53E3\uFF0C\u679A\u4E3E\u7C7B\u5DF2\u7ECF\u8003\u8651\u5230\u6B64\u95EE\u9898\uFF0C\u65E0\u9700\u62C5\u5FC3\u7834\u574F\u5355\u4F8B</span>
<span class="token comment">// \u95EE\u98985\uFF1A\u679A\u4E3E\u5355\u4F8B\u5C5E\u4E8E\u61D2\u6C49\u5F0F\u8FD8\u662F\u997F\u6C49\u5F0F\uFF1A\u997F\u6C49\u5F0F</span>
<span class="token comment">// \u95EE\u98986\uFF1A\u679A\u4E3E\u5355\u4F8B\u5982\u679C\u5E0C\u671B\u52A0\u5165\u4E00\u4E9B\u5355\u4F8B\u521B\u5EFA\u65F6\u7684\u521D\u59CB\u5316\u903B\u8F91\u8BE5\u5982\u4F55\u505A\uFF1A\u52A0\u6784\u9020\u65B9\u6CD5\u5C31\u884C\u4E86</span>
<span class="token keyword">enum</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
 	INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B03\uFF1A\u61D2\u6C49\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5206\u6790\u8FD9\u91CC\u7684\u7EBF\u7A0B\u5B89\u5168, \u5E76\u8BF4\u660E\u6709\u4EC0\u4E48\u7F3A\u70B9\uFF1Asynchronized\u52A0\u8F7D\u9759\u6001\u65B9\u6CD5\u4E0A\uFF0C\u53EF\u4EE5\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u3002\u7F3A\u70B9\u5C31\u662F\u9501\u7684\u8303\u56F4\u8FC7\u5927</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B04\uFF1ADCL \u61D2\u6C49\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token comment">// \u95EE\u98981\uFF1A\u89E3\u91CA\u4E3A\u4EC0\u4E48\u8981\u52A0 volatile ?\u4E3A\u4E86\u9632\u6B62\u91CD\u6392\u5E8F\u95EE\u9898</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// \u95EE\u98982\uFF1A\u5BF9\u6BD4\u5B9E\u73B03, \u8BF4\u51FA\u8FD9\u6837\u505A\u7684\u610F\u4E49\uFF1A\u53EA\u6709\u7B2C\u4E00\u6B21\u4F1A\u52A0\u9501\uFF0C\u540E\u9762\u5C31\u4E0D\u4F1A\u52A0\u9501\u4E86\uFF0C\u63D0\u9AD8\u4E86\u6548\u7387</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u95EE\u98983\uFF1A\u4E3A\u4EC0\u4E48\u8FD8\u8981\u5728\u8FD9\u91CC\u52A0\u4E3A\u7A7A\u5224\u65AD, \u4E4B\u524D\u4E0D\u662F\u5224\u65AD\u8FC7\u4E86\u5417\uFF1F\u8FD9\u662F\u4E3A\u4E86\u7B2C\u4E00\u6B21\u5224\u65AD\u65F6\u7684\u5E76\u53D1\u95EE\u9898\u3002</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// t2</span>
                <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B05\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token comment">// \u95EE\u98981\uFF1A\u5C5E\u4E8E\u61D2\u6C49\u5F0F\u8FD8\u662F\u997F\u6C49\u5F0F\uFF1A\u61D2\u6C49\u5F0F\uFF0C\u8FD9\u662F\u4E00\u4E2A\u9759\u6001\u5185\u90E8\u7C7B\u3002\u7C7B\u52A0\u8F7D\u672C\u8EAB\u5C31\u662F\u61D2\u60F0\u7684\uFF0C\u5728\u6CA1\u6709\u8C03\u7528getInstance\u65B9\u6CD5\u65F6\u662F\u6CA1\u6709\u6267\u884CLazyHolder\u5185\u90E8\u7C7B\u7684\u7C7B\u52A0\u8F7D\u64CD\u4F5C\u7684\u3002</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LazyHolder</span> <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u95EE\u98982\uFF1A\u5728\u521B\u5EFA\u65F6\u662F\u5426\u6709\u5E76\u53D1\u95EE\u9898\uFF0C\u8FD9\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF0C\u7C7B\u52A0\u8F7D\u65F6\uFF0Cjvm\u4FDD\u8BC1\u7C7B\u52A0\u8F7D\u64CD\u4F5C\u7684\u7EBF\u7A0B\u5B89\u5168</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">LazyHolder</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-\u672C\u7AE0\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#_5-4-\u672C\u7AE0\u5C0F\u7ED3" aria-hidden="true">#</a> 5.4 \u672C\u7AE0\u5C0F\u7ED3</h3><p>\u672C\u7AE0\u91CD\u70B9\u8BB2\u89E3\u4E86 JMM \u4E2D\u7684</p><ol><li>\u53EF\u89C1\u6027 - \u7531 JVM \u7F13\u5B58\u4F18\u5316\u5F15\u8D77</li><li>\u6709\u5E8F\u6027 - \u7531 JVM \u6307\u4EE4\u91CD\u6392\u5E8F\u4F18\u5316\u5F15\u8D77</li><li>happens-before \u89C4\u5219</li><li>\u539F\u7406\u65B9\u9762 <ul><li>CPU \u6307\u4EE4\u5E76\u884C</li><li>volatile(\u4F7F\u7528\u5185\u5B58\u5C4F\u969C\u4FDD\u8BC1\u4E86\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027)</li></ul></li><li>\u6A21\u5F0F\u65B9\u9762 <ol><li>\u4E24\u9636\u6BB5\u7EC8\u6B62\u6A21\u5F0F\u7684 volatile \u6539\u8FDB</li><li>\u540C\u6B65\u6A21\u5F0F\u4E4B balking(\u53EA\u5E0C\u671B\u4EE3\u7801\u6267\u884C\u4E00\u6B21\uFF0C\u6BD4\u5982\u76D1\u63A7\u7EBF\u7A0B\u3001\u5355\u4F8B\u6A21\u5F0F)</li></ol></li></ol>`,83);function _(E,A){const a=l("ExternalLinkIcon");return o(),c("div",null,[i,n("blockquote",null,[k,n("p",null,[n("a",r,[d,p(a)])]),n("p",null,[n("a",m,[b,p(a)])]),n("p",null,[n("a",v,[g,p(a)])])]),y,n("ol",null,[w,h,f,T,n("li",null,[q,n("a",j,[S,p(a)]),x])]),B,n("p",null,[I,n("a",N,[C,p(a)])]),z])}var M=e(u,[["render",_],["__file","juc02.html.vue"]]);export{M as default};
