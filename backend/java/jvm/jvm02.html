<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>二、垃圾回收 | tt110617</title><meta name="description" content="网站">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/myblog/assets/style.f2a6604f.css">
    <link rel="modulepreload" href="/myblog/assets/app.6a2d513d.js"><link rel="modulepreload" href="/myblog/assets/jvm02.html.a9498b0d.js"><link rel="modulepreload" href="/myblog/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/myblog/assets/jvm02.html.ad530863.js"><link rel="prefetch" href="/myblog/assets/index.html.d1ca62f7.js"><link rel="prefetch" href="/myblog/assets/index.html.b5c38db1.js"><link rel="prefetch" href="/myblog/assets/index.html.feb38b0c.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.dd1af2b2.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.6645e291.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.9da54164.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.95af3c37.js"><link rel="prefetch" href="/myblog/assets/index.html.2770fb04.js"><link rel="prefetch" href="/myblog/assets/index.html.9f31cb98.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.747bd522.js"><link rel="prefetch" href="/myblog/assets/index.html.7970fd4d.js"><link rel="prefetch" href="/myblog/assets/index.html.d76d8eeb.js"><link rel="prefetch" href="/myblog/assets/Docker.html.7e9153cc.js"><link rel="prefetch" href="/myblog/assets/ElasticSearch.html.68bc187d.js"><link rel="prefetch" href="/myblog/assets/nginx.html.feb27b40.js"><link rel="prefetch" href="/myblog/assets/index.html.c88cf0a5.js"><link rel="prefetch" href="/myblog/assets/java8新特性.html.eba77086.js"><link rel="prefetch" href="/myblog/assets/index.html.db442bd7.js"><link rel="prefetch" href="/myblog/assets/index.html.e978b3f4.js"><link rel="prefetch" href="/myblog/assets/vue2.html.cd054f5f.js"><link rel="prefetch" href="/myblog/assets/vue3.html.09644e9e.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.14852074.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.19638d4a.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.19940ab5.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.ff20e708.js"><link rel="prefetch" href="/myblog/assets/index.html.aeaeabce.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.5de27bef.js"><link rel="prefetch" href="/myblog/assets/network01.html.d374f53e.js"><link rel="prefetch" href="/myblog/assets/network02.html.612f1790.js"><link rel="prefetch" href="/myblog/assets/network03.html.f409d6e1.js"><link rel="prefetch" href="/myblog/assets/network04.html.417995ce.js"><link rel="prefetch" href="/myblog/assets/network05.html.383f02d3.js"><link rel="prefetch" href="/myblog/assets/network06.html.6b7b74f3.js"><link rel="prefetch" href="/myblog/assets/index.html.a5289baa.js"><link rel="prefetch" href="/myblog/assets/index.html.1ad05321.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.43cb742a.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.ba0a875f.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.c65b1aff.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.8d20d57a.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.66a2065a.js"><link rel="prefetch" href="/myblog/assets/Redisson原理.html.e587d689.js"><link rel="prefetch" href="/myblog/assets/basics.html.ec7af011.js"><link rel="prefetch" href="/myblog/assets/practice.html.3d6fcedb.js"><link rel="prefetch" href="/myblog/assets/index.html.195983d3.js"><link rel="prefetch" href="/myblog/assets/index.html.ffce25e3.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.1539f2df.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.8d492936.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.25f8081d.js"><link rel="prefetch" href="/myblog/assets/index.html.25b97898.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.11fa754a.js"><link rel="prefetch" href="/myblog/assets/SpringCloudAibaba.html.ba7822c1.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.e3fba77d.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.d245b413.js"><link rel="prefetch" href="/myblog/assets/index.html.2e0e8a71.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.ec57b0c6.js"><link rel="prefetch" href="/myblog/assets/index.html.195b9b99.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.f53a3387.js"><link rel="prefetch" href="/myblog/assets/design01.html.a9ca0966.js"><link rel="prefetch" href="/myblog/assets/design02.html.14685d48.js"><link rel="prefetch" href="/myblog/assets/design03.html.d0742e22.js"><link rel="prefetch" href="/myblog/assets/design04.html.4b4d3a60.js"><link rel="prefetch" href="/myblog/assets/design05.html.dd009a09.js"><link rel="prefetch" href="/myblog/assets/index.html.de8a79d7.js"><link rel="prefetch" href="/myblog/assets/juc01.html.7b5b2a61.js"><link rel="prefetch" href="/myblog/assets/juc02.html.e7af61bf.js"><link rel="prefetch" href="/myblog/assets/juc03.html.c680cb04.js"><link rel="prefetch" href="/myblog/assets/index.html.3ef30b14.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.226ff0ab.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.af77ed0d.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.dd845ccc.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.56d56c94.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.8c5c08ed.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.8713dffe.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.396f92cc.js"><link rel="prefetch" href="/myblog/assets/index.html.cacef81d.js"><link rel="prefetch" href="/myblog/assets/404.html.82bd4b1a.js"><link rel="prefetch" href="/myblog/assets/index.html.2f713335.js"><link rel="prefetch" href="/myblog/assets/index.html.1a811f74.js"><link rel="prefetch" href="/myblog/assets/index.html.79fe6d6e.js"><link rel="prefetch" href="/myblog/assets/index.html.dcd15e89.js"><link rel="prefetch" href="/myblog/assets/index.html.e8952663.js"><link rel="prefetch" href="/myblog/assets/index.html.5ad7ff00.js"><link rel="prefetch" href="/myblog/assets/index.html.92637d35.js"><link rel="prefetch" href="/myblog/assets/index.html.6033e64c.js"><link rel="prefetch" href="/myblog/assets/index.html.29a3be67.js"><link rel="prefetch" href="/myblog/assets/index.html.d2aef326.js"><link rel="prefetch" href="/myblog/assets/index.html.61fd0259.js"><link rel="prefetch" href="/myblog/assets/index.html.cf3e5974.js"><link rel="prefetch" href="/myblog/assets/index.html.b7fddec6.js"><link rel="prefetch" href="/myblog/assets/index.html.2d1c3407.js"><link rel="prefetch" href="/myblog/assets/index.html.f6e57d32.js"><link rel="prefetch" href="/myblog/assets/index.html.57cfa80f.js"><link rel="prefetch" href="/myblog/assets/index.html.5f4c6904.js"><link rel="prefetch" href="/myblog/assets/index.html.adc9fbf5.js"><link rel="prefetch" href="/myblog/assets/index.html.de6bf546.js"><link rel="prefetch" href="/myblog/assets/index.html.5802a134.js"><link rel="prefetch" href="/myblog/assets/index.html.00532d93.js"><link rel="prefetch" href="/myblog/assets/index.html.dcdb8b0c.js"><link rel="prefetch" href="/myblog/assets/index.html.64a2ffc8.js"><link rel="prefetch" href="/myblog/assets/index.html.aa56265b.js"><link rel="prefetch" href="/myblog/assets/index.html.cf5fc743.js"><link rel="prefetch" href="/myblog/assets/index.html.dd0debdd.js"><link rel="prefetch" href="/myblog/assets/index.html.598a85b3.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.9516ff71.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.f215eb2a.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.b981d3d4.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.921fe2c8.js"><link rel="prefetch" href="/myblog/assets/index.html.9ff070dd.js"><link rel="prefetch" href="/myblog/assets/index.html.f985f07c.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.367811ae.js"><link rel="prefetch" href="/myblog/assets/index.html.ccc78fec.js"><link rel="prefetch" href="/myblog/assets/index.html.cd9c8951.js"><link rel="prefetch" href="/myblog/assets/Docker.html.9aa6750f.js"><link rel="prefetch" href="/myblog/assets/ElasticSearch.html.834de972.js"><link rel="prefetch" href="/myblog/assets/nginx.html.96457f50.js"><link rel="prefetch" href="/myblog/assets/index.html.5f9750b5.js"><link rel="prefetch" href="/myblog/assets/java8新特性.html.72523a0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4267a9c7.js"><link rel="prefetch" href="/myblog/assets/index.html.64b7cc16.js"><link rel="prefetch" href="/myblog/assets/vue2.html.019d3a52.js"><link rel="prefetch" href="/myblog/assets/vue3.html.f014c692.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.1f3c1d4e.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.6085f62b.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.a05b3e35.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.f83e6c8a.js"><link rel="prefetch" href="/myblog/assets/index.html.c2377b6c.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.62e502c2.js"><link rel="prefetch" href="/myblog/assets/network01.html.bb391280.js"><link rel="prefetch" href="/myblog/assets/network02.html.4835dc75.js"><link rel="prefetch" href="/myblog/assets/network03.html.529a44ea.js"><link rel="prefetch" href="/myblog/assets/network04.html.c4a9ab39.js"><link rel="prefetch" href="/myblog/assets/network05.html.fefe6411.js"><link rel="prefetch" href="/myblog/assets/network06.html.4098bbbd.js"><link rel="prefetch" href="/myblog/assets/index.html.9a37999d.js"><link rel="prefetch" href="/myblog/assets/index.html.25f73ada.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.4774eebb.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.7aa43754.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.3b35817c.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.1eb9f421.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.445e2fb4.js"><link rel="prefetch" href="/myblog/assets/Redisson原理.html.a6281fb0.js"><link rel="prefetch" href="/myblog/assets/basics.html.64ecf975.js"><link rel="prefetch" href="/myblog/assets/practice.html.9bd91dc4.js"><link rel="prefetch" href="/myblog/assets/index.html.45528417.js"><link rel="prefetch" href="/myblog/assets/index.html.2765f82f.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.5e31fcb7.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.bbddd314.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.ccbf57f9.js"><link rel="prefetch" href="/myblog/assets/index.html.534d4ae8.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.eab22d83.js"><link rel="prefetch" href="/myblog/assets/SpringCloudAibaba.html.79284ee6.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.da3eb94f.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.1224037c.js"><link rel="prefetch" href="/myblog/assets/index.html.668ad86c.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.aabd01a5.js"><link rel="prefetch" href="/myblog/assets/index.html.9cd27700.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.469ecc81.js"><link rel="prefetch" href="/myblog/assets/design01.html.2b9f9e86.js"><link rel="prefetch" href="/myblog/assets/design02.html.849b42b0.js"><link rel="prefetch" href="/myblog/assets/design03.html.e4be33cd.js"><link rel="prefetch" href="/myblog/assets/design04.html.bc31a0d9.js"><link rel="prefetch" href="/myblog/assets/design05.html.d5c35997.js"><link rel="prefetch" href="/myblog/assets/index.html.4a7a1688.js"><link rel="prefetch" href="/myblog/assets/juc01.html.5bb1f884.js"><link rel="prefetch" href="/myblog/assets/juc02.html.0ce510cd.js"><link rel="prefetch" href="/myblog/assets/juc03.html.e93fe7b6.js"><link rel="prefetch" href="/myblog/assets/index.html.b5425fa1.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.f238e096.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.460f2e71.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.7205bd05.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.edac738a.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.91cbb3f0.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.f40c12f1.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.fb107a67.js"><link rel="prefetch" href="/myblog/assets/index.html.3ba3011a.js"><link rel="prefetch" href="/myblog/assets/404.html.1f196261.js"><link rel="prefetch" href="/myblog/assets/index.html.1375c5bc.js"><link rel="prefetch" href="/myblog/assets/index.html.90d1ac0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4d12ff1c.js"><link rel="prefetch" href="/myblog/assets/index.html.8ddb93d5.js"><link rel="prefetch" href="/myblog/assets/index.html.dd098c61.js"><link rel="prefetch" href="/myblog/assets/index.html.cebf8dc1.js"><link rel="prefetch" href="/myblog/assets/index.html.5674ca1e.js"><link rel="prefetch" href="/myblog/assets/index.html.d2abca49.js"><link rel="prefetch" href="/myblog/assets/index.html.1351de8d.js"><link rel="prefetch" href="/myblog/assets/index.html.9de6b46c.js"><link rel="prefetch" href="/myblog/assets/index.html.611ec9ae.js"><link rel="prefetch" href="/myblog/assets/index.html.a02c1bed.js"><link rel="prefetch" href="/myblog/assets/index.html.eb87c7a9.js"><link rel="prefetch" href="/myblog/assets/index.html.33261d15.js"><link rel="prefetch" href="/myblog/assets/index.html.5589fc08.js"><link rel="prefetch" href="/myblog/assets/index.html.f989be9b.js"><link rel="prefetch" href="/myblog/assets/index.html.9f0a51f1.js"><link rel="prefetch" href="/myblog/assets/index.html.49bd673c.js"><link rel="prefetch" href="/myblog/assets/index.html.f1449990.js"><link rel="prefetch" href="/myblog/assets/index.html.b063a78e.js"><link rel="prefetch" href="/myblog/assets/index.html.3f40e5f3.js"><link rel="prefetch" href="/myblog/assets/index.html.56c44de1.js"><link rel="prefetch" href="/myblog/assets/index.html.f8a7efd0.js"><link rel="prefetch" href="/myblog/assets/index.html.c2db4fad.js"><link rel="prefetch" href="/myblog/assets/404.d0d6ec4e.js"><link rel="prefetch" href="/myblog/assets/Layout.4e3e5e78.js"><link rel="prefetch" href="/myblog/assets/Slide.81c38424.js"><link rel="prefetch" href="/myblog/assets/Blog.d28c723c.js"><link rel="prefetch" href="/myblog/assets/auto.264f6c8c.js"><link rel="prefetch" href="/myblog/assets/index.d8a59108.js"><link rel="prefetch" href="/myblog/assets/index.1842ee54.js"><link rel="prefetch" href="/myblog/assets/mermaid.esm.min.fac286bf.js"><link rel="prefetch" href="/myblog/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/myblog/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/myblog/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/myblog/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/myblog/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/myblog/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/myblog/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/myblog/assets/Playground.c4bd3c9e.js"><link rel="prefetch" href="/myblog/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/myblog/" class="brand"><img class="logo" src="/myblog/avatar.jpg" alt="tt110617"><!----><span class="site-name hide-in-pad">tt110617</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/myblog/" class="nav-link" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/backend/" class="nav-link active" aria-label="后端"><span class="icon iconfont icon-java"></span>后端<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/frontend/" class="nav-link" aria-label="前端"><span class="icon iconfont icon-vue"></span>前端<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/tt110617" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-java"></span><span class="title">Java</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/myblog/backend/java/java8%E6%96%B0%E7%89%B9%E6%80%A7.html" class="nav-link sidebar-link sidebar-page" aria-label="Java8新特性"><!---->Java8新特性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-creative"></span><span class="title">设计模式</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-asynchronous"></span><span class="title">JUC</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-share"></span><span class="title">JVM</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/myblog/backend/java/jvm/jvm01.html" class="nav-link sidebar-link sidebar-page" aria-label="一、内存管理"><!---->一、内存管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="二、垃圾回收"><!---->二、垃圾回收<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#如何判断对象可以回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何判断对象可以回收"><!---->如何判断对象可以回收<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#引用计数法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="引用计数法"><!---->引用计数法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#可达性分析算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="可达性分析算法"><!---->可达性分析算法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#四种引用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="四种引用"><!---->四种引用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#方法区的回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="方法区的回收"><!---->方法区的回收<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#废弃的常量回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="废弃的常量回收"><!---->废弃的常量回收<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#不再使用的类回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="不再使用的类回收"><!---->不再使用的类回收<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#应用场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="应用场景"><!---->应用场景<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="垃圾回收算法"><!---->垃圾回收算法<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记清除" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="标记清除"><!---->标记清除<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记复制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="标记复制"><!---->标记复制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记整理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="标记整理"><!---->标记整理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#分代垃圾回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分代垃圾回收"><!---->分代垃圾回收<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="概述"><!---->概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#图例-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="图例"><!---->图例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#相关vm参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="相关VM参数"><!---->相关VM参数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#实例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="实例"><!---->实例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#大对象直接晋升到老年代" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="大对象直接晋升到老年代"><!---->大对象直接晋升到老年代<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#进程内的oom不会影响到主线程的运行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="进程内的OOM不会影响到主线程的运行"><!---->进程内的OOM不会影响到主线程的运行<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="垃圾回收器"><!---->垃圾回收器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#串行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="串行"><!---->串行<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#吞吐量优先" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="吞吐量优先"><!---->吞吐量优先<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#响应时间优先" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="响应时间优先"><!---->响应时间优先<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#g1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="G1"><!---->G1<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收调优" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="垃圾回收调优"><!---->垃圾回收调优<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#调优领域" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="调优领域"><!---->调优领域<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#确定目标" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="确定目标"><!---->确定目标<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#最快的gc是不发生gc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="最快的GC是不发生GC"><!---->最快的GC是不发生GC<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#新生代调优" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="新生代调优"><!---->新生代调优<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#老年代调优" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="老年代调优"><!---->老年代调优<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="案例"><!---->案例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm03.html" class="nav-link sidebar-link sidebar-page" aria-label="三、类结构文件"><!---->三、类结构文件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm04.html" class="nav-link sidebar-link sidebar-page" aria-label="四、字节码指令"><!---->四、字节码指令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm05.html" class="nav-link sidebar-link sidebar-page" aria-label="五、编译器优化"><!---->五、编译器优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm06.html" class="nav-link sidebar-link sidebar-page" aria-label="六、类加载"><!---->六、类加载<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm07.html" class="nav-link sidebar-link sidebar-page" aria-label="七、运行期优化"><!---->七、运行期优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/java/jvm/jvm08.html" class="nav-link sidebar-link sidebar-page" aria-label="八、内存模型"><!---->八、内存模型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/gaoxingneng.png"><span class="title">高性能</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">计算机基础</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-frame"></span><span class="title">框架</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/odbc-full.png"><span class="title">数据库</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-snow"></span><span class="title">算法</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->二、垃圾回收</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年8月29日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="/myblog/article/" target="_blank" rel="noopener noreferrer">十一</a></span><span property="author" content="十一"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年8月29日</span><meta property="datePublished" content="2022-08-29T00:00:00.000Z"></span><!----><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年8月29日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag2 clickable" role="navigation">jvm</li></ul><meta property="keywords" content="jvm"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2022年8月29日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 11142 字</span><meta property="wordCount" content="11142"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#如何判断对象可以回收" class="router-link-active router-link-exact-active toc-link level2">如何判断对象可以回收</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#引用计数法" class="router-link-active router-link-exact-active toc-link level3">引用计数法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#可达性分析算法" class="router-link-active router-link-exact-active toc-link level3">可达性分析算法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#四种引用" class="router-link-active router-link-exact-active toc-link level3">四种引用</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#方法区的回收" class="router-link-active router-link-exact-active toc-link level2">方法区的回收</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#废弃的常量回收" class="router-link-active router-link-exact-active toc-link level3">废弃的常量回收</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#不再使用的类回收" class="router-link-active router-link-exact-active toc-link level3">不再使用的类回收</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#应用场景" class="router-link-active router-link-exact-active toc-link level3">应用场景</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收算法" class="router-link-active router-link-exact-active toc-link level2">垃圾回收算法</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记清除" class="router-link-active router-link-exact-active toc-link level3">标记清除</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记复制" class="router-link-active router-link-exact-active toc-link level3">标记复制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#标记整理" class="router-link-active router-link-exact-active toc-link level3">标记整理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#分代垃圾回收" class="router-link-active router-link-exact-active toc-link level2">分代垃圾回收</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#概述" class="router-link-active router-link-exact-active toc-link level3">概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#图例-1" class="router-link-active router-link-exact-active toc-link level3">图例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#相关vm参数" class="router-link-active router-link-exact-active toc-link level3">相关VM参数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#实例" class="router-link-active router-link-exact-active toc-link level3">实例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#大对象直接晋升到老年代" class="router-link-active router-link-exact-active toc-link level3">大对象直接晋升到老年代</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#进程内的oom不会影响到主线程的运行" class="router-link-active router-link-exact-active toc-link level3">进程内的OOM不会影响到主线程的运行</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收器" class="router-link-active router-link-exact-active toc-link level2">垃圾回收器</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#串行" class="router-link-active router-link-exact-active toc-link level3">串行</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#吞吐量优先" class="router-link-active router-link-exact-active toc-link level3">吞吐量优先</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#响应时间优先" class="router-link-active router-link-exact-active toc-link level3">响应时间优先</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#g1" class="router-link-active router-link-exact-active toc-link level3">G1</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#垃圾回收调优" class="router-link-active router-link-exact-active toc-link level2">垃圾回收调优</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#调优领域" class="router-link-active router-link-exact-active toc-link level3">调优领域</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#确定目标" class="router-link-active router-link-exact-active toc-link level3">确定目标</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#最快的gc是不发生gc" class="router-link-active router-link-exact-active toc-link level3">最快的GC是不发生GC</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#新生代调优" class="router-link-active router-link-exact-active toc-link level3">新生代调优</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#老年代调优" class="router-link-active router-link-exact-active toc-link level3">老年代调优</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/java/jvm/jvm02.html#案例" class="router-link-active router-link-exact-active toc-link level3">案例</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="二、垃圾回收" tabindex="-1"><a class="header-anchor" href="#二、垃圾回收" aria-hidden="true">#</a> 二、垃圾回收</h1><blockquote><ul><li>哪些对象可以回收</li><li>什么时候回收</li><li>如何回收</li></ul></blockquote><h2 id="如何判断对象可以回收" tabindex="-1"><a class="header-anchor" href="#如何判断对象可以回收" aria-hidden="true">#</a> 如何判断对象可以回收</h2><h3 id="引用计数法" tabindex="-1"><a class="header-anchor" href="#引用计数法" aria-hidden="true">#</a> 引用计数法</h3><p>循环引用</p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911105425373.png" alt="image-20210911105425373"></p><p>引用计数法即某对象被引用一次，则引用次数加1，当引用次数为0时，则被回收。</p><p>但是出现上图循环引用则无法被回收。</p><p>java领域，主流的java虚拟机都没有选用引用计数算法来管理内存。</p><h3 id="可达性分析算法" tabindex="-1"><a class="header-anchor" href="#可达性分析算法" aria-hidden="true">#</a> 可达性分析算法</h3><ul><li>java虚拟机中的垃圾回收器采用 <code>可达性分析</code> 来探索所有存活的对象。</li><li>扫描堆中的对象，看是否能够沿着 <code>GC Root对象</code> 为起点的引用链找到该对象，找不到，表示可以回收</li><li>需要确定根对象，即肯定不会被回收的对象。</li><li>垃圾回收前，会对堆中所有的对象进行扫描，只有没有被根对象直接或者间接引用的对象才会被回收。</li><li>举个例子，当提起一串葡萄，连在根上的没有掉下来的葡萄即被根对象引用的对象，不能被回收；掉在盘子里的葡萄即可以被回收的对象。</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117101038437.png" alt="image-20211117101038437"></p><h4 id="gc-roots对象包括" tabindex="-1"><a class="header-anchor" href="#gc-roots对象包括" aria-hidden="true">#</a> GC Roots对象包括</h4><ol><li>在虚拟机栈(栈帧中的本地变量表)中引用的对象，譬如各个线程被调用的方法堆栈中使用到的 参数、局部变量、临时变量等。</li><li>在方法区中类静态属性引用的对象，譬如Java类的引用类型静态变量。</li><li>在方法区中常量引用的对象，譬如字符串常量池(String Table)里的引用。</li><li>在本地方法栈中 <code>JNI(即通常所说的Native方法)引用的对象</code>。</li><li>Java虚拟机内部的引用，如基本数据类型对应的Class对象，一些常驻的异常对象(比如 NullPointExcepiton、OutOfMemoryError)等，还有系统类加载器。</li><li>所有被 <code>同步锁(synchronized关键字)持有的对象</code>。</li><li>反映Java虚拟机内部情况的JM XBean、JVM TI中注册的回调、本地代码缓存等</li></ol><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 演示GC Roots
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        list1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;end...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行程序，分别生成垃圾回收前后的dunp文件</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## 查看进程号</span>
jps 
<span class="token comment">## format=b 生成文件格式为二进制；live主动触发垃圾回收，保留存活对象；file表示存放位置</span>
jmap -dump:format<span class="token operator">=</span>b,live,file<span class="token operator">=</span><span class="token number">1</span>.bin 进程号
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>list1置空前，生成dunmp文件1.bin</strong></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911114300327.png" alt="image-20210911114300327"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>list1是局部变量，存在于活动栈帧；new ArrayList&lt;&gt;()产生的对象才是存在于堆中的对象。即此处new ArrayList&lt;&gt;()对应的那个对象才能作为根对象。</p><p><strong>list1置空后，生成dunmp文件2.bin</strong></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911114535971.png" alt="image-20210911114535971"></p><p>因为在执行</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>jmap -dump:format<span class="token operator">=</span>b,live,file<span class="token operator">=</span><span class="token number">2</span>.bin <span class="token number">51125</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用了live参数，主动调用了垃圾回收。由于list1被置空，list对象无人引用，所以被垃圾回收了。所以在根对象中找不到了。</p><h3 id="四种引用" tabindex="-1"><a class="header-anchor" href="#四种引用" aria-hidden="true">#</a> 四种引用</h3><ol><li>强引用</li><li>软引用</li><li>弱引用</li><li>虚引用</li><li>终结器应用</li></ol><h4 id="特点" tabindex="-1"><a class="header-anchor" href="#特点" aria-hidden="true">#</a> 特点</h4><ol><li>强引用 <ul><li>强引用是最传统的“引用”的定义，是指在程序代码之中普遍存在的引用赋值，即类似“Object obj=new Object()”这种引用关系。无论任何情况下，只要强引用关系还存在，垃圾收集器就永远不会回 收掉被引用的对象。</li><li><strong>只有所有GC Roots对象都不通过【强引用】引用该对象，该对象才能被垃圾回收。</strong></li></ul></li><li>软引用（SoftReference） <ul><li>软引用是用来描述一些还有用，但非必须的对象。</li><li>只被软引用关联着的对象，在系统将要发生内存溢出异常前，会把这些对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存， 才会抛出内存溢出异常。</li><li><strong>即仅有软引用引用该对象时，在垃圾回收后，内存仍不足时会再次触发垃圾回收，回收软引用对象</strong></li><li>可以配合引用队列来释放软引用自身</li><li>在JDK 1.2版之后提供了<strong>SoftReference类</strong>来实现软引用。</li></ul></li><li>弱引用（WeakReference） <ul><li>被弱引用关联的对象只 能生存到下一次垃圾收集发生为止。</li><li><strong>仅有弱引用引用该对象时，在垃圾回收时，无论内存是否充足，都会回收弱引用对象。</strong></li><li>可以配合引用队列来释放弱引用自身。</li><li>在JDK 1.2版之后提供了WeakReference类来实现弱引用。</li></ul></li><li>虚引用（PhantomReference） <ul><li>一个对象是否有虚引用的 存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。</li><li>为一个对象设置虚引用关联的唯一目的 <code>只是为了能在这个对象被收集器回收时收到一个系统通知</code>。</li><li>必须配合引用队列使用，主要配合 <code>ByteBuffer</code> 使用，被引用对象回收时，会将虚引用入队，由 <code>Reference Handler</code> 线程调用虚引用相关方法释放直接内存。</li><li>在JDK 1.2版之后提供 了Phant omReference类来实现虚引用。</li></ul></li><li>终结器引用（FinalReference） <ul><li>无需手动编码，但其内部配合引用队列使用，在垃圾回收时，<code>终结器引用入队</code>（被引用对象暂时没有被回收），再由 <code>Finalizer线程</code> 通过终结器引用找到被引用对象并 <code>调用它的finalize()方法，第二次GC时才能回收被引用对象</code>。</li><li>finalize()方法是对象逃脱死亡命运的最后一次机会，稍后收集器将对F-Queue中的对象进行第二次小规模的标记，如果对象要在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，譬如把自己 (this关键字)赋值给某个类变量或者对象的成员变量，那在第二次标记时它将被移出“即将回收”的集合；如果对象这时候还没有逃脱，那基本上它就真的要被回收了。</li></ul></li></ol><h4 id="图例" tabindex="-1"><a class="header-anchor" href="#图例" aria-hidden="true">#</a> 图例</h4><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911154819757.png" alt="image-20210911154819757"></p><h5 id="强引用对象回收" tabindex="-1"><a class="header-anchor" href="#强引用对象回收" aria-hidden="true">#</a> 强引用对象回收</h5><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155008018.png" alt="image-20210911155008018"></p><h5 id="软引用对象回收" tabindex="-1"><a class="header-anchor" href="#软引用对象回收" aria-hidden="true">#</a> 软引用对象回收</h5><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155152121.png" alt="image-20210911155152121"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155706625.png" alt="image-20210911155706625"></p><p>此时A2对象可能被回收。</p><ul><li>A2对象 <code>仅仅只被软引用对象引用</code></li><li>在执行GC时，<code>内存空间不足了</code>，才会被垃圾回收</li><li>回收后，软引用对象本身可以通过进入引用队列进行释放</li></ul><h5 id="弱引用对象的回收" tabindex="-1"><a class="header-anchor" href="#弱引用对象的回收" aria-hidden="true">#</a> 弱引用对象的回收</h5><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155448697.png" alt="image-20210911155448697"></p><p>此时A3对象可能会被回收</p><ul><li>A3对象 <code>仅仅被弱引用对象引用</code></li><li>当执行GC时，<code>无论内存是否不足</code>，都会被垃圾回收</li><li>回收后，弱引用对象本身可以通过进入引用队列进行释放</li></ul><h5 id="虚引用对象的回收" tabindex="-1"><a class="header-anchor" href="#虚引用对象的回收" aria-hidden="true">#</a> 虚引用对象的回收</h5><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155912137.png" alt="image-20210911155912137"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911155959727.png" alt="image-20210911155959727"></p><p>虚引用一般是对直接内存分配的应用。</p><ul><li>当声明ByteBuffer时，ByteBuffer会分配一块直接内存，并把直接内存的地址传递给虚引用对象Cleaner。</li><li>当ByteBuffer不再被强引用时，被回收后，直接内存还没有被释放。这时会将虚引用放入虚引用的引用队列，由 <code>Reference Handler</code> 线程监控，发现虚引用对象，调用虚引用相关方法 <code>Unsafe.freeMemory()</code> 释放直接内存。</li></ul><h5 id="终结器引用的回收" tabindex="-1"><a class="header-anchor" href="#终结器引用的回收" aria-hidden="true">#</a> 终结器引用的回收</h5><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911161140742.png" alt="image-20210911161140742"></p><ul><li>所有的类都继承自Object类，里面有一个终结方法 <code>finalize()</code> 方法，当对象<strong>重写</strong>了finalize()方法，且没有强引用引用它时，它就可以被当成垃圾进行垃圾回收。</li><li>当对象没有被强引用时，会由jvm为该对象创建一个对应的终结器引用。当这个对象被垃圾回收时，会将终结器引用加入引用队列，但是对象不会被垃圾回收。</li><li>再由一个 <code>优先级较低</code> 的 <code>Finalizer线程</code> 去监控引用队列是否有终结器引用，如果有，就通过终结器引用找到A4对象，调用其 <code>finalize()</code> 方法，等调用之后，等下一次垃圾回收时，就可以被垃圾回收了。</li><li><code>工作效率低</code>，第一次GC不会回收对象，先将终结器引用入队，等到第二次垃圾回收才有可能被回收。</li></ul><h4 id="代码示例" tabindex="-1"><a class="header-anchor" href="#代码示例" aria-hidden="true">#</a> 代码示例</h4><h5 id="软引用" tabindex="-1"><a class="header-anchor" href="#软引用" aria-hidden="true">#</a> 软引用</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 演示软引用
 * -Xmx20m -XX:+PrintGCDetails -verbose:gc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_3</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _4MB <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>



    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">/*List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; 5; i++) {
            list.add(new byte[_4MB]);
        }

        System.in.read();*/</span>
        <span class="token function">soft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">soft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// list --&gt; SoftReference --&gt; byte[]</span>

        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_4MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;循环结束：&quot;</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911161930580.png" alt="image-20210911161930580"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 演示软引用, 配合引用队列
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_4</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _4MB <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 引用队列</span>
        <span class="token class-name">ReferenceQueue</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 关联了引用队列， 当软引用所关联的 byte[]被回收时，软引用自己会加入到 queue 中去</span>
            <span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_4MB<span class="token punctuation">]</span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 从队列中获取无用的 软引用对象，并移除</span>
        <span class="token class-name">Reference</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> poll <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span> poll <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>poll<span class="token punctuation">)</span><span class="token punctuation">;</span>
            poll <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> reference <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911162312048.png" alt="image-20210911162312048"></p><h5 id="弱引用" tabindex="-1"><a class="header-anchor" href="#弱引用" aria-hidden="true">#</a> 弱引用</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>## 虚拟机参数
<span class="token operator">-</span><span class="token class-name">Xmx20m</span> <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCDetails</span> <span class="token operator">-</span>verbose<span class="token operator">:</span>gc
<span class="token doc-comment comment">/**
 * 演示弱引用
 * -Xmx20m -XX:+PrintGCDetails -verbose:gc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_5</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _4MB <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  list --&gt; WeakReference --&gt; byte[]</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_4MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> w <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;循环结束：&quot;</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20220730142933107.png" alt="image-20220730142933107"></p><h2 id="方法区的回收" tabindex="-1"><a class="header-anchor" href="#方法区的回收" aria-hidden="true">#</a> 方法区的回收</h2><p>有些人认为方法区(如HotSpot虚拟机中的元空间或者永久代)是没有垃圾收集行为的，《Java虚拟机规范》中提到过可以不要求虚拟机在方法区中实现垃圾收集，事实上也确实有未实现或未能完整实现方法区类型卸载的收集器存在(如JDK 11时期的ZGC收集器就不支持类卸载)，方法区垃圾收集的“性价比”通常也是比较低的:在Java堆中，尤其是在新生代中，对常规应用进行一次垃圾收集通常 可以回收70%至99%的内存空间，相比之下，方法区回收囿于苛刻的判定条件，其区域垃圾收集的回收成果往往远低于此。</p><p>方法区的垃圾收集主要回收两部分内容：</p><ul><li>废弃的常量</li><li>不再使用的类型。</li></ul><h3 id="废弃的常量回收" tabindex="-1"><a class="header-anchor" href="#废弃的常量回收" aria-hidden="true">#</a> 废弃的常量回收</h3><p>回收废弃常量与回收 Java堆中的对象非常类似。举个常量池中字面量回收的例子，假如一个字符串“ java”曾经进入常量池中，但是当前系统又没有任何一个字符串对象的值是“ java”，换句话说，已经没有任何字符串对象引用常量池中的“ java”常量，且虚拟机中也没有其他地方引用这个字面量。如果在这时发生内存回收，而且垃圾收集器判断确有必要的话，这个“ java”常量就将会被系统清理出常量池。常量池中其他类(接口)、方法、字段的符号引用也与此类似。</p><h3 id="不再使用的类回收" tabindex="-1"><a class="header-anchor" href="#不再使用的类回收" aria-hidden="true">#</a> 不再使用的类回收</h3><p>判定一个常量是否“废弃”还是相对简单，而要判定一个类型是否属于“不再被使用的类”的条件就比较苛刻了。需要同时满足下面三个条件:（类加载器、类、类实例）</p><ol><li>该类所有的<strong>实例都已经被回收</strong>，也就是Java堆中不存在该类及其任何派生子类的实例。</li><li>加载该<strong>类的类加载器已经被回收</strong>，这个条件除非是经过精心设计的可替换类加载器的场景，如 OSGi、JSP的重加载等，否则通常是很难达成的。</li><li>该类对应的<strong>java.lang.Class对象没有在任何地方被引用</strong>，无法在任何地方通过<strong>反射</strong>访问该类的方 法。</li></ol><p>Java虚拟机被允许对满足上述三个条件的无用类进行回收，这里说的仅仅是“被允许”，而并不是和对象一样，没有引用了就必然会回收。</p><h3 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景" aria-hidden="true">#</a> 应用场景</h3><p>在大量使用反射、动态代理、CGLib等字节码框架，动态生成JSP以及OSGi这类频繁自定义类加载 器的场景中，通常都需要Java虚拟机具备类型卸载的能力，以保证不会对方法区造成过大的内存压力。</p><h2 id="垃圾回收算法" tabindex="-1"><a class="header-anchor" href="#垃圾回收算法" aria-hidden="true">#</a> 垃圾回收算法</h2><blockquote><p>从如何判定对象消亡的角度出发，垃圾收集算法可以划分为“引用计数式垃圾收集”(Reference Counting GC)和“追踪式垃圾收集”(Tracing GC)两大类，这两类也常被称作“直接垃圾收集”和“间接垃圾收集”。由于引用计数式垃圾收集算法在本书讨论到的主流Java虚拟机中均未涉及，所以我们暂不把它作为正文主要内容来讲解，本节介绍的所有算法均属于追踪式垃圾收集的范畴。</p></blockquote><h3 id="标记清除" tabindex="-1"><a class="header-anchor" href="#标记清除" aria-hidden="true">#</a> 标记清除</h3><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911172543719.png" alt="image-20210911172543719"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117110358213.png" alt="image-20211117110358213"></p><p>将没有被引用的对象标记出来，然后清除。这里的清除 <code>并不是把内存空间置零操作</code> ，而是把 <code>这些空间记录</code> 下来，待后面分配空间的时候，去寻找是否有空闲的空间，然后进行 <code>覆盖分配</code> 。</p><p>优点：<code>速度较快</code></p><p>缺陷：</p><ol><li>第一个是 <code>执行效率不稳定</code> ，如果Java堆中包含大量对象，而且其中大部分是需要被回收的，这时必须进行大量标记和清除的动作，导致标记和清除两个过程的执行效率都随对象数量增长而降低</li><li>内存空间的 <code>碎片化问题</code> ，标记、清除之后会产生大量 <code>不连续</code> 的内存碎片，空间碎片太多可能会导致当以后在程序运行过程中需要分配较大对象时无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作。</li></ol><h3 id="标记复制" tabindex="-1"><a class="header-anchor" href="#标记复制" aria-hidden="true">#</a> 标记复制</h3><ul><li>为了解决标记-清除算法面对大量可回收对象时执行效率低的问题，1969年Fenichel提出了一种称为“半区复制”(Semispace Copying)的垃圾收集算法</li><li>它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着 的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉。</li><li>如果内存中多数对象都是存活的，这种算法将会产生大量的内存间复制的开销</li><li>但对于多数对象都是可回收的情况，算法需要复制的就是占少数的存活对象，而且每次都是针对整个半区进行内存回收，分配内存时也就不用考虑有空间碎片的复杂情况</li><li>只要移动堆顶指针，按顺序分配即可。</li><li>这样实现简单，运行高效，不过其缺陷也显而易见，这种复制回收算法的代价是将可用内存缩小为了原来的一半，空间浪费未免太多了一 点。</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117110715066.png" alt="image-20211117110715066"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911173423835.png" alt="image-20210911173423835"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911173456246.png" alt="image-20210911173456246"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911173545768.png" alt="image-20210911173545768"></p><p>优点：<code>不会有内存碎片</code></p><p>缺陷：始终会占用 <code>双倍的内存空间</code></p><p>现在的商用Java虚拟机大多都优先采用了这种收集算法去回收<strong>新生代</strong>，IBM公司曾有一项专门研究对新生代“朝生夕灭”的特点做了更量化的诠释——新生代中的对象有98%熬不过第一轮收集。</p><h3 id="标记整理" tabindex="-1"><a class="header-anchor" href="#标记整理" aria-hidden="true">#</a> 标记整理</h3><ul><li>标记-复制算法在对象存活率较高时就要进行较多的复制操作，效率将会降低。</li><li>更关键的是，如果不想浪费50%的空间，就需要有额外的空间进行分配担保，以应对被使用的内存中所有对都100%存活的极端情况，所以在老年代一般不能直接选用这种算法。</li><li>针对<strong>老年代对象的存亡特征</strong>，1974年Edward Lueders提出了另外一种有针对性的“标记-整 理”(Mark-Compact)算法，其中的标记过程仍然与“标记-清除”算法一样，但后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向内存空间一端移动，然后直接清理掉边界以外的内存</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117111009520.png" alt="image-20211117111009520"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210911173213209.png" alt="image-20210911173213209"></p><p>优点： <code>没有内存碎片，连续空间比较充足</code></p><p>缺点：涉及到地址的改变，开销大，<code>效率低</code> ， 会触发STW</p><h2 id="分代垃圾回收" tabindex="-1"><a class="header-anchor" href="#分代垃圾回收" aria-hidden="true">#</a> 分代垃圾回收</h2><h3 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h3><p>建立在两个分 代假说之上:</p><ol><li>弱分代假说(Weak Generational Hypothesis)：绝大多数对象都是朝生夕灭的。</li><li>强分代假说(Strong Generational Hypothesis):熬过越多次垃圾收集过程的对象就越难以消亡。</li></ol><p>垃圾收集器的一致的设计原则:</p><ul><li>收集器应该将Java堆划分出不同的区域，然后将回收对象依据其年龄(年龄即对象熬过垃圾收集过程的次数)分配到不同的区域之中存储。</li><li>显而易见，如果一个区域中大多数对象都是朝生夕灭，难以熬过垃圾收集过程的话，那么把它们集中放在一起，每次回收时只关注如何保留少量存活而不是去标记那些大量将要被回收的对象，就能以较低代价回收到大量的空间;</li><li>如果剩下的都是难以消亡的对象，那把它们集中放在一块， 虚拟机便可以使用较低的频率来回收这个区域，这就同时兼顾了垃圾收集的时间开销和内存的空间有效利用。</li></ul><p>假如要现在进行一次只局限于新生代区域内的收集(Minor GC)，但新生代中的对象是完全有可能被老年代所引用的，为了找出该区域中的存活对象，不得不在固定的GC Roots之外，再额外遍历整个老年代中所有对象来确保可达性分析结果的正确性，反过来也是一样。遍历整个老年代所有对象的方案虽然理论上可行，但无疑会为内存回收带来很大的性能负担。为了解决这个问题，就需要对分代收集理论添加第三条经验法则:</p><ol><li>跨代引用假说(Intergenerational Reference Hypothesis):跨代引用相对于同代引用来说仅占极少数。</li></ol><p>这其实是可根据前两条假说逻辑推理得出的隐含推论:存在互相引用关系的两个对象，是应该倾向于同时生存或者同时消亡的。举个例子，如果某个新生代对象存在跨代引用，由于老年代对象难以消亡，该引用会使得新生代对象在收集时同样得以存活，进而在年龄增长之后晋升到老年代中，这时跨代引用也随即被消除了。</p><p>依据这条假说，我们就不应再为了少量的跨代引用去扫描整个老年代，也不必浪费空间专门记录每一个对象是否存在及存在哪些跨代引用，只需在新生代上建立一个全局的数据结构(该结构被称 为“记忆集”，Remembered Set)，这个结构把老年代划分成若干小块，标识出老年代的哪一块内存会存在跨代引用。此后当发生Minor GC时，只有包含了跨代引用的小块内存里的对象才会被加入到GC Roots进行扫描。虽然这种方法需要在对象改变引用关系(如将自己或者某个属性赋值)时维护记录数据的正确性，会增加一些运行时的开销，但比起收集时扫描整个老年代来说仍然是划算的。</p><p>部分收集(Partial GC):指目标不是完整收集整个Java堆的垃圾收集，其中又分为:</p><ol><li>新生代收集(Minor GC/Young GC):指目标只是新生代的垃圾收集。</li><li>老年代收集(Major GC/Old GC):指目标只是老年代的垃圾收集。目前只有 <strong>CMS收集器</strong> 会有单独收集老年代的行为。另外请注意“Major GC”这个说法现在有点混淆，在不同资料上常有不同所指， 读者需按上下文区分到底是指老年代的收集还是整堆收集。</li><li>混合收集(Mixed GC):指目标是收集整个新生代以及部分老年代的垃圾收集。目前只有 <strong>G1收集器</strong> 会有这种行为。</li></ol><p>整堆收集(Full GC):收集整个Java堆和方法区的垃圾收集。</p><h3 id="图例-1" tabindex="-1"><a class="header-anchor" href="#图例-1" aria-hidden="true">#</a> 图例</h3><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914152909431.png" alt="image-20210914152909431"></p><ul><li>jvm将堆分为了新生代和老年代。</li><li>对新生代的垃圾回收更加频繁，对老年代的垃圾回收频率低一些</li><li>新生代主要存放临时的、迭代快的对象，老年代存放仍然经常使用的对象</li><li>新生代类似每天打扫，老年代类似大扫除</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914154200284.png" alt="image-20210914154200284"></p><ul><li>对象首先分配在伊甸园区域。</li><li>新生代空间不足时，触发 <code>minor gc</code>，伊甸园和from存活的对象使用copy复制到to中，<code>存活的对象年龄加1</code> 并且 <code>交换from 和 to 所指向的空间</code>，即 <code>始终让to空间保持空闲</code>。</li><li><strong>minor gc 会引发stop the world</strong>，暂停其他用户的线程，等垃圾回收结束，用户线程才恢复运行。</li><li>当对象寿命超过阈值时，会晋升至老年代，最大寿命是 <code>15</code>（4bit）。</li><li><strong>当老年代空间不足，会先尝试触发minor gc，如果之后空间仍不足，那么触发full gc，STW的时间更长</strong></li><li>如果仍然不足，会抛出OutOfMemory异常。</li></ul><h3 id="相关vm参数" tabindex="-1"><a class="header-anchor" href="#相关vm参数" aria-hidden="true">#</a> 相关VM参数</h3><table><thead><tr><th>含义</th><th>参数</th></tr></thead><tbody><tr><td>堆初始大小</td><td>-Xms</td></tr><tr><td>堆最大大小</td><td>-Xmx 或 -XX:MaxHeapSize=size</td></tr><tr><td>新生代大小</td><td>-Xmn或（-XX:NewSize=size+-XX:MaxNewSize=size）</td></tr><tr><td>幸存区比例（动态）</td><td>-XX:InitialSurvivorRatio=ratio和-XX:+UseAdaptiveSizePolicy</td></tr><tr><td>幸存区比例</td><td>-XX:SurvivorRatio=ratio</td></tr><tr><td>晋升阈值</td><td>-XX:MaxTenuringThreshold=threshold</td></tr><tr><td>晋升详情</td><td>-XX:+PrintTenuringDistribution</td></tr><tr><td>GC详情</td><td>-XX:+PrintGCDetails -verbose:gc</td></tr><tr><td>FullGC前MinorGC</td><td>-XX:+ScavengeBeforeFullGC</td></tr></tbody></table><h3 id="实例" tabindex="-1"><a class="header-anchor" href="#实例" aria-hidden="true">#</a> 实例</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  演示内存的分配策略
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_1</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _512KB <span class="token operator">=</span> <span class="token number">512</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _6MB <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _7MB <span class="token operator">=</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _8MB <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token comment">// -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc -XX:-ScavengeBeforeFullGC</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914163100944.png" alt="image-20210914163100944"></p><p><strong>当分配空间后</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_7MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914164808294.png" alt="image-20210914164808294"></p><p><strong>再次分配</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_7MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_512KB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_512KB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914165616334.png" alt="image-20210914165616334"></p><h3 id="大对象直接晋升到老年代" tabindex="-1"><a class="header-anchor" href="#大对象直接晋升到老年代" aria-hidden="true">#</a> 大对象直接晋升到老年代</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_8MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914170604688.png" alt="image-20210914170604688"></p><p>当对象过大，新生代放不下后，不会触发GC，会直接放到老年代。当老年代也不足时，会OOM异常。</p><h3 id="进程内的oom不会影响到主线程的运行" tabindex="-1"><a class="header-anchor" href="#进程内的oom不会影响到主线程的运行" aria-hidden="true">#</a> 进程内的OOM不会影响到主线程的运行</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_8MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_8MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sleep....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914170902360.png" alt="image-20210914170902360"></p><h2 id="垃圾回收器" tabindex="-1"><a class="header-anchor" href="#垃圾回收器" aria-hidden="true">#</a> 垃圾回收器</h2><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117112601711.png" alt="image-20211117112601711"></p><p><strong>串行</strong></p><ul><li>Serial、SerialOld 收集器 （复制+整理）</li><li>底层是一个 <code>单线程</code> 的垃圾回收器</li><li>适合堆内存较小，cpu数量少，适合个人电脑</li></ul><p><strong>吞吐量优先</strong></p><ul><li><p>Parallel Scavenge、Parallel Old收集器（复制+整理）</p></li><li><p><code>多线程</code></p></li><li><p>适合堆内存较大的场景</p></li><li><p>需要多核cpu支持（否则多线程争强一个cpu效率低）</p></li><li><p><code>让单位时间内，STW的时间最短</code></p><p>0.2 + 0.2 = 0.4</p></li></ul><p><strong>响应时间优先</strong></p><ul><li><p>ParNew、CMS(Concurrent Mark Sweep)收集器（复制+清除）</p></li><li><p><code>多线程</code></p></li><li><p>适合堆内存较大</p></li><li><p>需要多核cpu</p></li><li><p>尽可能让 <code>单次STW的时间最短</code></p><p>0.1 + 0.1 + 0.1 + 0.1 + 0.1 = 0.5</p></li></ul><h3 id="串行" tabindex="-1"><a class="header-anchor" href="#串行" aria-hidden="true">#</a> 串行</h3><blockquote><p>Serial(复制)、SerialOld收集器(标记整理)</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>## 虚拟机参数
-XX:+UseSerialGC=Serial+SerialOld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>串行垃圾回收器分为两个部分，分开运行的。<code>新生代空间</code> 不足了触发 <code>Serial</code> 完成 MinorGC，<code>老年代</code>空间不足了触发 <code>SerialOld</code> 完成FullGC</p><ul><li>Serial <ul><li>工作在新生代</li><li>复制算法</li></ul></li><li>SerialOld <ul><li>工作在老年代</li><li>标记整理算法</li></ul></li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117113410549.png" alt="image-20211117113410549"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914172536866.png" alt="image-20210914172536866"></p><h3 id="吞吐量优先" tabindex="-1"><a class="header-anchor" href="#吞吐量优先" aria-hidden="true">#</a> 吞吐量优先</h3><blockquote><p>Parallel Scavenge、Parallel Old收集器</p><p>复制+整理</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>## 虚拟机参数
## 并行
-XX:+UseParallelGC ~ -XX:+UseParallelOldGC
-XX:+UseAdaptiveSizePolicy
-XX:GCTimeRatio=ratio
-XX:MaxGCPauseMillis=ms
-XX:ParallelGCThreads=n
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117113948828.png" alt="image-20211117113948828"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20220730172616196.png" alt="image-20220730172616196"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117114056814.png" alt="image-20211117114056814"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914173602885.png" alt="image-20210914173602885"></p><ul><li>parallel并行，指的是，多个垃圾回收器可以并行的运行，占用不同的cpu。但是在此期间，用户线程是被暂停的，只有垃圾回收线程在运行。</li></ul><h3 id="响应时间优先" tabindex="-1"><a class="header-anchor" href="#响应时间优先" aria-hidden="true">#</a> 响应时间优先</h3><blockquote><p>ParNew、CMS(Concurrent Mark Sweep)收集器</p><p>复制+清除</p></blockquote><p>CMS收集器是基于标记-清除算法实现的</p><ol><li>初始标记(CMS initial mark) <strong>STW</strong></li><li>并发标记(CM S concurrent mark)</li><li>重新标记(CMS remark) <strong>STW</strong></li><li>并发清除(CMS concurrent sweep)</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>## 虚拟机参数
## 并发
-XX:+UseConcMarkSweepGC~ -XX:+UseParNewGC~SerialOld
-XX:ParallelGCThreads=n~ -XX:ConcGCTreads=threads
-XX:CMSInitiatingOccupancyFraction=percent
-XX:+CMSScavengeBeforeRemark
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914192429184.png" alt="image-20210914192429184"></p><ul><li>Concurrent 并发、MarkSweep标记清除。基于标记清除且支持并发的一个垃圾回收器</li><li>并发意味着垃圾回收时，其他的用户线程也可以并发运行，与垃圾回收线程抢占cpu</li><li>CMS在垃圾回收的某些阶段是不需要STW，进一步减少需要STW的时间</li><li>UseConcMarkSweepGC是工作在老年代的垃圾回收器，与之对应的是UseParNewGC，工作在新生代的垃圾回收器，基于复制算法。</li><li>CMS回收器有时候会发生并行失败的情况，这时候CMS回收器会退化成SerialOld的单线程的基于标记整理的垃圾回收器。</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117115532928.png" alt="image-20211117115532928"></p><p><strong>CMS老年代回收过程</strong></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210914193509273.png" alt="image-20210914193509273"></p><ul><li>当老年代空间不足时，所有进程运行到安全点暂停，然后垃圾回收的线程进行<strong>初始标记</strong>，初始标记比较快，只是标记根对象。此过程会Stop The World，阻塞其他用户线程。</li><li>之后达到下一个安全点，其他用户线程也可以继续运行了，此时垃圾回收线程进行<strong>并发标记</strong>，从GC Roots的直接关联对象开始遍历整个对象图的过程，这个过程耗时较长但是不需要停顿用户线程，可以与垃圾收集线程一起并发运行。即可以跟其他用户线程并发工作，然后将垃圾标记出来。此过程不会STW</li><li>达到下一个安全点后，进行重新标记，因为上一个并发标记时，其他用户线程也在并发执行，所有可能会产生新对象新引用，对垃圾回收线程造成了干扰，需要<strong>重新标记</strong>。此过程会STW</li><li>到下一个安全点后，其他用户进程恢复，垃圾回收线程开始<strong>并发清理</strong>垃圾，恢复运行。</li></ul><p><strong>细节</strong></p><ul><li>垃圾回收的并发数受参数影响。 <ul><li>-XX:ParallelGCThreads=n 表示并行的垃圾回收线程数，一般跟cpu数目相等</li><li>-XX:ConcGCTreads=threads 并发的垃圾回收线程数目，一般是ParallelGCThreads的 1/4。即一个cpu做垃圾回收，剩下3个cpu留给人家用户线程。</li></ul></li><li>CMS垃圾回收器对cpu的占用率并不高，但是 用户线程不能完全占用cpu，<code>吞吐量变小了</code> 。</li><li>CMS在执行最后一步并发清理的时候，由于其他线程还在运行，就会产生新的垃圾，而新的垃圾只有等到下次垃圾回收才能清理了。这些垃圾被称为 <strong>浮动垃圾</strong>。</li><li>所以要预留一些空间来存放浮动垃圾。</li><li>-XX:CMSInitiatingOccupancyFraction=percent，开始执行CMS垃圾回收时的内存占比，早期默认65，即只要老年代内存占用率达到65％的时候就要开始清理，留下35％的空间给新产生的浮动垃圾。</li><li>-XX:+CMSScavengeBeforeRemark。在<strong>重新标记</strong>阶段，有可能新生代的对象会引用老年代的对象，重新标记时需要扫描整个堆，做可达性分析时，只要新生代的引用存在，不管有没有必要，都会通过新生代引用找到老年代，但是这其实对性能影响有些大。因为新生代对象很多，且很多要作为垃圾被回收。可达性分析又会通过新生代引用去找老年代，但是就算找到了老年代，这些新生代还是要被回收，也就是说，<code>本来没有必要查找老年代</code> 。所以在重新标记之前，把新生代先回收了，就不会存在新生代引用老年代，然后去查找老年代了。</li><li>新生代的回收是通过-XX:+UseParNewGC，垃圾回收之后，新生代对象少了，自然重新标记的压力就轻了。</li><li>因为CMS基于标记清除，有可能会产生比较多的内存碎片。这样的话，会造成将来给对象分配空间时，空间不足时，如果minorGC后内存空间也不足。那么由于标记清除，老年代的空间也不足，造成并发失败。于是 <code>CMS退化成SerialOld</code> 串行地垃圾回收，通过 <code>标记整理</code>，来得到空间。但是这样会导致垃圾回收的时间变得很长（要整理），结果本来是响应时间优先的回收器，响应时间长，给用户造成不好的体验。</li></ul><h3 id="g1" tabindex="-1"><a class="header-anchor" href="#g1" aria-hidden="true">#</a> G1</h3><p>定义：Garbage First</p><ul><li>2004论文发布</li><li>2009JDK6u14体验</li><li>2012JDK7u4官方支持</li><li>2017JDK9默认</li></ul><p>G1</p><ul><li>G1跳出了这个樊笼，它可以面向堆内存任何部分来组成回收集(Collection Set，一般简称CSet)进行回收，衡量标准不再是它属于哪个分代，而是哪块内存中存放的垃圾数量最多，回收收益最大，这就是G1收集器的 <code>Mixed GC</code> 模式。</li><li>G1开创的基于 <code>Region的堆内存布局</code> 是它能够实现这个目标的关键。</li><li>虽然G1也仍是遵循分代收集理论设计的，但其堆内存的布局与其他收集器有非常明显的差异:G1不再坚持固定大小以及固定数量的 分代区域划分，而是把连续的Java堆划分为多个大小相等的独立区域(Region)，每一个Region都可以根据需要，扮演新生代的Eden空间、Survivor空间，或者老年代空间。</li><li>收集器能够对扮演不同角色的 Region采用不同的策略去处理，这样无论是新创建的对象还是已经存活了一段时间、熬过多次收集的旧对象都能获取很好的收集效果。</li><li>Region中还有一类特殊的Humongous区域，专门用来存储大对象。G1认为只要大小超过了一个 Region容量一半的对象即可判定为大对象。而对于那些超过了整个Region容量的超级大对象， 将会被存放在N个连续的Humongous Region之中，G1的大多数行为都把Humongous Region作为老年代 的一部分来进行看待</li><li>虽然G1仍然保留新生代和老年代的概念，但新生代和老年代不再是固定的了，它们都是一系列区域(不需要连续)的动态集合。</li></ul><p>使用场景</p><ul><li>同时注 <code>重吞吐量（Throughput）</code>和 <code>低延迟（Low latency）</code>，默认的暂停目标是200ms</li><li>超大堆内存，会将 <code>堆划分为多个大小相等的Region</code>（每个Region可以分新生代老年代）</li><li>整体上是 <code>标记+整理</code> 算法，<code>两个区域之间是复制算法</code></li></ul><p>G1收集器的运作过程</p><ol><li><p>初始标记(Initial Marking)</p><p>STW</p><ul><li>仅仅只是标记一下GC Roots能直接关联到的对象，并且修改TAMS 指针的值，让下一阶段用户线程并发运行时，能正确地在可用的Region中分配新对象。</li><li>这个阶段需停顿线程，但耗时很短，而且是借用进行Minor GC的时候同步完成的，所以G1收集器在这个阶段实际并没有额外的停顿。</li></ul></li><li><p>并发标记(Concurrent Marking)</p><ul><li>从GC Root开始对堆中对象进行可达性分析，递归扫描整个堆里的对象图，找出要回收的对象，这阶段耗时较长，但可与用户程序并发执行。</li><li>当对象图扫描完成以后，还要重新处理SATB记录下的在并发时有引用变动的对象。</li></ul></li><li><p>最终标记(Final Marking)</p><p>STW</p><ul><li>对用户线程做另一个短暂的暂停，用于处理并发阶段结束后仍遗留下来的最后那少量的SATB记录。</li></ul></li><li><p>筛选回收(Live Data Counting and Evacuation)</p><p>STW</p><ul><li>负责更新Region的统计数据，对各个Region的回收价值和成本进行排序，根据用户所期望的停顿时间来制定回收计划，可以自由选择任意多个Region 构成回收集，然后把决定回收的那一部分Region的存活对象复制到空的Region中，再清理掉整个旧 Region的全部空间。</li></ul></li></ol><ul><li>这里的操作涉及存活对象的移动，是必须暂停用户线程，由多条收集器线程并行完成的。</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20211117120741812.png" alt="image-20211117120741812"></p><p>相关JVM参数</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+UseG1GC
-XX:G1HeapRegionSize=size
-XX:MaxGCPauseMillis=time
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="g1垃圾回收阶段" tabindex="-1"><a class="header-anchor" href="#g1垃圾回收阶段" aria-hidden="true">#</a> G1垃圾回收阶段</h4><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915112021863.png" alt="image-20210915112021863"></p><p>新生代的回收之后，可以在进行新生代回收时，同时并发标记，然后再进行混合垃圾回收，即对新生代、老年代都进行一次较大的垃圾回收。</p><h4 id="young-collection" tabindex="-1"><a class="header-anchor" href="#young-collection" aria-hidden="true">#</a> Young Collection</h4><ul><li>会STW（时间较短）</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915112537122.png" alt="image-20210915112537122"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915113142967.png" alt="image-20210915113142967"></p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915113421900.png" alt="image-20210915113421900"></p><h4 id="young-collection-cm" tabindex="-1"><a class="header-anchor" href="#young-collection-cm" aria-hidden="true">#</a> Young Collection +CM</h4><ul><li>新生代的垃圾回收+并发标记阶段</li><li>在 <code>YoungGC</code> 时会进行GC Root的 <code>初始标记</code></li><li>并发标记，顺着GC Roots找到其他对象</li><li><code>老年代占用堆空间比例达到阈值</code>时，进行 <code>并发标记（不会STW）</code>，由下面的JVM参数决定</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:InitiatingHeapOccupancyPercent=percent(默认45％)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915114111537.png" alt="image-20210915114111537"></p><h4 id="mixed-collection" tabindex="-1"><a class="header-anchor" href="#mixed-collection" aria-hidden="true">#</a> Mixed Collection</h4><p>混合收集， 会对E、S、O进行全面垃圾回收</p><ul><li>最终标记（Remark）会STW</li><li>拷贝存活（EVacuation）会STW</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:MaxGCPauseMillis=ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915152035617.png" alt="image-20210915152035617"></p><ul><li>因为在此之前有并发标记，所以需要最终标记并拷贝存活</li><li>新生代的存活对象通过复制算法到幸存区</li><li>幸存区的一些达到晋升寿命的对象，晋升到老年代</li><li>对于老年代的垃圾回收来说，并不会全部回收。为了达到 <code>暂停时间短（STW）</code>，会优先让一部分 <code>垃圾回收价值高的老年代回收</code>。与MaxGCPauseMillis参数有关</li></ul><h4 id="full-gc" tabindex="-1"><a class="header-anchor" href="#full-gc" aria-hidden="true">#</a> Full GC</h4><ul><li>SerialGC <ul><li>新生代内存不足发生的垃圾收集 ——minor gc</li><li>老年代内存不足发生的垃圾收集 ——full gc</li></ul></li><li>ParallelGC <ul><li>新生代内存不足发生的垃圾收集 ——minor gc</li><li>老年代内存不足发生的垃圾收集 ——full gc</li></ul></li><li>CMS <ul><li>新生代内存不足发生的垃圾回收 ——minor gc</li><li>老年代内存不足</li><li>当 <code>垃圾回收速度跟不上垃圾生成速度</code> 时，会 <code>full gc</code></li><li>并发收集失败前是 minor gc，并发失败退化为串行垃圾收集器，触发full gc</li></ul></li><li>G1 <ul><li>新生代内存不足发生的垃圾回收 ——minor gc</li><li>老年代内存不足</li><li>当垃圾回收速度跟不上垃圾生成速度时，会full gc</li><li>并发收集失败前是minor gc，并发失败退化为串行垃圾收集器，触发full gc</li></ul></li></ul><h4 id="young-collection跨代引用" tabindex="-1"><a class="header-anchor" href="#young-collection跨代引用" aria-hidden="true">#</a> Young Collection跨代引用</h4><ul><li>新生代回收的跨代引用（老年代引用新生代）问题</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915154920105.png" alt="image-20210915154920105"></p><ul><li>老年代会再细分，会形成一个 <code>卡表</code>，老年代里引用新生代的对象会被标记为 <code>dirty card(脏卡)</code>。</li><li>卡表与 <code>Remember Set(标记为dirty card的集合)</code></li><li>在引用变更时通过post-write barrier + dirty card queue</li><li>concurrent refinement threads 更新 Remember Set</li></ul><h4 id="remark" tabindex="-1"><a class="header-anchor" href="#remark" aria-hidden="true">#</a> Remark</h4><ul><li>重标记</li><li>pre-write barrier + satb_mark_queue</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915155443865.png" alt="image-20210915155443865"></p><p>黑色：已处理完成，不会被垃圾回收</p><p>白色：已处理完成，会被垃圾回收</p><p>灰色：正在处理</p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915155930677.png" alt="image-20210915155930677"></p><p>B会被标记为黑色</p><p>因为是并发标记，其他用户线程在工作，可能将C的引用改变</p><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915160019674.png" alt="image-20210915160019674"></p><p>C已经被处理过了，本来应该被直接回收，但是显然C被其他用户线程改变引用了。所以需要对对象的引用进行进一步检查。</p><p>当对象的引用发生改变时，jvm会对该对象加上 <code>写屏障pre-write barrier</code>，会把对象C加入到一个队列 <code>satb_mark_queue</code>，并且标记为灰色，表示正在处理。</p><p>等到并发标记结束，进行重新标记，会STW，暂停其他线程，然后将队列里的对象取出来检查，发现对象是灰色，还需要进行处理。在处理的时候发现，有强引用引用该对象，那么标记为黑色，即处理结束且不会被回收。</p><h4 id="jdk-8u20字符串去重" tabindex="-1"><a class="header-anchor" href="#jdk-8u20字符串去重" aria-hidden="true">#</a> JDK 8u20字符串去重</h4><ul><li>优点：节省大量空间</li><li>缺点：略微多占用了cpu空间，新生代回收时间略微增加</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseStringDeduplication</span>
<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//char[]{&#39;h&#39;,&#39;e&#39;,&#39;l&#39;,&#39;l&#39;,&#39;o&#39;}</span>
<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//char[]{&#39;h&#39;,&#39;e&#39;,&#39;l&#39;,&#39;l&#39;,&#39;o&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将所有新分配的字符串放入一个队列</li><li>当新生代回收时，G1并发检查是否有字符串重复</li><li>如果它们值一样，让它们引用同一个char[]</li><li>注意，与String.intern()不一样 <ul><li>String.intern()关注的是字符串对象</li><li>而字符串去重关注的是char[]</li><li>在JVM内部，使用了不同的字符串表</li></ul></li></ul><h4 id="jdk-8u40并发标记类卸载" tabindex="-1"><a class="header-anchor" href="#jdk-8u40并发标记类卸载" aria-hidden="true">#</a> JDK 8u40并发标记类卸载</h4><p>所有对象都经过并发标记后，就能知道哪些类不再被使用，当一个类加载器的所有类都不再使用，则卸载它所加载的所有类。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+ClassUnloadWithConcurrentMark ## 默认启用
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="jdk-8u60回收巨型对象" tabindex="-1"><a class="header-anchor" href="#jdk-8u60回收巨型对象" aria-hidden="true">#</a> JDK 8u60回收巨型对象</h4><ul><li>一个对象大于 <code>region的一半</code> 时，称之为巨型对象</li><li>G1不会对巨型对象进行拷贝</li><li>回收时被优先考虑</li><li>G1会跟踪老年代所有incoming引用，这样老年代incoming引用为0的巨型对象就可以在新生代垃圾回收时处理掉。</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915164307591.png" alt="image-20210915164307591"></p><h4 id="jdk-9并发标记起始时间的调整" tabindex="-1"><a class="header-anchor" href="#jdk-9并发标记起始时间的调整" aria-hidden="true">#</a> JDK 9并发标记起始时间的调整</h4><ul><li>并发标记必须在堆空间占满前完成，否则退化为FullGC</li><li>JDK9之前需要使用 -XX:InitiatingHeapOccupancyPercent</li><li>JDK9可以动态调整 <ul><li>-XX:InitiatingHeapOccupancyPercent 用来设置初始值</li><li>进行数据采样并动态调整</li><li>总会添加一个安全的空档空间</li></ul></li></ul><p>目的是 <code>尽早地开始垃圾回收，避免Full GC的发生。</code></p><h4 id="jdk-9更高效的回收" tabindex="-1"><a class="header-anchor" href="#jdk-9更高效的回收" aria-hidden="true">#</a> JDK 9更高效的回收</h4><ul><li>250+增强</li><li>180+bug修复</li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/en/java/javase/12/gctuning<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="垃圾回收调优" tabindex="-1"><a class="header-anchor" href="#垃圾回收调优" aria-hidden="true">#</a> 垃圾回收调优</h2><ul><li>掌握GC相关的VM参数，会基本的空间调整</li><li>掌握相关工具</li><li>调优跟应用、环境有关，没有放之四海皆准的法则</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2_8</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
## 查看虚拟机运行参数
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintFlagsFinal</span> <span class="token operator">-</span>version <span class="token operator">|</span> findstr <span class="token string">&quot;GC&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210915172646971.png" alt="image-20210915172646971"></p><h3 id="调优领域" tabindex="-1"><a class="header-anchor" href="#调优领域" aria-hidden="true">#</a> 调优领域</h3><ul><li>内存</li><li>锁竞争</li><li>cpu占用</li><li>io</li></ul><h3 id="确定目标" tabindex="-1"><a class="header-anchor" href="#确定目标" aria-hidden="true">#</a> 确定目标</h3><ul><li>【低延迟】还是【高吞吐量】，选择合适的回收器</li><li>CMS，G1，ZGC（响应时间优先）</li><li>ParallelGC（高吞吐量）</li><li>Zing（号称0停顿）</li></ul><h3 id="最快的gc是不发生gc" tabindex="-1"><a class="header-anchor" href="#最快的gc是不发生gc" aria-hidden="true">#</a> 最快的GC是不发生GC</h3><p>查看FullGC前后的内存占用，考虑下面几个问题</p><ul><li>数据是不是太多 <ul><li>resultSet = statement.executeQuery(“select * from 大表”)，加载到堆内存应该limit，避免把不必要的数据加载到java内存中</li></ul></li><li>数据表示是否太臃肿 <ul><li>对象图（用到对象的哪个属性就查哪个）</li><li>对象大小 至少16字节，Integer包装类型24字节，而int 4字节</li></ul></li><li>是否存在内存泄露 <ul><li>static Map map作为缓存等，静态的，长时间存活的对象，一直添加，会造成OOM</li><li>可以用软引用、弱引用</li><li>可以使用第三方的缓存实现，redis等，不会给java堆内存造成压力</li></ul></li></ul><h3 id="新生代调优" tabindex="-1"><a class="header-anchor" href="#新生代调优" aria-hidden="true">#</a> 新生代调优</h3><h4 id="新生代的特点" tabindex="-1"><a class="header-anchor" href="#新生代的特点" aria-hidden="true">#</a> 新生代的特点</h4><ul><li>所有的new操作的内存分配非常廉价 <ul><li><code>TLAB</code> thread-local allocation buffer</li></ul></li><li>死亡对象的回收代价是零 <ul><li>复制算法，复制之后直接释放空间，不整理</li></ul></li><li>大部分对象用过即死</li><li>MinorGC的时间远远低于FullGC</li></ul><h4 id="新生代越大越好吗" tabindex="-1"><a class="header-anchor" href="#新生代越大越好吗" aria-hidden="true">#</a> 新生代越大越好吗</h4><ul><li>小了容易经常触发MinorGC</li><li>新生代太大的话，老年代的空间就不足了，当老年代空间不足会触发FullGC，耗费更多时间</li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210916155118395.png" alt="image-20210916155118395"></p><ul><li>新生代最好能容纳所有【并发量 X (请求响应)】</li><li>幸存区大到能保留【当前活跃对象+需要晋升对象】</li><li>晋升阈值配置要得当，让长时间存活对象尽快晋升 <ul><li>因为晋升对象如果长时间存在于幸存区，每次垃圾回收进行复制其实都没必要。应该早点把待晋升对象晋升到幸存区。</li><li>-XX:MaxTenuringThreshold=threshold</li><li>-XX:+PrintTenuringDistribution</li></ul></li></ul><p><img src="https://chasing1874.oss-cn-chengdu.aliyuncs.com/image-20210916155932490.png" alt="image-20210916155932490"></p><h3 id="老年代调优" tabindex="-1"><a class="header-anchor" href="#老年代调优" aria-hidden="true">#</a> 老年代调优</h3><p>以CMS为例</p><ul><li>CMS的老年代内存越大越好</li><li>先尝试不做调优，如果没有FullGC那么说明老年代空间比较富裕，运行状况还不错。及时出现了FullGC，也可以先尝试调优新生代</li><li>观察发生FullGC时老年代内存占用，将老年代内存预设调大1/4~1/3 <ul><li>-XX:CMSInitiatingOccupancyFraction=percent</li><li>待空间达到了老年代的多少进行垃圾回收，预留空间给浮动垃圾</li></ul></li></ul><h3 id="案例" tabindex="-1"><a class="header-anchor" href="#案例" aria-hidden="true">#</a> 案例</h3><h4 id="案例1-fullgc和minorgc频繁" tabindex="-1"><a class="header-anchor" href="#案例1-fullgc和minorgc频繁" aria-hidden="true">#</a> 案例1 FullGC和MinorGC频繁</h4><ul><li>说明空间紧张</li><li>可能是新生代空间小，当高峰期时对象的频繁创建，导致频繁发生MinorGC</li><li>由于新生代空间紧张，动态调整晋升寿命，导致存活时间较短的对象也会晋升到老年代，导致触发FullGC</li><li>应尝试调节新生代的内存</li></ul><h4 id="案例2-请求高峰期发生fullgc-单次暂停时间特别长-cms" tabindex="-1"><a class="header-anchor" href="#案例2-请求高峰期发生fullgc-单次暂停时间特别长-cms" aria-hidden="true">#</a> 案例2 请求高峰期发生FullGC，单次暂停时间特别长（CMS）</h4><ul><li>通过查看GC日志，查看CMS哪个阶段耗时长</li><li>当高峰期时，对象频繁创建。在CMS的重新标记阶段，就可能耗费大量时间。</li><li>可以在重新标记之前，先进行一次垃圾回收</li><li>-XX:+CMSScavengeBeforeRemark</li></ul><h4 id="案例3-老年代充裕情况下-发生fullgc" tabindex="-1"><a class="header-anchor" href="#案例3-老年代充裕情况下-发生fullgc" aria-hidden="true">#</a> 案例3 老年代充裕情况下，发生FullGC()</h4><ul><li>1.7之前是永久代作为方法区的实现，可能会发生永久代不足。</li><li>永久代不足会触发堆的FullGC</li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/tt110617/edit/main/demo/src/backend/java/jvm/jvm02.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/29 21:57:52</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1253728268@qq.com">hzz</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/myblog/backend/java/jvm/jvm01.html" class="nav-link prev" aria-label="一、内存管理"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->一、内存管理</div></a><a href="/myblog/backend/java/jvm/jvm03.html" class="nav-link next" aria-label="三、类结构文件"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">三、类结构文件<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 十一</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/myblog/assets/app.6a2d513d.js" defer></script>
  </body>
</html>
