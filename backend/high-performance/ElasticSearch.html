<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>ElasticSearch | tt110617</title><meta name="description" content="网站">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/myblog/assets/style.f2a6604f.css">
    <link rel="modulepreload" href="/myblog/assets/app.6a2d513d.js"><link rel="modulepreload" href="/myblog/assets/ElasticSearch.html.834de972.js"><link rel="modulepreload" href="/myblog/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/myblog/assets/ElasticSearch.html.68bc187d.js"><link rel="prefetch" href="/myblog/assets/index.html.d1ca62f7.js"><link rel="prefetch" href="/myblog/assets/index.html.b5c38db1.js"><link rel="prefetch" href="/myblog/assets/index.html.feb38b0c.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.dd1af2b2.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.6645e291.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.9da54164.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.95af3c37.js"><link rel="prefetch" href="/myblog/assets/index.html.2770fb04.js"><link rel="prefetch" href="/myblog/assets/index.html.9f31cb98.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.747bd522.js"><link rel="prefetch" href="/myblog/assets/index.html.7970fd4d.js"><link rel="prefetch" href="/myblog/assets/index.html.d76d8eeb.js"><link rel="prefetch" href="/myblog/assets/Docker.html.7e9153cc.js"><link rel="prefetch" href="/myblog/assets/nginx.html.feb27b40.js"><link rel="prefetch" href="/myblog/assets/index.html.c88cf0a5.js"><link rel="prefetch" href="/myblog/assets/java8新特性.html.eba77086.js"><link rel="prefetch" href="/myblog/assets/index.html.db442bd7.js"><link rel="prefetch" href="/myblog/assets/index.html.e978b3f4.js"><link rel="prefetch" href="/myblog/assets/vue2.html.cd054f5f.js"><link rel="prefetch" href="/myblog/assets/vue3.html.09644e9e.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.14852074.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.19638d4a.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.19940ab5.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.ff20e708.js"><link rel="prefetch" href="/myblog/assets/index.html.aeaeabce.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.5de27bef.js"><link rel="prefetch" href="/myblog/assets/network01.html.d374f53e.js"><link rel="prefetch" href="/myblog/assets/network02.html.612f1790.js"><link rel="prefetch" href="/myblog/assets/network03.html.f409d6e1.js"><link rel="prefetch" href="/myblog/assets/network04.html.417995ce.js"><link rel="prefetch" href="/myblog/assets/network05.html.383f02d3.js"><link rel="prefetch" href="/myblog/assets/network06.html.6b7b74f3.js"><link rel="prefetch" href="/myblog/assets/index.html.a5289baa.js"><link rel="prefetch" href="/myblog/assets/index.html.1ad05321.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.43cb742a.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.ba0a875f.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.c65b1aff.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.8d20d57a.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.66a2065a.js"><link rel="prefetch" href="/myblog/assets/Redisson原理.html.e587d689.js"><link rel="prefetch" href="/myblog/assets/basics.html.ec7af011.js"><link rel="prefetch" href="/myblog/assets/practice.html.3d6fcedb.js"><link rel="prefetch" href="/myblog/assets/index.html.195983d3.js"><link rel="prefetch" href="/myblog/assets/index.html.ffce25e3.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.1539f2df.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.8d492936.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.25f8081d.js"><link rel="prefetch" href="/myblog/assets/index.html.25b97898.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.11fa754a.js"><link rel="prefetch" href="/myblog/assets/SpringCloudAibaba.html.ba7822c1.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.e3fba77d.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.d245b413.js"><link rel="prefetch" href="/myblog/assets/index.html.2e0e8a71.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.ec57b0c6.js"><link rel="prefetch" href="/myblog/assets/index.html.195b9b99.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.f53a3387.js"><link rel="prefetch" href="/myblog/assets/design01.html.a9ca0966.js"><link rel="prefetch" href="/myblog/assets/design02.html.14685d48.js"><link rel="prefetch" href="/myblog/assets/design03.html.d0742e22.js"><link rel="prefetch" href="/myblog/assets/design04.html.4b4d3a60.js"><link rel="prefetch" href="/myblog/assets/design05.html.dd009a09.js"><link rel="prefetch" href="/myblog/assets/index.html.de8a79d7.js"><link rel="prefetch" href="/myblog/assets/juc01.html.7b5b2a61.js"><link rel="prefetch" href="/myblog/assets/juc02.html.e7af61bf.js"><link rel="prefetch" href="/myblog/assets/juc03.html.c680cb04.js"><link rel="prefetch" href="/myblog/assets/index.html.3ef30b14.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.226ff0ab.js"><link rel="prefetch" href="/myblog/assets/jvm02.html.ad530863.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.af77ed0d.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.dd845ccc.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.56d56c94.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.8c5c08ed.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.8713dffe.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.396f92cc.js"><link rel="prefetch" href="/myblog/assets/index.html.cacef81d.js"><link rel="prefetch" href="/myblog/assets/404.html.82bd4b1a.js"><link rel="prefetch" href="/myblog/assets/index.html.2f713335.js"><link rel="prefetch" href="/myblog/assets/index.html.1a811f74.js"><link rel="prefetch" href="/myblog/assets/index.html.79fe6d6e.js"><link rel="prefetch" href="/myblog/assets/index.html.dcd15e89.js"><link rel="prefetch" href="/myblog/assets/index.html.e8952663.js"><link rel="prefetch" href="/myblog/assets/index.html.5ad7ff00.js"><link rel="prefetch" href="/myblog/assets/index.html.92637d35.js"><link rel="prefetch" href="/myblog/assets/index.html.6033e64c.js"><link rel="prefetch" href="/myblog/assets/index.html.29a3be67.js"><link rel="prefetch" href="/myblog/assets/index.html.d2aef326.js"><link rel="prefetch" href="/myblog/assets/index.html.61fd0259.js"><link rel="prefetch" href="/myblog/assets/index.html.cf3e5974.js"><link rel="prefetch" href="/myblog/assets/index.html.b7fddec6.js"><link rel="prefetch" href="/myblog/assets/index.html.2d1c3407.js"><link rel="prefetch" href="/myblog/assets/index.html.f6e57d32.js"><link rel="prefetch" href="/myblog/assets/index.html.57cfa80f.js"><link rel="prefetch" href="/myblog/assets/index.html.5f4c6904.js"><link rel="prefetch" href="/myblog/assets/index.html.adc9fbf5.js"><link rel="prefetch" href="/myblog/assets/index.html.de6bf546.js"><link rel="prefetch" href="/myblog/assets/index.html.5802a134.js"><link rel="prefetch" href="/myblog/assets/index.html.00532d93.js"><link rel="prefetch" href="/myblog/assets/index.html.dcdb8b0c.js"><link rel="prefetch" href="/myblog/assets/index.html.64a2ffc8.js"><link rel="prefetch" href="/myblog/assets/index.html.aa56265b.js"><link rel="prefetch" href="/myblog/assets/index.html.cf5fc743.js"><link rel="prefetch" href="/myblog/assets/index.html.dd0debdd.js"><link rel="prefetch" href="/myblog/assets/index.html.598a85b3.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.9516ff71.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.f215eb2a.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.b981d3d4.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.921fe2c8.js"><link rel="prefetch" href="/myblog/assets/index.html.9ff070dd.js"><link rel="prefetch" href="/myblog/assets/index.html.f985f07c.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.367811ae.js"><link rel="prefetch" href="/myblog/assets/index.html.ccc78fec.js"><link rel="prefetch" href="/myblog/assets/index.html.cd9c8951.js"><link rel="prefetch" href="/myblog/assets/Docker.html.9aa6750f.js"><link rel="prefetch" href="/myblog/assets/nginx.html.96457f50.js"><link rel="prefetch" href="/myblog/assets/index.html.5f9750b5.js"><link rel="prefetch" href="/myblog/assets/java8新特性.html.72523a0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4267a9c7.js"><link rel="prefetch" href="/myblog/assets/index.html.64b7cc16.js"><link rel="prefetch" href="/myblog/assets/vue2.html.019d3a52.js"><link rel="prefetch" href="/myblog/assets/vue3.html.f014c692.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.1f3c1d4e.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.6085f62b.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.a05b3e35.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.f83e6c8a.js"><link rel="prefetch" href="/myblog/assets/index.html.c2377b6c.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.62e502c2.js"><link rel="prefetch" href="/myblog/assets/network01.html.bb391280.js"><link rel="prefetch" href="/myblog/assets/network02.html.4835dc75.js"><link rel="prefetch" href="/myblog/assets/network03.html.529a44ea.js"><link rel="prefetch" href="/myblog/assets/network04.html.c4a9ab39.js"><link rel="prefetch" href="/myblog/assets/network05.html.fefe6411.js"><link rel="prefetch" href="/myblog/assets/network06.html.4098bbbd.js"><link rel="prefetch" href="/myblog/assets/index.html.9a37999d.js"><link rel="prefetch" href="/myblog/assets/index.html.25f73ada.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.4774eebb.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.7aa43754.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.3b35817c.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.1eb9f421.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.445e2fb4.js"><link rel="prefetch" href="/myblog/assets/Redisson原理.html.a6281fb0.js"><link rel="prefetch" href="/myblog/assets/basics.html.64ecf975.js"><link rel="prefetch" href="/myblog/assets/practice.html.9bd91dc4.js"><link rel="prefetch" href="/myblog/assets/index.html.45528417.js"><link rel="prefetch" href="/myblog/assets/index.html.2765f82f.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.5e31fcb7.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.bbddd314.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.ccbf57f9.js"><link rel="prefetch" href="/myblog/assets/index.html.534d4ae8.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.eab22d83.js"><link rel="prefetch" href="/myblog/assets/SpringCloudAibaba.html.79284ee6.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.da3eb94f.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.1224037c.js"><link rel="prefetch" href="/myblog/assets/index.html.668ad86c.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.aabd01a5.js"><link rel="prefetch" href="/myblog/assets/index.html.9cd27700.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.469ecc81.js"><link rel="prefetch" href="/myblog/assets/design01.html.2b9f9e86.js"><link rel="prefetch" href="/myblog/assets/design02.html.849b42b0.js"><link rel="prefetch" href="/myblog/assets/design03.html.e4be33cd.js"><link rel="prefetch" href="/myblog/assets/design04.html.bc31a0d9.js"><link rel="prefetch" href="/myblog/assets/design05.html.d5c35997.js"><link rel="prefetch" href="/myblog/assets/index.html.4a7a1688.js"><link rel="prefetch" href="/myblog/assets/juc01.html.5bb1f884.js"><link rel="prefetch" href="/myblog/assets/juc02.html.0ce510cd.js"><link rel="prefetch" href="/myblog/assets/juc03.html.e93fe7b6.js"><link rel="prefetch" href="/myblog/assets/index.html.b5425fa1.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.f238e096.js"><link rel="prefetch" href="/myblog/assets/jvm02.html.a9498b0d.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.460f2e71.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.7205bd05.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.edac738a.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.91cbb3f0.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.f40c12f1.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.fb107a67.js"><link rel="prefetch" href="/myblog/assets/index.html.3ba3011a.js"><link rel="prefetch" href="/myblog/assets/404.html.1f196261.js"><link rel="prefetch" href="/myblog/assets/index.html.1375c5bc.js"><link rel="prefetch" href="/myblog/assets/index.html.90d1ac0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4d12ff1c.js"><link rel="prefetch" href="/myblog/assets/index.html.8ddb93d5.js"><link rel="prefetch" href="/myblog/assets/index.html.dd098c61.js"><link rel="prefetch" href="/myblog/assets/index.html.cebf8dc1.js"><link rel="prefetch" href="/myblog/assets/index.html.5674ca1e.js"><link rel="prefetch" href="/myblog/assets/index.html.d2abca49.js"><link rel="prefetch" href="/myblog/assets/index.html.1351de8d.js"><link rel="prefetch" href="/myblog/assets/index.html.9de6b46c.js"><link rel="prefetch" href="/myblog/assets/index.html.611ec9ae.js"><link rel="prefetch" href="/myblog/assets/index.html.a02c1bed.js"><link rel="prefetch" href="/myblog/assets/index.html.eb87c7a9.js"><link rel="prefetch" href="/myblog/assets/index.html.33261d15.js"><link rel="prefetch" href="/myblog/assets/index.html.5589fc08.js"><link rel="prefetch" href="/myblog/assets/index.html.f989be9b.js"><link rel="prefetch" href="/myblog/assets/index.html.9f0a51f1.js"><link rel="prefetch" href="/myblog/assets/index.html.49bd673c.js"><link rel="prefetch" href="/myblog/assets/index.html.f1449990.js"><link rel="prefetch" href="/myblog/assets/index.html.b063a78e.js"><link rel="prefetch" href="/myblog/assets/index.html.3f40e5f3.js"><link rel="prefetch" href="/myblog/assets/index.html.56c44de1.js"><link rel="prefetch" href="/myblog/assets/index.html.f8a7efd0.js"><link rel="prefetch" href="/myblog/assets/index.html.c2db4fad.js"><link rel="prefetch" href="/myblog/assets/404.d0d6ec4e.js"><link rel="prefetch" href="/myblog/assets/Layout.4e3e5e78.js"><link rel="prefetch" href="/myblog/assets/Slide.81c38424.js"><link rel="prefetch" href="/myblog/assets/Blog.d28c723c.js"><link rel="prefetch" href="/myblog/assets/auto.264f6c8c.js"><link rel="prefetch" href="/myblog/assets/index.d8a59108.js"><link rel="prefetch" href="/myblog/assets/index.1842ee54.js"><link rel="prefetch" href="/myblog/assets/mermaid.esm.min.fac286bf.js"><link rel="prefetch" href="/myblog/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/myblog/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/myblog/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/myblog/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/myblog/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/myblog/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/myblog/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/myblog/assets/Playground.c4bd3c9e.js"><link rel="prefetch" href="/myblog/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/myblog/" class="brand"><img class="logo" src="/myblog/avatar.jpg" alt="tt110617"><!----><span class="site-name hide-in-pad">tt110617</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/myblog/" class="nav-link" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/backend/" class="nav-link active" aria-label="后端"><span class="icon iconfont icon-java"></span>后端<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/frontend/" class="nav-link" aria-label="前端"><span class="icon iconfont icon-vue"></span>前端<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/tt110617" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><img class="icon" src="/myblog/icon/gaoxingneng.png"><span class="title">高性能</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/myblog/backend/high-performance/nginx.html" class="nav-link sidebar-link sidebar-page" aria-label="Nginx"><span class="icon iconfont icon-nginx"></span>Nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/high-performance/Docker.html" class="nav-link sidebar-link sidebar-page" aria-label="Docker基础篇"><img class="icon" src="/myblog/icon/docker.png">Docker基础篇<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="ElasticSearch"><span class="icon iconfont icon-search"></span>ElasticSearch<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1-elasticsearch-全文检索" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.ElasticSearch-全文检索"><!---->1.ElasticSearch-全文检索<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1、安装elastic-search" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1、安装elastic search"><!---->1、安装elastic search<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2、初步检索" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2、初步检索"><!---->2、初步检索<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_3、检索" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3、检索"><!---->3、检索<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_4、elasticsearch-rest-client" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4、elasticsearch-Rest-Client"><!---->4、elasticsearch-Rest-Client<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_5、附录-安装nginx" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5、附录：安装Nginx"><!---->5、附录：安装Nginx<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2-springboot整合elasticsearch" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.SpringBoot整合ElasticSearch"><!---->2.SpringBoot整合ElasticSearch<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1、导入依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1、导入依赖"><!---->1、导入依赖<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2、编写测试类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2、编写测试类"><!---->2、编写测试类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/xiaoxiduilie.png"><span class="title">消息队列</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">计算机基础</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-frame"></span><span class="title">框架</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/odbc-full.png"><span class="title">数据库</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-snow"></span><span class="title">算法</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-search"></span>ElasticSearch</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年8月16日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="/myblog/article/" target="_blank" rel="noopener noreferrer">十一</a></span><span property="author" content="十一"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年8月16日</span><meta property="datePublished" content="2022-08-16T00:00:00.000Z"></span><!----><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年8月16日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag6 clickable" role="navigation">高性能</li></ul><meta property="keywords" content="高性能"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2022年8月16日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 11208 字</span><meta property="wordCount" content="11208"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1-elasticsearch-全文检索" class="router-link-active router-link-exact-active toc-link level2">1.ElasticSearch-全文检索</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1、安装elastic-search" class="router-link-active router-link-exact-active toc-link level3">1、安装elastic search</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2、初步检索" class="router-link-active router-link-exact-active toc-link level3">2、初步检索</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_3、检索" class="router-link-active router-link-exact-active toc-link level3">3、检索</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_4、elasticsearch-rest-client" class="router-link-active router-link-exact-active toc-link level3">4、elasticsearch-Rest-Client</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_5、附录-安装nginx" class="router-link-active router-link-exact-active toc-link level3">5、附录：安装Nginx</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2-springboot整合elasticsearch" class="router-link-active router-link-exact-active toc-link level2">2.SpringBoot整合ElasticSearch</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_1、导入依赖" class="router-link-active router-link-exact-active toc-link level3">1、导入依赖</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/high-performance/ElasticSearch.html#_2、编写测试类" class="router-link-active router-link-exact-active toc-link level3">2、编写测试类</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch" aria-hidden="true">#</a> ElasticSearch</h1><h2 id="_1-elasticsearch-全文检索" tabindex="-1"><a class="header-anchor" href="#_1-elasticsearch-全文检索" aria-hidden="true">#</a> 1.ElasticSearch-全文检索</h2><p>全文搜索属于最常见的需求，开源的 Elasticsearch 是目前全文搜索引擎的首选。</p><p>它<strong>可以快速地储存、搜索和分析海量数据</strong>。维基百科、Stack Overflow、Github 都采用它</p><p>lastic 的底层是开源库 Lucene。但是，你没法直接用 Lucene，必须自己写代码去调用它的接口。Elastic 是 Lucene 的封装，提供了 REST API 的操作接口，开箱即用。</p><p>REST API：天然的跨平台。</p><p>官方文档：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 官方中文：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 社区中文： <a href="https://es.xiaoleilu.com/index.html" target="_blank" rel="noopener noreferrer">https://es.xiaoleilu.com/index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="http://doc.codingdict.com/elasticsearch/0/" target="_blank" rel="noopener noreferrer">http://doc.codingdict.com/elasticsearch/0/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>基本概念</p></blockquote><p>1、Index（索引）</p><p>动词，相当于MySQL 中的insert；</p><p>名词，相当于MySQL 中的Database</p><p>2、Type（类型）</p><p>在Index（索引）中，可以定义一个或多个类型。</p><p>类似于MySQL 中的Table；每一种类型的数据放在一起；</p><p>3、Document（文档）</p><p>保存在某个索引（Index）下，某种类型（Type）的一个数据（Document），文档是 格式的，Document 就像是 MySQL 中的某个 Table 里面的内容；</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20220713153830043.png" alt="image-20220713153830043"></p><p>4、倒排索引机制</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20220713153848395.png" alt="image-20220713153848395"></p><h3 id="_1、安装elastic-search" tabindex="-1"><a class="header-anchor" href="#_1、安装elastic-search" aria-hidden="true">#</a> 1、安装elastic search</h3><p>dokcer中安装elastic search</p><p>（1）下载ealastic search和kibana</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull elasticsearch:7.6.2
<span class="token function">docker</span> pull kibana:7.6.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）配置</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /mydata/elasticsearch/config  
<span class="token function">mkdir</span> -p /mydata/elasticsearch/data
<span class="token builtin class-name">echo</span> <span class="token string">&quot;http.host: 0.0.0.0&quot;</span> <span class="token operator">&gt;</span>/mydata/elasticsearch/config/elasticsearch.yml

//将mydata/elasticsearch/文件夹中文件都可读可写
<span class="token function">chmod</span> -R <span class="token number">777</span> /mydata/elasticsearch/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）启动Elastic search</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>
-e  <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\</span>
-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms64m -Xmx512m&quot;</span> <span class="token punctuation">\</span>
-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\</span>
-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\</span>
-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span>
-d elasticsearch:7.6.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置开机启动elasticsearch</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> update elasticsearch --restart<span class="token operator">=</span>always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）启动kibana：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://192.168.13.101:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.6.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>设置开机启动kibana</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> update kibana  --restart<span class="token operator">=</span>always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（5）测试</p><p>查看elasticsearch版本信息： <a href="http://192.168.13.101:9200/" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
    &quot;name&quot;: &quot;0adeb7852e00&quot;,
    &quot;cluster_name&quot;: &quot;elasticsearch&quot;,
    &quot;cluster_uuid&quot;: &quot;9gglpP0HTfyOTRAaSe2rIg&quot;,
    &quot;version&quot;: {
        &quot;number&quot;: &quot;7.6.2&quot;,
        &quot;build_flavor&quot;: &quot;default&quot;,
        &quot;build_type&quot;: &quot;docker&quot;,
        &quot;build_hash&quot;: &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,
        &quot;build_date&quot;: &quot;2020-03-26T06:34:37.794943Z&quot;,
        &quot;build_snapshot&quot;: false,
        &quot;lucene_version&quot;: &quot;8.4.0&quot;,
        &quot;minimum_wire_compatibility_version&quot;: &quot;6.8.0&quot;,
        &quot;minimum_index_compatibility_version&quot;: &quot;6.0.0-beta1&quot;
    },
    &quot;tagline&quot;: &quot;You Know, for Search&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>显示elasticsearch 节点信息<a href="http://192.168.13.101:9200/_cat/nodes" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/_cat/nodes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ，</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>127.0.0.1 76 95 1 0.26 1.40 1.22 dilm * 0adeb7852e00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>访问Kibana： <a href="http://192.168.13.101:5601/app/kibana" target="_blank" rel="noopener noreferrer">http://192.168.13.101:5601/app/kibana<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501192629304.png" alt="image-20200501192629304"></p><h3 id="_2、初步检索" tabindex="-1"><a class="header-anchor" href="#_2、初步检索" aria-hidden="true">#</a> 2、初步检索</h3><h4 id="_1-cat" tabindex="-1"><a class="header-anchor" href="#_1-cat" aria-hidden="true">#</a> 1）_CAT</h4><p>（1）GET /_cat/nodes：查看所有节点</p><p>如：<a href="http://192.168.13.101:9200/_cat/nodes" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/_cat/nodes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> :</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>127.0.0.1 61 91 11 0.08 0.49 0.87 dilm * 0adeb7852e00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注：*表示集群中的主节点</p><p>（2）GET/_cat/health：查看es健康状况</p><p>如：<a href="http://192.168.13.101:9200/_cat/health" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/_cat/health<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1588332616 11:30:16 elasticsearch green 1 1 3 3 0 0 0 0 - 100.0%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注：green表示健康值正常</p><p>（3）GET/_cat/master：查看主节点信息</p><p>如： <a href="http://192.168.13.101:9200/_cat/master" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/_cat/master<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vfpgxbusTC6-W3C2Np31EQ 127.0.0.1 127.0.0.1 0adeb7852e00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）GET/_cat/indicies：查看所有索引 ，等价于mysql数据库的show databases;</p><p>如： <a href="http://192.168.13.101:9200/_cat/indices" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/_cat/indices<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>green open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg 1 0 2 0 39.8kb 39.8kb
green open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA 1 0 0 0   283b   283b
green open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw 1 0 7 0 31.2kb 31.2kb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-索引一个文档" tabindex="-1"><a class="header-anchor" href="#_2-索引一个文档" aria-hidden="true">#</a> 2）索引一个文档</h4><p>保存一个数据，保存在哪个索引的哪个类型下，指定用那个唯一标识 PUT customer/external/1; 在customer索引下的external类型下保存1号数据为</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT customer/external/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
 &quot;name&quot;:&quot;John Doe&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PUT和POST都可以</p><p>POST新增。如果不指定id，会自动生成id。指定id就会修改这个数据，并新增版本号；</p><p>PUT可以新增也可以修改。PUT必须指定id；由于PUT需要指定id，我们一般用来做修改操作，不指定id会报错。</p><p>下面是在postman中的测试数据： <img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501194449944.png" alt="image-20200501194449944"></p><p>创建数据成功后，显示201 created表示插入记录成功。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
    &quot;_index&quot;: &quot;customer&quot;,
    &quot;_type&quot;: &quot;external&quot;,
    &quot;_id&quot;: &quot;1&quot;,
    &quot;_version&quot;: 1,
    &quot;result&quot;: &quot;created&quot;,
    &quot;_shards&quot;: {
        &quot;total&quot;: 2,
        &quot;successful&quot;: 1,
        &quot;failed&quot;: 0
    },
    &quot;_seq_no&quot;: 0,
    &quot;_primary_term&quot;: 1
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些返回的串的含义；这些带有下划线开头的，称为元数据，反映了当前的基本信息。</p><p>&quot;_index&quot;: &quot;customer&quot; 表明该数据在哪个索引下；</p><p>&quot;_type&quot;: &quot;external&quot; 表明该数据在哪个类型下；</p><p>&quot;_id&quot;: &quot;1&quot; 表明被保存数据的id；</p><p>&quot;_version&quot;: 1, 被保存数据的版本</p><p>&quot;result&quot;: &quot;created&quot; 这里是创建了一条数据，如果重新put一条数据，则该状态会变为updated，并且版本号也会发生变化。</p><p>下面选用POST方式：</p><p>添加数据的时候，不指定ID，会自动的生成id，并且类型是新增：</p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501195619925.png" alt="image-20200501195619925" style="zoom:52%;"><p>再次使用POST插入数据，仍然是新增的：</p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501195732492.png" alt="image-20200501195732492" style="zoom:80%;"><p>添加数据的时候，指定ID，会使用该id，并且类型是新增：</p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501200048361.png" alt="image-20200501200048361" style="zoom:66%;"><p>再次使用POST插入数据，类型为updated</p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501200132199.png" alt="image-20200501200132199" style="zoom:67%;"><h4 id="_3-查看文档" tabindex="-1"><a class="header-anchor" href="#_3-查看文档" aria-hidden="true">#</a> 3）查看文档</h4><p>GET /customer/external/1</p><p><a href="http://192.168.13.101:9200/customer/external/1" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
    &quot;_index&quot;: &quot;customer&quot;,//在哪个索引
    &quot;_type&quot;: &quot;external&quot;,//在哪个类型
    &quot;_id&quot;: &quot;1&quot;,//记录id
    &quot;_version&quot;: 3,//版本号
    &quot;_seq_no&quot;: 6,//并发控制字段，每次更新都会+1，用来做乐观锁
    &quot;_primary_term&quot;: 1,//同上，主分片重新分配，如重启，就会变化
    &quot;found&quot;: true,
    &quot;_source&quot;: {
        &quot;name&quot;: &quot;John Doe&quot;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过“if_seq_no=1&amp;if_primary_term=1 ”，当序列号匹配的时候，才进行修改，否则不修改。</p><p>实例：将id=1的数据更新为name=1，然后再次更新为name=2，起始_seq_no=6，_primary_term=1</p><p>（1）将name更新为1</p><p><a href="http://192.168.13.101:9200/customer/external/1?if_seq_no=1&amp;if_primary_term=1" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1?if_seq_no=1&amp;if_primary_term=1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501212224983.png" alt="image-20200501212224983" style="zoom:61%;"><p>（2）将name更新为2，更新过程中使用seq_no=6</p><p><a href="http://192.168.13.101:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501213047499.png" alt="image-20200501213047499" style="zoom:60%;"><p>出现更新错误。</p><p>（3）查询新的数据</p><p><a href="http://192.168.13.101:9200/customer/external/1" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501212924094.png" alt="image-20200501212924094"></p><p>能够看到_seq_no变为7。</p><p>（4）再次更新，更新成功</p><p><a href="http://192.168.13.101:9200/customer/external/1?if_seq_no=7&amp;if_primary_term=1" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1?if_seq_no=7&amp;if_primary_term=1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501213130001.png" alt="image-20200501213130001" style="zoom:75%;"><h4 id="_4-更新文档" tabindex="-1"><a class="header-anchor" href="#_4-更新文档" aria-hidden="true">#</a> 4）更新文档</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501214522818.png" alt="image-20200501214522818"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501215746139.png" alt="image-20200501215746139"></p><p>（1）POST更新文档，带有_update</p><p><a href="http://192.168.13.101:9200/customer/external/1/_update" target="_blank" rel="noopener noreferrer">http://192.168.13.101:9200/customer/external/1/_update<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501214810741.png" alt="image-20200501214810741"></p><p>如果再次执行更新，则不执行任何操作，序列号也不发生变化</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501214912607.png" alt="image-20200501214912607"></p><p>POST更新方式，会对比原来的数据，和原来的相同，则不执行任何操作（version和_seq_no）都不变。</p><p>（2）POST更新文档，不带_update</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501215358666.png" alt="image-20200501215358666"></p><p>在更新过程中，重复执行更新操作，数据也能够更新成功，不会和原来的数据进行对比。</p><h4 id="_5-删除文档或索引" tabindex="-1"><a class="header-anchor" href="#_5-删除文档或索引" aria-hidden="true">#</a> 5）删除文档或索引</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE customer/external/1
DELETE customer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>注：elasticsearch并没有提供删除类型的操作，只提供了删除索引和文档的操作。</p><p>实例：删除id=1的数据，删除后继续查询</p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501220559094.png" alt="image-20200501220559094" style="zoom:67%;"><p>实例：删除整个costomer索引数据</p><p>删除前，所有的索引</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>green  open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg 1 0 2 0 39.8kb 39.8kb
green  open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA 1 0 0 0   283b   283b
green  open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw 1 0 7 0 31.2kb 31.2kb
yellow open customer                 nzDYCdnvQjSsapJrAIT8Zw 1 1 4 0  4.4kb  4.4kb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除“ customer ”索引</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501221105476.png" alt="image-20200501221105476"></p><p>删除后，所有的索引</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>green  open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg 1 0 2 0 39.8kb 39.8kb
green  open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA 1 0 0 0   283b   283b
green  open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw 1 0 7 0 31.2kb 31.2kb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-eleasticsearch的批量操作——bulk" tabindex="-1"><a class="header-anchor" href="#_6-eleasticsearch的批量操作——bulk" aria-hidden="true">#</a> 6）eleasticsearch的批量操作——bulk</h4><p>语法格式：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{action:{metadata}}\n   //例如index保存记录，update更新
{request body  }\n

{action:{metadata}}\n
{request body  }\n
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的批量操作，当发生某一条执行发生失败时，其他的数据仍然能够接着执行，也就是说彼此之间是独立的。</p><p>bulk api以此按顺序执行所有的action（动作）。如果一个单个的动作因任何原因失败，它将继续处理它后面剩余的动作。当bulk api返回时，它将提供每个动作的状态（与发送的顺序相同），所以您可以检查是否一个指定的动作是否失败了。</p><p>实例1: 执行多条数据 (postman 报错，在kibana中的Dev_tools中执行)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /customer/external/_bulk
{&quot;index&quot;:{&quot;_id&quot;:&quot;1&quot;}}
{&quot;name&quot;:&quot;John Doe&quot;}
{&quot;index&quot;:{&quot;_id&quot;:&quot;2&quot;}}
{&quot;name&quot;:&quot;John Doe&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#! Deprecation: [types removal] Specifying types in bulk requests is deprecated.
{
  &quot;took&quot; : 491,
  &quot;errors&quot; : false,
  &quot;items&quot; : [
    {
      &quot;index&quot; : {
        &quot;_index&quot; : &quot;customer&quot;,
        &quot;_type&quot; : &quot;external&quot;,
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_version&quot; : 1,
        &quot;result&quot; : &quot;created&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 0,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 201
      }
    },
    {
      &quot;index&quot; : {
        &quot;_index&quot; : &quot;customer&quot;,
        &quot;_type&quot; : &quot;external&quot;,
        &quot;_id&quot; : &quot;2&quot;,
        &quot;_version&quot; : 1,
        &quot;result&quot; : &quot;created&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 1,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 201
      }
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实例2：对于整个索引执行批量操作</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /_bulk
{&quot;delete&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;create&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;title&quot;:&quot;my first blog post&quot;}
{&quot;index&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;}}
{&quot;title&quot;:&quot;my second blog post&quot;}
{&quot;update&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;doc&quot;:{&quot;title&quot;:&quot;my updated blog post&quot;}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#! Deprecation: [types removal] Specifying types in bulk requests is deprecated.
{
  &quot;took&quot; : 608,
  &quot;errors&quot; : false,
  &quot;items&quot; : [
    {
      &quot;delete&quot; : {
        &quot;_index&quot; : &quot;website&quot;,
        &quot;_type&quot; : &quot;blog&quot;,
        &quot;_id&quot; : &quot;123&quot;,
        &quot;_version&quot; : 1,
        &quot;result&quot; : &quot;not_found&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 0,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 404
      }
    },
    {
      &quot;create&quot; : {
        &quot;_index&quot; : &quot;website&quot;,
        &quot;_type&quot; : &quot;blog&quot;,
        &quot;_id&quot; : &quot;123&quot;,
        &quot;_version&quot; : 2,
        &quot;result&quot; : &quot;created&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 1,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 201
      }
    },
    {
      &quot;index&quot; : {
        &quot;_index&quot; : &quot;website&quot;,
        &quot;_type&quot; : &quot;blog&quot;,
        &quot;_id&quot; : &quot;MCOs0HEBHYK_MJXUyYIz&quot;,
        &quot;_version&quot; : 1,
        &quot;result&quot; : &quot;created&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 2,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 201
      }
    },
    {
      &quot;update&quot; : {
        &quot;_index&quot; : &quot;website&quot;,
        &quot;_type&quot; : &quot;blog&quot;,
        &quot;_id&quot; : &quot;123&quot;,
        &quot;_version&quot; : 3,
        &quot;result&quot; : &quot;updated&quot;,
        &quot;_shards&quot; : {
          &quot;total&quot; : 2,
          &quot;successful&quot; : 1,
          &quot;failed&quot; : 0
        },
        &quot;_seq_no&quot; : 3,
        &quot;_primary_term&quot; : 1,
        &quot;status&quot; : 200
      }
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-样本测试数据" tabindex="-1"><a class="header-anchor" href="#_7-样本测试数据" aria-hidden="true">#</a> 7）样本测试数据</h4><p>准备了一份顾客银行账户信息的虚构的文档样本。每个文档都有下列的schema（模式）。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
	&quot;account_number&quot;: 1,
	&quot;balance&quot;: 39225,
	&quot;firstname&quot;: &quot;Amber&quot;,
	&quot;lastname&quot;: &quot;Duke&quot;,
	&quot;age&quot;: 32,
	&quot;gender&quot;: &quot;M&quot;,
	&quot;address&quot;: &quot;880 Holmes Lane&quot;,
	&quot;employer&quot;: &quot;Pyrami&quot;,
	&quot;email&quot;: &quot;amberduke@pyrami.com&quot;,
	&quot;city&quot;: &quot;Brogan&quot;,
	&quot;state&quot;: &quot;IL&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://gitee.com/xlh_blog/common_content/blob/master/es%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE" target="_blank" rel="noopener noreferrer">https://gitee.com/xlh_blog/common_content/blob/master/es测试数据<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. ，导入测试数据，</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>POST bank/account/_bulk
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、检索" tabindex="-1"><a class="header-anchor" href="#_3、检索" aria-hidden="true">#</a> 3、检索</h3><h4 id="_1-search-api" tabindex="-1"><a class="header-anchor" href="#_1-search-api" aria-hidden="true">#</a> 1）search Api</h4><p>ES支持两种基本方式检索；</p><ul><li>通过REST request uri 发送搜索参数 （uri +检索参数）；</li><li>通过REST request body 来发送它们（uri+请求体）；</li></ul><p>信息检索</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200501233938697.png" alt="image-20200501233938697"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502000221422.png" alt=""></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502000733594.png" alt="image-20200502000733594"></p><p>uri+请求体进行检索</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /bank/_search
{
  &quot;query&quot;: { &quot;match_all&quot;: {} },
  &quot;sort&quot;: [
    { &quot;account_number&quot;: &quot;asc&quot; },
    {&quot;balance&quot;:&quot;desc&quot;}
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>HTTP客户端工具（），get请求不能够携带请求体，</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GET bank<span class="token operator">/</span>_search<span class="token operator">?</span>q<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span>account_number<span class="token operator">:</span>asc
<span class="token comment">//q=* 查询所有，sort=account_number:asc 按照account_number进行asc升序排列sort</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>返回结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 235,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1000,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;0&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 0,
          &quot;balance&quot; : 16623,
          &quot;firstname&quot; : &quot;Bradshaw&quot;,
          &quot;lastname&quot; : &quot;Mckenzie&quot;,
          &quot;age&quot; : 29,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;244 Columbus Place&quot;,
          &quot;employer&quot; : &quot;Euron&quot;,
          &quot;email&quot; : &quot;bradshawmckenzie@euron.com&quot;,
          &quot;city&quot; : &quot;Hobucken&quot;,
          &quot;state&quot; : &quot;CO&quot;
        },
        &quot;sort&quot; : [
          0
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 1,
          &quot;balance&quot; : 39225,
          &quot;firstname&quot; : &quot;Amber&quot;,
          &quot;lastname&quot; : &quot;Duke&quot;,
          &quot;age&quot; : 32,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;880 Holmes Lane&quot;,
          &quot;employer&quot; : &quot;Pyrami&quot;,
          &quot;email&quot; : &quot;amberduke@pyrami.com&quot;,
          &quot;city&quot; : &quot;Brogan&quot;,
          &quot;state&quot; : &quot;IL&quot;
        },
        &quot;sort&quot; : [
          1
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;2&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 2,
          &quot;balance&quot; : 28838,
          &quot;firstname&quot; : &quot;Roberta&quot;,
          &quot;lastname&quot; : &quot;Bender&quot;,
          &quot;age&quot; : 22,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;560 Kingsway Place&quot;,
          &quot;employer&quot; : &quot;Chillium&quot;,
          &quot;email&quot; : &quot;robertabender@chillium.com&quot;,
          &quot;city&quot; : &quot;Bennett&quot;,
          &quot;state&quot; : &quot;LA&quot;
        },
        &quot;sort&quot; : [
          2
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;3&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 3,
          &quot;balance&quot; : 44947,
          &quot;firstname&quot; : &quot;Levine&quot;,
          &quot;lastname&quot; : &quot;Burks&quot;,
          &quot;age&quot; : 26,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;328 Wilson Avenue&quot;,
          &quot;employer&quot; : &quot;Amtap&quot;,
          &quot;email&quot; : &quot;levineburks@amtap.com&quot;,
          &quot;city&quot; : &quot;Cochranville&quot;,
          &quot;state&quot; : &quot;HI&quot;
        },
        &quot;sort&quot; : [
          3
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;4&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 4,
          &quot;balance&quot; : 27658,
          &quot;firstname&quot; : &quot;Rodriquez&quot;,
          &quot;lastname&quot; : &quot;Flores&quot;,
          &quot;age&quot; : 31,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;986 Wyckoff Avenue&quot;,
          &quot;employer&quot; : &quot;Tourmania&quot;,
          &quot;email&quot; : &quot;rodriquezflores@tourmania.com&quot;,
          &quot;city&quot; : &quot;Eastvale&quot;,
          &quot;state&quot; : &quot;HI&quot;
        },
        &quot;sort&quot; : [
          4
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;5&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 5,
          &quot;balance&quot; : 29342,
          &quot;firstname&quot; : &quot;Leola&quot;,
          &quot;lastname&quot; : &quot;Stewart&quot;,
          &quot;age&quot; : 30,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;311 Elm Place&quot;,
          &quot;employer&quot; : &quot;Diginetic&quot;,
          &quot;email&quot; : &quot;leolastewart@diginetic.com&quot;,
          &quot;city&quot; : &quot;Fairview&quot;,
          &quot;state&quot; : &quot;NJ&quot;
        },
        &quot;sort&quot; : [
          5
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;6&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 6,
          &quot;balance&quot; : 5686,
          &quot;firstname&quot; : &quot;Hattie&quot;,
          &quot;lastname&quot; : &quot;Bond&quot;,
          &quot;age&quot; : 36,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;671 Bristol Street&quot;,
          &quot;employer&quot; : &quot;Netagy&quot;,
          &quot;email&quot; : &quot;hattiebond@netagy.com&quot;,
          &quot;city&quot; : &quot;Dante&quot;,
          &quot;state&quot; : &quot;TN&quot;
        },
        &quot;sort&quot; : [
          6
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;7&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 7,
          &quot;balance&quot; : 39121,
          &quot;firstname&quot; : &quot;Levy&quot;,
          &quot;lastname&quot; : &quot;Richard&quot;,
          &quot;age&quot; : 22,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;820 Logan Street&quot;,
          &quot;employer&quot; : &quot;Teraprene&quot;,
          &quot;email&quot; : &quot;levyrichard@teraprene.com&quot;,
          &quot;city&quot; : &quot;Shrewsbury&quot;,
          &quot;state&quot; : &quot;MO&quot;
        },
        &quot;sort&quot; : [
          7
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;8&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 8,
          &quot;balance&quot; : 48868,
          &quot;firstname&quot; : &quot;Jan&quot;,
          &quot;lastname&quot; : &quot;Burns&quot;,
          &quot;age&quot; : 35,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;699 Visitation Place&quot;,
          &quot;employer&quot; : &quot;Glasstep&quot;,
          &quot;email&quot; : &quot;janburns@glasstep.com&quot;,
          &quot;city&quot; : &quot;Wakulla&quot;,
          &quot;state&quot; : &quot;AZ&quot;
        },
        &quot;sort&quot; : [
          8
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;9&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 9,
          &quot;balance&quot; : 24776,
          &quot;firstname&quot; : &quot;Opal&quot;,
          &quot;lastname&quot; : &quot;Meadows&quot;,
          &quot;age&quot; : 39,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;963 Neptune Avenue&quot;,
          &quot;employer&quot; : &quot;Cedward&quot;,
          &quot;email&quot; : &quot;opalmeadows@cedward.com&quot;,
          &quot;city&quot; : &quot;Olney&quot;,
          &quot;state&quot; : &quot;OH&quot;
        },
        &quot;sort&quot; : [
          9
        ]
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（1）只有9条数据，这是因为存在分页查询；</p><p>（2）详细的字段信息，参照： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-search.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-search.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>The response also provides the following information about the search request:</p><ul><li><code>took</code> – how long it took Elasticsearch to run the query, in milliseconds</li><li><code>timed_out</code> – whether or not the search request timed out</li><li><code>_shards</code> – how many shards were searched and a breakdown of how many shards succeeded, failed, or were skipped.</li><li><code>max_score</code> – the score of the most relevant document found</li><li><code>hits.total.value</code> - how many matching documents were found</li><li><code>hits.sort</code> - the document’s sort position (when not sorting by relevance score)</li><li><code>hits._score</code> - the document’s relevance score (not applicable when using <code>match_all</code>)</li></ul></blockquote><h4 id="_2-query-dsl" tabindex="-1"><a class="header-anchor" href="#_2-query-dsl" aria-hidden="true">#</a> 2）Query DSL</h4><h5 id="_1-基本语法格式" tabindex="-1"><a class="header-anchor" href="#_1-基本语法格式" aria-hidden="true">#</a> （1）基本语法格式</h5><p>Elasticsearch提供了一个可以执行查询的风格的DSL。这个被称为Query DSL，该查询语言非常全面。</p><p>一个查询语句的典型结构</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>QUERY_NAME:{
   ARGUMENT:VALUE,
   ARGUMENT:VALUE,...
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果针对于某个字段，那么它的结构如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  QUERY_NAME:{
     FIELD_NAME:{
       ARGUMENT:VALUE,
       ARGUMENT:VALUE,...
      }   
   }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;from&quot;: 0,
  &quot;size&quot;: 5,
  &quot;sort&quot;: [
    {
      &quot;account_number&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    }
  ]
}
//match_al查询所有，从第0个数据拿5个数据
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>query定义如何查询；</p><ul><li>match_all查询类型【代表查询所有的所有】，es中可以在query中组合非常多的查询类型完成复杂查询；</li><li>除了query参数之外，我们可也传递其他的参数以改变查询结果，如sort，size；</li><li>from+size限定，完成分页功能；</li><li>sort排序，多字段排序，会在前序字段相等时后续字段内部排序，否则以前序为准；</li></ul><h5 id="_2-返回部分字段" tabindex="-1"><a class="header-anchor" href="#_2-返回部分字段" aria-hidden="true">#</a> （2）返回部分字段</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;from&quot;: 0,
  &quot;size&quot;: 5,
  &quot;sort&quot;: [
    {
      &quot;account_number&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    }
  ],
  &quot;_source&quot;: [&quot;balance&quot;,&quot;firstname&quot;]
  
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 18,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1000,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;999&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;firstname&quot; : &quot;Dorothy&quot;,
          &quot;balance&quot; : 6087
        },
        &quot;sort&quot; : [
          999
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;998&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;firstname&quot; : &quot;Letha&quot;,
          &quot;balance&quot; : 16869
        },
        &quot;sort&quot; : [
          998
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;997&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;firstname&quot; : &quot;Combs&quot;,
          &quot;balance&quot; : 25311
        },
        &quot;sort&quot; : [
          997
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;996&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;firstname&quot; : &quot;Andrews&quot;,
          &quot;balance&quot; : 17541
        },
        &quot;sort&quot; : [
          996
        ]
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;995&quot;,
        &quot;_score&quot; : null,
        &quot;_source&quot; : {
          &quot;firstname&quot; : &quot;Phelps&quot;,
          &quot;balance&quot; : 21153
        },
        &quot;sort&quot; : [
          995
        ]
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-match匹配查询" tabindex="-1"><a class="header-anchor" href="#_3-match匹配查询" aria-hidden="true">#</a> （3）match匹配查询</h5><ul><li>基本类型（非字符串），&quot;account_number&quot;: 20 可加可不加“ ” 不加就是精确匹配</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;account_number&quot;: &quot;20&quot;
    }
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>match返回account_number=20的数据。</p><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;20&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 20,
          &quot;balance&quot; : 16418,
          &quot;firstname&quot; : &quot;Elinor&quot;,
          &quot;lastname&quot; : &quot;Ratliff&quot;,
          &quot;age&quot; : 36,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;282 Kings Place&quot;,
          &quot;employer&quot; : &quot;Scentric&quot;,
          &quot;email&quot; : &quot;elinorratliff@scentric.com&quot;,
          &quot;city&quot; : &quot;Ribera&quot;,
          &quot;state&quot; : &quot;WA&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>字符串，全文检索“ ” 模糊查询</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address&quot;: &quot;kings&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>全文检索，最终会按照评分进行排序，会对检索条件进行分词匹配。</p><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 30,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 2,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 5.990829,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;20&quot;,
        &quot;_score&quot; : 5.990829,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 20,
          &quot;balance&quot; : 16418,
          &quot;firstname&quot; : &quot;Elinor&quot;,
          &quot;lastname&quot; : &quot;Ratliff&quot;,
          &quot;age&quot; : 36,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;282 Kings Place&quot;,
          &quot;employer&quot; : &quot;Scentric&quot;,
          &quot;email&quot; : &quot;elinorratliff@scentric.com&quot;,
          &quot;city&quot; : &quot;Ribera&quot;,
          &quot;state&quot; : &quot;WA&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;722&quot;,
        &quot;_score&quot; : 5.990829,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 722,
          &quot;balance&quot; : 27256,
          &quot;firstname&quot; : &quot;Roberts&quot;,
          &quot;lastname&quot; : &quot;Beasley&quot;,
          &quot;age&quot; : 34,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;305 Kings Hwy&quot;,
          &quot;employer&quot; : &quot;Quintity&quot;,
          &quot;email&quot; : &quot;robertsbeasley@quintity.com&quot;,
          &quot;city&quot; : &quot;Hayden&quot;,
          &quot;state&quot; : &quot;PA&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-match-phrase-短句匹配" tabindex="-1"><a class="header-anchor" href="#_4-match-phrase-短句匹配" aria-hidden="true">#</a> （4）match_phrase [短句匹配]</h5><p>将需要匹配的值当成一整个单词（不分词）进行检索</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_phrase&quot;: {
      &quot;address&quot;: &quot;mill road&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查处address中包含mill road的所有记录，并给出相关性得分</p><p>查看结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 32,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 8.926605,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 8.926605,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>match_phrase和match的区别，观察如下实例：</p><p>match_phrase是做短语匹配</p><p>match是分词匹配，例如990 Mill匹配含有<strong>990或者Mill</strong>的结果</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_phrase&quot;: {
      &quot;address&quot;: &quot;990 Mill&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 10.806405,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 10.806405,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用match的keyword</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address.keyword&quot;: &quot;990 Mill&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果，一条也未匹配到</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 0,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [ ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改匹配条件为“990 Mill Road”</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address.keyword&quot;: &quot;990 Mill Road&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询出一条数据</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 6.5032897,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 6.5032897,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>文本字段的配，使用keyword，匹配的条件就是要显示字段的全部值，要进行精确匹配的。</p><p>match_phrase是做短语匹配，只要文本中包含匹配条件既包含这个短语，就能匹配到。</p><h5 id="_5-multi-math【多字段匹配】" tabindex="-1"><a class="header-anchor" href="#_5-multi-math【多字段匹配】" aria-hidden="true">#</a> （5）multi_math【多字段匹配】</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;multi_match&quot;: {
      &quot;query&quot;: &quot;mill&quot;,
      &quot;fields&quot;: [
        &quot;state&quot;,
        &quot;address&quot;
      ]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>state或者address中包含mill，并且在查询过程中，会对于查询条件进行分词。</p><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 28,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 4,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 5.4032025,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 5.4032025,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;136&quot;,
        &quot;_score&quot; : 5.4032025,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 136,
          &quot;balance&quot; : 45801,
          &quot;firstname&quot; : &quot;Winnie&quot;,
          &quot;lastname&quot; : &quot;Holland&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;198 Mill Lane&quot;,
          &quot;employer&quot; : &quot;Neteria&quot;,
          &quot;email&quot; : &quot;winnieholland@neteria.com&quot;,
          &quot;city&quot; : &quot;Urie&quot;,
          &quot;state&quot; : &quot;IL&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;345&quot;,
        &quot;_score&quot; : 5.4032025,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 345,
          &quot;balance&quot; : 9812,
          &quot;firstname&quot; : &quot;Parker&quot;,
          &quot;lastname&quot; : &quot;Hines&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;715 Mill Avenue&quot;,
          &quot;employer&quot; : &quot;Baluba&quot;,
          &quot;email&quot; : &quot;parkerhines@baluba.com&quot;,
          &quot;city&quot; : &quot;Blackgum&quot;,
          &quot;state&quot; : &quot;KY&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;472&quot;,
        &quot;_score&quot; : 5.4032025,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 472,
          &quot;balance&quot; : 25571,
          &quot;firstname&quot; : &quot;Lee&quot;,
          &quot;lastname&quot; : &quot;Long&quot;,
          &quot;age&quot; : 32,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;288 Mill Street&quot;,
          &quot;employer&quot; : &quot;Comverges&quot;,
          &quot;email&quot; : &quot;leelong@comverges.com&quot;,
          &quot;city&quot; : &quot;Movico&quot;,
          &quot;state&quot; : &quot;MT&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-bool用来做复合查询" tabindex="-1"><a class="header-anchor" href="#_6-bool用来做复合查询" aria-hidden="true">#</a> （6）bool用来做复合查询</h5><p>复合语句可以合并，任何其他查询语句，包括符合语句。这也就意味着，复合语句之间 可以互相嵌套，可以表达非常复杂的逻辑。</p><p>must：必须达到must所列举的所有条件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
   &quot;query&quot;:{
        &quot;bool&quot;:{
             &quot;must&quot;:[
              {&quot;match&quot;:{&quot;address&quot;:&quot;mill&quot;}},
              {&quot;match&quot;:{&quot;gender&quot;:&quot;M&quot;}}
             ]
         }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>must_not，必须不匹配must_not所列举的所有条件。</p><p>should，应该满足should所列举的条件。</p><p>实例：查询gender=m，并且address=mill的数据</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {
          &quot;match&quot;: {
            &quot;gender&quot;: &quot;M&quot;
          }
        },
        {
          &quot;match&quot;: {
            &quot;address&quot;: &quot;mill&quot;
          }
        }
      ]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 3,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 6.0824604,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;136&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 136,
          &quot;balance&quot; : 45801,
          &quot;firstname&quot; : &quot;Winnie&quot;,
          &quot;lastname&quot; : &quot;Holland&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;198 Mill Lane&quot;,
          &quot;employer&quot; : &quot;Neteria&quot;,
          &quot;email&quot; : &quot;winnieholland@neteria.com&quot;,
          &quot;city&quot; : &quot;Urie&quot;,
          &quot;state&quot; : &quot;IL&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;345&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 345,
          &quot;balance&quot; : 9812,
          &quot;firstname&quot; : &quot;Parker&quot;,
          &quot;lastname&quot; : &quot;Hines&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;715 Mill Avenue&quot;,
          &quot;employer&quot; : &quot;Baluba&quot;,
          &quot;email&quot; : &quot;parkerhines@baluba.com&quot;,
          &quot;city&quot; : &quot;Blackgum&quot;,
          &quot;state&quot; : &quot;KY&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>must_not：必须不是指定的情况</strong></p><p>实例：查询gender=m，并且address=mill的数据，但是age不等于38的</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {
          &quot;match&quot;: {
            &quot;gender&quot;: &quot;M&quot;
          }
        },
        {
          &quot;match&quot;: {
            &quot;address&quot;: &quot;mill&quot;
          }
        }
      ],
      &quot;must_not&quot;: [
        {
          &quot;match&quot;: {
            &quot;age&quot;: &quot;38&quot;
          }
        }
      ]
    }
  }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 4,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 6.0824604,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>should：应该达到should列举的条件，如果到达会增加相关文档的评分，并不会改变查询的结果。如果query中只有should且只有一种匹配规则，那么should的条件就会被作为默认匹配条件而去改变查询结果。</strong></p><p>实例：匹配lastName应该等于Wallace的数据</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {
          &quot;match&quot;: {
            &quot;gender&quot;: &quot;M&quot;
          }
        },
        {
          &quot;match&quot;: {
            &quot;address&quot;: &quot;mill&quot;
          }
        }
      ],
      &quot;must_not&quot;: [
        {
          &quot;match&quot;: {
            &quot;age&quot;: &quot;18&quot;
          }
        }
      ],
      &quot;should&quot;: [
        {
          &quot;match&quot;: {
            &quot;lastname&quot;: &quot;Wallace&quot;
          }
        }
      ]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 5,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 3,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 12.585751,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 12.585751,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;136&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 136,
          &quot;balance&quot; : 45801,
          &quot;firstname&quot; : &quot;Winnie&quot;,
          &quot;lastname&quot; : &quot;Holland&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;198 Mill Lane&quot;,
          &quot;employer&quot; : &quot;Neteria&quot;,
          &quot;email&quot; : &quot;winnieholland@neteria.com&quot;,
          &quot;city&quot; : &quot;Urie&quot;,
          &quot;state&quot; : &quot;IL&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;345&quot;,
        &quot;_score&quot; : 6.0824604,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 345,
          &quot;balance&quot; : 9812,
          &quot;firstname&quot; : &quot;Parker&quot;,
          &quot;lastname&quot; : &quot;Hines&quot;,
          &quot;age&quot; : 38,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;715 Mill Avenue&quot;,
          &quot;employer&quot; : &quot;Baluba&quot;,
          &quot;email&quot; : &quot;parkerhines@baluba.com&quot;,
          &quot;city&quot; : &quot;Blackgum&quot;,
          &quot;state&quot; : &quot;KY&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>能够看到相关度越高，得分也越高。</p><h5 id="_7-filter【结果过滤】" tabindex="-1"><a class="header-anchor" href="#_7-filter【结果过滤】" aria-hidden="true">#</a> （7）Filter【结果过滤】</h5><p>并不是所有的查询都需要产生分数，特别是哪些仅用于filtering过滤的文档。为了不计算分数，elasticsearch会自动检查场景并且优化查询的执行。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: {
        &quot;range&quot;: {
          &quot;balance&quot;: {
            &quot;gte&quot;: &quot;10000&quot;,
            &quot;lte&quot;: &quot;20000&quot;
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里先是查询所有匹配address=mill的文档，然后再根据10000&lt;=balance&lt;=20000进行过滤查询结果</p><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 2,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 5.4032025,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;970&quot;,
        &quot;_score&quot; : 5.4032025,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 970,
          &quot;balance&quot; : 19648,
          &quot;firstname&quot; : &quot;Forbes&quot;,
          &quot;lastname&quot; : &quot;Wallace&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;990 Mill Road&quot;,
          &quot;employer&quot; : &quot;Pheast&quot;,
          &quot;email&quot; : &quot;forbeswallace@pheast.com&quot;,
          &quot;city&quot; : &quot;Lopezo&quot;,
          &quot;state&quot; : &quot;AK&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Each <code>must</code>, <code>should</code>, and <code>must_not</code> element in a Boolean query is referred to as a query clause. How well a document meets the criteria in each <code>must</code> or <code>should</code> clause contributes to the document’s <em>relevance score</em>. The higher the score, the better the document matches your search criteria. By default, Elasticsearch returns documents ranked by these relevance scores.</p><p>在boolean查询中，<code>must</code>, <code>should</code> 和<code>must_not</code> 元素都被称为查询子句 。 文档是否符合每个“must”或“should”子句中的标准，决定了文档的“相关性得分”。 得分越高，文档越符合您的搜索条件。 默认情况下，Elasticsearch返回根据这些相关性得分排序的文档。</p><p>The criteria in a <code>must_not</code> clause is treated as a <em>filter</em>. It affects whether or not the document is included in the results, but does not contribute to how documents are scored. You can also explicitly specify arbitrary filters to include or exclude documents based on structured data.</p><p><code>“must_not”子句中的条件被视为“过滤器”。</code> 它影响文档是否包含在结果中， 但 <code>不影响文档的评分方式</code>。 还可以显式地指定任意过滤器来包含或排除基于结构化数据的文档。</p><p><strong>filter在使用过程中，并不会计算相关性得分_score：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: {
        &quot;range&quot;: {
          &quot;balance&quot;: {
            &quot;gte&quot;: &quot;10000&quot;,
            &quot;lte&quot;: &quot;20000&quot;
          }
        }
      }
    }
  }
}
//gte:&gt;=  lte:&lt;=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 213,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 0.0,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;20&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 20,
          &quot;balance&quot; : 16418,
          &quot;firstname&quot; : &quot;Elinor&quot;,
          &quot;lastname&quot; : &quot;Ratliff&quot;,
          &quot;age&quot; : 36,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;282 Kings Place&quot;,
          &quot;employer&quot; : &quot;Scentric&quot;,
          &quot;email&quot; : &quot;elinorratliff@scentric.com&quot;,
          &quot;city&quot; : &quot;Ribera&quot;,
          &quot;state&quot; : &quot;WA&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;37&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 37,
          &quot;balance&quot; : 18612,
          &quot;firstname&quot; : &quot;Mcgee&quot;,
          &quot;lastname&quot; : &quot;Mooney&quot;,
          &quot;age&quot; : 39,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;826 Fillmore Place&quot;,
          &quot;employer&quot; : &quot;Reversus&quot;,
          &quot;email&quot; : &quot;mcgeemooney@reversus.com&quot;,
          &quot;city&quot; : &quot;Tooleville&quot;,
          &quot;state&quot; : &quot;OK&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;51&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 51,
          &quot;balance&quot; : 14097,
          &quot;firstname&quot; : &quot;Burton&quot;,
          &quot;lastname&quot; : &quot;Meyers&quot;,
          &quot;age&quot; : 31,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;334 River Street&quot;,
          &quot;employer&quot; : &quot;Bezal&quot;,
          &quot;email&quot; : &quot;burtonmeyers@bezal.com&quot;,
          &quot;city&quot; : &quot;Jacksonburg&quot;,
          &quot;state&quot; : &quot;MO&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;56&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 56,
          &quot;balance&quot; : 14992,
          &quot;firstname&quot; : &quot;Josie&quot;,
          &quot;lastname&quot; : &quot;Nelson&quot;,
          &quot;age&quot; : 32,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;857 Tabor Court&quot;,
          &quot;employer&quot; : &quot;Emtrac&quot;,
          &quot;email&quot; : &quot;josienelson@emtrac.com&quot;,
          &quot;city&quot; : &quot;Sunnyside&quot;,
          &quot;state&quot; : &quot;UT&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;121&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 121,
          &quot;balance&quot; : 19594,
          &quot;firstname&quot; : &quot;Acevedo&quot;,
          &quot;lastname&quot; : &quot;Dorsey&quot;,
          &quot;age&quot; : 32,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;479 Nova Court&quot;,
          &quot;employer&quot; : &quot;Netropic&quot;,
          &quot;email&quot; : &quot;acevedodorsey@netropic.com&quot;,
          &quot;city&quot; : &quot;Islandia&quot;,
          &quot;state&quot; : &quot;CT&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;176&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 176,
          &quot;balance&quot; : 18607,
          &quot;firstname&quot; : &quot;Kemp&quot;,
          &quot;lastname&quot; : &quot;Walters&quot;,
          &quot;age&quot; : 28,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;906 Howard Avenue&quot;,
          &quot;employer&quot; : &quot;Eyewax&quot;,
          &quot;email&quot; : &quot;kempwalters@eyewax.com&quot;,
          &quot;city&quot; : &quot;Why&quot;,
          &quot;state&quot; : &quot;KY&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;183&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 183,
          &quot;balance&quot; : 14223,
          &quot;firstname&quot; : &quot;Hudson&quot;,
          &quot;lastname&quot; : &quot;English&quot;,
          &quot;age&quot; : 26,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;823 Herkimer Place&quot;,
          &quot;employer&quot; : &quot;Xinware&quot;,
          &quot;email&quot; : &quot;hudsonenglish@xinware.com&quot;,
          &quot;city&quot; : &quot;Robbins&quot;,
          &quot;state&quot; : &quot;ND&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;222&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 222,
          &quot;balance&quot; : 14764,
          &quot;firstname&quot; : &quot;Rachelle&quot;,
          &quot;lastname&quot; : &quot;Rice&quot;,
          &quot;age&quot; : 36,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;333 Narrows Avenue&quot;,
          &quot;employer&quot; : &quot;Enaut&quot;,
          &quot;email&quot; : &quot;rachellerice@enaut.com&quot;,
          &quot;city&quot; : &quot;Wright&quot;,
          &quot;state&quot; : &quot;AZ&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;227&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 227,
          &quot;balance&quot; : 19780,
          &quot;firstname&quot; : &quot;Coleman&quot;,
          &quot;lastname&quot; : &quot;Berg&quot;,
          &quot;age&quot; : 22,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;776 Little Street&quot;,
          &quot;employer&quot; : &quot;Exoteric&quot;,
          &quot;email&quot; : &quot;colemanberg@exoteric.com&quot;,
          &quot;city&quot; : &quot;Eagleville&quot;,
          &quot;state&quot; : &quot;WV&quot;
        }
      },
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,
        &quot;_id&quot; : &quot;272&quot;,
        &quot;_score&quot; : 0.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 272,
          &quot;balance&quot; : 19253,
          &quot;firstname&quot; : &quot;Lilly&quot;,
          &quot;lastname&quot; : &quot;Morgan&quot;,
          &quot;age&quot; : 25,
          &quot;gender&quot; : &quot;F&quot;,
          &quot;address&quot; : &quot;689 Fleet Street&quot;,
          &quot;employer&quot; : &quot;Biolive&quot;,
          &quot;email&quot; : &quot;lillymorgan@biolive.com&quot;,
          &quot;city&quot; : &quot;Sunbury&quot;,
          &quot;state&quot; : &quot;OH&quot;
        }
      }
    ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>能看到所有文档的 &quot;_score&quot; : 0.0。</strong></p><h5 id="_8-term" tabindex="-1"><a class="header-anchor" href="#_8-term" aria-hidden="true">#</a> （8）term</h5><p>和match一样。匹配某个属性的值。全文检索字段用match，其他<strong>非text字段</strong>匹配用term。</p><blockquote><p>Avoid using the <code>term</code> query for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/text.html" target="_blank" rel="noopener noreferrer"><code>text</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> fields.</p><p>避免对文本字段使用“term”查询</p><p>By default, Elasticsearch changes the values of <code>text</code> fields as part of <a href="">analysis</a>. This can make finding exact matches for <code>text</code> field values difficult.</p><p>默认情况下，Elasticsearch作为<a href="">analysis</a>的一部分更改&#39; text &#39;字段的值。这使得为“text”字段值寻找精确匹配变得困难。</p><p>To search <code>text</code> field values, use the match.</p><p>要搜索“text”字段值，请使用匹配。</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/query-dsl-term-query.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>使用term匹配查询</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;age&quot;: &quot;28&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是text则查不到：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;gender&quot; : &quot;F&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 0,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [ ]
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一条也没有匹配到</p><p>而更换为match匹配时，能够匹配到32个文档</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502120921830.png" alt="image-20200502120921830"></p><p>也就是说，<strong>全文检索字段用match，其他非text字段匹配用term</strong>。</p><h5 id="_9-aggregation-执行聚合" tabindex="-1"><a class="header-anchor" href="#_9-aggregation-执行聚合" aria-hidden="true">#</a> （9）Aggregation（执行聚合）</h5><p>聚合提供了从数据中分组和提取数据的能力。最简单的聚合方法大致等于SQL Group by和SQL聚合函数。在elasticsearch中，执行搜索返回this（命中结果），并且同时返回聚合结果，把以响应中的所有hits（命中结果）分隔开的能力。这是非常强大且有效的，你可以执行查询和多个聚合，并且在一次使用中得到各自的（任何一个的）返回结果，使用一次简洁和简化的API啦避免网络往返。</p><p>&quot;size&quot;:0</p><p>size:0不显示搜索数据 aggs：执行聚合。聚合语法如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;aggs&quot;:{
    &quot;aggs_name这次聚合的名字，方便展示在结果集中&quot;:{
        &quot;AGG_TYPE聚合的类型(avg,term,terms)&quot;:{}
     }
}，
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>搜索address中包含mill的所有人的年龄分布以及平均年龄，但不显示这些人的详情</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address&quot;: &quot;Mill&quot;
    }
  },
  &quot;aggs&quot;: {
    &quot;ageAgg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 10
      }
    },
    &quot;ageAvg&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;age&quot;
      }
    },
    &quot;balanceAvg&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;balance&quot;
      }
    }
  },
  &quot;size&quot;: 0
}
//ageAgg:聚合名字  terms：聚合类型  &quot;field&quot;: &quot;age&quot;:按照age字段聚合  size:10：取出前十种age
//avg：平均值聚合类型
//不显示这些人的详情，只看聚合结果
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 2,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 4,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [ ]
  },
  &quot;aggregations&quot; : {
    &quot;ageAgg&quot; : {
      &quot;doc_count_error_upper_bound&quot; : 0,
      &quot;sum_other_doc_count&quot; : 0,
      &quot;buckets&quot; : [
        {
          &quot;key&quot; : 38,
          &quot;doc_count&quot; : 2
        },
        {
          &quot;key&quot; : 28,
          &quot;doc_count&quot; : 1
        },
        {
          &quot;key&quot; : 32,
          &quot;doc_count&quot; : 1
        }
      ]
    },
    &quot;ageAvg&quot; : {
      &quot;value&quot; : 34.0
    },
    &quot;balanceAvg&quot; : {
      &quot;value&quot; : 25208.0
    }
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复杂： 按照年龄聚合，并且求这些年龄段的这些人的平均薪资</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;aggs&quot;: {
    &quot;ageAgg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 100
      },
      &quot;aggs&quot;: {
        &quot;ageAvg&quot;: {
          &quot;avg&quot;: {
            &quot;field&quot;: &quot;balance&quot;
          }
        }
      }
    }
  },
  &quot;size&quot;: 0
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 49,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1000,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [ ]
  },
  &quot;aggregations&quot; : {
    &quot;ageAgg&quot; : {
      &quot;doc_count_error_upper_bound&quot; : 0,
      &quot;sum_other_doc_count&quot; : 0,
      &quot;buckets&quot; : [
        {
          &quot;key&quot; : 31,
          &quot;doc_count&quot; : 61,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 28312.918032786885
          }
        },
        {
          &quot;key&quot; : 39,
          &quot;doc_count&quot; : 60,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 25269.583333333332
          }
        },
        {
          &quot;key&quot; : 26,
          &quot;doc_count&quot; : 59,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 23194.813559322032
          }
        },
        {
          &quot;key&quot; : 32,
          &quot;doc_count&quot; : 52,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 23951.346153846152
          }
        },
        {
          &quot;key&quot; : 35,
          &quot;doc_count&quot; : 52,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 22136.69230769231
          }
        },
        {
          &quot;key&quot; : 36,
          &quot;doc_count&quot; : 52,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 22174.71153846154
          }
        },
        {
          &quot;key&quot; : 22,
          &quot;doc_count&quot; : 51,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 24731.07843137255
          }
        },
        {
          &quot;key&quot; : 28,
          &quot;doc_count&quot; : 51,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 28273.882352941175
          }
        },
        {
          &quot;key&quot; : 33,
          &quot;doc_count&quot; : 50,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 25093.94
          }
        },
        {
          &quot;key&quot; : 34,
          &quot;doc_count&quot; : 49,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 26809.95918367347
          }
        },
        {
          &quot;key&quot; : 30,
          &quot;doc_count&quot; : 47,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 22841.106382978724
          }
        },
        {
          &quot;key&quot; : 21,
          &quot;doc_count&quot; : 46,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 26981.434782608696
          }
        },
        {
          &quot;key&quot; : 40,
          &quot;doc_count&quot; : 45,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 27183.17777777778
          }
        },
        {
          &quot;key&quot; : 20,
          &quot;doc_count&quot; : 44,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 27741.227272727272
          }
        },
        {
          &quot;key&quot; : 23,
          &quot;doc_count&quot; : 42,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 27314.214285714286
          }
        },
        {
          &quot;key&quot; : 24,
          &quot;doc_count&quot; : 42,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 28519.04761904762
          }
        },
        {
          &quot;key&quot; : 25,
          &quot;doc_count&quot; : 42,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 27445.214285714286
          }
        },
        {
          &quot;key&quot; : 37,
          &quot;doc_count&quot; : 42,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 27022.261904761905
          }
        },
        {
          &quot;key&quot; : 27,
          &quot;doc_count&quot; : 39,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 21471.871794871793
          }
        },
        {
          &quot;key&quot; : 38,
          &quot;doc_count&quot; : 39,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 26187.17948717949
          }
        },
        {
          &quot;key&quot; : 29,
          &quot;doc_count&quot; : 35,
          &quot;ageAvg&quot; : {
            &quot;value&quot; : 29483.14285714286
          }
        }
      ]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查出所有年龄分布，并且这些年龄段中M的平均薪资和F的平均薪资以及这个年龄段的总体平均薪资</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;aggs&quot;: {
    &quot;ageAgg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 100
      },
      &quot;aggs&quot;: {
        &quot;genderAgg&quot;: {
          &quot;terms&quot;: {
            &quot;field&quot;: &quot;gender.keyword&quot;
          },
          &quot;aggs&quot;: {
            &quot;balanceAvg&quot;: {
              &quot;avg&quot;: {
                &quot;field&quot;: &quot;balance&quot;
              }
            }
          }
        },
        &quot;ageBalanceAvg&quot;: {
          &quot;avg&quot;: {
            &quot;field&quot;: &quot;balance&quot;
          }
        }
      }
    }
  },
  &quot;size&quot;: 0
}
//&quot;field&quot;: &quot;gender.keyword&quot; gender是txt没法聚合 必须加.keyword精确替代
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 119,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1000,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : null,
    &quot;hits&quot; : [ ]
  },
  &quot;aggregations&quot; : {
    &quot;ageAgg&quot; : {
      &quot;doc_count_error_upper_bound&quot; : 0,
      &quot;sum_other_doc_count&quot; : 0,
      &quot;buckets&quot; : [
        {
          &quot;key&quot; : 31,
          &quot;doc_count&quot; : 61,
          &quot;genderAgg&quot; : {
            &quot;doc_count_error_upper_bound&quot; : 0,
            &quot;sum_other_doc_count&quot; : 0,
            &quot;buckets&quot; : [
              {
                &quot;key&quot; : &quot;M&quot;,
                &quot;doc_count&quot; : 35,
                &quot;balanceAvg&quot; : {
                  &quot;value&quot; : 29565.628571428573
                }
              },
              {
                &quot;key&quot; : &quot;F&quot;,
                &quot;doc_count&quot; : 26,
                &quot;balanceAvg&quot; : {
                  &quot;value&quot; : 26626.576923076922
                }
              }
            ]
          },
          &quot;ageBalanceAvg&quot; : {
            &quot;value&quot; : 28312.918032786885
          }
        }
      ]
        .......//省略其他
    }
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-mapping" tabindex="-1"><a class="header-anchor" href="#_3-mapping" aria-hidden="true">#</a> 3）Mapping</h4><h5 id="_1-字段类型" tabindex="-1"><a class="header-anchor" href="#_1-字段类型" aria-hidden="true">#</a> （1）字段类型</h5><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502161339291.png" alt="image-20200502161339291"></p><h5 id="_2-映射" tabindex="-1"><a class="header-anchor" href="#_2-映射" aria-hidden="true">#</a> （2）映射</h5><p>Mapping(映射) Maping是用来定义一个文档（document），以及它所包含的属性（field）是如何存储和索引的。比如：使用maping来定义：</p><ul><li><p>哪些字符串属性应该被看做全文本属性（full text fields）；</p></li><li><p>哪些属性包含数字，日期或地理位置；</p></li><li><p>文档中的所有属性是否都嫩被索引（all 配置）；</p></li><li><p>日期的格式；</p></li><li><p>自定义映射规则来执行动态添加属性；</p></li><li><p>查看mapping信息 GET bank/_mapping</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;bank&quot; : {
    &quot;mappings&quot; : {
      &quot;properties&quot; : {
        &quot;account_number&quot; : {
          &quot;type&quot; : &quot;long&quot;
        },
        &quot;address&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;age&quot; : {
          &quot;type&quot; : &quot;long&quot;
        },
        &quot;balance&quot; : {
          &quot;type&quot; : &quot;long&quot;
        },
        &quot;city&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;email&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;employer&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;firstname&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;gender&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;lastname&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        },
        &quot;state&quot; : {
          &quot;type&quot; : &quot;text&quot;,
          &quot;fields&quot; : {
            &quot;keyword&quot; : {
              &quot;type&quot; : &quot;keyword&quot;,
              &quot;ignore_above&quot; : 256
            }
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改mapping信息</p></li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502170924399.png" alt="image-20200502170924399"></p><h5 id="_3-新版本改变" tabindex="-1"><a class="header-anchor" href="#_3-新版本改变" aria-hidden="true">#</a> （3）新版本改变</h5><p>ElasticSearch7-去掉type概念</p><ol><li><p>关系型数据库中两个数据表示是独立的，即使他们里面有相同名称的列也不影响使用，但ES中不是这样的。elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。</p><ul><li>两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。</li><li>去掉type就是为了提高ES处理数据的效率。</li></ul></li><li><p>Elasticsearch 7.x URL中的type参数为可选。比如，索引一个文档不再要求提供文档类型。</p></li><li><p>Elasticsearch 8.x 不再支持URL中的type参数。</p></li><li><p>解决： 将索引从多类型迁移到单类型，每种类型文档一个独立索引</p><p>将已存在的索引下的类型数据，全部迁移到指定位置即可。详见数据迁移</p></li></ol><blockquote><p><strong>Elasticsearch 7.x</strong></p><ul><li>Specifying types in requests is deprecated. For instance, indexing a document no longer requires a document <code>type</code>. The new index APIs are <code>PUT {index}/_doc/{id}</code> in case of explicit ids and <code>POST {index}/_doc</code> for auto-generated ids. Note that in 7.0, <code>_doc</code> is a permanent part of the path, and represents the endpoint name rather than the document type.</li><li>The <code>include_type_name</code> parameter in the index creation, index template, and mapping APIs will default to <code>false</code>. Setting the parameter at all will result in a deprecation warning.</li><li>The <code>_default_</code> mapping type is removed.</li></ul><p><strong>Elasticsearch 8.x</strong></p><ul><li>Specifying types in requests is no longer supported.</li><li>The <code>include_type_name</code> parameter is removed.</li></ul></blockquote><h6 id="创建映射" tabindex="-1"><a class="header-anchor" href="#创建映射" aria-hidden="true">#</a> 创建映射</h6><p>创建索引并指定属性的映射规则（<strong>相当于新建表并制定字段和字段类型</strong>）</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /my_index
{
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;age&quot;: {
        &quot;type&quot;: &quot;integer&quot;
      },
      &quot;email&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;name&quot;: {
        &quot;type&quot;: &quot;text&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;acknowledged&quot; : true,
  &quot;shards_acknowledged&quot; : true,
  &quot;index&quot; : &quot;my_index&quot;
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="查看映射" tabindex="-1"><a class="header-anchor" href="#查看映射" aria-hidden="true">#</a> 查看映射</h6><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /my_index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//&quot;index&quot; : false 是否被索引即能被检索到，默认是true
{
  &quot;my_index&quot; : {
    &quot;aliases&quot; : { },
    &quot;mappings&quot; : {
      &quot;properties&quot; : {
        &quot;age&quot; : {
          &quot;type&quot; : &quot;integer&quot;
        },
        &quot;email&quot; : {
          &quot;type&quot; : &quot;keyword&quot;
        },
        &quot;employee-id&quot; : {
          &quot;type&quot; : &quot;keyword&quot;,
          &quot;index&quot; : false
        },
        &quot;name&quot; : {
          &quot;type&quot; : &quot;text&quot;
        }
      }
    },
    &quot;settings&quot; : {
      &quot;index&quot; : {
        &quot;creation_date&quot; : &quot;1588410780774&quot;,
        &quot;number_of_shards&quot; : &quot;1&quot;,
        &quot;number_of_replicas&quot; : &quot;1&quot;,
        &quot;uuid&quot; : &quot;ua0lXhtkQCOmn7Kh3iUu0w&quot;,
        &quot;version&quot; : {
          &quot;created&quot; : &quot;7060299&quot;
        },
        &quot;provided_name&quot; : &quot;my_index&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="添加新的字段映射" tabindex="-1"><a class="header-anchor" href="#添加新的字段映射" aria-hidden="true">#</a> 添加新的字段映射</h6><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /my_index/_mapping
{
  &quot;properties&quot;: {
    &quot;employee-id&quot;: {
      &quot;type&quot;: &quot;keyword&quot;,
      &quot;index&quot;: false
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 &quot;index&quot;: false，表明新增的字段不能被检索，只是一个冗余字段。</p><h6 id="更新映射" tabindex="-1"><a class="header-anchor" href="#更新映射" aria-hidden="true">#</a> 更新映射</h6><p>对于已经存在的字段映射，我们不能更新。更新必须创建新的索引，进行数据迁移。</p><h6 id="数据迁移" tabindex="-1"><a class="header-anchor" href="#数据迁移" aria-hidden="true">#</a> 数据迁移</h6><p>先创建new_twitter的正确映射。然后使用如下方式进行数据迁移。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST reindex [固定写法]
{
  &quot;source&quot;:{
      &quot;index&quot;:&quot;twitter&quot;
   },
  &quot;dest&quot;:{
      &quot;index&quot;:&quot;new_twitters&quot;
   }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将旧索引的type下的数据进行迁移</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST reindex [固定写法]
{
  &quot;source&quot;:{
      &quot;index&quot;:&quot;twitter&quot;,
      &quot;twitter&quot;:&quot;twitter&quot;
   },
  &quot;dest&quot;:{
      &quot;index&quot;:&quot;new_twitters&quot;
   }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更多详情见： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>GET /bank/_search</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  },
  &quot;hits&quot; : {
    &quot;total&quot; : {
      &quot;value&quot; : 1000,
      &quot;relation&quot; : &quot;eq&quot;
    },
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      {
        &quot;_index&quot; : &quot;bank&quot;,
        &quot;_type&quot; : &quot;account&quot;,//类型为account
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : {
          &quot;account_number&quot; : 1,
          &quot;balance&quot; : 39225,
          &quot;firstname&quot; : &quot;Amber&quot;,
          &quot;lastname&quot; : &quot;Duke&quot;,
          &quot;age&quot; : 32,
          &quot;gender&quot; : &quot;M&quot;,
          &quot;address&quot; : &quot;880 Holmes Lane&quot;,
          &quot;employer&quot; : &quot;Pyrami&quot;,
          &quot;email&quot; : &quot;amberduke@pyrami.com&quot;,
          &quot;city&quot; : &quot;Brogan&quot;,
          &quot;state&quot; : &quot;IL&quot;
        }
      },
      ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /bank/_search
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502174825233.png" alt="image-20200502174825233"></p><p>想要将年龄修改为integer</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /newbank
{
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;account_number&quot;: {
        &quot;type&quot;: &quot;long&quot;
      },
      &quot;address&quot;: {
        &quot;type&quot;: &quot;text&quot;
      },
      &quot;age&quot;: {
        &quot;type&quot;: &quot;integer&quot;
      },
      &quot;balance&quot;: {
        &quot;type&quot;: &quot;long&quot;
      },
      &quot;city&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;email&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;employer&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;firstname&quot;: {
        &quot;type&quot;: &quot;text&quot;
      },
      &quot;gender&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;lastname&quot;: {
        &quot;type&quot;: &quot;text&quot;,
        &quot;fields&quot;: {
          &quot;keyword&quot;: {
            &quot;type&quot;: &quot;keyword&quot;,
            &quot;ignore_above&quot;: 256
          }
        }
      },
      &quot;state&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看“newbank”的映射：</p><p>GET /newbank/_mapping</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502175901959.png" alt="image-20200502175901959"></p><p>能够看到age的映射类型被修改为了integer.</p><p>将bank中的数据迁移到newbank中</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST _reindex
{
  &quot;source&quot;: {
    &quot;index&quot;: &quot;bank&quot;,
    &quot;type&quot;: &quot;account&quot;
  },
  &quot;dest&quot;: {
    &quot;index&quot;: &quot;newbank&quot;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#! Deprecation: [types removal] Specifying types in reindex requests is deprecated.
{
  &quot;took&quot; : 768,
  &quot;timed_out&quot; : false,
  &quot;total&quot; : 1000,
  &quot;updated&quot; : 0,
  &quot;created&quot; : 1000,
  &quot;deleted&quot; : 0,
  &quot;batches&quot; : 1,
  &quot;version_conflicts&quot; : 0,
  &quot;noops&quot; : 0,
  &quot;retries&quot; : {
    &quot;bulk&quot; : 0,
    &quot;search&quot; : 0
  },
  &quot;throttled_millis&quot; : 0,
  &quot;requests_per_second&quot; : -1.0,
  &quot;throttled_until_millis&quot; : 0,
  &quot;failures&quot; : [ ]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看newbank中的数据</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502181432745.png" alt="image-20200502181432745"></p><h4 id="_4-分词" tabindex="-1"><a class="header-anchor" href="#_4-分词" aria-hidden="true">#</a> 4）分词</h4><p>一个tokenizer（分词器）接收一个字符流，将之分割为独立的tokens（词元，通常是独立的单词），然后输出tokens流。</p><p>例如：whitespace tokenizer遇到空白字符时分割文本。它会将文本“Quick brown fox!”分割为[Quick,brown,fox!]。</p><p>该tokenizer（分词器）还负责记录各个terms(词条)的顺序或position位置（用于phrase短语和word proximity词近邻查询），以及term（词条）所代表的原始word（单词）的start（起始）和end（结束）的character offsets（字符串偏移量）（用于高亮显示搜索的内容）。</p><p>elasticsearch提供了很多内置的分词器，可以用来构建custom analyzers（自定义分词器）。</p><p>关于分词器： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/analysis.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/analysis.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST _analyze
{
  &quot;analyzer&quot;: &quot;standard&quot;,
  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;the&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 3,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 0
    },
    {
      &quot;token&quot; : &quot;2&quot;,
      &quot;start_offset&quot; : 4,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;&lt;NUM&gt;&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;quick&quot;,
      &quot;start_offset&quot; : 6,
      &quot;end_offset&quot; : 11,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 2
    },
    {
      &quot;token&quot; : &quot;brown&quot;,
      &quot;start_offset&quot; : 12,
      &quot;end_offset&quot; : 17,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 3
    },
    {
      &quot;token&quot; : &quot;foxes&quot;,
      &quot;start_offset&quot; : 18,
      &quot;end_offset&quot; : 23,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 4
    },
    {
      &quot;token&quot; : &quot;jumped&quot;,
      &quot;start_offset&quot; : 24,
      &quot;end_offset&quot; : 30,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 5
    },
    {
      &quot;token&quot; : &quot;over&quot;,
      &quot;start_offset&quot; : 31,
      &quot;end_offset&quot; : 35,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 6
    },
    {
      &quot;token&quot; : &quot;the&quot;,
      &quot;start_offset&quot; : 36,
      &quot;end_offset&quot; : 39,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 7
    },
    {
      &quot;token&quot; : &quot;lazy&quot;,
      &quot;start_offset&quot; : 40,
      &quot;end_offset&quot; : 44,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 8
    },
    {
      &quot;token&quot; : &quot;dog&#39;s&quot;,
      &quot;start_offset&quot; : 45,
      &quot;end_offset&quot; : 50,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 9
    },
    {
      &quot;token&quot; : &quot;bone&quot;,
      &quot;start_offset&quot; : 51,
      &quot;end_offset&quot; : 55,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 10
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-安装ik分词器" tabindex="-1"><a class="header-anchor" href="#_1-安装ik分词器" aria-hidden="true">#</a> （1）安装ik分词器</h5><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200502182929583.png" alt="image-20200502182929583"></p><p>所有的语言分词，默认使用的都是“Standard Analyzer”，但是这些分词器针对于中文的分词，并不友好。为此需要安装中文的分词器。</p><p>注意：不能用默认elasticsearch-plugin install xxx.zip 进行自动安装 <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download" target="_blank" rel="noopener noreferrer">https://github.com/medcl/elasticsearch-analysis-ik/releases/download<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 对应es版本安装</p><p>在前面安装的elasticsearch时，我们已经将elasticsearch容器的“/usr/share/elasticsearch/plugins”目录，映射到宿主机的“ /mydata/elasticsearch/plugins”目录下，所以比较方便的做法就是下载“/elasticsearch-analysis-ik-7.6.2.zip”文件，然后解压到该文件夹下即可。安装完毕后，需要重启elasticsearch容器。</p><p>如果不嫌麻烦，还可以采用如下的方式。</p><h6 id="_1-查看elasticsearch版本号" tabindex="-1"><a class="header-anchor" href="#_1-查看elasticsearch版本号" aria-hidden="true">#</a> （1）查看elasticsearch版本号：</h6><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># curl http://localhost:9200</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;0adeb7852e00&quot;</span>,
  <span class="token string">&quot;cluster_name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;elasticsearch&quot;</span>,
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;9gglpP0HTfyOTRAaSe2rIg&quot;</span>,
  <span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;number&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;7.6.2&quot;</span>,      <span class="token comment">#版本号为7.6.2</span>
    <span class="token string">&quot;build_flavor&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
    <span class="token string">&quot;build_type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;docker&quot;</span>,
    <span class="token string">&quot;build_hash&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;</span>,
    <span class="token string">&quot;build_date&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2020-03-26T06:34:37.794943Z&quot;</span>,
    <span class="token string">&quot;build_snapshot&quot;</span> <span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;lucene_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;8.4.0&quot;</span>,
    <span class="token string">&quot;minimum_wire_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.8.0&quot;</span>,
    <span class="token string">&quot;minimum_index_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.0.0-beta1&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;tagline&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-进入es容器内部plugin目录" tabindex="-1"><a class="header-anchor" href="#_2-进入es容器内部plugin目录" aria-hidden="true">#</a> （2）进入es容器内部plugin目录</h6><ul><li>docker exec -it 容器id /bin/bash</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it elasticsearch /bin/bash</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>wget <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip" target="_blank" rel="noopener noreferrer">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/usr/share/elasticsearch
<span class="token comment">#下载ik7.6.2</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>unzip 下载的文件</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># unzip elasticsearch-analysis-ik-7.6.2.zip -d ink</span>
Archive:  elasticsearch-analysis-ik-7.6.2.zip
   creating: ik/config/
  inflating: ik/config/main.dic      
  inflating: ik/config/quantifier.dic  
  inflating: ik/config/extra_single_word_full.dic  
  inflating: ik/config/IKAnalyzer.cfg.xml  
  inflating: ik/config/surname.dic   
  inflating: ik/config/suffix.dic    
  inflating: ik/config/stopword.dic  
  inflating: ik/config/extra_main.dic  
  inflating: ik/config/extra_stopword.dic  
  inflating: ik/config/preposition.dic  
  inflating: ik/config/extra_single_word_low_freq.dic  
  inflating: ik/config/extra_single_word.dic  
  inflating: ik/elasticsearch-analysis-ik-7.6.2.jar  
  inflating: ik/httpclient-4.5.2.jar  
  inflating: ik/httpcore-4.4.4.jar   
  inflating: ik/commons-logging-1.2.jar  
  inflating: ik/commons-codec-1.9.jar  
  inflating: ik/plugin-descriptor.properties  
  inflating: ik/plugin-security.policy  
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#移动到plugins目录下</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># mv ik plugins/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>rm -rf *.zip</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@0adeb7852e00 elasticsearch]# rm -rf elasticsearch-analysis-ik-7.6.2.zip 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>确认是否安装好了分词器</p><h5 id="_2-测试分词器" tabindex="-1"><a class="header-anchor" href="#_2-测试分词器" aria-hidden="true">#</a> （2）测试分词器</h5><p>使用默认</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET my_index/_analyze
{
   &quot;text&quot;:&quot;我是中国人&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请观察执行结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;我&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 1,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 0
    },
    {
      &quot;token&quot; : &quot;是&quot;,
      &quot;start_offset&quot; : 1,
      &quot;end_offset&quot; : 2,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;中&quot;,
      &quot;start_offset&quot; : 2,
      &quot;end_offset&quot; : 3,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 2
    },
    {
      &quot;token&quot; : &quot;国&quot;,
      &quot;start_offset&quot; : 3,
      &quot;end_offset&quot; : 4,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 3
    },
    {
      &quot;token&quot; : &quot;人&quot;,
      &quot;start_offset&quot; : 4,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 4
    }
  ]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET my_index/_analyze
{
   &quot;analyzer&quot;: &quot;ik_smart&quot;, 
   &quot;text&quot;:&quot;我是中国人&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;我&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 1,
      &quot;type&quot; : &quot;CN_CHAR&quot;,
      &quot;position&quot; : 0
    },
    {
      &quot;token&quot; : &quot;是&quot;,
      &quot;start_offset&quot; : 1,
      &quot;end_offset&quot; : 2,
      &quot;type&quot; : &quot;CN_CHAR&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;中国人&quot;,
      &quot;start_offset&quot; : 2,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 2
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET my_index/_analyze
{
   &quot;analyzer&quot;: &quot;ik_max_word&quot;, 
   &quot;text&quot;:&quot;我是中国人&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;我&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 1,
      &quot;type&quot; : &quot;CN_CHAR&quot;,
      &quot;position&quot; : 0
    },
    {
      &quot;token&quot; : &quot;是&quot;,
      &quot;start_offset&quot; : 1,
      &quot;end_offset&quot; : 2,
      &quot;type&quot; : &quot;CN_CHAR&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;中国人&quot;,
      &quot;start_offset&quot; : 2,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 2
    },
    {
      &quot;token&quot; : &quot;中国&quot;,
      &quot;start_offset&quot; : 2,
      &quot;end_offset&quot; : 4,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 3
    },
    {
      &quot;token&quot; : &quot;国人&quot;,
      &quot;start_offset&quot; : 3,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 4
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-自定义词库" tabindex="-1"><a class="header-anchor" href="#_3-自定义词库" aria-hidden="true">#</a> （3）自定义词库</h5><ul><li>修改/usr/share/elasticsearch/plugins/ik/config中的IKAnalyzer.cfg.xml /usr/share/elasticsearch/plugins/ik/config</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">&gt;</span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
	 <span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_stopwords<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remote_ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>http://192.168.13.100/es/fenci.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span> 
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span>
	<span class="token comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原来的xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">&gt;</span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
	 <span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_stopwords<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span>
	<span class="token comment">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span>
	<span class="token comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改完成后，需要重启elasticsearch容器，否则修改不生效。</p><p>更新完成后，es只会对于新增的数据用更新分词。历史数据是不会重新分词的。如果想要历史数据重新分词，需要执行：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>POST my_index/_update_by_query?conflicts<span class="token operator">=</span>proceed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a href="http://192.168.13.101/es/fenci.txt%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%98%AFnginx%E4%B8%8A%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84" target="_blank" rel="noopener noreferrer">http://192.168.13.101/es/fenci.txt，这个是nginx上资源的访问路径<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>在运行下面实例之前，需要安装nginx（安装方法见安装nginx），然后创建“fenci.txt”文件，内容如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;樱桃萨其马，带你甜蜜入夏&quot;</span> <span class="token operator">&gt;</span> /mydata/nginx/html/fenci.txt 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>测试效果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET my_index/_analyze
{
   &quot;analyzer&quot;: &quot;ik_max_word&quot;, 
   &quot;text&quot;:&quot;樱桃萨其马，带你甜蜜入夏&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;樱桃&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 2,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 0
    },
    {
      &quot;token&quot; : &quot;萨其马&quot;,
      &quot;start_offset&quot; : 2,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;带你&quot;,
      &quot;start_offset&quot; : 6,
      &quot;end_offset&quot; : 8,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 2
    },
    {
      &quot;token&quot; : &quot;甜蜜&quot;,
      &quot;start_offset&quot; : 8,
      &quot;end_offset&quot; : 10,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 3
    },
    {
      &quot;token&quot; : &quot;入夏&quot;,
      &quot;start_offset&quot; : 10,
      &quot;end_offset&quot; : 12,
      &quot;type&quot; : &quot;CN_WORD&quot;,
      &quot;position&quot; : 4
    }
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、elasticsearch-rest-client" tabindex="-1"><a class="header-anchor" href="#_4、elasticsearch-rest-client" aria-hidden="true">#</a> 4、elasticsearch-Rest-Client</h3><h4 id="_1-9300-tcp" tabindex="-1"><a class="header-anchor" href="#_1-9300-tcp" aria-hidden="true">#</a> 1）9300: TCP</h4><ul><li>spring-data-elasticsearch:transport-api.jar; <ul><li>springboot版本不同，ransport-api.jar不同，不能适配es版本</li><li>7.x已经不建议使用，8以后就要废弃</li></ul></li></ul><h4 id="_2-9200-http" tabindex="-1"><a class="header-anchor" href="#_2-9200-http" aria-hidden="true">#</a> 2）9200: HTTP</h4><ul><li><p>jestClient: 非官方，更新慢；</p></li><li><p>RestTemplate：模拟HTTP请求，ES很多操作需要自己封装，麻烦；</p></li><li><p>HttpClient：同上；</p></li><li><p>Elasticsearch-Rest-Client：官方RestClient，封装了ES操作，API层次分明，上手简单； 最终选择Elasticsearch-Rest-Client（elasticsearch-rest-high-level-client）； <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h3 id="_5、附录-安装nginx" tabindex="-1"><a class="header-anchor" href="#_5、附录-安装nginx" aria-hidden="true">#</a> 5、附录：安装Nginx</h3><ul><li><p>随便启动一个nginx实例，只是为了复制出配置</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -p <span class="token number">8081</span>:80 --name nginx -d nginx:1.10   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>将容器内的配置文件拷贝到/mydata/nginx/conf/ 下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /mydata/nginx/html
<span class="token function">mkdir</span> -p /mydata/nginx/logs
<span class="token function">mkdir</span> -p /mydata/nginx/conf
<span class="token function">docker</span> container <span class="token function">cp</span> nginx:/etc/nginx <span class="token builtin class-name">.</span>  <span class="token comment">#拷贝到当前文件夹</span>
<span class="token comment">#由于拷贝完成后会在config中存在一个nginx文件夹，所以需要将它的内容移动到conf中</span>
<span class="token function">mv</span> /mydata/nginx/conf/nginx/* /mydata/nginx/conf/
<span class="token function">rm</span> -rf /mydata/nginx/conf/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>终止原容器：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> stop nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>执行命令删除原容器：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建新的Nginx，执行以下命令</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation">\</span>
 -v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\</span>
 -v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation">\</span>
 -v /mydata/nginx/conf/:/etc/nginx <span class="token punctuation">\</span>
 -d nginx:1.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置开机启动nginx</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker update nginx --restart=always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建“/mydata/nginx/html/index.html”文件，测试是否能够正常访问</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &#39;&lt;h2&gt;hello nginx!&lt;/h2&gt;&#39; &gt;/mydata/nginx/html/index.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>访问：<a href="http://xn--ngixIP-6y7ij32djrxcmle44b:80/index.html" target="_blank" rel="noopener noreferrer">http://ngix所在主机的IP:80/index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h2 id="_2-springboot整合elasticsearch" tabindex="-1"><a class="header-anchor" href="#_2-springboot整合elasticsearch" aria-hidden="true">#</a> 2.SpringBoot整合ElasticSearch</h2><blockquote><p>初始化：</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.6/java-rest-high-getting-started-initialization.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.6/java-rest-high-getting-started-initialization.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="_1、导入依赖" tabindex="-1"><a class="header-anchor" href="#_1、导入依赖" aria-hidden="true">#</a> 1、导入依赖</h3><p>这里的版本要和所按照的ELK版本匹配。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在spring-boot-dependencies中所依赖的ELK版本位6.8.7</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>6.8.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200511074437763.png" alt="image-20200511074437763"></p><p>需要在项目中将它改为7.6.2</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>7.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册到注册中心</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>searcch
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">12000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallSearcchApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GulimallSearcchApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写配置类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> hzz
 * <span class="token keyword">@create</span> 2022-07-14 15:18
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallElasticSearchConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">// 所有请求共享的配置</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RequestOptions</span> COMMON_OPTIONS<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestOptions<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">.</span><span class="token function">toBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// builder.addHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + TOKEN);</span>
        <span class="token comment">// builder.setHttpAsyncResponseConsumerFactory(</span>
        <span class="token comment">//         new HttpAsyncResponseConsumerFactory</span>
        <span class="token comment">//                 .HeapBufferedResponseConsumerFactory(30 * 1024 * 1024 * 1024));</span>
        COMMON_OPTIONS <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// es 客户端</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">esRestClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>
                <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.13.100&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、编写测试类" tabindex="-1"><a class="header-anchor" href="#_2、编写测试类" aria-hidden="true">#</a> 2、编写测试类</h3><h4 id="_1-测试保存数据" tabindex="-1"><a class="header-anchor" href="#_1-测试保存数据" aria-hidden="true">#</a> 1）测试保存数据</h4><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-document-index.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-document-index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">GulimallSearcchApplicationTests</span> <span class="token punctuation">{</span>   
      
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">indexData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span> <span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置要保存的内容</span>
        indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行创建索引和保存数据</span>
        <span class="token class-name">IndexResponse</span> index <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticSearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试前：</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200511111618183.png" alt="image-20200511111618183"></p><p>测试后：</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/image-20200511112025327.png" alt="image-20200511112025327"></p><h4 id="_2-测试获取数据" tabindex="-1"><a class="header-anchor" href="#_2-测试获取数据" aria-hidden="true">#</a> 2）测试获取数据</h4><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">GulimallSearcchApplicationTests</span> <span class="token punctuation">{</span>   
      
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">GetRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GetResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticSearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>搜索address中包含mill的所有人的年龄分布以及平均年龄，平均薪资</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address&quot;: &quot;Mill&quot;
    }
  },
  &quot;aggs&quot;: {
    &quot;ageAgg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 10
      }
    },
    &quot;ageAvg&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;age&quot;
      }
    },
    &quot;balanceAvg&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;balance&quot;
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>java实现</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">GulimallSearcchApplicationTests</span> <span class="token punctuation">{</span>
    
     <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

	<span class="token doc-comment comment">/**
     * 复杂检索:在bank中搜索address中包含mill的所有人的年龄分布以及平均年龄，平均薪资
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. 创建检索请求</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1.1）指定索引</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;bank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.2）构造检索条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Mill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1.2.1)按照年龄分布进行聚合</span>
        <span class="token class-name">TermsAggregationBuilder</span> ageAgg<span class="token operator">=</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;ageAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>ageAgg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1.2.2)计算平均年龄</span>
        <span class="token class-name">AvgAggregationBuilder</span> ageAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">&quot;ageAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>ageAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//1.2.3)计算平均薪资</span>
        <span class="token class-name">AvgAggregationBuilder</span> balanceAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">&quot;balanceAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>balanceAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;检索条件：&quot;</span><span class="token operator">+</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//2. 执行检索</span>
        <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;检索结果：&quot;</span><span class="token operator">+</span>searchResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3. 将检索结果封装为Bean</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> searchHit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> searchHit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//4. 获取聚合信息</span>
        <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Terms</span> ageAgg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ageAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> ageAgg1<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;年龄：&quot;</span><span class="token operator">+</span>keyAsString<span class="token operator">+</span><span class="token string">&quot; ==&gt; &quot;</span><span class="token operator">+</span>bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Avg</span> ageAvg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ageAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;平均年龄：&quot;</span><span class="token operator">+</span>ageAvg1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Avg</span> balanceAvg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balanceAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;平均薪资：&quot;</span><span class="token operator">+</span>balanceAvg1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
	<span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@ToString</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> accountNumber<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> balance<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> firstname<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> lastname<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> employer<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以尝试对比打印的条件和执行结果，和前面的ElasticSearch的检索语句和检索结果进行比较；</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/tt110617/edit/main/demo/src/backend/high-performance/ElasticSearch.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/17 10:42:03</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1253728268@qq.com">hzz</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/myblog/backend/high-performance/Docker.html" class="nav-link prev" aria-label="Docker基础篇"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><img class="icon" src="/myblog/icon/docker.png">Docker基础篇</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 十一</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/myblog/assets/app.6a2d513d.js" defer></script>
  </body>
</html>
