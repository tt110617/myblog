<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>SpringCloudAlibaba | tt110617</title><meta name="description" content="ç½‘ç«™">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/myblog/assets/style.f2a6604f.css">
    <link rel="modulepreload" href="/myblog/assets/app.6a2d513d.js"><link rel="modulepreload" href="/myblog/assets/SpringCloudAibaba.html.79284ee6.js"><link rel="modulepreload" href="/myblog/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/myblog/assets/SpringCloudAibaba.html.ba7822c1.js"><link rel="prefetch" href="/myblog/assets/index.html.d1ca62f7.js"><link rel="prefetch" href="/myblog/assets/index.html.b5c38db1.js"><link rel="prefetch" href="/myblog/assets/index.html.feb38b0c.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.dd1af2b2.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.6645e291.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.9da54164.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.95af3c37.js"><link rel="prefetch" href="/myblog/assets/index.html.2770fb04.js"><link rel="prefetch" href="/myblog/assets/index.html.9f31cb98.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.747bd522.js"><link rel="prefetch" href="/myblog/assets/index.html.7970fd4d.js"><link rel="prefetch" href="/myblog/assets/index.html.d76d8eeb.js"><link rel="prefetch" href="/myblog/assets/Docker.html.7e9153cc.js"><link rel="prefetch" href="/myblog/assets/ElasticSearch.html.68bc187d.js"><link rel="prefetch" href="/myblog/assets/nginx.html.feb27b40.js"><link rel="prefetch" href="/myblog/assets/index.html.c88cf0a5.js"><link rel="prefetch" href="/myblog/assets/java8æ–°ç‰¹æ€§.html.eba77086.js"><link rel="prefetch" href="/myblog/assets/index.html.db442bd7.js"><link rel="prefetch" href="/myblog/assets/index.html.e978b3f4.js"><link rel="prefetch" href="/myblog/assets/vue2.html.cd054f5f.js"><link rel="prefetch" href="/myblog/assets/vue3.html.09644e9e.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.14852074.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.19638d4a.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.19940ab5.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.ff20e708.js"><link rel="prefetch" href="/myblog/assets/index.html.aeaeabce.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.5de27bef.js"><link rel="prefetch" href="/myblog/assets/network01.html.d374f53e.js"><link rel="prefetch" href="/myblog/assets/network02.html.612f1790.js"><link rel="prefetch" href="/myblog/assets/network03.html.f409d6e1.js"><link rel="prefetch" href="/myblog/assets/network04.html.417995ce.js"><link rel="prefetch" href="/myblog/assets/network05.html.383f02d3.js"><link rel="prefetch" href="/myblog/assets/network06.html.6b7b74f3.js"><link rel="prefetch" href="/myblog/assets/index.html.a5289baa.js"><link rel="prefetch" href="/myblog/assets/index.html.1ad05321.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.43cb742a.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.ba0a875f.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.c65b1aff.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.8d20d57a.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.66a2065a.js"><link rel="prefetch" href="/myblog/assets/RedissonåŸç†.html.e587d689.js"><link rel="prefetch" href="/myblog/assets/basics.html.ec7af011.js"><link rel="prefetch" href="/myblog/assets/practice.html.3d6fcedb.js"><link rel="prefetch" href="/myblog/assets/index.html.195983d3.js"><link rel="prefetch" href="/myblog/assets/index.html.ffce25e3.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.1539f2df.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.8d492936.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.25f8081d.js"><link rel="prefetch" href="/myblog/assets/index.html.25b97898.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.11fa754a.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.e3fba77d.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.d245b413.js"><link rel="prefetch" href="/myblog/assets/index.html.2e0e8a71.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.ec57b0c6.js"><link rel="prefetch" href="/myblog/assets/index.html.195b9b99.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.f53a3387.js"><link rel="prefetch" href="/myblog/assets/design01.html.a9ca0966.js"><link rel="prefetch" href="/myblog/assets/design02.html.14685d48.js"><link rel="prefetch" href="/myblog/assets/design03.html.d0742e22.js"><link rel="prefetch" href="/myblog/assets/design04.html.4b4d3a60.js"><link rel="prefetch" href="/myblog/assets/design05.html.dd009a09.js"><link rel="prefetch" href="/myblog/assets/index.html.de8a79d7.js"><link rel="prefetch" href="/myblog/assets/juc01.html.7b5b2a61.js"><link rel="prefetch" href="/myblog/assets/juc02.html.e7af61bf.js"><link rel="prefetch" href="/myblog/assets/juc03.html.c680cb04.js"><link rel="prefetch" href="/myblog/assets/index.html.3ef30b14.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.226ff0ab.js"><link rel="prefetch" href="/myblog/assets/jvm02.html.ad530863.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.af77ed0d.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.dd845ccc.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.56d56c94.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.8c5c08ed.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.8713dffe.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.396f92cc.js"><link rel="prefetch" href="/myblog/assets/index.html.cacef81d.js"><link rel="prefetch" href="/myblog/assets/404.html.82bd4b1a.js"><link rel="prefetch" href="/myblog/assets/index.html.2f713335.js"><link rel="prefetch" href="/myblog/assets/index.html.1a811f74.js"><link rel="prefetch" href="/myblog/assets/index.html.79fe6d6e.js"><link rel="prefetch" href="/myblog/assets/index.html.dcd15e89.js"><link rel="prefetch" href="/myblog/assets/index.html.e8952663.js"><link rel="prefetch" href="/myblog/assets/index.html.5ad7ff00.js"><link rel="prefetch" href="/myblog/assets/index.html.92637d35.js"><link rel="prefetch" href="/myblog/assets/index.html.6033e64c.js"><link rel="prefetch" href="/myblog/assets/index.html.29a3be67.js"><link rel="prefetch" href="/myblog/assets/index.html.d2aef326.js"><link rel="prefetch" href="/myblog/assets/index.html.61fd0259.js"><link rel="prefetch" href="/myblog/assets/index.html.cf3e5974.js"><link rel="prefetch" href="/myblog/assets/index.html.b7fddec6.js"><link rel="prefetch" href="/myblog/assets/index.html.2d1c3407.js"><link rel="prefetch" href="/myblog/assets/index.html.f6e57d32.js"><link rel="prefetch" href="/myblog/assets/index.html.57cfa80f.js"><link rel="prefetch" href="/myblog/assets/index.html.5f4c6904.js"><link rel="prefetch" href="/myblog/assets/index.html.adc9fbf5.js"><link rel="prefetch" href="/myblog/assets/index.html.de6bf546.js"><link rel="prefetch" href="/myblog/assets/index.html.5802a134.js"><link rel="prefetch" href="/myblog/assets/index.html.00532d93.js"><link rel="prefetch" href="/myblog/assets/index.html.dcdb8b0c.js"><link rel="prefetch" href="/myblog/assets/index.html.64a2ffc8.js"><link rel="prefetch" href="/myblog/assets/index.html.aa56265b.js"><link rel="prefetch" href="/myblog/assets/index.html.cf5fc743.js"><link rel="prefetch" href="/myblog/assets/index.html.dd0debdd.js"><link rel="prefetch" href="/myblog/assets/index.html.598a85b3.js"><link rel="prefetch" href="/myblog/assets/algorithm01.html.9516ff71.js"><link rel="prefetch" href="/myblog/assets/algorithm02.html.f215eb2a.js"><link rel="prefetch" href="/myblog/assets/algorithm03.html.b981d3d4.js"><link rel="prefetch" href="/myblog/assets/LeetCode Hot 100.html.921fe2c8.js"><link rel="prefetch" href="/myblog/assets/index.html.9ff070dd.js"><link rel="prefetch" href="/myblog/assets/index.html.f985f07c.js"><link rel="prefetch" href="/myblog/assets/MongoDB.html.367811ae.js"><link rel="prefetch" href="/myblog/assets/index.html.ccc78fec.js"><link rel="prefetch" href="/myblog/assets/index.html.cd9c8951.js"><link rel="prefetch" href="/myblog/assets/Docker.html.9aa6750f.js"><link rel="prefetch" href="/myblog/assets/ElasticSearch.html.834de972.js"><link rel="prefetch" href="/myblog/assets/nginx.html.96457f50.js"><link rel="prefetch" href="/myblog/assets/index.html.5f9750b5.js"><link rel="prefetch" href="/myblog/assets/java8æ–°ç‰¹æ€§.html.72523a0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4267a9c7.js"><link rel="prefetch" href="/myblog/assets/index.html.64b7cc16.js"><link rel="prefetch" href="/myblog/assets/vue2.html.019d3a52.js"><link rel="prefetch" href="/myblog/assets/vue3.html.f014c692.js"><link rel="prefetch" href="/myblog/assets/mysql01.html.1f3c1d4e.js"><link rel="prefetch" href="/myblog/assets/mysql02.html.6085f62b.js"><link rel="prefetch" href="/myblog/assets/mysql03.html.a05b3e35.js"><link rel="prefetch" href="/myblog/assets/mysql04.html.f83e6c8a.js"><link rel="prefetch" href="/myblog/assets/index.html.c2377b6c.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.62e502c2.js"><link rel="prefetch" href="/myblog/assets/network01.html.bb391280.js"><link rel="prefetch" href="/myblog/assets/network02.html.4835dc75.js"><link rel="prefetch" href="/myblog/assets/network03.html.529a44ea.js"><link rel="prefetch" href="/myblog/assets/network04.html.c4a9ab39.js"><link rel="prefetch" href="/myblog/assets/network05.html.fefe6411.js"><link rel="prefetch" href="/myblog/assets/network06.html.4098bbbd.js"><link rel="prefetch" href="/myblog/assets/index.html.9a37999d.js"><link rel="prefetch" href="/myblog/assets/index.html.25f73ada.js"><link rel="prefetch" href="/myblog/assets/Redis01.html.4774eebb.js"><link rel="prefetch" href="/myblog/assets/Redis02.html.7aa43754.js"><link rel="prefetch" href="/myblog/assets/Redis03.html.3b35817c.js"><link rel="prefetch" href="/myblog/assets/Redis04.html.1eb9f421.js"><link rel="prefetch" href="/myblog/assets/Redis05.html.445e2fb4.js"><link rel="prefetch" href="/myblog/assets/RedissonåŸç†.html.a6281fb0.js"><link rel="prefetch" href="/myblog/assets/basics.html.64ecf975.js"><link rel="prefetch" href="/myblog/assets/practice.html.9bd91dc4.js"><link rel="prefetch" href="/myblog/assets/index.html.45528417.js"><link rel="prefetch" href="/myblog/assets/index.html.2765f82f.js"><link rel="prefetch" href="/myblog/assets/SpringBoot01.html.5e31fcb7.js"><link rel="prefetch" href="/myblog/assets/SpringBoot02.html.bbddd314.js"><link rel="prefetch" href="/myblog/assets/Dubbo.html.ccbf57f9.js"><link rel="prefetch" href="/myblog/assets/index.html.534d4ae8.js"><link rel="prefetch" href="/myblog/assets/SpringCloud.html.eab22d83.js"><link rel="prefetch" href="/myblog/assets/mianshi.html.da3eb94f.js"><link rel="prefetch" href="/myblog/assets/RabbitMQ.html.1224037c.js"><link rel="prefetch" href="/myblog/assets/index.html.668ad86c.js"><link rel="prefetch" href="/myblog/assets/OAuth2.0.html.aabd01a5.js"><link rel="prefetch" href="/myblog/assets/index.html.9cd27700.js"><link rel="prefetch" href="/myblog/assets/SpringSecurity.html.469ecc81.js"><link rel="prefetch" href="/myblog/assets/design01.html.2b9f9e86.js"><link rel="prefetch" href="/myblog/assets/design02.html.849b42b0.js"><link rel="prefetch" href="/myblog/assets/design03.html.e4be33cd.js"><link rel="prefetch" href="/myblog/assets/design04.html.bc31a0d9.js"><link rel="prefetch" href="/myblog/assets/design05.html.d5c35997.js"><link rel="prefetch" href="/myblog/assets/index.html.4a7a1688.js"><link rel="prefetch" href="/myblog/assets/juc01.html.5bb1f884.js"><link rel="prefetch" href="/myblog/assets/juc02.html.0ce510cd.js"><link rel="prefetch" href="/myblog/assets/juc03.html.e93fe7b6.js"><link rel="prefetch" href="/myblog/assets/index.html.b5425fa1.js"><link rel="prefetch" href="/myblog/assets/jvm01.html.f238e096.js"><link rel="prefetch" href="/myblog/assets/jvm02.html.a9498b0d.js"><link rel="prefetch" href="/myblog/assets/jvm03.html.460f2e71.js"><link rel="prefetch" href="/myblog/assets/jvm04.html.7205bd05.js"><link rel="prefetch" href="/myblog/assets/jvm05.html.edac738a.js"><link rel="prefetch" href="/myblog/assets/jvm06.html.91cbb3f0.js"><link rel="prefetch" href="/myblog/assets/jvm07.html.f40c12f1.js"><link rel="prefetch" href="/myblog/assets/jvm08.html.fb107a67.js"><link rel="prefetch" href="/myblog/assets/index.html.3ba3011a.js"><link rel="prefetch" href="/myblog/assets/404.html.1f196261.js"><link rel="prefetch" href="/myblog/assets/index.html.1375c5bc.js"><link rel="prefetch" href="/myblog/assets/index.html.90d1ac0c.js"><link rel="prefetch" href="/myblog/assets/index.html.4d12ff1c.js"><link rel="prefetch" href="/myblog/assets/index.html.8ddb93d5.js"><link rel="prefetch" href="/myblog/assets/index.html.dd098c61.js"><link rel="prefetch" href="/myblog/assets/index.html.cebf8dc1.js"><link rel="prefetch" href="/myblog/assets/index.html.5674ca1e.js"><link rel="prefetch" href="/myblog/assets/index.html.d2abca49.js"><link rel="prefetch" href="/myblog/assets/index.html.1351de8d.js"><link rel="prefetch" href="/myblog/assets/index.html.9de6b46c.js"><link rel="prefetch" href="/myblog/assets/index.html.611ec9ae.js"><link rel="prefetch" href="/myblog/assets/index.html.a02c1bed.js"><link rel="prefetch" href="/myblog/assets/index.html.eb87c7a9.js"><link rel="prefetch" href="/myblog/assets/index.html.33261d15.js"><link rel="prefetch" href="/myblog/assets/index.html.5589fc08.js"><link rel="prefetch" href="/myblog/assets/index.html.f989be9b.js"><link rel="prefetch" href="/myblog/assets/index.html.9f0a51f1.js"><link rel="prefetch" href="/myblog/assets/index.html.49bd673c.js"><link rel="prefetch" href="/myblog/assets/index.html.f1449990.js"><link rel="prefetch" href="/myblog/assets/index.html.b063a78e.js"><link rel="prefetch" href="/myblog/assets/index.html.3f40e5f3.js"><link rel="prefetch" href="/myblog/assets/index.html.56c44de1.js"><link rel="prefetch" href="/myblog/assets/index.html.f8a7efd0.js"><link rel="prefetch" href="/myblog/assets/index.html.c2db4fad.js"><link rel="prefetch" href="/myblog/assets/404.d0d6ec4e.js"><link rel="prefetch" href="/myblog/assets/Layout.4e3e5e78.js"><link rel="prefetch" href="/myblog/assets/Slide.81c38424.js"><link rel="prefetch" href="/myblog/assets/Blog.d28c723c.js"><link rel="prefetch" href="/myblog/assets/auto.264f6c8c.js"><link rel="prefetch" href="/myblog/assets/index.d8a59108.js"><link rel="prefetch" href="/myblog/assets/index.1842ee54.js"><link rel="prefetch" href="/myblog/assets/mermaid.esm.min.fac286bf.js"><link rel="prefetch" href="/myblog/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/myblog/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/myblog/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/myblog/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/myblog/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/myblog/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/myblog/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/myblog/assets/Playground.c4bd3c9e.js"><link rel="prefetch" href="/myblog/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/myblog/" class="brand"><img class="logo" src="/myblog/avatar.jpg" alt="tt110617"><!----><span class="site-name hide-in-pad">tt110617</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/myblog/" class="nav-link" aria-label="é¦–é¡µ"><span class="icon iconfont icon-home"></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/backend/" class="nav-link active" aria-label="åç«¯"><span class="icon iconfont icon-java"></span>åç«¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/myblog/frontend/" class="nav-link" aria-label="å‰ç«¯"><span class="icon iconfont icon-vue"></span>å‰ç«¯<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/tt110617" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/gaoxingneng.png"><span class="title">é«˜æ€§èƒ½</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">è®¡ç®—æœºåŸºç¡€</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-frame"></span><span class="title">æ¡†æ¶</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">SpringCloud</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/myblog/backend/frame/springcloud/Dubbo.html" class="nav-link sidebar-link sidebar-page" aria-label="Dubbo"><!---->Dubbo<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/myblog/backend/frame/springcloud/SpringCloud.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringCloud"><!---->SpringCloud<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="SpringCloudAlibaba"><!---->SpringCloudAlibaba<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_13-springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13.SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"><!---->13.SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#springcloud-alibabaç®€ä»‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringCloud Alibabaç®€ä»‹"><!---->SpringCloud Alibabaç®€ä»‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"><!---->SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_14-springcloud-alibaba-sentinelå®ç°ç†”æ–­ä¸é™æµ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="14.SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ"><!---->14.SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸€ã€sentinel" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸€ã€Sentinel"><!---->ä¸€ã€Sentinel<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äºŒã€å®‰è£…sentinelæ§åˆ¶å°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äºŒã€å®‰è£…Sentinelæ§åˆ¶å°"><!---->äºŒã€å®‰è£…Sentinelæ§åˆ¶å°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><!---->ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å››ã€æµæ§è§„åˆ™" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å››ã€æµæ§è§„åˆ™"><!---->å››ã€æµæ§è§„åˆ™<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äº”ã€é™çº§è§„åˆ™-ç†”æ–­è§„åˆ™" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº”ã€é™çº§è§„åˆ™ï¼ˆç†”æ–­è§„åˆ™ï¼‰"><!---->äº”ã€é™çº§è§„åˆ™ï¼ˆç†”æ–­è§„åˆ™ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å…­ã€çƒ­ç‚¹keyé™æµ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…­ã€çƒ­ç‚¹keyé™æµ"><!---->å…­ã€çƒ­ç‚¹keyé™æµ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸ƒã€ç³»ç»Ÿè§„åˆ™-ç³»ç»Ÿè‡ªé€‚åº”é™æµ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸ƒã€ç³»ç»Ÿè§„åˆ™ï¼ˆç³»ç»Ÿè‡ªé€‚åº”é™æµï¼‰"><!---->ä¸ƒã€ç³»ç»Ÿè§„åˆ™ï¼ˆç³»ç»Ÿè‡ªé€‚åº”é™æµï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å…«ã€-sentinelresource-æ³¨è§£è¯¦è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…«ã€@SentinelResource æ³¨è§£è¯¦è§£"><!---->å…«ã€@SentinelResource æ³¨è§£è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¹ã€æœåŠ¡ç†”æ–­" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¹ã€æœåŠ¡ç†”æ–­"><!---->ä¹ã€æœåŠ¡ç†”æ–­<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#åã€æŒä¹…åŒ–è§„åˆ™" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åã€æŒä¹…åŒ–è§„åˆ™"><!---->åã€æŒä¹…åŒ–è§„åˆ™<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_15-springcloud-alibaba-seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="15.SpringCloud Alibaba Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡"><!---->15.SpringCloud Alibaba Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><!---->åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸€ã€seataç®€ä»‹ä¸å®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸€ã€Seataç®€ä»‹ä¸å®‰è£…"><!---->ä¸€ã€Seataç®€ä»‹ä¸å®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äºŒã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äºŒã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡"><!---->äºŒã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸‰ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸‰ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡"><!---->ä¸‰ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å››ã€æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å››ã€æµ‹è¯•"><!---->å››ã€æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äº”ã€è¡¥å……è¯´æ˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº”ã€è¡¥å……è¯´æ˜"><!---->äº”ã€è¡¥å……è¯´æ˜<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">SpringSecurity</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><img class="icon" src="/myblog/icon/odbc-full.png"><span class="title">æ•°æ®åº“</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-snow"></span><span class="title">ç®—æ³•</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->SpringCloudAlibaba</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´8æœˆ16æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="/myblog/article/" target="_blank" rel="noopener noreferrer">åä¸€</a></span><span property="author" content="åä¸€"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´8æœˆ16æ—¥</span><meta property="datePublished" content="2022-08-16T00:00:00.000Z"></span><!----><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2022å¹´8æœˆ16æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag3 clickable" role="navigation">æ¡†æ¶</li></ul><meta property="keywords" content="æ¡†æ¶"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2022å¹´8æœˆ16æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 29604 å­—</span><meta property="wordCount" content="29604"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_13-springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active toc-link level2">13.SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#springcloud-alibabaç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">SpringCloud Alibabaç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active toc-link level3">SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_14-springcloud-alibaba-sentinelå®ç°ç†”æ–­ä¸é™æµ" class="router-link-active router-link-exact-active toc-link level2">14.SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸€ã€sentinel" class="router-link-active router-link-exact-active toc-link level3">ä¸€ã€Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äºŒã€å®‰è£…sentinelæ§åˆ¶å°" class="router-link-active router-link-exact-active toc-link level3">äºŒã€å®‰è£…Sentinelæ§åˆ¶å°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="router-link-active router-link-exact-active toc-link level3">ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å››ã€æµæ§è§„åˆ™" class="router-link-active router-link-exact-active toc-link level3">å››ã€æµæ§è§„åˆ™</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äº”ã€é™çº§è§„åˆ™-ç†”æ–­è§„åˆ™" class="router-link-active router-link-exact-active toc-link level3">äº”ã€é™çº§è§„åˆ™ï¼ˆç†”æ–­è§„åˆ™ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å…­ã€çƒ­ç‚¹keyé™æµ" class="router-link-active router-link-exact-active toc-link level3">å…­ã€çƒ­ç‚¹keyé™æµ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸ƒã€ç³»ç»Ÿè§„åˆ™-ç³»ç»Ÿè‡ªé€‚åº”é™æµ" class="router-link-active router-link-exact-active toc-link level3">ä¸ƒã€ç³»ç»Ÿè§„åˆ™ï¼ˆç³»ç»Ÿè‡ªé€‚åº”é™æµï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å…«ã€-sentinelresource-æ³¨è§£è¯¦è§£" class="router-link-active router-link-exact-active toc-link level3">å…«ã€@SentinelResource æ³¨è§£è¯¦è§£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¹ã€æœåŠ¡ç†”æ–­" class="router-link-active router-link-exact-active toc-link level3">ä¹ã€æœåŠ¡ç†”æ–­</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#åã€æŒä¹…åŒ–è§„åˆ™" class="router-link-active router-link-exact-active toc-link level3">åã€æŒä¹…åŒ–è§„åˆ™</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#_15-springcloud-alibaba-seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡" class="router-link-active router-link-exact-active toc-link level2">15.SpringCloud Alibaba Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸€ã€seataç®€ä»‹ä¸å®‰è£…" class="router-link-active router-link-exact-active toc-link level3">ä¸€ã€Seataç®€ä»‹ä¸å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äºŒã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" class="router-link-active router-link-exact-active toc-link level3">äºŒã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#ä¸‰ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡" class="router-link-active router-link-exact-active toc-link level3">ä¸‰ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#å››ã€æµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">å››ã€æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/myblog/backend/frame/springcloud/SpringCloudAibaba.html#äº”ã€è¡¥å……è¯´æ˜" class="router-link-active router-link-exact-active toc-link level3">äº”ã€è¡¥å……è¯´æ˜</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="springcloudalibaba" tabindex="-1"><a class="header-anchor" href="#springcloudalibaba" aria-hidden="true">#</a> SpringCloudAlibaba</h1><h2 id="_13-springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_13-springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" aria-hidden="true">#</a> 13.SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</h2><h3 id="springcloud-alibabaç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#springcloud-alibabaç®€ä»‹" aria-hidden="true">#</a> SpringCloud Alibabaç®€ä»‹</h3><h5 id="_1-ä¸ºä»€ä¹ˆå‡ºç°-springcloud-alibaba" tabindex="-1"><a class="header-anchor" href="#_1-ä¸ºä»€ä¹ˆå‡ºç°-springcloud-alibaba" aria-hidden="true">#</a> 1. ä¸ºä»€ä¹ˆå‡ºç° SpringCloud Alibaba</h5><p>Spring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼</p><p><a href="https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now" target="_blank" rel="noopener noreferrer">https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶</p><p>æˆ‘ä»¬éƒ½çŸ¥é“Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ISSUEéƒ½è¿˜æ¥ä¸åŠFixå°±åˆæ¨å¦ä¸€ä¸ªReleaseäº†ã€‚è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„æ€å°±æ˜¯ç›®å‰ä¸€ç›´ä»¥åä¸€æ®µæ—¶é—´Spring Cloud Netflixæä¾›çš„æœåŠ¡å’ŒåŠŸèƒ½å°±è¿™ä¹ˆå¤šäº†ï¼Œä¸åœ¨å¼€å‘æ–°çš„ç»„ä»¶å’ŒåŠŸèƒ½äº†ã€‚ä»¥åå°†ä»¥ç»´æŠ¤å’ŒMergeåˆ†æ”¯Full Requestä¸ºä¸»</p><p>æ–°ç»„ä»¶åŠŸèƒ½å°†ä»¥å…¶ä»–æ›¿ä»£å¹³ä»£æ›¿çš„æ–¹å¼å®ç°</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635599539964-2836bdaa-57a0-46ba-815f-34ee6bcc4f75.png" alt="img"></p><h5 id="_2-springcloud-alibabaå¸¦æ¥äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-springcloud-alibabaå¸¦æ¥äº†ä»€ä¹ˆ" aria-hidden="true">#</a> 2. SpringCloud Alibabaå¸¦æ¥äº†ä»€ä¹ˆ</h5><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h6 id="_2-1-èƒ½å¹²ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-1-èƒ½å¹²ä»€ä¹ˆ" aria-hidden="true">#</a> 2.1 èƒ½å¹²ä»€ä¹ˆ</h6><p>æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒ Servletã€Feignã€RestTemplateã€Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</p><p>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</p><p>åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</p><p>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</p><p>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p><p>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</p><h6 id="_2-2-å»å“ªé‡Œä¸‹è½½" tabindex="-1"><a class="header-anchor" href="#_2-2-å»å“ªé‡Œä¸‹è½½" aria-hidden="true">#</a> 2.2 å»å“ªé‡Œä¸‹è½½</h6><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¹‹å‰åœ¨çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ä¸­å·²ç»å¼•å…¥äº†alibabaçš„ä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-3-æ€ä¹ˆç©" tabindex="-1"><a class="header-anchor" href="#_2-3-æ€ä¹ˆç©" aria-hidden="true">#</a> 2.3 æ€ä¹ˆç©</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635600464114-3215f873-7617-46ef-9850-503b8cff3a64.png" alt="img"></p><h5 id="_3-å­¦ä¹ èµ„æ–™çš„è·å–" tabindex="-1"><a class="header-anchor" href="#_3-å­¦ä¹ èµ„æ–™çš„è·å–" aria-hidden="true">#</a> 3. å­¦ä¹ èµ„æ–™çš„è·å–</h5><p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-cloud-alibaba##overview" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-cloud-alibaba##overview<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è‹±æ–‡ï¼š</p><p><a href="https://github.com/alibaba/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/spring-cloud-alibaba<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html" target="_blank" rel="noopener noreferrer">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸­æ–‡ï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#springcloud-alibaba-nacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" aria-hidden="true">#</a> SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</h3><p>å¯¹åº”ç€æˆ‘ä»¬å‰é¢å­¦çš„ï¼šEureka/Consul/Zookeeperï¼ˆæœåŠ¡æ³¨å†Œï¼‰ Config+Busï¼ˆé…ç½®ä¸­å¿ƒï¼‰</p><h5 id="ä¸€ã€-nacosç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€-nacosç®€ä»‹" aria-hidden="true">#</a> ä¸€ã€ Nacosç®€ä»‹</h5><p>Nacosâ€”â€”<strong>Na</strong>ming <strong>Co</strong>nfiguration <strong>S</strong>ervice</p><h6 id="_1-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> 1 æ˜¯ä»€ä¹ˆ</h6><ul><li>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡çš„ç®¡ç†å¹³å°ã€‚</li><li>Nacosï¼šDynamic Naming and Configuration Service</li><li>Nacoså°±æ˜¯ <code>æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒçš„ç»„åˆ</code> ï¼Œ <strong>Nacos = Eureka + Config + Bus</strong></li></ul><h6 id="_2-èƒ½å¹²ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-èƒ½å¹²ä»€ä¹ˆ" aria-hidden="true">#</a> 2 èƒ½å¹²ä»€ä¹ˆ</h6><p>æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼›æ›¿ä»£ConfigåšæœåŠ¡é…ç½®ä¸­å¿ƒ</p><h6 id="_3-ä¸‹è½½åœ°å€" tabindex="-1"><a class="header-anchor" href="#_3-ä¸‹è½½åœ°å€" aria-hidden="true">#</a> 3 ä¸‹è½½åœ°å€</h6><p><a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html##_spring_cloud_alibaba_nacos_discovery" target="_blank" rel="noopener noreferrer">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html##_spring_cloud_alibaba_nacos_discovery<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h6 id="_4-å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#_4-å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ" aria-hidden="true">#</a> 4 å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635603894076-3a5b9f04-9718-4e2c-b52b-cff0cce61967.png" alt="img"></p><h5 id="äºŒã€-å®‰è£…å¹¶è¿è¡Œnacos" tabindex="-1"><a class="header-anchor" href="#äºŒã€-å®‰è£…å¹¶è¿è¡Œnacos" aria-hidden="true">#</a> äºŒã€ å®‰è£…å¹¶è¿è¡ŒNacos</h5><p>æœ¬åœ°éœ€è¦å‡†å¤‡java8+mavenç¯å¢ƒã€‚</p><p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://github.com/alibaba/nacos/releases" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è€å¸ˆå®‰è£…çš„1.1.4ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æœ€æ–°ç‰ˆ2.0.3</p><p>è§£å‹å®‰è£…åŒ…ï¼Œè¿è¡Œbinç›®å½•ä¸‹çš„startup.cmd</p><p>é»˜è®¤çš„æ˜¯<strong>é›†ç¾¤æ¨¡å¼</strong>ï¼Œæˆ‘ä»¬éœ€è¦<strong>å•æœºå¯åŠ¨</strong>cmdä¸­è¾“å…¥ï¼š</p><p><code>startup.cmd -m standalone</code> å³å¯é€šè¿‡å•æœºæ¨¡å¼å¯åŠ¨</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635660682220-9df0b752-6b72-4aa3-95ba-d7255e6a5aed.png" alt="img"></p><p>å‘½ä»¤è¿è¡ŒæˆåŠŸåç›´æ¥è®¿é—®<a href="http://localhost:8848/nacos" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯nacos</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635660841412-9cf6bb11-c111-47af-afa8-30726930fd00.png" alt="img"></p><p>å¯åŠ¨æˆåŠŸã€‚</p><h5 id="ä¸‰ã€-nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€-nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" aria-hidden="true">#</a> ä¸‰ã€ Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º</h5><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html##_spring_cloud_alibaba_nacos_discovery" target="_blank" rel="noopener noreferrer">å®˜ç½‘æ‰‹å†Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h6 id="_1-åŸºäºnacosçš„æœåŠ¡æä¾›è€…" tabindex="-1"><a class="header-anchor" href="#_1-åŸºäºnacosçš„æœåŠ¡æä¾›è€…" aria-hidden="true">#</a> 1 åŸºäºNacosçš„æœåŠ¡æä¾›è€…</h6><p>######## 1.1 å»ºmoudle</p><p>cloudalibaba-provider-payment9001</p><p>######## 1.2 pom</p><p>çˆ¶å·¥ç¨‹ä¸­éœ€è¦å¼•å…¥alibabaçš„ä¾èµ–ï¼Œä¹‹å‰å·²ç»å¼•å…¥è¿‡äº†</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- çˆ¶å·¥ç¨‹pomä¸­éœ€è¦å¼•å…¥alibaba --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ¬æ¨¡å—pom</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-provider-payment9001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.3 yml</p><p>æŒ‰ç…§å®˜ç½‘ä¸Šçš„è¯´æ˜é…ç½®ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635662280490-67a7615d-b304-447c-a8d5-870e9e5f67e7.png" alt="img"></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#é…ç½®Nacosåœ°å€ï¼Œæ³¨å†Œåˆ°Nacos</span>
<span class="token comment"># åšç›‘æ§éœ€è¦æŠŠè¿™ä¸ªå…¨éƒ¨æš´éœ²å‡ºæ¥</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.4 ä¸»å¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>  <span class="token comment">//è¿™é‡Œè·Ÿä»¥å‰ä¸åŒäº†ï¼Œä¸å†æ˜¯EnableEurekaClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.5 ä¸šåŠ¡ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry, serverPort: &quot;</span><span class="token operator">+</span> serverPort<span class="token operator">+</span><span class="token string">&quot;\t id&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.6 æµ‹è¯•</p><p>è¿™é‡Œä¸åƒeurekaè¿˜è¦å†™æ³¨å†Œä¸­å¿ƒå¾®æœåŠ¡ï¼Œç›´æ¥å®‰è£…æ‰“å¼€nacoså³å¯ã€‚</p><p>å¯åŠ¨9001ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°ï¼Œæ³¨å†ŒæˆåŠŸ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635662987849-8d3226c2-9554-4c40-9d38-b647820ce175.png" alt="img"></p><p>è®¿é—®<a href="http://localhost:9001/payment/nacos/1" target="_blank" rel="noopener noreferrer">http://localhost:9001/payment/nacos/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635663012705-77ca9ca4-ef3e-4651-9f38-51c9254000f8.png" alt="img"></p><p>nacosæœåŠ¡æ³¨å†Œä¸­å¿ƒ+æœåŠ¡æä¾›è€…9001éƒ½OKäº†</p><p>######## 1.7 ç›¸åŒé…ç½®å†æ–°å»ºä¸€ä¸ªmodule 9002</p><p>æ­¥éª¤ä¸9001ä¸€è‡´ï¼Œå°±æ˜¯ç«¯å£å·æ”¹æˆ9002</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œè™šæ‹Ÿæ˜ å°„ä¸€ä¸ªå’Œ9001é…ç½®ç›¸åŒçš„9011å¾®æœåŠ¡æ¨¡å—ï¼Œç«¯å£å·æ˜¯9011</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635663511339-6a6dbe02-65c6-468b-9528-25449f466a37.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635663647097-c62850c8-27dc-4a95-80bf-fa769eb2ed95.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635663662348-cbf1b8f5-f7e1-4ccb-8cd1-568a40ecbbe3.png" alt="img"></p><p>ç°åœ¨æœ‰ä¸¤ä¸ªæ”¯ä»˜æ¨¡å—ï¼Œ9001å’Œè™šæ‹Ÿæ˜ å°„çš„9011ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635663730838-4a170fcd-dc35-4b47-9810-a8fe105b52f6.png" alt="img"></p><h6 id="_2-åŸºäºnacosçš„æœåŠ¡æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#_2-åŸºäºnacosçš„æœåŠ¡æ¶ˆè´¹è€…" aria-hidden="true">#</a> 2 åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…</h6><p>Nacosè‡ªå¸¦è´Ÿè½½å‡è¡¡</p><p>######## 2.1 æ–°å»ºmodule cloudalibaba-consumer-nacos-order83</p><p>######## 2.2 pom</p><p>nacosè‡ªå¸¦è´Ÿè½½å‡è¡¡</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635664487366-5f26a5ef-6bc5-4e8e-a222-64b5f0047a5c.png" alt="img"></p><p>Ribbonï¼šæ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œè‡ªå¸¦RestTemplate</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-consumer-nacos-order83<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 2.3 yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>


<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>

<span class="token comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 2.4 ä¸»å¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain83</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderNacosMain83</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨å…¥ RestTemplate</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">LoadBalanced</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextBean</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> 
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 2.5 ä¸šåŠ¡ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${service-url.nacos-user-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverURL<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverURL <span class="token operator">+</span> <span class="token string">&quot;/payment/nacos/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635665889497-7b99643e-adcd-4b21-85f1-270838741d69.png" alt="img"></p><p>######## 2.6 æµ‹è¯•</p><p>å¯åŠ¨9001ã€9002ã€83</p><p>nacosæ§åˆ¶å°</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635666371594-bd8ff811-3278-4098-9575-7983f07cb7e3.png" alt="img"></p><p>æµ‹è¯•é“¾æ¥ï¼š<a href="http://localhost:83/consumer/payment/nacos/1" target="_blank" rel="noopener noreferrer">http://localhost:83/consumer/payment/nacos/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å‘ç°9001ä¸9002äº¤æ›¿å‡ºç°ï¼Œå³è½®è¯¢è´Ÿè½½å‡è¡¡ã€‚</p><p><strong>å¯èƒ½å‡ºç°çš„é—®é¢˜</strong>ï¼š</p><p>å½“æ¶ˆè´¹è€…é€šè¿‡<a href="http://xn--nacos-payment-providerUnknowHostException-if92ef9krqn9r9kpe2ar76au6kmp2ot25j" target="_blank" rel="noopener noreferrer">http://nacos-payment-providerå»è°ƒç”¨å¾®æœåŠ¡æ—¶æŠ›å‡ºUnknowHostException<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼šæœªçŸ¥ä¸»æœºåå¼‚å¸¸ã€‚</p><p>è¿™æ˜¯å› ä¸ºnacos-payment-providerå¯¹åº”ä¸¤ä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œä»–ä¸çŸ¥é“ç”¨å“ªä¸ªå¾®æœåŠ¡ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</p><p>è§£å†³ï¼šåŠ ä¸Šè´Ÿè½½å‡è¡¡æ³¨è§£ @LoadBalanced</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635666314847-e7408e10-067d-4b84-b308-dd4571aaaca3.png" alt="img"></p><h6 id="_3-æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_3-æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" aria-hidden="true">#</a> 3. æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635667131341-de67d0df-0669-4c3c-9052-dfd9f4b6e4f9.png" alt="img"></p><p>######## 3.1 Nacosä¸CAP</p><p>Nacoså¯ä»¥åœ¨CPä¸APä¹‹é—´åˆ‡æ¢</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635666897448-5bdee4bc-0e24-4f3c-bdc2-3683e18799c7.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635666799095-c4a6d7c1-8b61-4edf-9af0-e6e94f8ecf3b.png" alt="img"></p><p>######## 3.2 CPä¸APçš„åˆ‡æ¢</p><p>Cï¼ˆconsistencyï¼‰ï¼šæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œå¼ºä¸€è‡´æ€§ï¼›</p><p>Aï¼ˆavailabilityï¼‰ï¼šçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ï¼Œæœ€èµ·ç æœ‰ä¸€ä¸ªå…œåº•å›å¤ï¼Œé«˜å¯ç”¨æ€§ã€‚</p><p>######### ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿ</p><p><strong>AP:</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</p><p><strong>CP:</strong></p><p>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚</p><p>CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p><p>######### æ€ä¹ˆåˆ‡æ¢ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -X PUT <span class="token string">&#39;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="å››ã€-nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#å››ã€-nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" aria-hidden="true">#</a> å››ã€ Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º</h5><p>ä»¥å‰æˆ‘ä»¬å°†æ‰€æœ‰çš„é…ç½®ä¿¡æ¯å†™åˆ°äº†GitHubä¸Šï¼Œç”¨Config+Busæ¥è¿›è¡Œè‡ªåŠ¨åˆ·æ–°å’ŒåŠ¨æ€çš„æ›´æ–°ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠé…ç½®æ–‡ä»¶å†™è¿›Nacosï¼Œç„¶åå†ç”¨Nacosåšç±»ä¼¼äºconfigè¿™æ ·çš„åŠŸèƒ½ï¼Œç›´æ¥ä»Nacosä¸ŠæŠ“å–æˆ‘ä»¬çš„é…ç½®ä¿¡æ¯ã€‚</p><h6 id="_1-nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åŸºç¡€é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åŸºç¡€é…ç½®" aria-hidden="true">#</a> 1. Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åŸºç¡€é…ç½®</h6><p>ä¸»è¦æ˜¯æ·»åŠ ä¸€ä¸ªï¼šnacos-configä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--nacos-config--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.1 å»ºmodule cloudalibaba-config-nacos-client3377</p><p>######## 1.2 pom</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-config-nacos-client3377<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-config--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos-discovery--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.3 yml</p><p>è¿™é‡Œéœ€è¦é…ç½®ä¸¤ä¸ªï¼Œä¸€ä¸ªbootstrapå’Œä¸€ä¸ªapplicationã€‚</p><p>åŸå› ï¼šNacosåŒspringcloud-configä¸€æ ·ï¼Œåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œæ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚</p><p>springbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œ<strong>bootstrapä¼˜å…ˆçº§é«˜äºapplication</strong>ã€‚</p><p>å…¨å±€çš„æ”¾åœ¨ï¼šbootstrap.yml è‡ªå·±çš„æ”¾åœ¨ï¼šapplication.yml</p><p><strong>bootstrapï¼š</strong></p><p>å¾®æœåŠ¡ç«¯å£ï¼š3377ï¼ŒæœåŠ¡ånacos-config-clientï¼Œæ³¨å†Œè¿›nacosï¼šlocalhost:8848 ä½œä¸ºé…ç½®å®¢æˆ·ç«¯</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nacosé…ç½®</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span>

<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>applicationï¼š</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>bootstrap + application å°±è¡¨ç¤ºæˆ‘è¦å»é…ç½®ä¸­å¿ƒæ‰¾åä¸ºdev.yamlçš„æ–‡ä»¶ã€‚</p><p>######## 1.4 ä¸»å¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientMain3377</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConfigClientMain3377</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.5 ä¸šåŠ¡ç±»</p><p>é€šè¿‡Spring CloudåŸç”Ÿæ³¨è§£**@RefreshScope** å®ç°é…ç½®è‡ªåŠ¨æ›´æ–°</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RefreshScope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">//åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${config.info}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configInfo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/config/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 1.6 åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯</p><p>######## Nacosä¸­çš„åŒ¹é…è§„åˆ™</p><p>ç†è®ºï¼š</p><ul><li>Nacosä¸­çš„dataidçš„ç»„æˆæ ¼å¼ä¸SpringBooté…ç½®æ–‡ä»¶ä¸­çš„åŒ¹é…è§„åˆ™</li></ul><p>å®˜ç½‘ï¼š<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635683360153-499516ca-fc68-40e3-9a8d-b57080c4890b.png" alt="img"></p><p>æ³¨æ„nacosåªè¯†åˆ«yamlï¼Œä¸æ”¯æŒymlã€‚</p><p>æœ€ç»ˆå…¬å¼ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo>âˆ—</mo><mo>âˆ—</mo><mi>s</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">.</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">.</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>âˆ—</mo><mo>âˆ—</mo></mrow><mo>âˆ’</mo></mrow><annotation encoding="application/x-tex">{**spring.application.name**}-</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ppl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord">.</span><span class="mord mathnormal">nam</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">âˆ—</span></span><span class="mord">âˆ’</span></span></span></span>{<strong>spring.profiles.active</strong>}.${<strong>spring.cloud.nacos.config.file-extension</strong>}</p><p>ç»“æœï¼š nacos-config-client-dev.yaml</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635684258256-cda8e9fc-3b88-42cc-86cb-080698853a3c.png" alt="img"></p><p>######## å®æ“</p><p>é…ç½®æ–°å¢ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635684133899-cb940e70-fed6-4893-9136-a1605f864ac6.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635683995494-e18c9f15-33c4-486a-ab85-a986c9810fd4.png" alt="img"></p><p>######## 1.7 æµ‹è¯•</p><p>å¯åŠ¨3377</p><p>å‘é€è¯·æ±‚ï¼š<a href="http://localhost:3377/config/info" target="_blank" rel="noopener noreferrer">http://localhost:3377/config/info<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635684417158-e8ca283d-c66e-4edd-8489-76e65673925e.png" alt="img">æµ‹è¯•æˆåŠŸ</p><p>è‡ªå¸¦åŠ¨æ€åˆ·æ–°ï¼šä¿®æ”¹nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®ï¼Œå‘ç°é…ç½®åˆ·æ–°äº†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635684484023-62bb8360-f694-4ece-81c7-16bda7005a02.png" alt="img"></p><h6 id="_2-nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åˆ†ç±»é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åˆ†ç±»é…ç½®" aria-hidden="true">#</a> 2. Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€”â€”åˆ†ç±»é…ç½®</h6><p>######## 2.1 åˆ†å¸ƒå¼å¼€å‘ä¸­çš„å¤šç¯å¢ƒå¤šé¡¹ç›®ç®¡ç†é—®é¢˜</p><ul><li><strong>é—®é¢˜1ï¼š</strong></li></ul><p>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡</p><p>devå¼€å‘ç¯å¢ƒ</p><p>testæµ‹è¯•ç¯å¢ƒ</p><p>prodç”Ÿäº§ç¯å¢ƒã€‚</p><p>å¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ°Nacosä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p><ul><li><strong>é—®é¢˜2ï¼š</strong></li></ul><p>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šå¾®æœåŠ¡å­é¡¹ç›®ï¼Œ</p><p>æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®åˆéƒ½ä¼šæœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ......</p><p>é‚£æ€ä¹ˆå¯¹è¿™äº›å¾®æœåŠ¡é…ç½®è¿›è¡Œç®¡ç†å‘¢ï¼Ÿ</p><p>######## 2.2 Nacosçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢</p><p>é…ç½®ç®¡ç†ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635685284361-4572707d-d143-41be-8c13-c36d096ab04c.png" alt="img"></p><p>å‘½åç©ºé—´ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635685319379-4ca4c0aa-f0b3-4c0a-821e-6516d5ff9fba.png" alt="img"></p><p>######## 2.3 Namespace+Group+Data IDä¸‰è€…å…³ç³»ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿ</p><p>ç±»ä¼¼Javaé‡Œé¢çš„packageåå’Œç±»åï¼Œæœ€å¤–å±‚çš„namespaceæ˜¯å¯ä»¥ç”¨äºåŒºåˆ†éƒ¨ç½²ç¯å¢ƒçš„ï¼ŒGroupå’ŒDataIDé€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªç›®æ ‡å¯¹è±¡ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635685398335-e647481f-d32d-4833-b7f9-4fcbfa6bf693.png" alt="img"></p><p><strong>é»˜è®¤æƒ…å†µï¼š</strong></p><p><strong>Namespace=publicï¼ŒGroup=DEFAULT_GROUP, é»˜è®¤Clusteræ˜¯DEFAULT</strong></p><p>Nacosé»˜è®¤çš„å‘½åç©ºé—´æ˜¯publicï¼ŒNamespaceä¸»è¦ç”¨æ¥å®ç°éš”ç¦»ã€‚</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚</p><p>Groupé»˜è®¤æ˜¯DEFAULT_GROUPï¼ŒGroupå¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»</p><p>Serviceå°±æ˜¯å¾®æœåŠ¡ï¼›ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªClusterï¼ˆé›†ç¾¤ï¼‰ï¼ŒNacosé»˜è®¤Clusteræ˜¯DEFAULTï¼ŒClusteræ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ã€‚</p><p>æ¯”æ–¹è¯´ä¸ºäº†å®¹ç¾ï¼Œå°†Serviceå¾®æœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨äº†æ­å·æœºæˆ¿å’Œå¹¿å·æœºæˆ¿ï¼Œè¿™æ—¶å°±å¯ä»¥ç»™æ­å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆHZï¼‰ï¼Œç»™å¹¿å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆGZï¼‰ï¼Œè¿˜å¯ä»¥å°½é‡è®©åŒä¸€ä¸ªæœºæˆ¿çš„å¾®æœåŠ¡äº’ç›¸è°ƒç”¨ï¼Œä»¥æå‡æ€§èƒ½ã€‚</p><p>æœ€åæ˜¯Instanceï¼Œå°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ã€‚</p><h6 id="_3-ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®" aria-hidden="true">#</a> 3. ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®</h6><p>######## 3.1 DataIDæ–¹æ¡ˆ</p><p>æŒ‡å®šspring.profile.activeå’Œé…ç½®æ–‡ä»¶çš„DataIDæ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½®</p><p>é»˜è®¤ç©ºé—´+é»˜è®¤åˆ†ç»„+æ–°å»ºdevå’Œtestä¸¤ä¸ªDataID</p><ul><li>devé…ç½®DataIDï¼Œä¸Šä¸€è®²é…ç½®è¿‡</li><li>æ–°å»ºtesté…ç½®DataID</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687085675-43bff20e-5d0f-4140-8356-41d5774614a2.png" alt="img"></p><p>è¿™é‡Œå‘½åç©ºé—´æ˜¯é»˜è®¤çš„publicï¼ŒGroupä¹Ÿæ˜¯é»˜è®¤çš„ã€‚</p><p>é€šè¿‡spring.profile.activeå±æ€§å°±èƒ½è¿›è¡Œå¤šç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶çš„è¯»å–</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687246140-40f3010d-2e3c-4959-a537-42d5e0f21b2e.png" alt="img"></p><p>é‡å¯3377 æµ‹è¯•<a href="http://localhost:3377/config/info%EF%BC%8C%E6%88%90%E5%8A%9F%E8%AF%BB%E5%8F%96%E5%88%B0test%E9%85%8D%E7%BD%AE%E4%B8%8B%E7%9A%84config.info" target="_blank" rel="noopener noreferrer">http://localhost:3377/config/infoï¼ŒæˆåŠŸè¯»å–åˆ°testé…ç½®ä¸‹çš„config.info<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687508172-571f6d42-9516-4ca1-a1a3-8d75bea9b912.png" alt="img"></p><p>######## 3.2 Groupæ–¹æ¡ˆ</p><p>é»˜è®¤Groupæ˜¯DEFAULT_GROUPï¼Œç°åœ¨é€šè¿‡Groupå®ç°ç¯å¢ƒåˆ†åŒº</p><ol><li>æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ åˆ°DEV_GROUPåˆ†ç»„</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687829633-f170e566-7692-42cd-9524-eef3337aeffe.png" alt="img"></p><ol><li>æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ åˆ°TEST_GROUPåˆ†ç»„</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687928881-aa121233-ef4d-4868-b2aa-3a12017af496.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635687983063-3062040c-8821-4fac-b868-f570612d6a36.png" alt="img"></p><ol><li>åœ¨configä¸‹å¢åŠ ä¸€æ¡groupçš„é…ç½®å³å¯ã€‚å¯é…ç½®ä¸ºDEV_GROUPæˆ–TEST_GROUP</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635688159372-2a81a5bd-4797-4e5c-a1fb-37fca2c56aee.png" alt="img"></p><ol><li>æµ‹è¯•ï¼š</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635688181202-bf3709c6-29f3-49fe-95a9-bc55925d375b.png" alt="img"></p><p>######## 3.3 namesapceæ–¹æ¡ˆ</p><ol><li>æ–°å»ºdev/testçš„Namesapce</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635688594593-dcfc88bc-b792-421a-a01f-0ac785be0650.png" alt="img"></p><ol><li>å›åˆ°æœåŠ¡ç®¡ç†-æœåŠ¡åˆ—è¡¨æŸ¥çœ‹</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635688736719-d5c116d7-f8b1-4637-8488-0174a8b463b6.png" alt="img"></p><ol><li>åœ¨è¿™ä¸¤ä¸ªæ–°å»ºçš„namespaceä¸­åˆ†åˆ«æ–°å»ºä¸‰ä¸ªä¸åŒåˆ†ç»„çš„é…ç½®æ–‡ä»¶</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635690723423-42a30b93-e4c1-42d2-b349-277dd6a068fd.png" alt="img"></p><ol><li>ä¿®æ”¹3377çš„ymlæ–‡ä»¶</li></ol><p>bootstrapï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635689312883-38e75de9-0081-4b50-82bb-be5b057b7d41.png" alt="img"></p><p>applicationï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635689345327-7fb0d48a-aba1-4814-9c54-d1d1bfc6f7a0.png" alt="img"></p><ol><li>æµ‹è¯•</li></ol><p>dev namesapceï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635690766323-8fe68084-ec12-4a06-a1fc-c5d5f5ed38c2.png" alt="img"></p><p>test namesapceï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635690996286-aff5fe00-8620-4648-8933-c18e1a770519.png" alt="img"></p><p>######## 3.4 æ€»ç»“</p><p>DataIDæ–¹æ¡ˆæ˜¯åœ¨é»˜è®¤namesapceå’Œé»˜è®¤Groupä¸‹ï¼Œåˆ›å»ºä¸¤ä¸ªä¸åŒçš„DataIDã€‚</p><p>Groupæ–¹æ¡ˆæ˜¯åœ¨é»˜è®¤namespaceä¸‹ï¼Œæ–°å»ºä¸¤ä¸ªDataIDç›¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡å®šä¸åŒçš„åˆ†ç»„æ¥è¯»å–ä¸åŒçš„é…ç½®ã€‚</p><p>Namespaceæ–¹æ¡ˆï¼Œæ˜¯ç›¸åŒçš„Groupï¼Œç›¸åŒçš„DataIDï¼Œåˆ›å»ºå¹¶æŒ‡å®šä¸åŒçš„namespaceæ¥è¯»å–ä¸åŒé…ç½®ã€‚</p><h6 id="_4-nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_4-nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®-é‡ç‚¹" aria-hidden="true">#</a> 4. Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡ç‚¹ï¼‰</h6><p>æˆ‘ä»¬ä¹‹å‰åœ¨å­¦eurekaçš„æ—¶å€™ï¼Œé…ç½®äº†ä¸¤ä¸ªeurekaæ³¨å†Œä¸­å¿ƒå¾®æœåŠ¡ã€‚å­¦Nacosæ—¶ï¼Œä¸ç”¨æˆ‘ä»¬å•ç‹¬æ–°å»ºæ³¨å†Œä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—äº†ï¼Œç›´æ¥å®‰è£…ä½¿ç”¨å³å¯ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p><p>ä½†æ˜¯ï¼šå¦‚æœè¿™ä¸ªæ³¨å†Œä¸­å¿ƒæŒ‚äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ç›®å‰å°±å¼€äº†ä¸€ä¸ªNacosç¨‹åºï¼Œä¹Ÿæ²¡æœ‰é…ç½®é›†ç¾¤ã€‚æ˜¾ç„¶ï¼Œå®é™…æƒ…å†µä¸­ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªNacosæ³¨å†Œä¸­å¿ƒï¼Œå› æ­¤éœ€è¦ç”¨åˆ°nacosé›†ç¾¤ã€‚</p><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener noreferrer">é›†ç¾¤å®˜ç½‘æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>######## 4.1 å®˜ç½‘è¯´æ˜</p><ol><li><strong>æ¶æ„å›¾ï¼š</strong></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635774952980-508e21d6-48a1-4eb9-94b9-ac493e7ac4d4.png" alt="img"></p><p>è¿™é‡Œvipè¡¨ç¤ºvirtual ipï¼ˆè™šæ‹ŸIPï¼‰</p><ol><li><strong>è¦å°†é…ç½®æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼šMySQL</strong></li></ol><p>ä¸ç”¨nacoså†…åµŒçš„æ•°æ®åº“</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635775427756-97237fc3-1533-4f48-a906-98fc0102fda5.png" alt="img"></p><ol><li><strong>é€šä¿—æ˜“æ‡‚çš„Nacosé›†ç¾¤æ¶æ„å›¾</strong></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635775247554-92fa7cbf-573e-4385-9efd-1ad111ae0371.png" alt="img"></p><ol><li><strong>é‡ç‚¹è¯´æ˜ï¼š</strong></li></ol><p>é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ï¼Œæˆ‘ä»¬é‡å¯Nacosåï¼Œä»¥å‰çš„é…ç½®æ–‡ä»¶ä¸ä¼šæ¶ˆå¤±ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚æ¯ä¸ªnacoséƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œå­˜æ”¾çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚</p><p>nacosæ”¯æŒçš„ä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p><ul><li>å•æœºæ¨¡å¼ï¼šç”¨äºæµ‹è¯•å’Œå•æœºä½¿ç”¨</li><li>é›†ç¾¤æ¨¡å¼ï¼šç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é«˜å¯ç”¨</li><li>å¤šé›†ç¾¤æ¨¡å¼ï¼šç”¨äºå¤šæ•°æ®ä¸­å¿ƒåœºæ™¯</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635775664121-2c4d8a51-44d0-4ee0-90b5-3d6df0079932.png" alt="img"></p><p>######## 4.2 NacosåµŒå…¥å¼æ•°æ®åº“derbyåˆ‡æ¢åˆ°mysql</p><p>Nacosé»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“derbyï¼Œé‚£ä¹ˆå¦‚æœåšé›†ç¾¤æ—¶æ¯ä¸ªnacoséƒ½è‡ªå¸¦ä¸€ä¸ªderbyï¼Œé‚£ä¹ˆå°±æœ‰ä¸‰ä¸ªå­˜å‚¨é…ç½®ç¨³å¥çš„æ•°æ®åº“ï¼Œæ˜¾ç„¶æ•°æ®çš„ç»Ÿä¸€æ€§å­˜åœ¨é—®é¢˜ã€‚</p><p>######### windowså•æœºç‰ˆderbyåˆ°mysqlåˆ‡æ¢æ­¥éª¤</p><ol><li>é¦–å…ˆåœ¨nacoså®‰è£…ç›®å½•çš„confç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªåä¸º<strong>nacos-mysql.sql</strong>çš„sqlè„šæœ¬</li></ol><p>ç„¶åæ‰§è¡Œnacos-mysql.sqlè„šæœ¬</p><p>æ³¨æ„ï¼šæ•°æ®åº“nacos_configéœ€è¦è‡ªå·±åˆ›å»º</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/* åˆ›å»ºnacos_configæ•°æ®åº“  */</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> nacos_config<span class="token punctuation">;</span>
<span class="token keyword">USE</span> nacos_config<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://www.yuque.com/attachments/yuque/0/2021/sql/22423156/1635776971740-ab4fe82b-a375-4dbc-b8e0-348acb2b1003.sql" target="_blank" rel="noopener noreferrer">ğŸ“nacos-mysql.sql<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ol><li>åœ¨confç›®å½•ä¸‹æ‰¾åˆ°application.properties</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635777806883-a979fbfc-91fa-4cd8-a967-810765af235c.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635777987285-f0947ebc-127d-4873-81a4-9851f777c15b.png" alt="img"></p><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>spring.datasource.platform=mysql
 
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=æ•°æ®åº“è´¦å·
db.password=æ•°æ®åº“å¯†ç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>é‡æ–°å¯åŠ¨nacosï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸ªå…¨æ–°çš„ç©ºè®°å½•ç•Œé¢ï¼Œä»¥å‰æ˜¯è®°å½•è¿›derby</li></ol><p>åœ¨binç›®å½•ä¸‹çš„cmd è¾“å…¥ <code>startup.cmd -m standalone</code> æ‰§è¡Œï¼Œè¿™é‡Œè¿˜æ˜¯å•æœºæ¨¡å¼ï¼Œåªä¸è¿‡æ•°æ®åº“ä»derbyè¿ç§»åˆ°äº†mysql</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635778357485-54471c63-4653-4490-aafc-7e04f8f2f911.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé‡å¯ä¹‹åä¹‹å‰çš„é…ç½®éƒ½æ²¡äº†ï¼Œè¯´æ˜è¿ç§»æˆåŠŸã€‚</p><ol><li>åœ¨naocsæ–°å»ºé…ç½®æ—¶ï¼Œä¼šè‡ªåŠ¨ä¿å­˜åˆ°mysqlæ•°æ®åº“ä¸­</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635778640587-bac74307-033c-475e-a1a7-2aeba30c04bc.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1635778680246-a20e51f7-4fd9-4c94-8196-840cd3a33a3b.png" alt="img"></p><p>######## ï¼ˆè¸©å‘ï¼‰1.1.4ç‰ˆæœ¬nacosä½¿ç”¨å¤–éƒ¨æ•°æ®åº“Mysql8</p><p>åé¢Seataç« èŠ‚ç”±äºNacosã€sentinelã€seataå­˜åœ¨ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œå› æ­¤éœ€è¦å®‰è£…1.1.4ç‰ˆæœ¬nacosã€‚</p><p>æˆ‘åœ¨å®‰è£…nacos1.1.4é…ç½®MYSQL8çš„application.propertiesåï¼ŒæŠ¥é”™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636689711167-14daa147-53a0-4100-9997-89807bbb5551.png" alt="img"></p><p>å°è¯•äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p><ol><li>åœ¨nacos\plugins\mysqlï¼ˆè‡ªå·±åˆ›å»ºï¼‰æ–‡ä»¶å¤¹ä¸‹æ”¾mysql8å¯¹åº”ç‰ˆæœ¬çš„jaråŒ…ï¼ˆä¸ç®¡ç”¨ï¼‰</li><li>ä¿®æ”¹application.propertiesæ–‡ä»¶åä¸ºbootstrap.propertiesï¼šå¯ä»¥æ­£å¸¸å¯åŠ¨nacosï¼Œä½†æ˜¯æ•°æ®åº“å¹¶æ²¡æœ‰ä»derbyåˆ‡æ¢ä¸ºmysql</li><li>æ·»åŠ æ—¶åŒºï¼š<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636688994869-43048817-50a7-486e-90d9-c0a2d589e64e.png" alt="img"></li></ol><p>ä¸€èˆ¬æˆ‘åœ¨ä½¿ç”¨mysql8çš„æ—¶å€™éƒ½ä¼šæ·»åŠ ä¸Šæ—¶åŒºï¼Œä»ç„¶ä¸ç®¡ç”¨ã€‚</p><ol><li>ä¿®æ”¹nacosæºç ï¼ˆå¯è¡Œï¼‰</li></ol><p>######### ä¿®æ”¹nacosæºç </p><p>ä¸‹è½½nacos1.1.4æºç ï¼Œä¿®æ”¹çˆ¶å·¥ç¨‹pomçš„mysql-connector-javaçš„ç‰ˆæœ¬ï¼Œå°†5.1.34æ”¹æˆè‡ªå·±mysqlå¯¹åº”çš„ç‰ˆæœ¬</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636692383529-991ca7a4-d60e-4df2-8b6f-e271e0e7f73a.png" alt="img"></p><p>è¿™é‡Œä¸€æ”¹ï¼Œnamingæ¨¡å—ä¸‹çš„<strong>com.alibaba.nacos.naming.healthcheck.MysqlHealthCheckProcessor</strong>å°±ä¼šæŠ¥é”™</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636692552809-fd63b51b-e355-43ec-88ed-0d424023bb40.png" alt="img"></p><p>æŠŠ<code>import com.mysql.jdbc.jdbc2.optional.MysqlDataSource;</code>æ”¹ä¸º<code>import com.mysql.cj.jdbc.MysqlDataSource;</code></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636692775087-5a140dbb-0f10-4329-aaa3-836daedc850c.png" alt="img"></p><p>è¿™é‡Œæˆ‘æ³¨é‡Šçš„ä¸€å®šè¦åˆ æ‰ï¼ˆè¿™é‡Œæˆ‘æ³¨é‡Šæ‰ä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†ï¼‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636694992341-b1680444-d9dc-47bb-9437-bbc14388c5ff.png" alt="img"></p><p>ç„¶ååœ¨æºç æ ¹ç›®å½•ä¸‹æ‰“å¼€cmdï¼Œä½¿ç”¨mavenæ‰“åŒ…</p><p>æ‰§è¡Œï¼š<code>mvn -Prelease-nacos -Dmaven.test.skip=true clean install -U</code></p><p>æ‰“åŒ…å¥½çš„nacoså­˜æ”¾åœ¨æ ¹ç›®å½•\distribution\targetç›®å½•ä¸‹</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636699215820-994303ce-a905-4980-8356-4eba81cfe3df.png" alt="img"></p><p>è¿™ä¸ªå‹ç¼©åŒ…å°±ç›¸å½“äºæˆ‘ä»¬ä»å®˜ç½‘ä¸Šä¸‹çš„ã€‚ç„¶åå¤åˆ¶åˆ°ä½ æƒ³è§£å‹çš„åœ°æ–¹ï¼Œè§£å‹ã€‚</p><p>éšåï¼Œé…ç½®conf\application.propertiesé‡Œé¢çš„æ•°æ®åº“ï¼š</p><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>#******************  å•æœºæ¨¡å¼æ”¯æŒmysql  *******************#
spring.datasource.platform=mysql
 
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=10000&amp;socketTimeout=30000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC
db.user=æ•°æ®åº“è´¦å·
db.password=æ•°æ®åº“å¯†ç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>serverTimezone=UTC</strong>ä¸è¦å¿˜è®°äº†ã€‚ï¼ˆæ¯æ¬¡é…ç½®mysql8ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ªè®¾ç½®ï¼‰</p><p>ç„¶åå¯åŠ¨nacosï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636699506385-b20079ed-0143-4f43-8791-baa2a05a7193.png" alt="img"></p><p>å¯åŠ¨æˆåŠŸï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹ï¼Œèƒ½ä¸èƒ½å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ–°å»ºä¸€ä¸ªé…ç½®</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636699613637-8419ae67-dbae-47be-be53-014b96bb0d99.png" alt="img"></p><p>æˆåŠŸå­˜å…¥æ•°æ®åº“ï¼</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636699673050-624c269c-e53c-4af6-bca4-79f2ada11586.png" alt="img"></p><p>######## 4.3 Linuxç‰ˆNacos+MySQLç”Ÿäº§ç¯å¢ƒé…ç½®</p><p>ä¸€å®šè¦å…ˆæŠŠç¯å¢ƒå‡†å¤‡å¥½ï¼ centos7/Ubuntu/ + maven(3.2+)+mysql(5.6.5+)+JDK1.8</p><p>é¢„è®¡éœ€è¦1ä¸ªNginx+3ä¸ªnacosæ³¨å†Œä¸­å¿ƒ+1ä¸ªmysql</p><p>######### 4.3.1 Nacos ä¸‹è½½Linuxç‰ˆ</p><p>ä¸‹è½½nacos-linuxï¼š<a href="https://github.com/alibaba/nacos/releases/tag/2.0.3" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases/tag/2.0.3<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æˆ‘æ”¾åœ¨äº†/usr/local ä¸‹</p><p>è§£å‹ï¼š <code>tar -zxvf nacos-server-2.0.3.tar.gz</code></p><p><code>cp -r nacos /mynacos/</code> é€’å½’æ‹·è´nacos æ–‡ä»¶å¤¹åˆ°mynacosæ–‡ä»¶å¤¹ä¸‹ ï¼ˆæˆ‘è¿™é‡Œæ²¡æœ‰æ‰§è¡Œè¿™æ­¥ï¼‰</p><p>######### 4.3.2 é›†ç¾¤é…ç½®æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰</p><p>(1) LinuxæœåŠ¡å™¨ä¸Šmysqlæ•°æ®åº“é…ç½®</p><p>è·Ÿwindowsä¸€æ ·ï¼Œlinxuçš„nacos åœ¨ /nacos/conf ç›®å½•ä¸‹æœ‰ä¸€ä¸ªnacos-mysql.sqlçš„sqlè„šæœ¬</p><p>æˆ‘æ˜¯é€šè¿‡SQLyogå®¢æˆ·ç«¯è¿œç¨‹è¿æ¥ï¼Œç„¶åæ‰§è¡Œã€‚</p><p>(2) application.properties é…ç½®</p><p>/usr/local/nacos/conf ä¸‹ï¼Œä¿®æ”¹å†…å®¹ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#******************  å•æœºæ¨¡å¼æ”¯æŒmysql  *******************#</span>
spring.datasource.platform<span class="token operator">=</span>mysql
 
db.num<span class="token operator">=</span><span class="token number">1</span>
db.url.0<span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC
db.user<span class="token operator">=</span>æ•°æ®åº“è´¦å·
db.password<span class="token operator">=</span>æ•°æ®åº“å¯†ç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) LinuxæœåŠ¡å™¨ä¸Šnacosçš„é›†ç¾¤é…ç½®cluster.conf</p><p>æ¢³ç†å‡º3å°nacosé›†å™¨çš„ä¸åŒæœåŠ¡ç«¯å£å· 3333 4444 5555</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636100427810-4462fb17-7381-42df-a034-8caf3b3aa211.png" alt="img"></p><p><strong>cp cluster.conf.example cluster.conf</strong></p><p><strong>vim cluster.conf</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636100588057-959ee6c7-b84b-4a65-a5d8-0013380a8e46.png" alt="img"><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636100696082-247401dd-4c5f-4e9e-b9bf-bcbaa8108414.png" alt="img"></p><p>(4) <a href="http://xn--Nacosstartup-bh7t29nlt0guk9brp4avuh7v5e.sh" target="_blank" rel="noopener noreferrer">ç¼–è¾‘Nacosçš„å¯åŠ¨è„šæœ¬startup.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä½¿å®ƒèƒ½å¤Ÿæ¥å—ä¸åŒçš„å¯åŠ¨ç«¯å£</p><p>/usr/local/nacos/bin <a href="http://xn--startup-nw3k389jqdq043b.sh" target="_blank" rel="noopener noreferrer">ç›®å½•ä¸‹æœ‰startup.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå¹³æ—¶å•æœºç‰ˆçš„å¯åŠ¨ï¼Œéƒ½æ˜¯./startup.shå³å¯ã€‚</p><p>é›†ç¾¤å¯åŠ¨ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç±»ä¼¼å…¶å®ƒè½¯ä»¶çš„shellå‘½ä»¤ï¼Œä¼ é€’ä¸åŒçš„ç«¯å£å·å¯åŠ¨ä¸åŒçš„nacoså®ä¾‹ã€‚</p><p>å‘½ä»¤ï¼š./startup.sh <strong>-p 3333</strong> è¡¨ç¤ºå¯åŠ¨ç«¯å£å·ä¸º3333çš„nacosæœåŠ¡å™¨å®ä¾‹ï¼Œå’Œä¸Šä¸€æ­¥çš„cluster.confé…ç½®çš„ä¸€è‡´ã€‚</p><p><strong>æ³¨æ„ï¼š2.0ç‰ˆæœ¬çš„-pè¢«å ç”¨äº†ï¼Œå¯ä»¥ç”¨å¤§å†™Pæˆ–è€…å…¶ä»–å­—æ¯ï¼Œåˆšæ”¹å®Œæµè§ˆå™¨ä¼šæœ‰å»¶è¿Ÿï¼Œè¿‡ä¸€ä¼šæ‰ä¼šå¥½ã€‚</strong></p><ul><li>1.1.4 ç‰ˆæœ¬ä¿®æ”¹å‰åå¯¹æ¯”æ–¹å¼ï¼š</li></ul><table><thead><tr><th>ä¿®æ”¹å‰</th><th>ä¿®æ”¹å</th></tr></thead><tbody><tr><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636101801849-65e53edf-8bd0-4978-b51f-c60091601f11.png" alt="img"></td><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636101807905-b1e3a2be-09a2-45dc-8e84-c0b1eb58fc9e.png" alt="img"></td></tr><tr><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636101797900-5b7d1e70-9e92-47ba-81e2-c5b520334ec4.png" alt="img"></td><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636101791050-52f8abbf-3af1-498d-980e-c1d95dc27509.png" alt="img"></td></tr></tbody></table><ul><li>2.0.3ç‰ˆæœ¬ä¿®æ”¹å‰åå¯¹æ¯”</li></ul><table><thead><tr><th>ä¿®æ”¹å‰</th><th>ä¿®æ”¹å</th></tr></thead><tbody><tr><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636965100107-f81bce09-bfcf-4d91-ae4c-3f080d6bac4c.png" alt="img"></td><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636965136571-aea13396-dc5c-4316-be51-1cdd8a8d6155.png" alt="img"></td></tr><tr><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636965209533-e9e31b66-0621-4975-ae86-d99549bdeea1.png" alt="img"></td><td><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636965580222-2c12fd48-38f9-4ed7-aefe-acf1c2ef345f.png" alt="img"></td></tr></tbody></table><p>å¦‚æœé˜²ç«å¢™æ²¡å…³ï¼Œè®°å¾—å°†3333,4444,5555ç«¯å£å·è®¾ç½®å¯è®¿é—®</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --add-port<span class="token operator">=</span><span class="token number">3333</span>/tcp --permanent
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">4444</span>/tcp --permanent
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">5555</span>/tcp --permanent
firewall-cmd --reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆåªèƒ½å¯åŠ¨ä¸€ä¸ªnacosï¼Œå°è¯•å„ç§åŠæ³•æœªè§£å†³ï¼Œæ›´æ¢nacos1.1.4åæ²¡æœ‰é—®é¢˜ã€‚</p><p>(ç•ªå¤–)nacos linuxè¸©å‘å¿…çœ‹</p><p>æœ€å¼€å§‹æˆ‘ç”¨çš„nacos2.0.3ï¼Œåˆ°é›†ç¾¤é‚£å°±å‡ºç°äº†é—®é¢˜ï¼Œåªèƒ½å¼€ä¸€ä¸ªnacosï¼Œå‰©ä¸‹ä¸¤ä¸ªå¼€èµ·æ¥å°±æŠ¥é”™ã€‚æŠ¥é”™çš„ä¿¡æ¯ï¼š<a href="https://www.yuque.com/attachments/yuque/0/2021/txt/22423156/1636115364580-b52c91e1-48ef-4459-9182-388752447b2b.txt" target="_blank" rel="noopener noreferrer">ğŸ“startout.txt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼ˆstart.outï¼‰ æ—¥å¿—ï¼š<a href="https://www.yuque.com/attachments/yuque/0/2021/txt/22423156/1636115522178-750173d8-70ad-43ba-98c1-52f1791ebf7f.txt" target="_blank" rel="noopener noreferrer">ğŸ“nacos.log.txt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (nacos.log)ã€‚å°è¯•äº†å„ç§æ–¹æ³•ï¼Œæ”¹JVMé…ç½®ç­‰ç­‰ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚æœ€åé€‰æ‹©ä½¿ç”¨è·Ÿè§†é¢‘é‡Œé¢ä¸€æ ·çš„nacosç‰ˆæœ¬1.1.4</p><p>ä½¿ç”¨1.1.4çš„æ—¶å€™æ•°æ®åº“çš„é…ç½® <code>/usr/local/mynacos/nacos/conf/</code> (1.1.4çš„å®‰è£…è·¯å¾„) application.properties æ–‡ä»¶ä½¿ç”¨mysql8+ éœ€è¦åŠ ä¸Šæ—¶åŒº 2.0.3 ä¸éœ€è¦</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>#************************* é…ç½®æ•°æ®åº“ ****************************#
spring.datasource.platform=mysql
 
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;serverTimezone=UTC
db.user=root
db.password=10086
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cluster.conf è¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·é…ç½®ï¼›</p><p><a href="http://startup.sh" target="_blank" rel="noopener noreferrer">startup.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è·Ÿè€å¸ˆä¸€æ ·çš„æ”¹æ³•ï¼Œç„¶åéœ€è¦å°†JVMçš„é…ç½®ä¿®æ”¹ï¼Œå› ä¸ºæˆ‘çš„è™šæ‹Ÿæœºåªæœ‰4Gå†…å­˜ï¼Œæ‰€ä»¥æˆ‘æŠŠJVMé…ç½®è°ƒæ•´ä¸ºå¦‚ä¸‹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636115846275-0f7eef6b-d977-47d6-92be-5f1e7be2737c.png" alt="img"></p><p>ç„¶ååˆ†åˆ«æ‰§è¡Œå¼€å¯3333ã€4444ã€5555ä¸‰ä¸ªnacosï¼ŒæˆåŠŸå¼€å¯nacosé›†ç¾¤</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636115985623-1655b0e4-a749-4856-b287-b91167099866.png" alt="img"></p><p>ä½¿ç”¨nacos2+çš„æœ‹å‹å¯ä»¥å°è¯•å¼€ä¸‰å°è™šæ‹Ÿæœºï¼Œå‚è€ƒå®˜æ–¹æ‰‹å†Œé…ç½®é›†ç¾¤<a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener noreferrer">nacoså®˜æ–¹æ‰‹å†Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æ³¨æ„ï¼šç”¨nacos1.4ä»¥ä¸Šçš„ï¼Œè²Œä¼¼å°±ç”¨ä¸äº†è¿™ä¸ªæ¨¡æ‹Ÿé›†ç¾¤çš„æ–¹æ³•äº†ï¼Œè€å®å¤åˆ¶3ä¸ªnacosæ–‡ä»¶å¤¹å†é€ä¸ªè®¾ç½®ç«¯å£å·å¯åŠ¨ <a href="https://blog.csdn.net/qq1623803207/article/details/120277919?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link" target="_blank" rel="noopener noreferrer">åŒä¸€å°æœºå¯åŠ¨å¤šä¸ªnacosçš„é—®é¢˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>(5) Nginxçš„é…ç½®ï¼Œç”±å®ƒä½œä¸ºè´Ÿè½½å‡è¡¡å™¨</p><p><a href="https://www.yuque.com/mrlinxi/pxvr4g/he0i9c" target="_blank" rel="noopener noreferrer">NginxåŸºç¡€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>/usr/local/nginx/conf ä¸‹nginx.confæ–‡ä»¶ä¸ºé»˜è®¤é…ç½®æ–‡ä»¶ å¯åŠ¨nginxé€šè¿‡-cå¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ã€‚æˆ‘è¿™é‡Œå°†åŸæ¥çš„é…ç½®æ–‡ä»¶æ‹·è´ä¸º<code>nginx_nacos.conf</code></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636118716205-76c7f6e2-a07a-4518-80e3-f23b875b373e.png" alt="img"></p><p>å¯åŠ¨nginxï¼Œcdåˆ°/usr/local/nginx/sbinä¸‹ ,æ‰§è¡Œï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./nginx -c /usr/local/nginx/conf/nginx_nacos.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ«å¿˜äº†é˜²ç«å¢™å¼€å¯1111ç«¯å£çš„è®¿é—®ï¼š</p><p><strong>firewall-cmd --add-port=1111/tcp --permanent</strong></p><p><strong>firewall-cmd --reload</strong></p><p>(6) æµ‹è¯•</p><p>æµ‹è¯•é€šè¿‡nginxè®¿é—®nacosï¼ŒæˆåŠŸç™»é™†</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636119394556-51964220-c6c9-4c5c-9311-004d20e669e9.png" alt="img"></p><p>ç„¶åæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636119472865-2b8373f1-6cab-4823-85c1-f91772c2cf37.png" alt="img"></p><p>æˆåŠŸå­˜åˆ°Linuxçš„æ•°æ®åº“ä¸­ï¼</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636119509441-e9e33dc7-fd36-40e6-817f-2034a2cf1f11.png" alt="img"></p><p>######## 4.4 å¾®æœåŠ¡cloudalibaba-provider-payment9002å¯åŠ¨æ³¨å†Œè¿›nacosé›†ç¾¤</p><p>ä¿®æ”¹9002çš„application.ymlæ–‡ä»¶ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636119919002-851f57c9-7ec7-4ef5-a531-28e7315627ac.png" alt="img"></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9002</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
<span class="token comment">#        server-addr: localhost:8848 #é…ç½®Nacosåœ°å€ï¼Œæ³¨å†Œåˆ°Nacos</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.190.134<span class="token punctuation">:</span><span class="token number">1111</span> <span class="token comment"># æ³¨å†Œåˆ°nacosé›†ç¾¤ï¼Œé€šè¿‡nginxä»£ç†</span>
<span class="token comment"># åšç›‘æ§éœ€è¦æŠŠè¿™ä¸ªå…¨éƒ¨æš´éœ²å‡ºæ¥</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨9002ï¼Œæ³¨å†ŒæˆåŠŸ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636120024459-af14247e-507b-4915-8b0c-42594be9faec.png" alt="img"></p><h2 id="_14-springcloud-alibaba-sentinelå®ç°ç†”æ–­ä¸é™æµ" tabindex="-1"><a class="header-anchor" href="#_14-springcloud-alibaba-sentinelå®ç°ç†”æ–­ä¸é™æµ" aria-hidden="true">#</a> 14.SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ</h2><h3 id="ä¸€ã€sentinel" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€sentinel" aria-hidden="true">#</a> ä¸€ã€Sentinel</h3><p><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Sentinel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer">ä¸­æ–‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Sentinel æ˜¯è½»é‡çº§çš„æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§Javaåº“ï¼›åŠŸèƒ½ç±»ä¼¼äºHystrix</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636121571580-6b6a7838-1def-4a6a-8780-9dced8b563e1.png" alt="img"></p><p><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">ä¸‹è½½åœ°å€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636120420628-55b29acd-23e4-4a77-8963-7e46ed37d7f2.png" alt="img"></p><p>æ€ä¹ˆç©ï¼š</p><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html##_spring_cloud_alibaba_sentinel" target="_blank" rel="noopener noreferrer">å…¥é—¨æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ</p><h3 id="äºŒã€å®‰è£…sentinelæ§åˆ¶å°" tabindex="-1"><a class="header-anchor" href="#äºŒã€å®‰è£…sentinelæ§åˆ¶å°" aria-hidden="true">#</a> äºŒã€å®‰è£…Sentinelæ§åˆ¶å°</h3><p>Sentinelåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æ ¸å¿ƒåº“ï¼ˆJavaå®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿäº‘æ˜Ÿå®‡æ‰€æœ‰Javaè¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹Dubbo/Spring Cloudç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒâ€”â€”åå°ï¼›</li><li>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäºSpring Bootå¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„Tomcatç­‰åº”ç”¨å®¹å™¨â€”â€”å‰å° 8080</li></ul><h5 id="å®‰è£…æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æ­¥éª¤" aria-hidden="true">#</a> å®‰è£…æ­¥éª¤</h5><p>ä¸‹è½½åˆ°æœ¬åœ°sentinel-dashboard-1.8.2.jar</p><p>è¿è¡Œå‘½ä»¤ï¼š</p><p>å‰æéœ€è¦Java8ï¼Œä¸”8080ç«¯å£ä¸èƒ½è¢«å ç”¨ï¼›<code>java -jar sentinel-dashboard-1.8.2.jar</code></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636122488124-495f5f8f-b46a-48d3-b749-e1ee087ad7d4.png" alt="img"></p><p>è®¿é—® localhost:8080ï¼Œè´¦å·å¯†ç å‡ä¸ºsentinel</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636122678696-1a939dde-0487-4767-85ca-a9f1da74cd59.png" alt="img"></p><h3 id="ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" aria-hidden="true">#</a> ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h3><h5 id="_3-1-å¯åŠ¨nacos8848" tabindex="-1"><a class="header-anchor" href="#_3-1-å¯åŠ¨nacos8848" aria-hidden="true">#</a> 3.1 å¯åŠ¨Nacos8848</h5><h5 id="_3-2-æ–°å»ºmodule-cloudalibaba-sentinel-service8401" tabindex="-1"><a class="header-anchor" href="#_3-2-æ–°å»ºmodule-cloudalibaba-sentinel-service8401" aria-hidden="true">#</a> 3.2 æ–°å»ºModule cloudalibaba-sentinel-service8401</h5><h6 id="_3-2-1-pom" tabindex="-1"><a class="header-anchor" href="#_3-2-1-pom" aria-hidden="true">#</a> 3.2.1 pom</h6><p>ä»¥ååŸºæœ¬ä¸Šnacos è·Ÿsentinelä¸€èµ·é…ç½®</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-sentinel-service8401<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--openfeign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-2-2-yaml" tabindex="-1"><a class="header-anchor" href="#_3-2-2-yaml" aria-hidden="true">#</a> 3.2.2 yaml</h6><p>spring.cloud.sentinel.transport.port ç«¯å£é…ç½®ä¼šåœ¨åº”ç”¨å¯¹åº”çš„æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª Http Serverï¼Œè¯¥ Server ä¼šä¸ Sentinel æ§åˆ¶å°åšäº¤äº’ã€‚</p><p>æ¯”å¦‚ Sentinel æ§åˆ¶å°æ·»åŠ äº†1ä¸ªé™æµè§„åˆ™ï¼Œä¼šæŠŠè§„åˆ™æ•°æ®pushç»™è¿™ä¸ªHttp Serveræ¥æ”¶ï¼ŒHttp Serverå†å°†è§„åˆ™æ³¨å†Œåˆ°Sentinelä¸­ã€‚</p><p>spring.cloud.sentinel.transport.portï¼šæŒ‡å®šä¸Sentinelæ§åˆ¶å°äº¤äº’çš„ç«¯å£ï¼Œåº”ç”¨æœ¬åœ°ä¼šå¯åŠ¨ä¸€ä¸ªå ç”¨è¯¥ç«¯å£çš„Http Server</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment">#é…ç½®Sentinel dashboardåœ°å€</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment">#é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
        
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-2-3-ä¸»å¯åŠ¨ç±»" tabindex="-1"><a class="header-anchor" href="#_3-2-3-ä¸»å¯åŠ¨ç±»" aria-hidden="true">#</a> 3.2.3 ä¸»å¯åŠ¨ç±»</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelMainApp8401</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SentinelMainApp8401</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-2-4-ä¸šåŠ¡ç±»" tabindex="-1"><a class="header-anchor" href="#_3-2-4-ä¸šåŠ¡ç±»" aria-hidden="true">#</a> 3.2.4 ä¸šåŠ¡ç±»</h6><p>æµé‡æ§åˆ¶controllerï¼šFlowLimitController</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testA&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;------testA&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testB&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;------testB&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-3-æµ‹è¯•" aria-hidden="true">#</a> 3.3 æµ‹è¯•</h5><p>å¯åŠ¨Sentinel8080 <code>java -jar sentinel-dashboard-1.8.2.jar</code>ã€å¯åŠ¨å¾®æœåŠ¡8401</p><p>æŸ¥çœ‹Sentinelæ§åˆ¶å°ï¼Œå‘ç°ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636167613578-84824ab7-cec7-45bb-8a89-52c3f3619098.png" alt="img"></p><p>åŸå› ï¼šSentinelé‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶</p><p>æ‰§è¡Œä¸€ä¸‹ï¼š<a href="http://localhost:8401/testA" target="_blank" rel="noopener noreferrer">http://localhost:8401/testA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636175140467-9975b3a8-255f-45da-89ff-791b5be271bb.png" alt="img"></p><p>sentinel8080æ­£åœ¨ç›‘æ§å¾®æœåŠ¡8401</p><h3 id="å››ã€æµæ§è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#å››ã€æµæ§è§„åˆ™" aria-hidden="true">#</a> å››ã€æµæ§è§„åˆ™</h3><p>æµé‡é™åˆ¶æ§åˆ¶è§„åˆ™ï¼Œåˆ†ä¸ºï¼šæµæ§æ¨¡å¼å’Œæµæ§æ•ˆæœ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636175547549-6c575fa5-1aef-405d-b939-a4d68029c825.png" alt="img"></p><p>å„é€‰é¡¹å«ä¹‰ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636175587333-c9adeac1-c4a0-48be-b5f8-b174b1a4051c.png" alt="img"></p><h5 id="_4-1-æµæ§æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_4-1-æµæ§æ¨¡å¼" aria-hidden="true">#</a> 4.1 æµæ§æ¨¡å¼</h5><p>æµæ§æ¨¡å¼æœ‰ä¸‰ç§ï¼šç›´æ¥ã€å…³è”ã€é“¾è·¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636176700047-5a4c8c69-02ef-4ab9-a2a1-2f118d4b814b.png" alt="img"></p><h6 id="_4-1-1-ç›´æ¥-é»˜è®¤-å¿«é€Ÿå¤±è´¥-é»˜è®¤" tabindex="-1"><a class="header-anchor" href="#_4-1-1-ç›´æ¥-é»˜è®¤-å¿«é€Ÿå¤±è´¥-é»˜è®¤" aria-hidden="true">#</a> 4.1.1 ç›´æ¥ï¼ˆé»˜è®¤ï¼‰+å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤ï¼‰</h6><p>######## (1) QPSç›´æ¥å¿«é€Ÿå¤±è´¥</p><p>QPSï¼šquery per secondï¼Œæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼Œå½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œé™æµã€‚</p><p>ä¸‹é¢è®¾ç½®è¡¨ç¤º1ç§’é’Ÿå†…æŸ¥è¯¢ä¸€æ¬¡å°±æ˜¯OKï¼Œè‹¥QPS&gt;1ï¼Œå°±ç›´æ¥-å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636176644611-c8d5c126-80b4-40ae-a6d2-fa3de2cd58e0.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636176782203-f7067740-667d-4eda-99df-8a6e1f9f9361.png" alt="img"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå½“/testAçš„è®¿é—®è¶…è¿‡1æ¬¡/sæ˜¯ï¼Œé¡µé¢æŠ¥é”™ã€‚è¢«Sentinelé™æµï¼Œè¿˜èƒ½ç»§ç»­è¯·æ±‚åªè¦QPS&lt;=1ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636177334549-a11fb3c2-1f91-4794-8e48-62b741305c6a.png" alt="img"></p><p>å°ç»“ï¼šè¡¨ç¤º1ç§’é’Ÿå†…è¯·æ±‚æ¬¡æ•°å¤§äº1ï¼Œå°±ç›´æ¥å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636177524780-585615e0-eae4-45d1-a9dc-b58088f0adf6.png" alt="img"></p><p>ç›´æ¥è°ƒç”¨é»˜è®¤çš„æŠ¥é”™ä¿¡æ¯åœ¨æŠ€æœ¯ä¸Šæ˜¯OKçš„ï¼Œä½†æ˜¯æ˜¯å¦åº”è¯¥æœ‰è‡ªå®šä¹‰çš„åç»­å¤„ç†ï¼Ÿåº”è¯¥æœ‰ç±»ä¼¼Hystrixçš„fallbackçš„å…œåº•æ–¹æ³•ã€‚</p><p>######## (2) çº¿ç¨‹æ•°ç›´æ¥å¿«é€Ÿå¤±è´¥</p><p>å½“è°ƒç”¨è¯¥apiçš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµã€‚</p><p>ä¸QPSç›´æ¥å¿«é€Ÿå¤±è´¥ä¸åŒçš„æ˜¯ï¼ŒQPSæƒ…å†µä¸‹é™åˆ¶çš„æ˜¯æµé‡ï¼Œæ¯”å¦‚é“¶è¡Œçš„äººæµé‡åªèƒ½æ˜¯1äºº/sï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡åªèƒ½ä¸€ä¸ªäººè¿›å…¥é“¶è¡ŒåŠç†ä¸šåŠ¡ï¼›è€Œçº¿ç¨‹æ•°å°±å¥½æ¯”é“¶è¡Œåªæœ‰ä¸€ä¸ªçª—å£å¼€æ”¾ï¼Œä¸€ç¾¤äººéƒ½å¯ä»¥è¿›å…¥é“¶è¡Œï¼Œä½†æ˜¯æ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªäººçš„ä¸šåŠ¡ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636178641049-10ce2a40-c119-496b-a555-f1d68ebf23cf.png" alt="img"></p><p>æ¼”ç¤ºæ•ˆæœï¼š</p><p>å…ˆä¿®æ”¹ä¸€ä¸‹8401çš„ä¸šåŠ¡ç±»</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636181621634-2a4740b7-24a3-47dc-be31-b41231bf546f.png" alt="img"></p><p>ç„¶åé‡å¯8401ï¼Œæµ‹è¯•/testAï¼Œæœ€å¥½ç”¨ä¸¤ä¸ªæµè§ˆå™¨è®¿é—®ï¼Œæ•ˆæœæ›´æ˜æ˜¾</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636182093947-e60d26d5-6444-48e2-9031-404b805c86b1.png" alt="img"></p><h6 id="_4-1-2-å…³è”" tabindex="-1"><a class="header-anchor" href="#_4-1-2-å…³è”" aria-hidden="true">#</a> 4.1.2 å…³è”</h6><p>å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ã€‚æ¯”å¦‚å½“ä¸Aå…³è”çš„èµ„æºBè¾¾åˆ°é˜ˆå€¼åï¼Œå°±é™æµAè‡ªå·±ã€‚</p><p>æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼ï¼Œé™æµä¸‹è®¢å•çš„æ¥å£ã€‚</p><p>######## 1. é…ç½®</p><p>è®¾ç½®æ•ˆæœï¼šå½“å…³è”èµ„æº/testBçš„qpsé˜€å€¼è¶…è¿‡1æ—¶ï¼Œå°±é™æµ/testAçš„Restè®¿é—®åœ°å€ï¼Œå½“å…³è”èµ„æºåˆ°é˜ˆå€¼åé™åˆ¶é…ç½®å¥½çš„èµ„æºå</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636185529204-c4973c0a-7ca9-4fe9-857c-ed28a602c17d.png" alt="img"></p><p>######## 2. æµ‹è¯•</p><p>å•ç‹¬è®¿é—®testBæˆåŠŸã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636185759699-dbad4fbb-7c9e-4e3f-9990-4a21f12f34ae.png" alt="img"></p><p>postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB</p><p>å…ˆåˆ›å»ºä¸€ä¸ªé›†åˆï¼Œåå­—è‡ªå·±éšä¾¿å–ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636186406791-1d909ef7-5650-4260-b198-56ad5bd4adef.png" alt="img"></p><p>ç„¶åå°†åˆ›å»ºçš„è®¿é—®/testBçš„è¯·æ±‚ä¿å­˜åœ¨åˆ›å»ºçš„é›†åˆä¸­</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636186397189-6b78e38a-d267-4eb1-9090-f62e50bb003e.png" alt="img"></p><p>è®¾å®šé›†åˆè¿è¡Œå‚æ•°ï¼Œ20ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡é—´éš”0.3sè®¿é—®ä¸€æ¬¡ï¼ˆQPS&gt;1ï¼‰ï¼Œæ‰§è¡Œï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636186554384-4d416f2c-da41-4642-b726-f4852ebb648c.png" alt="img"></p><p>ç„¶åå†è®¿é—®/testAï¼Œå‘ç°è¢«é™æµï¼Œç­‰postmanæ‰§è¡Œå®Œæ¯•ï¼ŒtestAåˆå¯ä»¥è®¿é—®äº†</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636186747122-a0428fb4-34f8-4336-a04b-784b3eb9cb9f.png" alt="img"></p><h6 id="_4-1-3-é“¾è·¯" tabindex="-1"><a class="header-anchor" href="#_4-1-3-é“¾è·¯" aria-hidden="true">#</a> 4.1.3 é“¾è·¯</h6><p>éœ€è¦æµ‹è¯•é“¾è·¯çš„è¯ï¼Œspringcloud é˜¿é‡Œå·´å·´ç‰ˆæœ¬éœ€è¦2.1.1.RELEASEä»¥ä¸Šï¼Œåœ¨çˆ¶å·¥ç¨‹çš„pomä¸­ä¿®æ”¹ï¼Œä¸è¦ç›´æ¥åœ¨å­moduleçš„pomä¸­ä¿®æ”¹ï¼Œç‰ˆæœ¬æœ‰å¯¹åº”å…³ç³»ï¼Œä¸ç„¶æŠ¥é”™ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636198092134-626f793b-2f04-47ae-a4df-5f771fadd13a.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636198752208-50584f8f-ed1b-4a84-910e-7dfed9a0d1f4.png" alt="img"></p><ul><li>Sentinelä»1.6.3ç‰ˆæœ¬å¼€å§‹ï¼ŒSentinel Web Filter é»˜è®¤æ”¶æ•›æ‰€æœ‰çš„URLå…¥å£çš„Contextï¼Œå› æ­¤é“¾è·¯é™æµä¸ç”Ÿæ•ˆ</li><li>1.7.0ç‰ˆæœ¬å¼€å§‹ï¼Œå®˜æ–¹åœ¨CommomFilterä¸­å¼•å…¥äº†<code>WEB_CONTEXT_UNIFY</code>è¿™ä¸ªinit parameterï¼Œç”¨äºæ§åˆ¶æ˜¯å¦æ”¶æ•›contextï¼Œå°†å…¶é…ç½®ä¸º<code>false</code>å³å¯æ ¹æ®ä¸åŒçš„URLè¿›è¡Œé“¾è·¯é™æµ</li><li>Spring Cloud Alibaba åœ¨2.1.1.RELEASEç‰ˆæœ¬åï¼Œå¯ä»¥é€šè¿‡é…ç½®spring.cloud.sentinel.web-context-unify=falseå…³é—­</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636198422479-133556df-4fbf-4a93-841a-6399ebe4142b.png" alt="img"></p><p><a href="https://github.com/alibaba/Sentinel/issues/1313" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Sentinel/issues/1313<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>######## æµ‹è¯•</p><p>å¯åŠ¨8401ï¼Œç»™/testAè®¾ç½®é“¾è·¯+å¿«é€Ÿå¤±è´¥æµæ§è§„åˆ™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636198858162-237cfa39-c6b3-4d95-8211-c73c44e4ad49.png" alt="img"></p><p>è¿™é‡Œå…¥å£èµ„æºå°±æ˜¯ç°‡ç‚¹é“¾è·¯ä¸­ï¼Œèµ„æºåç§°çš„ä¸Šä¸€çº§ã€‚</p><p>è®¿é—®<a href="http://localhost:8401/linktestA" target="_blank" rel="noopener noreferrer">http://localhost:8401/linktestA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼Œå¤šæ¬¡åˆ·æ–°å‡ºç°é™æµ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636201194747-227fde3b-a8a4-4935-b5a5-3556bc1a6008.png" alt="img">ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæˆ‘ä¸ªäººè§‰å¾—è·Ÿç›´æ¥å¿«é€Ÿå¤±è´¥åŒºåˆ«ä¸å¤§ï¼Œåªç›´æ¥æ˜¯ç›‘æ§/testAèµ„æºï¼Œè€Œé“¾è·¯æ˜¯ç›‘æ§/testAçš„èµ„æºå…¥å£sentinel_web_servlet_contextã€‚</p><p>ç„¶åæˆ‘åˆå‚çœ‹äº†å…¶ä»–åšå®¢ï¼Œ<a href="https://blog.csdn.net/qq_29064815/article/details/107102060?utm_term=sentinel%E6%B5%81%E6%8E%A7%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%93%BE%E8%B7%AF&amp;utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-0-107102060&amp;spm=3001.4430" target="_blank" rel="noopener noreferrer">æµæ§æ¨¡å¼â€”â€”é“¾è·¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚å¢åŠ äº†FlowLimitService ä¿®æ”¹äº†controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">FlowLimitService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">FlowLimitService</span> flowLimitService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testA&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æš‚åœ0.8ç§’</span>
<span class="token comment">//        try {</span>
<span class="token comment">//            TimeUnit.MILLISECONDS.sleep(800);</span>
<span class="token comment">//        } catch (InterruptedException e) {</span>
<span class="token comment">//            e.printStackTrace();</span>
<span class="token comment">//        }</span>

        <span class="token keyword">return</span> <span class="token string">&quot;------testA&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testB&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;------testB&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
    <span class="token comment">//   é“¾è·¯æµ‹è¯•</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/linktestA&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">linktestA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> flowLimitService<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/linktestB&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">linktestB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> flowLimitService<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†åˆ«é€šè¿‡/linktetA å’Œ /linktestBéƒ½æ˜¯messageçš„å…¥å£ï¼Œç„¶åè®¾ç½®/linktestAå…¥å£çš„æµé‡é™åˆ¶ï¼Œå‘ç°ä¸èµ·ä½œç”¨ã€‚ã€‚ã€‚</p><h5 id="_4-2-æµæ§æ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#_4-2-æµæ§æ•ˆæœ" aria-hidden="true">#</a> 4.2 æµæ§æ•ˆæœ</h5><p><strong>å¿«é€Ÿå¤±è´¥</strong>åœ¨ä¸Šé¢çš„æµæ§æ¨¡å¼æ¼”ç¤ºè¿‡äº†ï¼Œä»–æ˜¯é»˜è®¤çš„æµæ§æ•ˆæœï¼Œç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚æºç ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController</p><h6 id="_4-2-1-warm-up-é¢„çƒ­" tabindex="-1"><a class="header-anchor" href="#_4-2-1-warm-up-é¢„çƒ­" aria-hidden="true">#</a> 4.2.1 warm up é¢„çƒ­</h6><p><a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æºç ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController</p><p>å…¬å¼ï¼šé˜ˆå€¼é™¤ä»¥coldFactor(é»˜è®¤å€¼ä¸º3),ç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜ˆå€¼</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636204182838-32d2e249-f24f-4837-a0f0-3c4be43a5b8c.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636204711029-22aea67e-cc6b-4cfd-994c-dd51bb5fd0b6.png" alt="img"></p><p>######## æµ‹è¯•</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636204985038-e380529f-cc06-4fd7-9d61-ca191748bf9c.png" alt="img"></p><p>ç‹‚ç‚¹è¯·æ±‚ï¼Œå¯ä»¥çœ‹é€šè¿‡çš„QPSé€æ¸å¢åŠ ï¼Œæœ€å¼€å§‹ä¼šæŠ¥é”™é™æµï¼Œä¹‹åå°±å¯ä»¥æŠ—ä½10/sçš„QPSäº†</p><p>åº”ç”¨åœºæ™¯ï¼šç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼ã€‚</p><h6 id="_4-2-2-æ’é˜Ÿç­‰å¾…" tabindex="-1"><a class="header-anchor" href="#_4-2-2-æ’é˜Ÿç­‰å¾…" aria-hidden="true">#</a> 4.2.2 æ’é˜Ÿç­‰å¾…</h6><p><a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æºç ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.RateLimiterController</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636205316214-62574c1a-6bb6-47d6-915f-b02211bf4281.png" alt="img"></p><p>åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆQPSï¼Œå¦åˆ™æ— æ•ˆã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636205407842-08de7a67-8015-421a-9181-e3fa123cf8be.png" alt="img"></p><p>/testAçš„QPSæœ€å¤§ä¸º1ï¼Œè¶…è¿‡çš„è¯å°±æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…çš„è¶…æ—¶æ—¶é—´ä¸º20000msã€‚</p><p>ä¿®æ”¹ä¸€ä¸‹ä¸šåŠ¡ä»£ç ï¼ŒæŠŠçº¿ç¨‹åæ‰“å°å‡ºæ¥ä»¥éªŒè¯æ˜¯å¦æ’é˜Ÿã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636205738814-e13e3122-ad11-4423-8152-b4bbc6e88744.png" alt="img"></p><p>######## æµ‹è¯•</p><p>postmanï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636205861798-1d6022d2-1cfc-4e83-a31f-9b05bcc6f293.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636206130850-dd47f017-0e97-4fbc-b825-b9e5ea590c12.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°åˆšå¥½æ»¡è¶³1sä¸€ä¸ªè¯·æ±‚ï¼Œè¯´æ˜è¯·æ±‚çš„æ‰§è¡Œè¿›è¡Œäº†æ’é˜Ÿã€‚</p><h3 id="äº”ã€é™çº§è§„åˆ™-ç†”æ–­è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#äº”ã€é™çº§è§„åˆ™-ç†”æ–­è§„åˆ™" aria-hidden="true">#</a> äº”ã€é™çº§è§„åˆ™ï¼ˆç†”æ–­è§„åˆ™ï¼‰</h3><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è€ç‰ˆæœ¬çš„Sentinelçš„æ–­è·¯å™¨æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼ŒåŠå¼€çš„çŠ¶æ€ç³»ç»Ÿè‡ªåŠ¨å»æ£€æµ‹æ˜¯å¦è¯·æ±‚æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸å°±å…³é—­æ–­è·¯å™¨æ¢å¤ä½¿ç”¨ï¼Œæœ‰å¼‚å¸¸åˆ™ç»§ç»­æ‰“å¼€æ–­è·¯å™¨ä¸å¯ç”¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒHystrixã€‚ï¼ˆåœ¨Hystrixä¸­ å¿«ç…§æ—¶é—´çª—å£æ˜¯å€¼ é˜ˆå€¼æ£€æµ‹æ—¶é—´ ï¼Œè€Œä¼‘çœ æ—¶é—´çª—å£æ˜¯æŒ‡ æ–­è·¯å™¨ä»å¼€å¯åˆ°åŠå¼€çŠ¶æ€é—´éš”çš„æ—¶é—´ï¼‰</p><p><strong>æ–°ç‰ˆæœ¬çš„SentinelåŠ å…¥äº†åŠå¼€çŠ¶æ€</strong>ï¼</p><h5 id="_5-1-é™çº§ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-1-é™çº§ç­–ç•¥" aria-hidden="true">#</a> 5.1 é™çº§ç­–ç•¥</h5><p>Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚</p><p>å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636207003638-9f6107f8-025c-47c5-89d5-d59a24051703.png" alt="img"></p><h6 id="_5-1-1-æ…¢è°ƒç”¨æ¯”ä¾‹-rt-å¹³å‡å“åº”æ—¶é—´-ç§’çº§" tabindex="-1"><a class="header-anchor" href="#_5-1-1-æ…¢è°ƒç”¨æ¯”ä¾‹-rt-å¹³å‡å“åº”æ—¶é—´-ç§’çº§" aria-hidden="true">#</a> 5.1.1 æ…¢è°ƒç”¨æ¯”ä¾‹ï¼ŒRTï¼ˆå¹³å‡å“åº”æ—¶é—´ï¼Œç§’çº§ï¼‰</h6><p>è€ç‰ˆæœ¬ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378468415-d870b7ac-5a40-47c1-b6ca-13ae193bd2b4.png" alt="img"></p><p>æ–°ç‰ˆæœ¬ï¼š</p><ul><li>æ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO)ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œ<strong>å¹¶ä¸”</strong>æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚ï¼ˆè·Ÿè±ªçŒªç§‘ç±»ä¼¼ï¼‰</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636207429643-4edd50c3-d110-4666-ad70-831e744bbfb9.png" alt="img"></p><p>######## å®æˆ˜æµ‹è¯•</p><p><strong>ä¸šåŠ¡ç±»ä¸­åŠ ä¸€ä¸ªrest æ¥å£ï¼Œä»¥ç”¨äºæµ‹è¯•ï¼š</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testD&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æš‚åœ1ç§’</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;testD  æµ‹è¯•æ…¢è°ƒç”¨æ¯”ä¾‹ RT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------tedtD&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636266326957-7c5e050b-cf3b-41b9-9d5f-25708ff0a496.png" alt="img"> è®¿é—®æ²¡æœ‰é—®é¢˜</p><p><strong>ç¼–è¾‘ç†”æ–­è§„åˆ™ï¼š</strong></p><p>åœ¨1000msçš„ç»Ÿè®¡æ—¶é—´å†…ï¼Œæ€»è¯·æ±‚æ•°ï¼ˆè¶…è¿‡5æ¬¡ï¼‰ä¸­æœ‰80%çš„è¯·æ±‚æœ€å¤§RTè¶…è¿‡äº†200msï¼Œé‚£ä¹ˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼Œç†”æ–­2sã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636265807427-1198f086-d189-442c-975d-e971611c0e16.png" alt="img"></p><p><strong>jmeterå‹æµ‹ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636266473500-f055ba07-c8ca-48cf-86da-9333b7f55128.png" alt="img"></p><p>æ°¸è¿œä¸€ç§’é’Ÿæ‰“è¿›æ¥10ä¸ªçº¿ç¨‹ï¼ˆå¤§äº5ä¸ªäº†ï¼‰è°ƒç”¨testDï¼Œæˆ‘ä»¬å¸Œæœ›200æ¯«ç§’å¤„ç†å®Œæœ¬æ¬¡ä»»åŠ¡ï¼Œå¦‚æœè¶…è¿‡200æ¯«ç§’è¿˜æ²¡å¤„ç†å®Œï¼Œåœ¨æœªæ¥sç§’é’Ÿçš„æ—¶é—´å†…ï¼Œæ–­è·¯å™¨æ‰“å¼€(ä¿é™©ä¸è·³é—¸)å¾®æœåŠ¡ä¸å¯ç”¨ï¼Œä¿é™©ä¸è·³é—¸æ–­ç”µäº†ã€‚</p><p>testDè¢«ç†”æ–­äº†</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636266522552-1fe03a0c-6140-4994-9717-6e42c25f60e9.png" alt="img"></p><p>ä»å®æ—¶ç›‘æ§ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåœ¨09çš„æ—¶å€™å¼€å§‹ç†”æ–­ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636266606192-df29ca4b-f481-40da-af03-be7b19566893.png" alt="img"></p><p>åç»­æˆ‘åœæ­¢jmeterï¼Œæ²¡æœ‰è¿™ä¹ˆå¤§çš„è®¿é—®é‡äº†ï¼Œæ–­è·¯å™¨åŠå¼€åˆ°å…³é—­(ä¿é™©ä¸æ¢å¤)ï¼Œå¾®æœåŠ¡æ¢å¤OKã€‚</p><h6 id="_5-1-2-å¼‚å¸¸æ¯”ä¾‹" tabindex="-1"><a class="header-anchor" href="#_5-1-2-å¼‚å¸¸æ¯”ä¾‹" aria-hidden="true">#</a> 5.1.2 å¼‚å¸¸æ¯”ä¾‹</h6><p>è€ç‰ˆæœ¬ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378442709-b1dd34e0-96d1-4be1-bbfd-26f9986b2a07.png" alt="img"></p><p>æ–°ç‰ˆæœ¬ï¼š</p><ul><li>å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636207879946-e9294f3f-9dff-469f-9ff9-29fe9298f491.png" alt="img"></p><p>######## å®æˆ˜æµ‹è¯•</p><p><strong>ä¿®æ”¹ä¸šåŠ¡ç±»ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636267293236-37a974f2-db79-4a0d-99e2-18aa1f0141c9.png" alt="img"></p><p><strong>ç¼–è¾‘ç†”æ–­è§„åˆ™ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636267653333-5d7543f3-6415-46f0-aa37-5e7438583c52.png" alt="img"></p><p>1000msç»Ÿè®¡æ—¶é•¿å†…ï¼Œå¤§äº5æ¬¡çš„è¯·æ±‚ä¸­è¶…è¿‡80%çš„è¯·æ±‚å‡ºç°å¼‚å¸¸ï¼Œåˆ™ç†”æ–­2sã€‚</p><p><strong>jmeterå‹æµ‹ï¼š</strong></p><p>å•ç‹¬è®¿é—®ä¸€æ¬¡ï¼Œå¿…ç„¶æ¥ä¸€æ¬¡æŠ¥é”™ä¸€æ¬¡(int age = 10/0)ï¼Œè°ƒä¸€æ¬¡é”™ä¸€æ¬¡ï¼›å¼€å¯jmeteråï¼Œç›´æ¥é«˜å¹¶å‘å‘é€è¯·æ±‚ï¼Œå¤šæ¬¡è°ƒç”¨è¾¾åˆ°æˆ‘ä»¬çš„é…ç½®æ¡ä»¶äº†ã€‚æ–­è·¯å™¨å¼€å¯(ä¿é™©ä¸è·³é—¸)ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼Œä¸å†æŠ¥é”™errorè€Œæ˜¯æœåŠ¡é™çº§äº†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636268158534-04e8bef7-faae-4252-b62d-4b6a99268aff.png" alt="img">testDè¢«ç†”æ–­ã€‚</p><p>åœæ‰jemeteråè¿‡2sã€‚æŠ¥/zeroé”™è¯¯ï¼Œå› ä¸ºä¸šåŠ¡ç±»ä¸­æœ‰ä¸ª10/0ã€‚</p><h6 id="_5-1-3-å¼‚å¸¸æ•°" tabindex="-1"><a class="header-anchor" href="#_5-1-3-å¼‚å¸¸æ•°" aria-hidden="true">#</a> 5.1.3 å¼‚å¸¸æ•°</h6><p>è€ç‰ˆæœ¬ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378394872-1cfc747b-422a-4df5-a551-e21137e49095.png" alt="img"></p><p>æ—¶é—´çª—å£ä¸€å®šè¦å¤§äºç­‰äº60ç§’ã€‚</p><p>æ–°ç‰ˆæœ¬</p><ul><li>å¼‚å¸¸æ•° (ERROR_COUNT)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636207898160-37b7b016-4d79-4b44-a455-a072fae85cf2.png" alt="img"></p><p>######## å®æˆ˜æµ‹è¯•</p><p><strong>ä¿®æ”¹ä¸šåŠ¡ç±»ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636268914525-f0a66727-3263-4f54-8dca-7a94f8a4f812.png" alt="img"></p><p><strong>ç¼–è¾‘ç†”æ–­è§„åˆ™ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636268891084-07a17150-d76a-46b3-a166-71240d074b60.png" alt="img"></p><p><strong>æ‰‹åŠ¨æµ‹è¯•ï¼š</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636269346017-b329de29-198b-436c-9975-4135956f2d29.png" alt="img"></p><p>è¿™é‡Œæˆ‘æµ‹è¯•æœ‰bugï¼Œè™½ç„¶ç†”æ–­äº†ä½†æ˜¯ç†”æ–­æ—¶é•¿ä¸æ˜¯æˆ‘é…ç½®çš„5sï¼Œå¤§çº¦æ˜¯ä¸€åˆ†é’Ÿï¼Œç»Ÿè®¡æ—¶é•¿ä¹Ÿä¸æ˜¯1sï¼Œå¥½åƒä¹Ÿæ˜¯ä¸€åˆ†é’Ÿï¼ŒåŒæ—¶æ²¡è¾¾åˆ°æœ€å°è¯·æ±‚æ•°ï¼Œåªè¾¾åˆ°3æ¬¡å¼‚å¸¸å°±ç›´æ¥ç†”æ–­äº†ã€‚è™½ç„¶æˆ‘ç”¨çš„æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯é€»è¾‘å¥½åƒè·Ÿè€ç‰ˆæœ¬çš„ä¸€æ ·ï¼Ÿ</p><h3 id="å…­ã€çƒ­ç‚¹keyé™æµ" tabindex="-1"><a class="header-anchor" href="#å…­ã€çƒ­ç‚¹keyé™æµ" aria-hidden="true">#</a> å…­ã€çƒ­ç‚¹keyé™æµ</h3><h5 id="_6-1-åŸºæœ¬ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_6-1-åŸºæœ¬ä»‹ç»" aria-hidden="true">#</a> 6.1 åŸºæœ¬ä»‹ç»</h5><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä½•ä¸ºçƒ­ç‚¹ï¼šçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æˆ–è€…é™åˆ¶æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„TopNæ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™æµæˆ–è€…å…¶å®ƒæ“ä½œã€‚æ¯”å¦‚ï¼š</p><ul><li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>çƒ­ç‚¹å‚æ•°é™åˆ¶ä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™åˆ¶ã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636271319999-dd06109b-159d-417c-ab3a-8ff219009af4.png" alt="img"></p><p>Sentinelåˆ©ç”¨LRUç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç”µå‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚</p><h5 id="_6-2-åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_6-2-åŸºæœ¬ä½¿ç”¨" aria-hidden="true">#</a> 6.2 åŸºæœ¬ä½¿ç”¨</h5><p>å…œåº•é˜²èŒƒåˆ†ä¸ºç³»ç»Ÿé»˜è®¤å’Œå®¢æˆ·è‡ªå®šä¹‰ï¼›ä¸¤ç§ï¼Œæ ¹æ®ä¹‹å‰çš„caseï¼Œéƒ½æ˜¯ä½¿ç”¨sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting)ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½è‡ªå®šä¹‰å…œåº•æ–¹æ³•å‘¢ï¼Ÿç±»ä¼¼hystrixï¼ŒæŸä¸ªæ–¹æ³•å‡ºé—®é¢˜äº†ï¼Œå°±æ‰¾å¯¹åº”çš„å…œåº•é™çº§æ–¹æ³•ï¼Ÿ</p><p>ç±»ä¼¼äº**@HystrixCommandï¼Œ** å¼•å…¥**@SentinelResource**æ³¨è§£ã€‚</p><p>çƒ­ç‚¹è§„åˆ™å…±æœ‰èµ„æºåã€é™æµæ¨¡å¼ï¼ˆåªæ”¯æŒQPSæ¨¡å¼ï¼‰ã€å‚æ•°ç´¢å¼•ã€å•æœºé˜ˆå€¼ã€ç»Ÿè®¡çª—å£æ—¶é•¿ã€æ˜¯å¦é›†ç¾¤6ç§å‚æ•°ï¼Œè¿˜æœ‰ä¸€äº›é«˜çº§é€‰é¡¹ï¼Œç”¨åˆ°æ—¶ä¼šè¯¦ç»†ä»‹ç»ã€‚è¿™é‡Œä¼šç”¨åˆ°æ³¨è§£ä¸­çš„valueä½œä¸ºèµ„æºåï¼Œå…œåº•æ–¹æ³•ä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»<a href="##HQt8b">@SentinelResourceæ³¨è§£è¯¦è§£</a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636426167642-e877c00d-bcc0-4fdf-9b3d-a67bb51fd640.png" alt="img"></p><p>æ³¨æ„ï¼š</p><p><strong>èµ„æºå</strong>ï¼š**å”¯ä¸€è·¯å¾„ï¼Œé»˜è®¤ä¸ºè¯·æ±‚è·¯å¾„ã€‚**æ­¤å¤„å¿…é¡»æ˜¯ @SentinelResource æ³¨è§£çš„ value å±æ€§å€¼ï¼Œé…ç½®@GetMapping çš„è¯·æ±‚è·¯å¾„æ— æ•ˆï¼‰</p><h6 id="_6-2-1-æµ‹è¯•æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_6-2-1-æµ‹è¯•æ–¹æ³•" aria-hidden="true">#</a> 6.2.1 æµ‹è¯•æ–¹æ³•</h6><p>è¿˜æ˜¯åœ¨8401çš„controllerä¸­ï¼ŒåŠ å…¥çƒ­ç‚¹æµ‹è¯•æ–¹æ³•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;del_testHotKey&quot;</span><span class="token punctuation">)</span>   <span class="token comment">//è¿™é‡Œçš„åç§°å¯ä»¥éšä¾¿å†™ï¼Œä½†æ˜¯ä¸€èˆ¬è·Ÿreståœ°å€ä¸€æ ·</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testHotkey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p1<span class="token punctuation">,</span>
                         <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;------testHotkey&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å…œåº•æ–¹æ³•ï¼ŒBlockExceptionä¸è¦æ‰“æˆäº†BlockedException</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">del_testHotKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">,</span> <span class="token class-name">String</span> p2<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;è¿™æ¬¡ä¸ç”¨é»˜è®¤çš„å…œåº•æç¤ºBlocked by Sentinel(flow limiting)ï¼Œè‡ªå®šä¹‰æç¤ºï¼šdel_testHotKeyo(â•¥ï¹â•¥)o...&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨è§£@SentinelResource(value = &quot;testHotKey&quot;, blockHandler = &quot;del_testHotKey&quot;)</p><p><strong>åˆ†æï¼š</strong></p><ul><li>å…¶ä¸­ value = &quot;testHotKey&quot; æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼ˆSentinelèµ„æºåï¼‰ï¼Œä¸restçš„<code>/testHotKey</code>å¯¹åº”ï¼Œè¿™é‡Œvalueçš„å€¼å¯ä»¥ä»»æ„å†™ï¼Œä½†æ˜¯æˆ‘ä»¬çº¦å®šä¸reståœ°å€ä¸€è‡´ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯æ²¡æœ‰<code>/</code>ã€‚</li><li>blockHandler = &quot;del_testHotKey&quot; åˆ™è¡¨ç¤ºå¦‚æœè¿èƒŒäº†Sentinelä¸­é…ç½®çš„æµæ§è§„åˆ™ï¼Œå°±ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå·±çš„å…œåº•æ–¹æ³•del_testHotKey</li></ul><h6 id="_6-2-2-é…ç½®çƒ­ç‚¹keyé™æµè§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_6-2-2-é…ç½®çƒ­ç‚¹keyé™æµè§„åˆ™" aria-hidden="true">#</a> 6.2.2 é…ç½®çƒ­ç‚¹keyé™æµè§„åˆ™</h6><p>ç»‘å®štestHotKeyèµ„æºï¼ŒæŠŠtestHotKeyå¯¹åº”çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºçƒ­ç‚¹keyè¿›è¡Œç›‘æ§ã€‚è®¾å®šçƒ­ç‚¹é™æµè§„åˆ™ï¼šå½“è¯¥èµ„æºçš„è®¿é—®QPSè¶…è¿‡1æ¬¡/sçš„æ—¶å€™ï¼Œäº§ç”Ÿé™æµå¹¶æ‰§è¡Œè‡ªå®šä¹‰çš„del_testHotKeyå…œåº•æ–¹æ³•ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼šæ–¹æ³•testHotKeyé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦QPSè¶…è¿‡æ¯ç§’1æ¬¡ï¼Œé©¬ä¸Šé™çº§å¤„ç†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636425843025-86f932d2-ce64-4c9a-baa1-b67ed8db5eec.png" alt="img"></p><h6 id="_6-2-3-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_6-2-3-æµ‹è¯•" aria-hidden="true">#</a> 6.2.3 æµ‹è¯•</h6><ol><li>è®¿é—®<a href="http://localhost:8401/testHotKey?p1=a&amp;p2=b" target="_blank" rel="noopener noreferrer">http://localhost:8401/testHotKey?p1=a&amp;p2=b<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><p>1æ¬¡/sæ­£å¸¸æ˜¾ç¤ºï¼Œè¿…é€Ÿç‚¹å‡»ä¸¤æ¬¡ï¼Œè§¦å‘çƒ­ç‚¹é™æµï¼Œæ‰§è¡Œè‡ªå®šä¹‰å…œåº•æ–¹æ³•ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636275834807-7920316a-2d72-40fd-a595-60140e381d43.png" alt="img"></p><ol><li>ä»…ä¼ å…¥å‚æ•°p2æ²¡æœ‰ä»»ä½•å½±å“ï¼š <a href="http://localhost:8401/testHotKey?p2=b" target="_blank" rel="noopener noreferrer">http://localhost:8401/testHotKey?p2=b<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636275869802-3bdd8cb1-e801-45df-9953-c5a5969e1c5f.png" alt="img"></p><ol><li>ç°åœ¨å¼€ä¸¤ä¸ªè®¿é—®ï¼Œä¸€ä¸ªé€šè¿‡jmeterå‹æµ‹<a href="http://localhost:8401/testHotKey?p1=a&amp;p2=b%EF%BC%8C%E5%8F%A6%E5%A4%96%E5%86%8D%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhttp://localhost:8401/testHotKey?p2=b%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%8F%AA%E5%B8%A6%E5%8F%82%E6%95%B0p2%E8%AE%BF%E9%97%AE%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E5%BD%B1%E5%93%8D%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:8401/testHotKey?p1=a&amp;p2=bï¼Œå¦å¤–å†å•ç‹¬ä½¿ç”¨æµè§ˆå™¨è®¿é—®http://localhost:8401/testHotKey?p2=bï¼Œå‘ç°åªå¸¦å‚æ•°p2è®¿é—®æ²¡æœ‰ä»»ä½•å½±å“ã€‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636276162514-571b00d8-1487-4190-9988-2a8c0e648b13.png" alt="img"></p><ol><li>ä¸é…ç½®blockeHandlerï¼ˆå…œåº•æ–¹æ³•ï¼‰</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636276470239-1a76b8b7-d7bb-4aa3-8fea-0d0634e9c479.png" alt="img"></p><p>è§¦å‘çƒ­ç‚¹é™æµé™çº§ä¼šå‡ºç°error pageï¼Œå¯¹ç”¨æˆ·ä¸å‹å¥½ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636276517119-596fd456-81dc-4164-9c2b-5b8f6a8404bc.png" alt="img"></p><h5 id="_6-3-å‚æ•°ä¾‹å¤–é¡¹" tabindex="-1"><a class="header-anchor" href="#_6-3-å‚æ•°ä¾‹å¤–é¡¹" aria-hidden="true">#</a> 6.3 å‚æ•°ä¾‹å¤–é¡¹</h5><p>ä¸Šè¿°æ¡ˆä¾‹æ¼”ç¤ºäº†ç¬¬ä¸€ä¸ªå‚æ•°p1ï¼Œå½“QPSè¶…è¿‡1ç§’1æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµ</p><p>ç‰¹ä¾‹æƒ…å†µï¼šæˆ‘ä»¬æœŸæœ›p1å‚æ•°å½“å®ƒæ˜¯æŸä¸ªç‰¹æ®Šå€¼æ—¶ï¼Œå®ƒçš„é™æµå€¼å’Œå¹³æ—¶ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å½“p1çš„å€¼ç­‰äº5æ—¶ï¼Œå®ƒçš„é˜ˆå€¼å¯ä»¥è¾¾åˆ°200ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636276820213-7a189398-d408-4696-9175-bddfbf2345a1.png" alt="img"></p><p>æµ‹è¯•</p><p>ç‹‚ç‚¹<a href="http://localhost:8401/testHotKey?p1=5&amp;p2=b" target="_blank" rel="noopener noreferrer">http://localhost:8401/testHotKey?p1=5&amp;p2=b<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ²¡æœ‰é™æµ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636283340923-8390dc9b-5578-4b43-950f-38c18929da74.png" alt="img"></p><h5 id="_6-4-å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#_6-4-å…¶ä»–" aria-hidden="true">#</a> 6.4 å…¶ä»–</h5><p>æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªå¼‚å¸¸ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636283487769-27477123-c4db-4bb0-870d-86d588b5a972.png" alt="img"></p><p>æµ‹è¯•ç›´æ¥é”™è¯¯é¡µé¢ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636283506208-a3983356-e6a2-44b4-85d5-f76bd33b08e3.png" alt="img"></p><p>è¦æ³¨æ„ï¼š Sentinelå®ƒåªç®¡ä½ æœ‰æ²¡æœ‰è§¦å‘å®ƒçš„é™æµè§„åˆ™ï¼Œä¹Ÿå¯ä»¥è¯´åªç®¡è¿™ä¸ªwebäº¤äº’é¡µé¢ï¼ˆæ§åˆ¶å°ï¼‰é‡Œé¢çš„ä¸œè¥¿ã€‚ é…ç½®ç±»çš„ä¸œè¥¿Sentinelå¯ä»¥ç®¡ï¼Œjavaå¼‚å¸¸çš„é”™è¯¯æˆ‘ä¸ç®¡ã€‚</p><p><strong>@SentinelResource</strong></p><p>å¤„ç†çš„æ˜¯Sentinelæ§åˆ¶å°é…ç½®çš„è¿è§„æƒ…å†µï¼Œæœ‰blockHandleræ–¹æ³•é…ç½®çš„å…œåº•å¤„ç†ï¼›</p><p>RuntimeException</p><p>int age = 10/0,è¿™ä¸ªæ˜¯javaè¿è¡Œæ—¶æŠ¥å‡ºçš„è¿è¡Œæ—¶å¼‚å¸¸RunTimeExceptionï¼Œ@SentinelResourceä¸ç®¡</p><p><strong>æ€»ç»“ï¼š</strong></p><p>@SentinelResourceä¸»ç®¡é…ç½®å‡ºé”™ï¼Œè¿è¡Œå‡ºé”™è¯¥èµ°å¼‚å¸¸èµ°å¼‚å¸¸</p><h3 id="ä¸ƒã€ç³»ç»Ÿè§„åˆ™-ç³»ç»Ÿè‡ªé€‚åº”é™æµ" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ç³»ç»Ÿè§„åˆ™-ç³»ç»Ÿè‡ªé€‚åº”é™æµ" aria-hidden="true">#</a> ä¸ƒã€ç³»ç»Ÿè§„åˆ™ï¼ˆç³»ç»Ÿè‡ªé€‚åº”é™æµï¼‰</h3><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä»æ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p><p>ç³»ç»Ÿä¿æŠ¤è§„åˆ™æ˜¯åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œå¹¶ä¸”<strong>ä»…å¯¹å…¥å£æµé‡ç”Ÿæ•ˆ</strong>ã€‚å…¥å£æµé‡æŒ‡çš„æ˜¯è¿›å…¥åº”ç”¨çš„æµé‡ï¼ˆ<a href="http://EntryType.IN" target="_blank" rel="noopener noreferrer">EntryType.IN<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œæ¯”å¦‚ Web æœåŠ¡æˆ– Dubbo æœåŠ¡ç«¯æ¥æ”¶çš„è¯·æ±‚ï¼Œéƒ½å±äºå…¥å£æµé‡ã€‚</p><p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p><ul><li><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps * minRt ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores * 2.5ã€‚</li><li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li><li><strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li></ul><h5 id="æ¡ˆä¾‹â€”â€”é…ç½®å…¨å±€qps" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹â€”â€”é…ç½®å…¨å±€qps" aria-hidden="true">#</a> æ¡ˆä¾‹â€”â€”é…ç½®å…¨å±€QPS</h5><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636283979732-9ec624d5-b538-4e97-b131-800c32624945.png" alt="img"></p><p>ä¸ç®¡æ˜¯/testAè¿˜æ˜¯/testB åªè¦QPS &gt; 1 æ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½ç”¨ã€‚</p><p>è¿™ä¸ªç²’åº¦å¤ªç²—ï¼Œå°±ç›¸å½“äºä¸€ä¸ªçª—å£äººå¾ˆå¤šï¼Œæ•´ä¸ªé“¶è¡Œå°±ä¸æ¥å¾…äººäº†ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨ã€‚</p><h3 id="å…«ã€-sentinelresource-æ³¨è§£è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#å…«ã€-sentinelresource-æ³¨è§£è¯¦è§£" aria-hidden="true">#</a> å…«ã€@SentinelResource æ³¨è§£è¯¦è§£</h3><h5 id="_8-1-æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_8-1-æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†" aria-hidden="true">#</a> 8.1 æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†</h5><p>å¯åŠ¨nacos+sentinel</p><h6 id="_8-1-1-ä¿®æ”¹8401" tabindex="-1"><a class="header-anchor" href="#_8-1-1-ä¿®æ”¹8401" aria-hidden="true">#</a> 8.1.1 ä¿®æ”¹8401</h6><h6 id="_1-pom" tabindex="-1"><a class="header-anchor" href="#_1-pom" aria-hidden="true">#</a> (1) pom</h6><p>å¼•å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„å…¬å…±api jaråŒ…</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-ä¸šåŠ¡ç±»" tabindex="-1"><a class="header-anchor" href="#_2-ä¸šåŠ¡ç±»" aria-hidden="true">#</a> (2) ä¸šåŠ¡ç±»</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/byResource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byResource&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;handleException&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span> <span class="token string">&quot;serial001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 8.1.2 é…ç½®æµæ§è§„åˆ™â€”â€”æŒ‰èµ„æºåç§°æ·»åŠ æµæ§è§„åˆ™</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285393933-ddc0a9ee-ed0e-440f-bc83-48cd579dcc76.png" alt="img"></p><p>######## 8.1.3 æµ‹è¯•</p><p>è‡ªæµ‹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285275609-5ad7070a-105e-4aec-8237-202601cd4b82.png" alt="img"></p><p>è§¦å‘æµæ§è§„åˆ™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285458697-f546d3c3-34da-491e-a379-b0ccfcf2cc9e.png" alt="img"></p><p>######## 8.1.4 é—®é¢˜</p><p>å¦‚æœæˆ‘ä»¬é‡å¯8401ä¼šå‘ç°ä¹‹å‰é…ç½®çš„ä¸€äº›è§„åˆ™éƒ½æ²¡æœ‰äº†ã€‚éš¾é“æ¯æ¬¡é‡å¯æœåŠ¡å™¨éƒ½è¦é‡æ–°é…ç½®ä¸€éè§„åˆ™å—ï¼Ÿè§„åˆ™å¦‚ä½•è¿›è¡ŒæŒä¹…åŒ–ï¼Ÿ</p><h5 id="_8-2-æŒ‰ç…§urlåœ°å€é™æµ-åç»­å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_8-2-æŒ‰ç…§urlåœ°å€é™æµ-åç»­å¤„ç†" aria-hidden="true">#</a> 8.2 æŒ‰ç…§Urlåœ°å€é™æµ+åç»­å¤„ç†</h5><p>é€šè¿‡è®¿é—®çš„URLæ¥é™æµï¼Œä¼šè¿”å›Sentinelè‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯</p><p>######## 8.2.1 ä¿®æ”¹controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/byUrl&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byUrl&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;æŒ‰urlé™æµæµ‹è¯•OK&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">&quot;serial002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 8.2.2 è®¾ç½®æµæ§è§„åˆ™åŠæµ‹è¯•</p><p>å…ˆè‡ªæµ‹ï¼Œæ²¡æœ‰é—®é¢˜ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285855107-0bf3e784-1753-46cc-a91a-09056010b7a0.png" alt="img"></p><p>æŒ‰rest URIè®¾ç½®æµæ§è§„åˆ™</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285921229-af984a98-bdca-4013-ba83-a43c63fdfe1a.png" alt="img"></p><p>è§¦å‘æµæ§ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636285937287-c80bb686-053d-49d1-871f-9014b13e3962.png" alt="img"></p><p>è¿™ä¸ªæ²¡æœ‰è‡ªå®šä¹‰çš„å…œåº•çš„æ–¹æ³•ï¼Œè¿”å›Sentinelè‡ªå¸¦çš„é™æµå¤„ç†ç»“æœã€‚</p><h5 id="_8-3-æ€»ç»“ä»¥åŠé¢ä¸´çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_8-3-æ€»ç»“ä»¥åŠé¢ä¸´çš„é—®é¢˜" aria-hidden="true">#</a> 8.3 æ€»ç»“ä»¥åŠé¢ä¸´çš„é—®é¢˜</h5><p>ä¸ç®¡æ˜¯@GetMapping(rest url)è¿˜æ˜¯ @SentinelResourceï¼Œåªè¦æ˜¯å”¯ä¸€çš„ï¼Œå°±å¯ä»¥ä½œä¸ºæµæ§è§„åˆ™çš„èµ„æºåç§°ã€‚å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è‡ªå·±çš„å…œåº•æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ã€‚</p><p>é—®é¢˜ï¼š</p><ul><li>ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚ã€‚å¦‚æœéƒ½ç”¨ç³»ç»Ÿé»˜è®¤çš„ï¼Œå°±æ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ã€‚</li><li>å¦‚æœæ¯ä¸ªä¸šåŠ¡æ–¹æ³•/APIæ¥å£éƒ½æ·»åŠ ä¸€ä¸ªå…œåº•çš„ï¼Œé‚£ä»£ç è†¨èƒ€åŠ å‰§ã€‚</li><li>å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç°ã€‚</li></ul><h5 id="_8-4-å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#_8-4-å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" aria-hidden="true">#</a> 8.4 å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</h5><p>ä¸ºäº†è§£å†³ä»£ç è€¦åˆä¸è†¨èƒ€çš„é—®é¢˜</p><h6 id="_8-4-1-åˆ›å»ºcustomerblockhandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#_8-4-1-åˆ›å»ºcustomerblockhandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" aria-hidden="true">#</a> 8.4.1 åˆ›å»ºCustomerBlockHandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</h6><p>åœ¨CustomerBlockHandlerç±»ä¸­ç»Ÿä¸€çš„å¤„ç†é™æµæç¤ºã€æœåŠ¡é™çº§çš„è¯´æ˜ç­‰ç­‰ã€‚ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>myhandler</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerBlockHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰å®¢æˆ·è‡ªå®šä¹‰, global handlerException----1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException2</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰å®¢æˆ·è‡ªå®šä¹‰, global handlerException----2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 8.4.2 ä¿®æ”¹RateLimitControllerï¼Œä½¿ç”¨è‡ªå®šä¹‰å¤„ç†é€»è¾‘ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>myhandler<span class="token punctuation">.</span></span><span class="token class-name">CustomerBlockHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/byResource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byResource&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;handleException&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span> <span class="token string">&quot;serial001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/byUrl&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byUrl&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰urlé™æµæµ‹è¯•OK&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span> <span class="token string">&quot;serial002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//CustomerBlockHandlerè‡ªå®šä¹‰ç±»,æ¥å¤„ç†æœåŠ¡é™çº§ã€é™æµæç¤º.....</span>
    <span class="token doc-comment comment">/**
     * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ï¼Œ
     * blockHandlerClass = CustomerBlockHandler.class
     * blockHandler = handleException2
     * ä¸Šè¿°é…ç½®ï¼šæ‰¾CustomerBlockHandlerç±»é‡Œçš„handleException2æ–¹æ³•è¿›è¡Œå…œåº•å¤„ç†
     */</span>
    <span class="token comment">//è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/customerBlockHandler&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;customerBlockHandler&quot;</span><span class="token punctuation">,</span>
            blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomerBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerException2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">customerBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æŒ‰å®¢æˆ·è‡ªå®šä¹‰&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span> <span class="token string">&quot;serial003&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## 8.4.3 æµ‹è¯•</p><p>å¯åŠ¨8401ï¼Œå…ˆæµ‹è¯•ä¸€æ¬¡<a href="http://localhost:8401/rateLimit/customerBlockHandler" target="_blank" rel="noopener noreferrer">http://localhost:8401/rateLimit/customerBlockHandler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636287580303-28b3cfb9-1b59-45f3-a285-490cdadfcc6c.png" alt="img"></p><p>è®¾ç½®æµæ§è§„åˆ™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636287621476-3a3eaf6f-4507-468f-bde2-decdc7f78973.png" alt="img"></p><p>è§¦å‘æµæ§ï¼Œçœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰æç¤ºï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636287665130-41bc38f3-b6cd-483a-b3f4-7fbe7462cb0a.png" alt="img"></p><p>è‡ªå®šä¹‰æç¤ºå‡ºæ¥äº†ï¼</p><p>######## 8.4.4 ç»“æ„è¯´æ˜</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636287798408-543e1ede-a827-49c3-92f0-5c0b13725223.png" alt="img"></p><p>è¿™æ ·å°±å®ç°äº†å…œåº•æ–¹æ³•ä¸ä¸šåŠ¡æ–¹æ³•çš„è§£è€¦ã€‚</p><p>######## 8.5 æ›´å¤šå±æ€§è¯´æ˜</p><p><a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81" target="_blank" rel="noopener noreferrer">æ³¨è§£æ”¯æŒæ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636289727930-10fdb9a1-5ddf-47a5-bd1a-8c62f33357ed.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636289848511-939d2aa2-1c45-4d66-922c-56a2da957cac.png" alt="img"></p><h3 id="ä¹ã€æœåŠ¡ç†”æ–­" tabindex="-1"><a class="header-anchor" href="#ä¹ã€æœåŠ¡ç†”æ–­" aria-hidden="true">#</a> ä¹ã€æœåŠ¡ç†”æ–­</h3><p>ä¸»è¦å†…å®¹ï¼š</p><ul><li>sentinelåˆ†åˆ«æ•´åˆribbon+openFeignä»¥åŠè®¾ç½®fallback</li><li>ç†”æ–­æ¡†æ¶æ¯”è¾ƒ</li></ul><h5 id="_9-1-ribbonç³»åˆ—" tabindex="-1"><a class="header-anchor" href="#_9-1-ribbonç³»åˆ—" aria-hidden="true">#</a> 9.1 Ribbonç³»åˆ—</h5><p>nacosä¸­æ•´åˆäº†Ribbonï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨nacoså°±è¡Œã€‚å¯åŠ¨nacoså’ŒSentinelã€‚</p><h6 id="_9-1-1-æœåŠ¡æä¾›è€…9003-9004" tabindex="-1"><a class="header-anchor" href="#_9-1-1-æœåŠ¡æä¾›è€…9003-9004" aria-hidden="true">#</a> 9.1.1 æœåŠ¡æä¾›è€…9003/9004</h6><p>æ–°å»ºcloudalibaba-provider-payment9003/9004ä¸¤ä¸ªä¸€æ ·çš„åšæ³•</p><p>######## (1) pom</p><p>2020ç‰ˆå’Œspringcloudå’Œnacosè®°å¾—å¼•å…¥spring-cloud-starter-loadbalancerä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-provider-payment9003<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (2) yml</p><p>9004 åˆ«å¿˜äº†æ”¹ç«¯å£å·</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9003</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#é…ç½®Nacosåœ°å€</span>

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (3) ä¸»å¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9003</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain9003</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (4) ä¸šåŠ¡ç±»</p><p>è¿™é‡Œå›¾æ–¹ä¾¿ï¼Œå°±æ²¡æœ‰è¿æ¥æ•°æ®åº“ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;from mysql,serverPort:  &quot;</span> <span class="token operator">+</span> serverPort<span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (5) æµ‹è¯•</p><p><a href="http://localhost:9003/paymentSQL/1" target="_blank" rel="noopener noreferrer">http://localhost:9003/paymentSQL/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636295326201-3cba78d6-90d2-446d-a2d8-a94fc8e5691a.png" alt="img"></p><p><a href="http://localhost:9004/paymentSQL/1" target="_blank" rel="noopener noreferrer">http://localhost:9004/paymentSQL/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636295338547-274e5857-8816-4723-a2e7-de4cc0c9ef4f.png" alt="img"></p><h6 id="_9-1-2-æœåŠ¡æ¶ˆè´¹è€…84" tabindex="-1"><a class="header-anchor" href="#_9-1-2-æœåŠ¡æ¶ˆè´¹è€…84" aria-hidden="true">#</a> 9.1.2 æœåŠ¡æ¶ˆè´¹è€…84</h6><p>æ–°å»ºcloudalibaba-consumer-nacos-order84</p><p>######## (1) pom</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-consumer-nacos-order84<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (2) yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">84</span>


<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment">#é…ç½®Sentinel dashboardåœ°å€</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment">#é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>


<span class="token comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span>
<span class="token comment">#æ–¹ä¾¿controllerçš„@valueè·å–</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (3) ä¸»å¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain84</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderNacosMain84</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (4) ä¸šåŠ¡ç±»</p><p>å› ä¸ºç”¨çš„Ribbonï¼Œéœ€è¦ä½¿ç”¨å…¶æä¾›çš„RestTemplate</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">LoadBalanced</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>  <span class="token comment">//ä¸è¦å¿˜äº†</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleBreakerController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${service-url.nacos-user-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> SERVICE_URL<span class="token punctuation">;</span>
    <span class="token comment">//public static final String SERVICE_URL = &quot;http://nacos-payment-provider&quot;;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//æ²¡æœ‰é…ç½®</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (5) æµ‹è¯•</p><p>è´Ÿè½½å‡è¡¡å®ç°ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636295900018-2e6c309b-8454-4cab-a0e8-d00d83fba367.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636295908562-9d50031c-7b65-437b-9494-d3f4454f0ddd.png" alt="img"></p><h6 id="_9-1-3-fallback-å’Œ-blockhandler" tabindex="-1"><a class="header-anchor" href="#_9-1-3-fallback-å’Œ-blockhandler" aria-hidden="true">#</a> 9.1.3 fallback å’Œ blockHandler</h6><p>åŠ æ·±@SentinelResource(value = &quot;xxx&quot;, fallback = &quot;fffff&quot;, blockHandler = &quot;bbbbbb&quot;)æ³¨è§£ç†è§£ï¼š</p><p><strong>fallbackç®¡è¿è¡Œå¼‚å¸¸ï¼ŒblockHandlerç®¡é…ç½®è¿è§„ã€‚</strong></p><p>fallbackå¯¹åº”æœåŠ¡é™çº§ï¼Œå°±æ˜¯æœåŠ¡å‡ºé”™äº†åº”è¯¥æ€ä¹ˆåŠï¼ˆéœ€è¦æœ‰ä¸ªå…œåº•æ–¹æ³•ï¼‰ï¼›</p><p>blockHandlerå¯¹åº”æœåŠ¡ç†”æ–­ï¼Œå°±æ˜¯æˆ‘ç°åœ¨æœåŠ¡ä¸å¯ç”¨ï¼Œæˆ‘åº”è¯¥æ€ä¹ˆåŠï¼Œæ€ä¹ˆç»™å®¢æˆ·ä¸€ä¸ªæˆ·æç¤ºï¼ˆåŒæ ·éœ€è¦ä¸€ä¸ªå…œåº•æ–¹æ³•ï¼‰</p><h6 id="_9-1-4-å·®å¼‚åŒ–é…ç½®" tabindex="-1"><a class="header-anchor" href="#_9-1-4-å·®å¼‚åŒ–é…ç½®" aria-hidden="true">#</a> 9.1.4 å·®å¼‚åŒ–é…ç½®</h6><p><strong>è¿™é‡Œæ”¹çš„ä¸šåŠ¡ç±»ä»£ç å‡æ˜¯æ¶ˆè´¹è€…84ç«¯çš„ä¸šåŠ¡ç±»ä»£ç ï¼Œä¸è¦æé”™äº†ã€‚</strong></p><p>é™çº§æ˜¯æœåŠ¡ä¸šåŠ¡ä»£ç å‡ºç°é”™è¯¯çš„å…œåº•ï¼Œç†”æ–­æ˜¯æœåŠ¡ä¸å¯ç”¨ã€‚é™çº§æ˜¯å…œåº•æ–¹æ³•,ç†”æ–­æ˜¯å¯¹æœåŠ¡ä¿æŠ¤æ—¶é—´çª—å£æœŸæœåŠ¡ä¸å¯ç”¨ã€‚</p><p>######## (1) æ²¡æœ‰ä»»ä½•é…ç½®</p><p>å‰é¢æˆ‘ä»¬çš„84æ¶ˆè´¹ç«¯ï¼Œ@SentinelResourceé‡Œé¢åªé…ç½®äº†valueï¼Œfallbackå’ŒblockHandleréƒ½æ²¡æœ‰é…ç½®ï¼Œè¯¥æƒ…å†µä¸‹æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹<a href="http://localhost:84/consumer/fallback/4" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/fallback/4<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636296443903-85032cef-0249-47a7-9422-5b2626522837.png" alt="img"></p><p>å‡ºç°äº†é”™è¯¯é¡µé¢ï¼Œerror pageå¯¹å®¢æˆ·ä¸å‹å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰å…œåº•æ–¹æ³•ã€‚</p><p>######## (2) åªé…ç½®fallback</p><p>fallbackå¯¹åº”æœåŠ¡é™çº§ï¼Œå°±æ˜¯æœåŠ¡å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯ä¸šåŠ¡é€»è¾‘å‡ºç°é”™è¯¯ï¼Œéœ€è¦é™çº§å…œåº•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@SentinelResource(value = &quot;fallback&quot;) //æ²¡æœ‰é…ç½®</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">&quot;handlerFallback&quot;</span><span class="token punctuation">)</span> <span class="token comment">//fallbackè´Ÿè´£ä¸šåŠ¡å¼‚å¸¸</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636296874173-d549dc01-eea9-4008-8970-530ddd329d87.png" alt="img"></p><p>è®¿é—®<a href="http://localhost:84/consumer/fallback/4%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/fallback/4ï¼Œå¯ä»¥çœ‹åˆ°ä¸šåŠ¡å¼‚å¸¸<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636296836332-e0231afe-55ae-4999-a4a6-02c656f443d7.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636376600977-3e77373a-45cd-4f57-b09c-ef7b84ad1440.png" alt="img"></p><p>######## (3) åªé…ç½®blockHandler</p><p>blockHandlerå¯¹åº”æœåŠ¡ç†”æ–­ï¼Œå½“å‰sentinelé…ç½®å·²ç»è¿è§„ï¼ˆRTæ•°è¿‡å¤šã€å¼‚å¸¸è¿‡å¤šï¼‰ï¼ŒæœåŠ¡ç†”æ–­åä¸å¯ç”¨ï¼Œéœ€è¦ç»™å®¢æˆ·æç¤ºï¼Œè¿›è¡Œä¸€ä¸ªç†”æ–­çš„å…œåº•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@SentinelResource(value = &quot;fallback&quot;) //æ²¡æœ‰é…ç½®</span>
<span class="token comment">//@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;) //fallbackè´Ÿè´£ä¸šåŠ¡å¼‚å¸¸,å¯¹åº”æœåŠ¡é™çº§</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandler&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„,å¯¹åº”æœåŠ¡ç†”æ–­</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯fallback</span>
<span class="token comment">//    public CommonResult handlerFallback(@PathVariable  Long id,Throwable e) {</span>
<span class="token comment">//        Payment payment = new Payment(id,&quot;null&quot;);</span>
<span class="token comment">//        return new CommonResult&lt;&gt;(444,&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;+e.getMessage(),payment);</span>
<span class="token comment">//    }</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯blockHandler</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> blockException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span><span class="token string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span>
                              <span class="token operator">+</span> blockException<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636377488633-9fbf083a-c1b7-4b8f-b0fb-780cc3149cd9.png" alt="img"></p><p>é…ç½®sentinel</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378236102-092d5db5-1b25-448f-ab7b-90e1005941a9.png" alt="img"></p><p>è®¿é—®ï¼š<a href="http://localhost:84/consumer/fallback/5" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/fallback/5<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378622776-6814a21d-f639-4916-88c3-a02a09ca9ea5.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636378646427-5916609c-ee75-4561-b82b-a5305ca1ad2d.png" alt="img"></p><p>è¿™é‡Œè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·çš„bugï¼Œå¾ˆè¿·ã€‚</p><p>######## (4) fallbackå’ŒblockHandleréƒ½é…ç½®</p><p>åŒæ—¶æœ‰é™çº§è·Ÿç†”æ–­çš„å…œåº•æ–¹æ³•ï¼Œå½“é™çº§è¾¾åˆ°sentinelé…ç½®è§„åˆ™åï¼Œè§¦å‘ç†”æ–­ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">&quot;handlerFallback&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandler&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯fallback</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯blockHandler</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> blockException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span><span class="token string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span>
                              <span class="token operator">+</span> blockException<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636379028565-b0a58044-6568-40c7-a127-893179509f17.png" alt="img"></p><p>é…ç½®sentinel</p><p>åˆ é™¤ä¹‹å‰çš„ç†”æ–­è§„åˆ™ï¼Œé…ç½®æµæ§ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636379267539-ae4d7c97-3a11-4365-8a08-45fa444b7334.png" alt="img"></p><p>é™æµæ•ˆæœï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636381019917-19556a7d-37e6-47ae-964f-72f43a7db72c.png" alt="img"></p><p>æ²¡æœ‰è§¦å‘é™æµæ—¶ï¼Œæˆ‘ä»¬è§¦å‘ä¸šåŠ¡å¼‚å¸¸<a href="http://localhost:84/consumer/fallback/4%EF%BC%8C%E4%BC%9A%E8%A2%AB%E9%99%8D%E7%BA%A7%E6%96%B9%E6%B3%95fallback%E5%85%9C%E5%BA%95%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/fallback/4ï¼Œä¼šè¢«é™çº§æ–¹æ³•fallbackå…œåº•ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636381545549-1837da35-4d9a-4fe2-9703-af4577a55fa5.png" alt="img"></p><p>è§¦å‘é™æµæ—¶ï¼Œæˆ‘ä»¬ä»ç„¶è®¿é—®å¯ä»¥è§¦å‘ä¸šåŠ¡å¼‚å¸¸çš„è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡å·²ç»è¢«é™æµï¼ˆå¯ä»¥ç†è§£ä¸ºæœåŠ¡ä¸å¯ç”¨å³ç†”æ–­ï¼‰ï¼Œæ­¤æ—¶è§¦å‘çš„æ˜¯é™æµï¼ˆç†”æ–­blockHandlerï¼‰ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636381657535-9cb4112c-8d99-4cbe-b6a3-435fed6479cb.png" alt="img"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ—¶é…ç½®fallbackï¼šå¤„ç†ä¸šåŠ¡å¼‚å¸¸ï¼ˆå¾®æœåŠ¡è‡ªèº«å¼‚å¸¸ï¼ŒæœåŠ¡é™çº§ï¼‰å’ŒblockHandlerï¼šå¤„ç†è§¦å‘sentinelé…ç½®ï¼ˆå¾®æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡ç†”æ–­ï¼‰æ—¶ã€‚åœ¨æ²¡æœ‰è¿åsentinelè§„åˆ™æ—¶ï¼Œå‡ºç°ä¸šåŠ¡å¼‚å¸¸ï¼ˆé™çº§ï¼‰èµ°fallbackæ–¹æ³•ï¼›è¿åäº†sentinelè§„åˆ™æ—¶ï¼Œç›´æ¥å¾®æœåŠ¡ä¸å¯ç”¨ï¼ˆç†”æ–­ï¼‰ï¼Œèµ°blockHandleræŒ‡å®šçš„è‡ªå®šä¹‰æ–¹æ³•ã€‚</p><p>######## (5) å¼‚å¸¸å¿½ç•¥å±æ€§</p><p>å¯ä»¥é€‰æ‹©æ€§çš„é…ç½®å½“æŸäº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œä¸è§¦å‘fallbackçš„å…œåº•æ–¹æ³•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">&quot;handlerFallback&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandler&quot;</span><span class="token punctuation">,</span>
                  exceptionsToIgnore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯fallback</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æœ¬ä¾‹æ˜¯blockHandler</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span>  <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> blockException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span><span class="token string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span>
                              <span class="token operator">+</span> blockException<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636382629691-ae5cd6c6-3222-41fc-b194-f604cbe6ca2b.png" alt="img"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œè®¿é—®ï¼š<a href="http://localhost:84/consumer/fallback/4" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/fallback/4<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636382674753-3fb1691e-a2bf-4fbf-acdb-33bdf00f971e.png" alt="img"></p><p>ç›´æ¥æŠ¥é”™è¯¯é¡µé¢ï¼Œæ²¡æœ‰äº†é™çº§å…œåº•æ–¹æ³•ã€‚</p><p>å…¶ä»–å¼‚å¸¸ä¸å—å½±å“ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636383051275-12b54175-7254-40da-82fe-2b553361b4a6.png" alt="img"></p><p>å½“ç„¶ï¼Œè§¦å‘æµæ§ä¹‹åï¼Œä»ç„¶é€šè¿‡blockHandleræŒ‡å®šçš„æ–¹æ³•è¿›è¡Œç†”æ–­å…œåº•ã€‚</p><h5 id="_9-2-feignç³»åˆ—" tabindex="-1"><a class="header-anchor" href="#_9-2-feignç³»åˆ—" aria-hidden="true">#</a> 9.2 Feignç³»åˆ—</h5><h6 id="_9-2-1-ä¿®æ”¹84æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_9-2-1-ä¿®æ”¹84æ¨¡å—" aria-hidden="true">#</a> 9.2.1 ä¿®æ”¹84æ¨¡å—</h6><p>ä¿®æ”¹84æ¨¡å—ï¼ŒFeignç»„ä»¶ä¸€èˆ¬æ˜¯åœ¨æ¶ˆè´¹ä¾§ã€‚</p><p>######## (1) pom</p><p>pom åŠ å…¥feignçš„ä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud openfeign --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (2) yml</p><p>æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span>
<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (3) ä¸šåŠ¡ç±»</p><p>åç»­84çš„controllerä¸æ‰¾restTemplateï¼ˆRibbonï¼‰ï¼Œä¸æ˜¯restTemplateå»è°ƒç”¨paymentå¾®æœåŠ¡ä¸­çš„æ¥å£ã€‚è€Œæ˜¯é€šè¿‡è°ƒç”¨PaymentFeignServiceï¼Œserviceå†å»è°ƒç”¨paymentå¾®æœåŠ¡ä¸­çš„ç«¯å£ã€‚</p><p>Feignéœ€è¦å®šä¹‰ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼ˆserviceï¼‰æ¥å£+ @FeignClientæ³¨è§£ä»¥è°ƒç”¨æœåŠ¡æä¾›è€…ã€‚</p><p>æ–°å»ºPaymentFeignService interfaceï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>

<span class="token comment">// æŒ‡æ˜è°ƒç”¨å¤±è´¥çš„å…œåº•æ–¹æ³•åœ¨PaymentFallbackService</span>
<span class="token comment">// ä½¿ç”¨ fallback æ–¹å¼æ˜¯æ— æ³•è·å–å¼‚å¸¸ä¿¡æ¯çš„ï¼Œ</span>
<span class="token comment">// å¦‚æœæƒ³è¦è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ fallbackFactoryå‚æ•°</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;nacos-payment-provider&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token class-name">PaymentFallbackService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentFeignService</span> <span class="token punctuation">{</span>
    <span class="token comment">//å»nacos-payment-provideræœåŠ¡ä¸­æ‰¾ç›¸åº”çš„æ¥å£</span>
    <span class="token comment">// æ–¹æ³•ç­¾åä¸€å®šè¦å’Œnacos-payment-providerä¸­controllerçš„ä¸€è‡´</span>
    <span class="token comment">// å¯¹åº”9003ã€9004ä¸­çš„æ–¹æ³•</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨å¤±è´¥çš„å…œåº•æ–¹æ³•ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>   <span class="token comment">//ä¸è¦å¿˜è®°äº†</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFallbackService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentFeignService</span> <span class="token punctuation">{</span>
    <span class="token comment">//å¦‚æœnacos-payment-consumeræœåŠ¡ä¸­çš„ç›¸åº”æ¥å£å‡ºäº‹äº†ï¼Œæˆ‘æ¥å…œåº•</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;æœåŠ¡é™çº§è¿”å›,æ²¡æœ‰è¯¥æµæ°´ä¿¡æ¯-------PaymentFallbackService&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;errorSerial......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>84ç«¯å£controlleråŠ å…¥openFeignçš„æ¥å£ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//==================OpenFeign</span>
<span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">PaymentFeignService</span> paymentFeignService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/consumer/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡æœ‰è¯¥id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> paymentFeignService<span class="token punctuation">.</span><span class="token function">paymentSQL</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## (4) ä¸»å¯åŠ¨ç±»</p><p>åŠ ä¸Š**@EnableFeignClient**æ³¨è§£å¼€å¯OpenFeign</p><p>######## (5) æµ‹è¯•</p><p>å¯åŠ¨9003ã€9004ã€84</p><p>è®¿é—®ï¼š<a href="http://localhost:84/consumer/paymentSQL/1" target="_blank" rel="noopener noreferrer">http://localhost:84/consumer/paymentSQL/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>9003ã€9004è´Ÿè½½å‡è¡¡</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636439455803-e9c03675-1a11-4dec-be5e-bf92f0ab37ee.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636439472093-4b41f770-ccfe-4779-b73a-778290855c33.png" alt="img"></p><p>å…³é—­9003ã€9004å¾®æœåŠ¡æä¾›è€…ï¼Œçœ‹åˆ°84æ¶ˆè´¹è€…è‡ªåŠ¨æ‰§è¡Œé™çº§å…œåº•æ–¹æ³•ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636440219538-a4cad0f5-3108-46a5-9de7-22dd3d2003dc.png" alt="img"></p><p>å¦‚æœyamlæ²¡æœ‰é…ç½®Sentinelå¯¹Feignçš„æ”¯æŒï¼Œå°±ä¸ä¼šæ‰§è¡Œé™çº§æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥æŠ¥é”™è¯¯é¡µé¢ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636440204489-cef2429a-b054-4fa3-9fda-8723526b59a0.png" alt="img"></p><h5 id="_9-3-ç†”æ–­æ¡†æ¶æ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#_9-3-ç†”æ–­æ¡†æ¶æ¯”è¾ƒ" aria-hidden="true">#</a> 9.3 ç†”æ–­æ¡†æ¶æ¯”è¾ƒ</h5><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636440701197-692a61f8-63d8-494d-8ead-f44acefab3df.png" alt="img"></p><h3 id="åã€æŒä¹…åŒ–è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#åã€æŒä¹…åŒ–è§„åˆ™" aria-hidden="true">#</a> åã€æŒä¹…åŒ–è§„åˆ™</h3><p>å‰é¢æˆ‘ä»¬å¾®æœåŠ¡æ–°å¢çš„é™æµè§„åˆ™åï¼Œå¾®æœåŠ¡å…³é—­åå°±ä¼šä¸¢å¤±ï¼Œå½“æ—¶é…ç½®éƒ½é™æµè§„åˆ™éƒ½æ˜¯ä¸´æ—¶çš„ã€‚ å°†é™æµé…ç½®è§„åˆ™æŒä¹…åŒ–è¿›Nacosä¿å­˜ï¼Œåªè¦åˆ·æ–°8401æŸä¸ªreståœ°å€ï¼Œsentinelæ§åˆ¶å°çš„æµæ§è§„åˆ™ å°±èƒ½çœ‹åˆ°ã€‚åªè¦nacosé‡Œé¢çš„é…ç½®ä¸åˆ é™¤ï¼Œé’ˆå¯¹8401ä¸Šçš„sentinelä¸Šçš„æµæ§è§„åˆ™å°±æŒç»­å­˜åœ¨ã€‚ ï¼ˆä¹Ÿå¯ä»¥æŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œredisï¼Œæ•°æ®åº“ç­‰ï¼‰</p><h5 id="æ¡ˆä¾‹â€”â€”ä¿®æ”¹8401å·²å®ŒæˆæŒä¹…åŒ–è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹â€”â€”ä¿®æ”¹8401å·²å®ŒæˆæŒä¹…åŒ–è®¾ç½®" aria-hidden="true">#</a> æ¡ˆä¾‹â€”â€”ä¿®æ”¹8401å·²å®ŒæˆæŒä¹…åŒ–è®¾ç½®</h5><h6 id="_1-pom-1" tabindex="-1"><a class="header-anchor" href="#_1-pom-1" aria-hidden="true">#</a> (1) pom</h6><p>å¯¼å…¥æŒä¹…åŒ–æ‰€éœ€ä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos æŒä¹…åŒ–--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-yaml" tabindex="-1"><a class="header-anchor" href="#_2-yaml" aria-hidden="true">#</a> (2) yaml</h6><p>æ·»åŠ nacosæ•°æ®æºé…ç½®</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment">#é…ç½®Sentinel dashboardåœ°å€</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment">#é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
      <span class="token comment"># å…³é—­é»˜è®¤æ”¶æ•›æ‰€æœ‰URLçš„å…¥å£contextï¼Œä¸ç„¶é“¾è·¯é™æµä¸ç”Ÿæ•ˆ</span>
      <span class="token comment"># Spring Cloud Alibaba éœ€è¦2.1.1.RELEASEä»¥ä¸Šç‰ˆæœ¬</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment">#      filter:</span>
<span class="token comment">#        enabled: false  # å…³é—­è‡ªåŠ¨æ”¶æ•›</span>

      <span class="token comment">#æŒä¹…åŒ–é…ç½®</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">ds1</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-æ·»åŠ nacosä¸šåŠ¡è§„åˆ™é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-æ·»åŠ nacosä¸šåŠ¡è§„åˆ™é…ç½®" aria-hidden="true">#</a> (3) æ·»åŠ nacosä¸šåŠ¡è§„åˆ™é…ç½®</h6><p>æˆ‘ä»¬å°†sentinelçš„æµæ§é…ç½®ä¿å­˜åœ¨nacosä¸­ï¼Œå› ä¸ºnacosçš„é…ç½®æŒä¹…åŒ–åœ¨äº†æ•°æ®åº“ä¸­ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636443367569-59d065b4-ec4e-43c0-8f50-8f805c8c818f.png" alt="img"></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/rateLimit/byUrl&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;limitApp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;controlBehavior&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;clusterMode&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>resourceï¼šèµ„æºåç§°ï¼›</p><p>limitAppï¼šæ¥æºåº”ç”¨ï¼›</p><p>gradeï¼šé˜ˆå€¼ç±»å‹ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1è¡¨ç¤ºQPSï¼›</p><p>countï¼šå•æœºé˜ˆå€¼ï¼›</p><p>strategyï¼šæµæ§æ¨¡å¼ï¼Œ0è¡¨ç¤ºç›´æ¥ï¼Œ1è¡¨ç¤ºå…³è”ï¼Œ2è¡¨ç¤ºé“¾è·¯ï¼›</p><p>controlBehaviorï¼šæµæ§æ•ˆæœï¼Œ0è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1è¡¨ç¤ºWarm Upï¼Œ2è¡¨ç¤ºæ’é˜Ÿç­‰å¾…ï¼›</p><p>clusterModeï¼šæ˜¯å¦é›†ç¾¤ã€‚</p><p>æ³¨æ„ï¼šè¿™é‡Œå¦‚æœè¦é…nacosçš„å‘½åç©ºé—´ï¼ˆpublicã€devã€testï¼‰çš„è¯ï¼Œåº”è¯¥æ˜¯é…namespaceçš„idï¼Œä¸æ˜¯åç§°</p><h6 id="_4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-æµ‹è¯•" aria-hidden="true">#</a> (4) æµ‹è¯•</h6><p>å¯åŠ¨8401ï¼Œè®¿é—®8401ä»»æ„æ¥å£ï¼Œåˆ·æ–°Sentinelã€‚å¯ä»¥çœ‹åˆ°Sentinelä¸­åŠ è½½äº†é€šè¿‡nacosæŒä¹…åŒ–çš„è§„åˆ™é…ç½®æ–‡ä»¶ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636459020329-7d5d5e38-9dfb-48bd-96bb-2488b066a8f8.png" alt="img"></p><p>å…³æ‰8401åå‘ç°æµæ§è§„åˆ™æ²¡æœ‰äº†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636459171130-489aa6a9-cf4c-4c28-94ba-456418bbaa4f.png" alt="img"></p><p>å†æ¬¡å¯åŠ¨8401æŸ¥çœ‹sentinelï¼Œè®¿é—®å‡ æ¬¡8401åæµæ§è§„åˆ™åˆå‡ºç°äº†ã€‚</p><p>æŸ¥çœ‹æ•°æ®åº“ï¼Œå‘ç°è§„åˆ™æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­äº†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636459413078-73a851a4-729f-4e9a-b5ef-1d1bddf40cdf.png" alt="img"></p><h2 id="_15-springcloud-alibaba-seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_15-springcloud-alibaba-seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡" aria-hidden="true">#</a> 15.SpringCloud Alibaba Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" aria-hidden="true">#</a> åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><p><strong>åªè¦ç”¨åˆ°åˆ†å¸ƒå¼ï¼Œå¿…ç„¶ä¼šæåŠåˆ†å¸ƒå¼çš„äº‹åŠ¡ã€‚</strong></p><p>åœ¨åˆ†å¸ƒå¼ä¹‹å‰ï¼Œä¸€åˆ‡ç»„ä»¶å…¨éƒ½åœ¨ä¸€å°æœºå™¨ä¸Šã€‚</p><p>åœ¨ä½¿ç”¨åˆ†å¸ƒå¼ä¹‹åï¼Œå•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„ä¸‰ä¸ªæ¨¡å—è¢«æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ•°æ®æºã€‚</p><p>ä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±<strong>æœ¬åœ°</strong>äº‹åŠ¡æ¥ä¿è¯ï¼Œä½†æ˜¯<strong>å…¨å±€</strong>çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636468367331-5feffbdc-ec8f-4620-9c50-d8c5485c2871.png" alt="img"></p><p>ä¸€å¥è¯ï¼š<code>ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</code></p><h3 id="ä¸€ã€seataç®€ä»‹ä¸å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€seataç®€ä»‹ä¸å®‰è£…" aria-hidden="true">#</a> ä¸€ã€Seataç®€ä»‹ä¸å®‰è£…</h3><p>Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ <a href="http://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h5 id="_1-1-ç›¸å…³æœ¯è¯­" tabindex="-1"><a class="header-anchor" href="#_1-1-ç›¸å…³æœ¯è¯­" aria-hidden="true">#</a> 1.1 ç›¸å…³æœ¯è¯­</h5><p>ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨åˆ†å¸ƒå¼å¤„ç†è¿‡ç¨‹çš„<strong>ä¸€ID+ä¸‰ç»„ä»¶</strong>æ¨¡å‹æ¥æè¿°ã€‚</p><p>ä¸€IDï¼ˆ<strong>å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ID</strong>ï¼‰ï¼šTransaction ID XIDï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡IDä¸‹çš„æ‰€æœ‰äº‹åŠ¡ä¼šè¢«ç»Ÿä¸€æ§åˆ¶</p><p><strong>ä¸‰ç»„ä»¶</strong>ï¼š</p><ul><li><strong>Transaction Coordinator (TC)</strong>ï¼šäº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼›ï¼ˆServerç«¯ï¼Œä¸ºå•ç‹¬æœåŠ¡å™¨éƒ¨ç½²ï¼‰</li><li><strong>Transaction Manager (TM)</strong>ï¼šäº‹åŠ¡ç®¡ç†å™¨ï¼Œæ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼›</li><li><strong>Resource Manager (RM)</strong>ï¼šèµ„æºç®¡ç†å™¨ï¼Œæ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š</li><li>Seataåˆ†TCã€TMå’ŒRMä¸‰ä¸ªè§’è‰²ï¼Œ<strong>TCï¼ˆServerç«¯ï¼‰ä¸ºå•ç‹¬æœåŠ¡ç«¯éƒ¨ç½²</strong>ï¼Œ<strong>TMå’ŒRMï¼ˆClientç«¯ï¼‰ç”±ä¸šåŠ¡ç³»ç»Ÿé›†æˆï¼ˆå¾®æœåŠ¡ï¼‰</strong>ã€‚</li></ul><h5 id="_1-2-å…¸å‹çš„åˆ†å¸ƒå¼æ§åˆ¶äº‹åŠ¡æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-2-å…¸å‹çš„åˆ†å¸ƒå¼æ§åˆ¶äº‹åŠ¡æµç¨‹" aria-hidden="true">#</a> 1.2 å…¸å‹çš„åˆ†å¸ƒå¼æ§åˆ¶äº‹åŠ¡æµç¨‹</h5><ol><li>TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ª<strong>å…¨å±€å”¯ä¸€çš„ XID</strong>ï¼›</li><li>XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼›ï¼ˆä¹Ÿå°±æ˜¯åœ¨å¤šä¸ªTMï¼ŒRMä¸­ä¼ æ’­ï¼‰</li><li>RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼›</li><li>TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼›</li><li>TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636511629414-0e4a7788-1488-40b8-8b5f-93f330a481b7.png" alt="img"></p><h5 id="_1-3-seata-serverçš„ä¸‹è½½ä¸é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-3-seata-serverçš„ä¸‹è½½ä¸é…ç½®" aria-hidden="true">#</a> 1.3 Seata-Serverçš„ä¸‹è½½ä¸é…ç½®</h5><p>æˆ‘è¿™é‡Œä¸‹è½½äº†0.9.0ç‰ˆæœ¬è·Ÿ1.4.2ç‰ˆæœ¬ï¼ˆé…äº†åŠå¤©æ²¡é…å¥½ï¼Œåé¢å†å¡«å‘ï¼‰ï¼Œå·®åˆ«è¿˜æ˜¯è›®å¤§çš„ã€‚</p><h6 id="_1-3-1-ä¿®æ”¹file-confæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-3-1-ä¿®æ”¹file-confæ–‡ä»¶" aria-hidden="true">#</a> 1.3.1 ä¿®æ”¹file.confæ–‡ä»¶</h6><p>è§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶ä¿®æ”¹confç›®å½•ä¸‹çš„file.confé…ç½®æ–‡ä»¶ã€‚</p><ol><li><p>å¤‡ä»½åŸå§‹file.confæ–‡ä»¶ã€‚</p></li><li><ol><li>ä¸»è¦ä¿®æ”¹ï¼šè‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°+äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸ºdb+æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚</li></ol></li><li><p>ä¿®æ”¹file.confæ–‡ä»¶</p></li><li><ol><li>serviceæ¨¡å—ï¼ˆ1.4.2é‡Œé¢æ²¡æœ‰è¿™ä¸ªæ¨¡å—ï¼Œéœ€è¦è‡ªå·±åŠ ï¼‰</li></ol></li><li><p>storeæ¨¡å—</p></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636531841434-f5abb282-86e4-48b1-b7a0-71ad75de1679.png" alt="img"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">## transaction log store, only used in seata-server</span>
<span class="token key attr-name">store</span> <span class="token value attr-value">{</span>
<span class="token comment">  ## store mode: fileã€dbã€redis</span>
<span class="token key attr-name">  mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;db&quot;</span>
<span class="token comment">  ## rsa decryption public key</span>
<span class="token key attr-name">  publicKey</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token comment">  ## file store property</span>
<span class="token key attr-name">  file</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## store location dir</span>
<span class="token key attr-name">    dir</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;sessionStore&quot;</span>
<span class="token comment">    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span>
<span class="token key attr-name">    maxBranchSessionSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">16384</span>
<span class="token comment">    # globe session size , if exceeded throws exceptions</span>
<span class="token key attr-name">    maxGlobalSessionSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">512</span>
<span class="token comment">    # file buffer size , if exceeded allocate new buffer</span>
<span class="token key attr-name">    fileWriteBufferCacheSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">16384</span>
<span class="token comment">    # when recover batch read size</span>
<span class="token key attr-name">    sessionReloadReadSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token comment">    # async, sync</span>
<span class="token key attr-name">    flushDiskMode</span> <span class="token punctuation">=</span> <span class="token value attr-value">async</span>
  }

<span class="token comment">  ## database store property</span>
<span class="token key attr-name">  db</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.</span>
<span class="token key attr-name">    datasource</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;druid&quot;</span>
<span class="token comment">    ## mysql/oracle/postgresql/h2/oceanbase etc.</span>
<span class="token key attr-name">    dbType</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;mysql&quot;</span>
<span class="token comment">	## mysql 5.xx</span>
<span class="token comment">    ## driverClassName = &quot;com.mysql.jdbc.Driver&quot;</span>
<span class="token comment">	## mysql 8.xx</span>
<span class="token key attr-name">	driverClassName</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;com.mysql.cj.jdbc.Driver&quot;</span>
<span class="token comment">    ## if using mysql to store the data, recommend add rewriteBatchedStatements=true in jdbc connection param</span>
<span class="token comment">    ## url = &quot;jdbc:mysql://127.0.0.1:3306/seata?rewriteBatchedStatements=true&quot;</span>
<span class="token key attr-name">	url</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;nullCatalogMeansCurrent=true&amp;serverTimezone=UTC&quot;</span>
<span class="token key attr-name">    user</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;root&quot;</span>
<span class="token key attr-name">    password</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;10086&quot;</span>
<span class="token key attr-name">    minConn</span> <span class="token punctuation">=</span> <span class="token value attr-value">5</span>
<span class="token key attr-name">    maxConn</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token key attr-name">    globalTable</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;global_table&quot;</span>
<span class="token key attr-name">    branchTable</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;branch_table&quot;</span>
<span class="token key attr-name">    lockTable</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;lock_table&quot;</span>
<span class="token key attr-name">    queryLimit</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token key attr-name">    maxWait</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000</span>
  }

<span class="token comment">  ## redis store property</span>
<span class="token key attr-name">  redis</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## redis mode: singleã€sentinel</span>
<span class="token key attr-name">    mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;single&quot;</span>
<span class="token comment">    ## single mode property</span>
<span class="token key attr-name">    single</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">      host</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1&quot;</span>
<span class="token key attr-name">      port</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;6379&quot;</span>
    }
<span class="token comment">    ## sentinel mode property</span>
<span class="token key attr-name">    sentinel</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">      masterName</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token comment">      ## such as &quot;10.28.235.65:26379,10.28.235.65:26380,10.28.235.65:26381&quot;</span>
<span class="token key attr-name">      sentinelHosts</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
    }
<span class="token key attr-name">    password</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token key attr-name">    database</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;0&quot;</span>
<span class="token key attr-name">    minConn</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">    maxConn</span> <span class="token punctuation">=</span> <span class="token value attr-value">10</span>
<span class="token key attr-name">    maxTotal</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token key attr-name">    queryLimit</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
  }
}
<span class="token comment">## 1.4.2 ç‰ˆæœ¬éœ€è¦è‡ªå·±æ‰‹åŠ¨å¢åŠ serviceæ¨¡å—</span>
<span class="token key attr-name">service</span> <span class="token value attr-value">{</span>
<span class="token comment">  #vgroup-&gt;rgroup</span>
<span class="token key attr-name">  vgroup_mapping.my_test_tx_group</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;my_group&quot;    </span>
<span class="token comment">  #only support single node</span>
<span class="token key attr-name">  default.grouplist</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:8091&quot;</span>
<span class="token comment">  #degrade current not support</span>
<span class="token key attr-name">  enableDegrade</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token comment">  #disable</span>
<span class="token key attr-name">  disable</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token comment">  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent</span>
<span class="token key attr-name">  max.commit.retry.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;-1&quot;</span>
<span class="token key attr-name">  max.rollback.retry.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;-1&quot;</span>
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_1-3-2-æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨" tabindex="-1"><a class="header-anchor" href="#_1-3-2-æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨" aria-hidden="true">#</a> 1.3.2 æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨</h6><p>æ•°æ®åº“æ–°å»ºåº“seataï¼Œå»ºè¡¨db_store.sqlåœ¨\seata-server-0.9.0\seata\confç›®å½•é‡Œé¢</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636533282768-affabe76-a21f-4727-aa06-ded73aaa73cb.png" alt="img"></p><h6 id="_1-3-3-ä¿®æ”¹seata-server-0-9-0-seata-confç›®å½•ä¸‹çš„registry-confé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-3-3-ä¿®æ”¹seata-server-0-9-0-seata-confç›®å½•ä¸‹çš„registry-confé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 1.3.3 ä¿®æ”¹seata-server-0.9.0\seata\confç›®å½•ä¸‹çš„registry.confé…ç½®æ–‡ä»¶</h6><p>ç›®çš„æ˜¯ï¼šæŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸ºnacosï¼ŒåŠä¿®æ”¹nacosè¿æ¥ä¿¡æ¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636533822408-2ed7382f-c9ba-41f2-af4d-c7a7313b4c1a.png" alt="img"></p><h6 id="_1-3-4-å¯åŠ¨nacoså’Œseata" tabindex="-1"><a class="header-anchor" href="#_1-3-4-å¯åŠ¨nacoså’Œseata" aria-hidden="true">#</a> 1.3.4 å¯åŠ¨nacoså’Œseata</h6><p>seata-server-0.9.0\seata\bin\seata-server.bat</p><p>å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636540085504-750df869-8d65-42d9-80af-30c3f4e927d5.png" alt="img"></p><p>è§£å†³ï¼š0.9.0é»˜è®¤çš„mysqlæ˜¯5.1.30ç‰ˆæœ¬ï¼Œå°†libæ–‡ä»¶å¤¹ä¸‹mysql-connector-java-5.1.30.jaråˆ é™¤ï¼Œæ›¿æ¢æˆè‡ªå·±mysqlç‰ˆæœ¬çš„jaråŒ…ï¼Œæˆ‘çš„æ˜¯mysql-connector-java-8.0.22.jarã€‚</p><p>å†æ¬¡å¯åŠ¨ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636540290726-7072e4b8-6751-4779-9ed6-829a06a63ee6.png" alt="img"></p><p>å‡ºç°è¿™äº›æç¤ºä¿¡æ¯ä»£è¡¨seataå¯åŠ¨æˆåŠŸã€‚</p><p>nacosä¸­æˆåŠŸæ³¨å†Œäº†seateï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636540463325-cae9956d-6610-43ac-ae3c-60c81e803afc.png" alt="img"></p><h5 id="seata-1-4-2ç‰ˆæœ¬å¡«å‘-nacosä½œä¸ºseataçš„æ³¨å†Œ-é…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#seata-1-4-2ç‰ˆæœ¬å¡«å‘-nacosä½œä¸ºseataçš„æ³¨å†Œ-é…ç½®ä¸­å¿ƒ" aria-hidden="true">#</a> Seata 1.4.2ç‰ˆæœ¬å¡«å‘---nacosä½œä¸ºseataçš„æ³¨å†Œ/é…ç½®ä¸­å¿ƒ</h5><p><a href="https://blog.csdn.net/weixin_44790046/article/details/106970822" target="_blank" rel="noopener noreferrer">seata1.2.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://blog.csdn.net/jixieguang/article/details/110621561" target="_blank" rel="noopener noreferrer">Seata1.4.0+nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Seata0.9.0ç‰ˆæœ¬ä¸æ”¯æŒé›†ç¾¤ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹éœ€è¦ä½¿ç”¨1.0.0ä»¥ä¸Šç‰ˆæœ¬ã€‚æˆ‘ä»¬è¿™é‡Œé…ç½®seataçš„æœ€æ–°ç‰ˆæœ¬1.4.2ï¼Œä¸‹è½½åæ–‡ä»¶ç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636963968461-50e5b2f3-d6e2-4156-bf95-09acb6ae7516.png" alt="img"></p><h6 id="_0-å¯åŠ¨nacos" tabindex="-1"><a class="header-anchor" href="#_0-å¯åŠ¨nacos" aria-hidden="true">#</a> 0. å¯åŠ¨nacos</h6><p>å¯åŠ¨nacosï¼Œæ–°å»ºä¸€ä¸ªå‘½åç©ºé—´seataç”¨äºå­˜æ”¾seataçš„é…ç½®ä¿¡æ¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637029808220-a37b6073-5157-410e-b0ac-a9ec6f165fd4.png" alt="img"></p><p>æ³¨æ„è¿™é‡Œçš„å‘½åç©ºé—´IDï¼Œåé¢ä¼šç”¨åˆ°ã€‚<strong>è¿™é‡Œä¸æ–°å»ºä¹Ÿå¯ä»¥ï¼Œseataä½¿ç”¨çš„æ˜¯publicã€‚</strong></p><p><strong>æˆ‘ä»¬ä½¿ç”¨nacoså……å½“seataçš„æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼</strong></p><h6 id="_1-ä¿®æ”¹é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-ä¿®æ”¹é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 1. ä¿®æ”¹é…ç½®æ–‡ä»¶</h6><p>######## â‘ è¿›å…¥confæ–‡ä»¶å¤¹ï¼Œä¿®æ”¹file.confæ–‡ä»¶</p><p>1.4.2ç‰ˆæœ¬å¯ä»¥å‚è€ƒfile.conf.example(serverç«¯)å’Œconfæ–‡ä»¶å¤¹ä¸‹<strong>README-zh.mdä¸­çš„client</strong>ç«¯é…ç½®</p><p>æ€»å…±éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼šæˆ‘è¿™é‡Œç”¨seate_1_4_2æ•°æ®åº“æ¥å¯¹åº”seata1.4.2ç‰ˆæœ¬</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636978078529-61784d3f-4230-46b3-8612-1dc1b1f61152.png" alt="img"></p><p>æœ€ç»ˆå®Œæ•´ä»£ç file.confï¼š<a href="https://www.yuque.com/attachments/yuque/0/2021/txt/22423156/1636978207422-66810a14-f335-4a73-8dee-998f58dfcd7c.txt" target="_blank" rel="noopener noreferrer">ğŸ“file.conf.txt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>######## â‘¡ä¿®æ”¹conf\registry.confæ–‡ä»¶</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636978611296-61ea13d9-ba2f-4343-a016-66f7ade007bd.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637047172825-51ffe35a-3d7b-451f-b7a9-4789089a03e4.png" alt="img"></p><p><strong>æ€è€ƒï¼šè¿™é‡Œæˆ‘ä»¬æŠŠseata-serverç«¯çš„configè®¾ç½®ä¸ºäº†nacosï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ç¬¬ä¸€æ­¥çš„file.confæ–‡ä»¶å°±ä¸å†éœ€è¦äº†ã€‚å› ä¸ºç›´æ¥ä»nacosè¯»å–é…ç½®ï¼Ÿ</strong></p><h6 id="_2-å°†é…ç½®å¯¼å…¥åˆ°nacos" tabindex="-1"><a class="header-anchor" href="#_2-å°†é…ç½®å¯¼å…¥åˆ°nacos" aria-hidden="true">#</a> 2. å°†é…ç½®å¯¼å…¥åˆ°nacos</h6><p>######## â‘  å‡†å¤‡nacos-config.shè„šæœ¬</p><p>åœ¨confæ–‡ä»¶å¤¹ä¸‹ï¼Œéœ€è¦æœ‰ä¸ªnacos-config.shæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶1.4.2ç‰ˆæœ¬æ²¡æœ‰ã€‚README-zh.mdæ–‡ä»¶ä¸­è®¿é—®<strong>config-center</strong>è¶…é“¾æ¥ï¼ˆ<a href="https://github.com/seata/seata/tree/develop/script/config-center%EF%BC%89%EF%BC%8Cnacos%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/tree/develop/script/config-centerï¼‰ï¼Œnacosæ–‡ä»¶å¤¹ä¸‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636979042179-785512f7-9422-4f15-b316-78bc0cb8ca43.png" alt="img"></p><p>ç”¨è¿™ä¸ªå¯ä»¥ç›´æ¥ä¸‹å½“å‰é¡µçš„æ–‡ä»¶<a href="http://blog.luckly-mjw.cn/tool-show/github-directory-downloader/index.html" target="_blank" rel="noopener noreferrer">github-directory-downloader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636979658725-0d097480-053f-4717-95f2-f0b517e69ee6.png" alt="img"></p><p><a href="https://www.yuque.com/attachments/yuque/0/2021/sh/22423156/1636979669265-dc8c3809-bc69-4326-95fb-06e2313bd41a.sh" target="_blank" rel="noopener noreferrer">ğŸ“nacos-config.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>######## â‘¡ config.txtå‡†å¤‡åŠä¿®æ”¹</p><p>åœ¨confç›®å½•ä¸‹è¿˜éœ€è¦ä¸€ä¸ªconfig.txtæ–‡ä»¶ï¼Œ1.4.2ç‰ˆæœ¬åŒæ ·æ²¡æœ‰ï¼Œè¿˜æ˜¯å»READMEé‡Œé¢çš„config-centerè¶…é“¾æ¥ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636979791988-612e5b27-d79c-4467-a096-28dd77757fdc.png" alt="img"></p><p>config.txtéœ€è¦æ”¾åœ¨confçš„ä¸Šçº§ç›®å½•ä¸‹ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637047258914-56fed840-82ca-4b98-90e4-8776b0e8f350.png" alt="img"></p><p>ä¿®æ”¹config.txtæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä¸»è¦æ˜¯ä¸‹é¢è¿™å‡ é¡¹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637047663366-547b68e5-66fc-4110-8336-61d030cc1656.png" alt="img"></p><p>æ”¹ä¸ºä½¿ç”¨dbå­˜å‚¨ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637047446901-badf8370-0ef1-46b7-ab5b-212198588148.png" alt="img"></p><p><strong>æ³¨æ„è¿™é‡Œstore.db.urlä¸­æ•°æ®åº“çš„åå­—å°±æ˜¯æˆ‘ä»¬ä¹‹åéœ€è¦æ–°å»ºçš„æ•°æ®åº“çš„åå­—ã€‚</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637060537507-74cbaa87-b363-4cf8-9345-f29a47c739c8.png" alt="img">ç›¸æ¯”äºå…¶ä»–ç‰ˆæœ¬ï¼Œ1.4.2è¿™é‡Œå¤šäº†ä¸ªdistributedLockTableã€‚</p><p>æ•´ä¸ªconfig.txtæ–‡ä»¶ä¸­ï¼Œstore.publicKeyã€store.redis.sentinel.masterNameã€store.redis.sentinel.sentinelHostsã€store.redis.passwordå››ä¸ªå±æ€§é»˜è®¤éƒ½æ˜¯ç©ºçš„<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637047508781-a702d6a3-cf10-4ebc-9606-8f2c039c79dc.png" alt="img">ã€‚æ‰€ä»¥åé¢åœ¨å°†config.txtæ–‡ä»¶ä¸­çš„é…ç½®æ³¨å†Œåˆ°nacosçš„æ—¶å€™ï¼Œä¼šå‡ºç°å››ä¸ªå¤±è´¥é¡¹ã€‚</p><p>######## â‘¢ å¯¼å…¥seataç›¸åº”çš„é…ç½®é¡¹åˆ°Nacos</p><p>config.txtå°±æ˜¯seataå„ç§è¯¦ç»†çš„é…ç½®ï¼Œæ‰§è¡Œnacos-config.shå³å¯å°†è¿™äº›é…ç½®å¯¼å…¥åˆ°nacosã€‚è¿™æ ·å°±ä¸éœ€è¦å°†file.confå’Œregistry.confæ”¾åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­äº†ï¼Œéœ€è¦ä»€ä¹ˆé…ç½®å°±ç›´æ¥ä»nacosä¸­è¯»å–ã€‚ï¼ˆè¿™å¥è¯æ˜¯å‚è€ƒåšå®¢<a href="https://blog.csdn.net/jixieguang/article/details/110621561%EF%BC%8C%E6%88%91%E8%A7%89%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%AF%B9%EF%BC%8C%E5%90%8E%E9%9D%A2registry.conf%E9%87%8C%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%99%BD%E7%84%B6%E4%B8%8D%E9%9C%80%E8%A6%81.conf%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%86%E6%98%AF%E9%9C%80%E8%A6%81%E5%9C%A8yml%E6%88%96properties%E6%96%87%E4%BB%B6%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%80%8Cfile.conf%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%9C%A8nacos%E4%B8%AD%E8%AF%BB%E5%8F%96%EF%BC%89" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/jixieguang/article/details/110621561ï¼Œæˆ‘è§‰ä¸å®Œå…¨å¯¹ï¼Œåé¢registry.confé‡Œçš„é…ç½®é¡¹è™½ç„¶ä¸éœ€è¦.confæ–‡ä»¶é…ç½®ï¼Œä½†æ˜¯éœ€è¦åœ¨ymlæˆ–propertiesæ–‡ä»¶ä¸­é…ç½®ï¼Œè€Œfile.confå¯ä»¥ç›´æ¥åœ¨nacosä¸­è¯»å–ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å¯¼å…¥é…ç½®ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637061235108-cd9a6f20-4af7-43ae-853f-9c7dfca5463a.png" alt="img"></p><p>ç„¶ååœ¨git bashç•Œé¢è¾“å…¥ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sh</span> nacos-config.sh -h localhost -p <span class="token number">8848</span> -g SEATA_GROUP -t f0378218-b129-4fd8-839c-9bdfd010205b -u nacos -w nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ³¨ï¼šhè¡¨ç¤ºnacosçš„åœ°å€ï¼Œpè¡¨ç¤ºç«¯å£å·ï¼Œgè¡¨ç¤ºé…ç½®çš„åˆ†ç»„ï¼Œtè¡¨ç¤ºå‘½åç©ºé—´çš„IDï¼Œuè·Ÿwè¡¨ç¤ºnacosçš„è´¦æˆ·å¯†ç ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®å‘½åç©ºé—´ï¼Œè€Œä¸”éƒ½æ˜¯é»˜è®¤é€‰é¡¹ç›´æ¥ <code>sh nacos-config.sh -h localhost</code>å°±è¡Œã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637061534007-6fd0a49d-3739-45a5-99ec-716b0f42ce8b.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°å…±98é¡¹ï¼Œå¯¼å…¥å¤±è´¥4é¡¹ï¼Œå°±æ˜¯ä¸Šé¢æ²¡æœ‰å€¼çš„é‚£å››é¡¹ï¼ˆä¸å½±å“ï¼Œå¦‚æœç”¨åˆ°ç›´æ¥åœ¨nacosé‡Œé¢æ–°å»ºé…ç½®å³å¯ï¼‰</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637061628150-648485a8-cafa-4442-8f24-c0f4d1f292f3.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œnacosçš„seataå‘½åç©ºé—´ä¸­å·²ç»å¯¼å…¥äº†é…ç½®é¡¹ã€‚ï¼ˆseataå‘½åç©ºé—´æ˜¯æˆ‘è‡ªå·±åˆ›å»ºçš„ï¼Œå¯ä»¥æŒ‰è‡ªå·±çš„éœ€æ±‚åˆ›å»ºï¼Œä¸åˆ›å»ºé»˜è®¤çš„å°±æ˜¯publicã€‚ï¼‰</p><h6 id="_3-æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨" aria-hidden="true">#</a> 3. æ•°æ®åº“ä¸­å»ºåº“å»ºè¡¨</h6><p>æˆ‘ä»¬å…ˆåˆ›å»ºæ•°æ®åº“seata1_4_2ï¼ˆæ•°æ®åº“è¦ä¸config.txtä¸­dbè®¾ç½®é‚£é‡Œå¯¹åº”ï¼‰ï¼Œæ•°æ®åº“çš„å»ºè¡¨è¯­å¥åœ¨READMEæ–‡ä»¶çš„serverè¿æ¥ä¸­ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636543057789-77a7f2ee-9448-4d64-8e4e-95a2b5e1d8c4.png" alt="img"></p><p>ç„¶åæ‰§è¡Œmysql.sqlï¼ˆ1.4.2å¤šäº†ä¸ªdistributed_lockè¡¨ï¼Œå’Œä¸€äº›æ’å…¥è¯­å¥ï¼‰ï¼š</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------</span>
<span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span>       <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_value<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;AsyncCommitting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;RetryCommitting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;RetryRollbacking&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;TxTimeoutCheck&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637062163704-a5352fe8-9d6d-4997-97c4-a09f41404864.png" alt="img">ï¼Œè¿™å››å¼ è¡¨è·Ÿconfig.txtæ–‡ä»¶ä¸­çš„é…ç½®å¯¹åº”ã€‚</p><h6 id="_4-å¯åŠ¨seata" tabindex="-1"><a class="header-anchor" href="#_4-å¯åŠ¨seata" aria-hidden="true">#</a> 4. å¯åŠ¨seata</h6><p>è¿è¡Œbinç›®å½•ä¸‹çš„seata-server.batã€‚</p><p>å‡ºç°ä¸‹é¢å­—æ®µè¡¨ç¤ºseataå¯åŠ¨æˆåŠŸã€‚seataå¯åŠ¨æ—¥å¿—åœ¨C:\Users\admin\logs\seataæ–‡ä»¶å¤¹ä¸‹ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636544358754-13d5bceb-8223-4f92-8fe1-7e196e59906d.png" alt="img"></p><p>nacosä¸­åœ¨seataå‘½åç©ºé—´å†…ä¹ŸæˆåŠŸæ³¨å†Œï¼Œæ³¨æ„è¿™é‡ŒæœåŠ¡åå¯¹åº”çš„æ˜¯registry.confæ–‡ä»¶ä¸­nacosä¸‹é¢applicationçš„å€¼ã€‚0.9.0ç‰ˆæœ¬å¥½åƒè®¾ç½®ä¸äº†è¿™ä¸ªï¼Œé»˜è®¤æ˜¯serverAddrã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637062927719-91dd19dc-bf55-4d31-975a-f3a4d9225f59.png" alt="img"></p><h3 id="äºŒã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" aria-hidden="true">#</a> äºŒã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡</h3><p>ä»¥ä¸‹æ¼”ç¤ºéƒ½éœ€è¦å…ˆå¯åŠ¨Nacosåå¯åŠ¨Seataï¼Œä¿è¯ä¸¤ä¸ªéƒ½OKã€‚Seataæ²¡å¯åŠ¨æŠ¥é”™no available server to connectã€‚</p><h5 id="_2-1-åˆ†å¸ƒå¼äº‹åŠ¡ä¸šåŠ¡è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_2-1-åˆ†å¸ƒå¼äº‹åŠ¡ä¸šåŠ¡è¯´æ˜" aria-hidden="true">#</a> 2.1 åˆ†å¸ƒå¼äº‹åŠ¡ä¸šåŠ¡è¯´æ˜</h5><p>è¿™é‡Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸‰ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œä¸€ä¸ªåº“å­˜æœåŠ¡ï¼Œä¸€ä¸ªè´¦æˆ·æœåŠ¡ã€‚</p><p>å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šåœ¨è®¢å•æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œç„¶åé€šè¿‡è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ¥æ‰£å‡ä¸‹å•å•†å“çš„åº“å­˜ï¼Œå†é€šè¿‡è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ¥æ‰£å‡ç”¨æˆ·è´¦æˆ·é‡Œé¢çš„ä½™é¢ï¼Œæœ€ååœ¨è®¢å•æœåŠ¡ä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆã€‚</p><p>è¯¥æ“ä½œè·¨è¶Šä¸‰ä¸ªæ•°æ®åº“ï¼Œæœ‰ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><p>ä¸‹è®¢å•---&gt;æ‰£åº“å­˜---&gt;å‡è´¦æˆ·(ä½™é¢)</p><h5 id="_2-2-åˆ›å»ºä¸šåŠ¡æ•°æ®åº“ä¸è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-2-åˆ›å»ºä¸šåŠ¡æ•°æ®åº“ä¸è¡¨" aria-hidden="true">#</a> 2.2 åˆ›å»ºä¸šåŠ¡æ•°æ®åº“ä¸è¡¨</h5><h6 id="_1-åˆ›å»ºä¸šåŠ¡æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸šåŠ¡æ•°æ®åº“" aria-hidden="true">#</a> 1. åˆ›å»ºä¸šåŠ¡æ•°æ®åº“</h6><ul><li>seata_orderï¼šå­˜å‚¨è®¢å•çš„æ•°æ®åº“ï¼›</li><li>seata_storageï¼šå­˜å‚¨åº“å­˜çš„æ•°æ®åº“ï¼›</li><li>seata_accountï¼šå­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ã€‚</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_order<span class="token punctuation">;</span>
 
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_storage<span class="token punctuation">;</span>
 
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_account<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨" aria-hidden="true">#</a> 2. æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨</h6><p>seata_orderåº“ä¸‹å»ºt_orderè¡¨ï¼š</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> seata_order<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>t_order<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;äº§å“id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ•°é‡&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>money<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;é‡‘é¢&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“&#39;</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">7</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>seata_storageåº“ä¸‹å»ºt_storage è¡¨:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>seata_storage<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>t_storage<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
 <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;äº§å“id&#39;</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ€»åº“å­˜&#39;</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å·²ç”¨åº“å­˜&#39;</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å‰©ä½™åº“å­˜&#39;</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
 
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> seata_storage<span class="token punctuation">.</span>t_storage<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>product_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;100&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;100&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>seata_accountåº“ä¸‹å»ºt_account è¡¨:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>seata_account<span class="token punctuation">`</span></span><span class="token punctuation">.</span>t_account <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ€»é¢åº¦&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å·²ç”¨ä½™é¢&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å‰©ä½™å¯ç”¨é¢åº¦&#39;</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> seata_account<span class="token punctuation">.</span>t_account<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>total<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>used<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>residue<span class="token punctuation">`</span></span><span class="token punctuation">)</span>  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1000&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_3-æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨" aria-hidden="true">#</a> 3. æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨</h6><p>è®¢å•-åº“å­˜-è´¦æˆ·3ä¸ªåº“ä¸‹éƒ½éœ€è¦å»ºå„è‡ªçš„å›æ»šæ—¥å¿—è¡¨ï¼Œ\seata-server-0.9.0\seata\confç›®å½•ä¸‹çš„db_undo_log.sqlï¼›1.4.2ç‰ˆæœ¬çš„åœ¨README_ZHæ–‡ä»¶ä¸­çš„clientï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636548279472-a160bd9b-045f-4a31-93ab-6e56480ae2f6.png" alt="img"><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636548287477-760e3369-f841-4a74-8c07-c51cc4a2c77f.png" alt="img"></p><p>**æ³¨æ„ï¼š**<strong>0.9ç‰ˆæœ¬è·Ÿ1.4.2ç‰ˆæœ¬çš„undo_logè¡¨çš„å±æ€§æœ‰å·®åˆ«ï¼Œ<strong><strong>1.4.2ç‰ˆæœ¬æ²¡æœ‰idè·Ÿextè¿™ä¸¤ä¸ªå±æ€§</strong></strong>ï¼Œä¸ªäººè§‰å¾—ä½¿ç”¨ä¸Šæ²¡æœ‰å½±å“</strong></p><p>è¿™é‡Œçš„è¯æˆ‘è¿˜æ˜¯æŒ‰0.9.0ç‰ˆæœ¬æ¥å»ºè¡¨ã€‚</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 0.9.0 ç‰ˆæœ¬</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>ext<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment"># 1.4.2ç‰ˆæœ¬</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;branch transaction id&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;global transaction id&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;undo_log context,such as serialization&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;rollback info&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;0:normal status,1:defense status&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;create datetime&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;modify datetime&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">&#39;AT transaction mode undo table&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆæ•ˆæœï¼š è¿™é‡Œå±•ç¤ºäº†1.4.2ç‰ˆæœ¬è·Ÿ0.9ç‰ˆæœ¬ï¼Œå®é™…ä¸­ç”¨ä¸€ä¸ªå°±è¡Œï¼Œåˆ«çš„ç‰ˆæœ¬ä¸€æ ·ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636548808495-fa194c4f-7fc4-4863-871d-b044e93b9500.png" alt="img"></p><h3 id="ä¸‰ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡" aria-hidden="true">#</a> ä¸‰ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡</h3><p>ä¸šåŠ¡éœ€æ±‚ï¼šä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;æ‰£ä½™é¢-&gt;æ”¹(è®¢å•)çŠ¶æ€</p><hr><h5 id="ç‰ˆæœ¬å¯¹åº”å…³ç³»â€”â€”å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬å¯¹åº”å…³ç³»â€”â€”å¾ˆé‡è¦" aria-hidden="true">#</a> ç‰ˆæœ¬å¯¹åº”å…³ç³»â€”â€”å¾ˆé‡è¦</h5><p>**æ³¨æ„ï¼š**ç”±äºseata0.9.0ç‰ˆæœ¬è·Ÿ1.0ä¹‹åçš„ç‰ˆæœ¬ï¼ˆæ”¯æŒymlã€propertiesé…ç½®ï¼‰åŒºåˆ«å·¨å¤§ï¼Œè¿™é‡Œä½¿ç”¨0.9.0ç‰ˆæœ¬ï¼ˆè·Ÿè§†é¢‘ä¸€è‡´ï¼‰ï¼Œå…¶ç‰ˆæœ¬å¯¹åº”å…³ç³»è§<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬è¯´æ˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ï¼ˆ<strong>seata0.9.0 + nacos 1.1.4 + sentinel 1.7.0 + SpringCloud Alibaba 2.1.1RELEASE</strong>ï¼‰å‰é¢ç”¨çš„å„ç»„ä»¶ç‰ˆæœ¬å¾—å¯¹åº”ä¸Šï¼ˆå¤´ç–¼ï¼‰</p><h5 id="_3-1-æ–°å»ºè®¢å•order-moduleâ€”â€”seata-order-service2001" tabindex="-1"><a class="header-anchor" href="#_3-1-æ–°å»ºè®¢å•order-moduleâ€”â€”seata-order-service2001" aria-hidden="true">#</a> 3.1 æ–°å»ºè®¢å•Order-Moduleâ€”â€”seata-order-service2001</h5><p>æ–°å»ºseata-order-service2001</p><h6 id="_1-pom-2" tabindex="-1"><a class="header-anchor" href="#_1-pom-2" aria-hidden="true">#</a> (1) pom</h6><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-order-service2001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- å› ä¸ºå…¼å®¹ç‰ˆæœ¬é—®é¢˜,æ‰€ä»¥éœ€è¦å‰”é™¤å®ƒè‡ªå¸¦çš„seataçš„åŒ… --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     		<span class="token comment">&lt;!-- è¦è·Ÿæˆ‘ä»¬å®‰è£…SeaTaçš„ä¸€è‡´ï¼ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--feign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web-actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mysql-druid--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-application-yml" tabindex="-1"><a class="header-anchor" href="#_2-application-yml" aria-hidden="true">#</a> (2) application.yml</h6><p>è¿™é‡Œé…ç½®çš„æ˜¯æˆ‘ä»¬è‡ªå·±å¾®æœåŠ¡çš„æ•°æ®æº</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>order<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span>
        <span class="token comment">#è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­file.confä¸­é…ç½®çš„äº‹åŠ¡ç»„IDå¯¹åº”</span>
        <span class="token comment">#vgroup_mapping.my_test_tx_group = &quot;my_group&quot;</span>
        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> my_group
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_order<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">10086</span>

<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info

<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-file-conf" tabindex="-1"><a class="header-anchor" href="#_3-file-conf" aria-hidden="true">#</a> (3) file.conf</h6><p>ç¨‹åºä¸­ä¾èµ–çš„æ˜¯ seata-allï¼Œå¯¹åº”äº *.conf æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨resourceæ–°å»º.confæ–‡ä»¶ï¼Œé«˜ç‰ˆæœ¬çš„æ”¯æŒymlã€propertiesé…ç½®ã€‚è¿™é‡Œä»…ä»…æ˜¯seata-order-service2001æ¨¡å—çš„file.confï¼ˆé…ç½®2001çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ï¼Œseataè½¯ä»¶é‚£é‡Œé…ç½®çš„æ˜¯æ€»æ§file.confã€‚</p><p>æ³¨æ„ä¿®æ”¹è¿™ä¸¤å¤„ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636715541883-b0548d85-0e4a-440e-821b-f07c2d75f270.png" alt="img"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">transport</span> <span class="token value attr-value">{</span>
<span class="token comment">  # tcp udt unix-domain-socket</span>
<span class="token key attr-name">  type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;TCP&quot;</span>
<span class="token comment">  #NIO NATIVE</span>
<span class="token key attr-name">  server</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NIO&quot;</span>
<span class="token comment">  #enable heartbeat</span>
<span class="token key attr-name">  heartbeat</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token comment">  #thread factory for netty</span>
<span class="token key attr-name">  thread-factory</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    boss-thread-prefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NettyBoss&quot;</span>
<span class="token key attr-name">    worker-thread-prefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NettyServerNIOWorker&quot;</span>
<span class="token key attr-name">    server-executor-thread-prefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NettyServerBizHandler&quot;</span>
<span class="token key attr-name">    share-boss-worker</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">    client-selector-thread-prefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NettyClientSelector&quot;</span>
<span class="token key attr-name">    client-selector-thread-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">    client-worker-thread-prefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;NettyClientWorkerThread&quot;</span>
<span class="token comment">    # netty boss thread size,will not be used for UDT</span>
<span class="token key attr-name">    boss-thread-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token comment">    #auto default pin or 8</span>
<span class="token key attr-name">    worker-thread-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">8</span>
  }
<span class="token key attr-name">  shutdown</span> <span class="token value attr-value">{</span>
<span class="token comment">    # when destroy server, wait seconds</span>
<span class="token key attr-name">    wait</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
  }
<span class="token key attr-name">  serialization</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;seata&quot;</span>
<span class="token key attr-name">  compressor</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;none&quot;</span>
}

<span class="token key attr-name">service</span> <span class="token value attr-value">{</span>
<span class="token comment">  #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°ï¼Œè¿™é‡Œè·Ÿåœ¨seataé‡Œé…ç½®çš„ä¸ä¸€æ ·ï¼Œè¿™é‡Œåªé’ˆå¯¹2001è‡ªå·±çš„äº‹åŠ¡ï¼Œ</span>
<span class="token comment">  #è€Œseataé‡Œé’ˆå¯¹çš„æ˜¯æ•´ä¸ªåˆ†å¸ƒå¼å…¨å±€äº‹åŠ¡</span>
<span class="token comment">  #è¿™é‡Œè¦æ³¨æ„ vgroup_mapping. åé¢çš„å€¼ï¼Œè¦è·Ÿseata-serverå®‰è£…æ—¶ conf æ–‡ä»¶å¤¹ä¸‹file.conf serviceæ¨¡å—è®¾å®šçš„</span>
<span class="token comment">  #vgroup_mapping.my_test_tx_group = &quot;my_group&quot;</span>
<span class="token key attr-name">  vgroup_mapping.my_group</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>

<span class="token key attr-name">  default.grouplist</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:8091&quot;</span>
<span class="token key attr-name">  enableDegrade</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">  disable</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">  max.commit.retry.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;-1&quot;</span>
<span class="token key attr-name">  max.rollback.retry.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;-1&quot;</span>
<span class="token key attr-name">  disableGlobalTransaction</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
}


<span class="token key attr-name">client</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">  async.commit.buffer.limit</span> <span class="token punctuation">=</span> <span class="token value attr-value">10000</span>
<span class="token key attr-name">  lock</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    retry.internal</span> <span class="token punctuation">=</span> <span class="token value attr-value">10</span>
<span class="token key attr-name">    retry.times</span> <span class="token punctuation">=</span> <span class="token value attr-value">30</span>
  }
<span class="token key attr-name">  report.retry.count</span> <span class="token punctuation">=</span> <span class="token value attr-value">5</span>
<span class="token key attr-name">  tm.commit.retry.count</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">  tm.rollback.retry.count</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
}

<span class="token comment">## transaction log store</span>
<span class="token key attr-name">store</span> <span class="token value attr-value">{</span>
<span class="token comment">  ## store mode: fileã€db</span>
<span class="token key attr-name">  mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;db&quot;</span>

<span class="token comment">  ## file store</span>
<span class="token key attr-name">  file</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    dir</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;sessionStore&quot;</span>

<span class="token comment">    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span>
<span class="token key attr-name">    max-branch-session-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">16384</span>
<span class="token comment">    # globe session size , if exceeded throws exceptions</span>
<span class="token key attr-name">    max-global-session-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">512</span>
<span class="token comment">    # file buffer size , if exceeded allocate new buffer</span>
<span class="token key attr-name">    file-write-buffer-cache-size</span> <span class="token punctuation">=</span> <span class="token value attr-value">16384</span>
<span class="token comment">    # when recover batch read size</span>
<span class="token key attr-name">    session.reload.read_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token comment">    # async, sync</span>
<span class="token key attr-name">    flush-disk-mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">async</span>
  }

<span class="token comment">  ## database store</span>
<span class="token key attr-name">  db</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.</span>
<span class="token key attr-name">    datasource</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;dbcp&quot;</span>
<span class="token comment">    ## mysql/oracle/h2/oceanbase etc.</span>
<span class="token key attr-name">    db-type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;mysql&quot;</span>
<span class="token comment">    ## è¿™é‡Œè¦æ³¨æ„mysql5è·Ÿmysql8ä¸ä¸€æ ·</span>
<span class="token key attr-name">    driver-class-name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;com.mysql.cj.jdbc.Driver&quot;</span>
<span class="token key attr-name">    url</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC&quot;</span>
<span class="token key attr-name">    user</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;root&quot;</span>
<span class="token key attr-name">    password</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;10086&quot;</span>
<span class="token key attr-name">    min-conn</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">    max-conn</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">    global.table</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;global_table&quot;</span>
<span class="token key attr-name">    branch.table</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;branch_table&quot;</span>
<span class="token key attr-name">    lock-table</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;lock_table&quot;</span>
<span class="token key attr-name">    query-limit</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
  }
}
<span class="token key attr-name">lock</span> <span class="token value attr-value">{</span>
<span class="token comment">  ## the lock store mode: localã€remote</span>
<span class="token key attr-name">  mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;remote&quot;</span>

<span class="token key attr-name">  local</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## store locks in user&#39;s database</span>
  }

<span class="token key attr-name">  remote</span> <span class="token value attr-value">{</span>
<span class="token comment">    ## store locks in the seata&#39;s server</span>
  }
}
<span class="token key attr-name">recovery</span> <span class="token value attr-value">{</span>
<span class="token comment">  #schedule committing retry period in milliseconds</span>
<span class="token key attr-name">  committing-retry-period</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token comment">  #schedule asyn committing retry period in milliseconds</span>
<span class="token key attr-name">  asyn-committing-retry-period</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token comment">  #schedule rollbacking retry period in milliseconds</span>
<span class="token key attr-name">  rollbacking-retry-period</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token comment">  #schedule timeout retry period in milliseconds</span>
<span class="token key attr-name">  timeout-retry-period</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
}

<span class="token key attr-name">transaction</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">  undo.data.validation</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">  undo.log.serialization</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;jackson&quot;</span>
<span class="token key attr-name">  undo.log.save.days</span> <span class="token punctuation">=</span> <span class="token value attr-value">7</span>
<span class="token comment">  #schedule delete expired undo_log in milliseconds</span>
<span class="token key attr-name">  undo.log.delete.period</span> <span class="token punctuation">=</span> <span class="token value attr-value">86400000</span>
<span class="token key attr-name">  undo.log.table</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;undo_log&quot;</span>
}

<span class="token comment">## metrics settings</span>
<span class="token key attr-name">metrics</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">  enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">  registry-type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;compact&quot;</span>
<span class="token comment">  # multi exporters use comma divided</span>
<span class="token key attr-name">  exporter-list</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;prometheus&quot;</span>
<span class="token key attr-name">  exporter-prometheus-port</span> <span class="token punctuation">=</span> <span class="token value attr-value">9898</span>
}

<span class="token key attr-name">support</span> <span class="token value attr-value">{</span>
<span class="token comment">  ## spring</span>
<span class="token key attr-name">  spring</span> <span class="token value attr-value">{</span>
<span class="token comment">    # auto proxy the DataSource bean</span>
<span class="token key attr-name">    datasource.autoproxy</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡ ä¸ªé…ç½®æ–‡ä»¶å¯¹åº”å…³ç³»</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636715439474-c19e0db9-7d20-41f3-acba-898bb1071b32.png" alt="img"></p><h6 id="_4-registry-conf" tabindex="-1"><a class="header-anchor" href="#_4-registry-conf" aria-hidden="true">#</a> (4) registry.conf</h6><p>æŒ‡æ˜æ³¨å†Œåˆ°nacosä¸­ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636553697753-f5c87f38-aeed-42e2-8e09-5c8daf7f81bb.png" alt="img"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">registry</span> <span class="token value attr-value">{</span>
<span class="token comment">  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span>
<span class="token key attr-name">  type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>

<span class="token key attr-name">  nacos</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;localhost:8848&quot;    # å¦‚æœnacosä¸åœ¨æœ¬æœºï¼Œå°±å†™æœåŠ¡å™¨çš„IP</span>
<span class="token key attr-name">    namespace</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
  }
<span class="token key attr-name">  eureka</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serviceUrl</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;http://localhost:8761/eureka&quot;</span>
<span class="token key attr-name">    application</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    weight</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;1&quot;</span>
  }
<span class="token key attr-name">  redis</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;localhost:6379&quot;</span>
<span class="token key attr-name">    db</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;0&quot;</span>
  }
<span class="token key attr-name">  zk</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:2181&quot;</span>
<span class="token key attr-name">    session.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">6000</span>
<span class="token key attr-name">    connect.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">2000</span>
  }
<span class="token key attr-name">  consul</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:8500&quot;</span>
  }
<span class="token key attr-name">  etcd3</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;http://localhost:2379&quot;</span>
  }
<span class="token key attr-name">  sofa</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:9603&quot;</span>
<span class="token key attr-name">    application</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    region</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;DEFAULT_ZONE&quot;</span>
<span class="token key attr-name">    datacenter</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;DefaultDataCenter&quot;</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    group</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;SEATA_GROUP&quot;</span>
<span class="token key attr-name">    addressWaitTime</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;3000&quot;</span>
  }
<span class="token key attr-name">  file</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;file.conf&quot;</span>
  }
}

<span class="token key attr-name">config</span> <span class="token value attr-value">{</span>
<span class="token comment">  # fileã€nacos ã€apolloã€zkã€consulã€etcd3</span>
<span class="token key attr-name">  type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;file&quot;</span>

<span class="token key attr-name">  nacos</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;localhost&quot;</span>
<span class="token key attr-name">    namespace</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
  }
<span class="token key attr-name">  consul</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:8500&quot;</span>
  }
<span class="token key attr-name">  apollo</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    app.id</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;seata-server&quot;</span>
<span class="token key attr-name">    apollo.meta</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;http://192.168.1.204:8801&quot;</span>
  }
<span class="token key attr-name">  zk</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;127.0.0.1:2181&quot;</span>
<span class="token key attr-name">    session.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">6000</span>
<span class="token key attr-name">    connect.timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">2000</span>
  }
<span class="token key attr-name">  etcd3</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;http://localhost:2379&quot;</span>
  }
<span class="token key attr-name">  file</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;file.conf&quot;</span>
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_5-domain" tabindex="-1"><a class="header-anchor" href="#_5-domain" aria-hidden="true">#</a> (5) domain</h6><p>domain å°±æ˜¯entityï¼ˆpojoï¼Œbeanï¼‰ï¼Œå¯¹åº”æ•°æ®åº“çš„è¡¨ï¼Œä¸åŒå…¬å¸ä¹ æƒ¯ä¸ä¸€æ ·ã€‚</p><p>æ–°å»ºOrderç±»ä¸CommonResultç±»</p><p>######## Order</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## CommonResult</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_6-daoæ¥å£åŠå®ç°-sqlæ˜ å°„æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_6-daoæ¥å£åŠå®ç°-sqlæ˜ å°„æ–‡ä»¶" aria-hidden="true">#</a> (6) Daoæ¥å£åŠå®ç°(SQLæ˜ å°„æ–‡ä»¶)</h6><p>daoä¸­è‡³å°‘è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åˆ›å»ºè®¢å•ï¼Œä¸€ä¸ªæ˜¯ä¿®æ”¹è®¢å•çŠ¶æ€</p><p>######## OrderDao</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> MrLinxi
 * @Description
 * <span class="token keyword">@create</span> 2021-11-10-22:24
 */</span>
<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œä»0æ”¹ä¸º1
     */</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## OrderMapper.xml</p><p>resourcesæ–‡ä»¶å¤¹ä¸‹æ–°å»ºmapperæ–‡ä»¶å¤¹åæ·»åŠ OrderMapper.xmlã€‚å®Œæˆdaoçš„å…·ä½“å®ç°ã€‚</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.dao.OrderDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--å®šä¹‰ä¸€ä¸ªç»“æœé›†å’Œå®ä½“ç±»çš„æ˜ å°„è¡¨--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.domain.Order<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>productId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>status<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>status<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>create<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        INSERT INTO `t_order` (`id`, `user_id`, `product_id`, `count`, `money`, `status`)
        VALUES (NULL, #{userId}, #{productId}, #{count}, #{money}, 0);
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>update<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        UPDATE `t_order`
        SET status = 1
        WHERE user_id = #{userId} AND status = #{status};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_7-serviceæ¥å£åŠå®ç°" tabindex="-1"><a class="header-anchor" href="#_7-serviceæ¥å£åŠå®ç°" aria-hidden="true">#</a> (7) Serviceæ¥å£åŠå®ç°</h6><p><strong>Order2001é©±åŠ¨è‡ªå·±ï¼Œå¤–åŠ è°ƒç”¨åº“å­˜å’Œè´¦æˆ·ï¼šå…±3ä¸ªservice</strong></p><p>######## OrderService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºè®¢å•</span>
    <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## StorageService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token comment">//é€šè¿‡OpenFeignè¿œç¨‹è°ƒç”¨åº“å­˜çš„å¾®æœåŠ¡</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;seata-storage-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ‰£å‡åº“å­˜ï¼Œæ¯”å¦‚ä¹°äº†5ä¸ª1å·å•†å“ï¼šå¯¹1å·å•†å“åº“å­˜å‡5</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/storage/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## AccountService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token comment">//é€šè¿‡OpenFeignè¿œç¨‹è°ƒç”¨è´¦å·å¾®æœåŠ¡</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;seata-account-service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ‰£å‡è´¦æˆ·ä½™é¢ï¼Œéœ€è¦ä¼ å…¥ç”¨æˆ·IDè·Ÿæ‰£é™¤çš„é‡‘é¢</span>
    <span class="token comment">//@RequestMapping(value = &quot;/account/decrease&quot;, method = RequestMethod.POST, produces = &quot;application/json; charset=UTF-8&quot;)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/account/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## OrderServiceImpl</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">OrderDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AccountService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">StorageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€
     * ç®€å•è¯´ï¼š
     * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;ä¸‹å•å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æœ¬åº”ç”¨åˆ›å»ºè®¢å•</span>
        orderDao<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨åº“å­˜å¾®æœåŠ¡ï¼Œæ‰£å‡åº“å­˜å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        storageService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨åº“å­˜å¾®æœåŠ¡ï¼Œæ‰£å‡åº“å­˜ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨è´¦æˆ·å¾®æœåŠ¡ï¼Œæ‰£å‡ä½™é¢å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨è´¦æˆ·å¾®æœåŠ¡ï¼Œå‡ä½™é¢ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿™é‡Œçš„è¯æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯orderIdï¼Ÿ</span>
        orderDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;ä¸‹å•ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_8-controller" tabindex="-1"><a class="header-anchor" href="#_8-controller" aria-hidden="true">#</a> (8) controller</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token comment">//åˆ›å»ºè®¢å•</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/order/create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        orderService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;è®¢å•åˆ›å»ºæˆåŠŸ!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_9-config" tabindex="-1"><a class="header-anchor" href="#_9-config" aria-hidden="true">#</a> (9) config</h6><p>######## MyBatisConfig</p><p>mybatisé…ç½®ç±»ï¼Œç»‘å®šå®ç°æ–‡ä»¶OrderMapper.xmlä¸Daoæ¥å£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;com.atguigu.cloudalibaba.dao&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## DataSourceProxyConfig</p><p>DataSouceçš„åŒ…æ˜¯sqlä¸‹çš„ï¼ŒDataSourceProxyæ˜¯seataä¸‹çš„ï¼Œä¸è¦æé”™äº†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636623945614-0c74dca4-e78e-4a6d-b65f-f3bf588c143c.png" alt="img"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">SpringManagedTransactionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Primary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">PathMatchingResourcePatternResolver</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span>

<span class="token comment">//ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç†</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceProxyConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${mybatis.mapperLocations}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mapperLocations<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
<span class="token comment">//    @Primary</span>
    <span class="token comment">//DataSourceProxyæ–¹æ³•ä¸Šæ ‡æ³¨@Primaryå°±å¯ä»¥äº†ï¼Œè¿™æ ·å°±è‡ªåŠ¨ç”¨çš„ä»£ç†çš„DataSource(DSçš„å­ç±»)ï¼Œ</span>
    <span class="token comment">// è€Œä¸æ˜¯Druidçš„, å¦åˆ™å°±éœ€è¦è‡ªå·±æ„é€ sqlSessionFactory</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceProxy</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProxy</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProxy</span> dataSourceProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SqlSessionFactoryBean</span> sqlSessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSessionFactoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSourceProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSessionFactoryBean<span class="token punctuation">.</span><span class="token function">setMapperLocations</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>mapperLocations<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSessionFactoryBean<span class="token punctuation">.</span><span class="token function">setTransactionFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sqlSessionFactoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_10-ä¸»å¯åŠ¨ç±»" tabindex="-1"><a class="header-anchor" href="#_10-ä¸»å¯åŠ¨ç±»" aria-hidden="true">#</a> (10) ä¸»å¯åŠ¨ç±»</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»º</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataOrderMainApp2001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataOrderMainApp2001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## å¯åŠ¨æµ‹è¯•</p><p>å…ˆå¯åŠ¨nacos-1.1.4å’Œseata-0.9.0ï¼Œå†å¯åŠ¨2001ã€‚</p><p>2001å¯åŠ¨æˆåŠŸï¼ŒæˆåŠŸæ³¨å†Œåˆ°nacosä¸­</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636722603007-0a6df6bf-28d9-44dd-8d58-e76b14d94427.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636722630747-fbdc8cc0-dd4c-45bf-96cb-4da7906a623e.png" alt="img"></p><p>æµ‹è¯•nacos-2.0.3å’Œseata-0.9.0ï¼Œå†å¯åŠ¨2001 ä¹Ÿå¯ä»¥å¯åŠ¨æˆåŠŸ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636722844267-369a9bea-7ac3-4d0a-a2f0-ef322fc362d4.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636722828489-0bdc54a6-0acc-4a8f-8972-ff8d7ba0985a.png" alt="img"></p><h5 id="_3-2-æ–°å»ºåº“å­˜storage-moduleâ€”â€”seata-storage-service2002" tabindex="-1"><a class="header-anchor" href="#_3-2-æ–°å»ºåº“å­˜storage-moduleâ€”â€”seata-storage-service2002" aria-hidden="true">#</a> 3.2 æ–°å»ºåº“å­˜Storage-Moduleâ€”â€”seata-storage-service2002</h5><h6 id="_1-pom-3" tabindex="-1"><a class="header-anchor" href="#_1-pom-3" aria-hidden="true">#</a> (1) pom</h6><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-storage-service2002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- å› ä¸ºå…¼å®¹ç‰ˆæœ¬é—®é¢˜,æ‰€ä»¥éœ€è¦å‰”é™¤å®ƒè‡ªå¸¦çš„seataçš„åŒ… --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--è¿™é‡Œå¼•å…¥çš„ç‰ˆæœ¬è¦è·Ÿå®‰è£…çš„ç‰ˆæœ¬å¯¹åº”--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--feign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web-actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mysql-druid--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-application-yml-1" tabindex="-1"><a class="header-anchor" href="#_2-application-yml-1" aria-hidden="true">#</a> (2) application.yml</h6><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2002</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>storage<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span>
        <span class="token comment">#è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­file.confä¸­é…ç½®çš„äº‹åŠ¡ç»„IDå¯¹åº”</span>
        <span class="token comment">#vgroup_mapping.my_test_tx_group = &quot;my_group&quot;</span>
        <span class="token comment">#        tx-service-group: my_test_tx_group</span>
        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> my_group
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_storage<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">10086</span>

<span class="token comment">#æœåŠ¡æä¾›ç«¯ä¸éœ€è¦è¿œç¨‹è°ƒç”¨</span>
<span class="token comment">#feign:</span>
<span class="token comment">#  hystrix:</span>
<span class="token comment">#    enabled: false</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info

<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token comment"># æ‰«æç±»è·¯å¾„ä¸‹mapperæ–‡ä»¶å¤¹ä¸‹çš„.xmlé…ç½®æ–‡ä»¶</span>
  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-file-conf-registry-conf" tabindex="-1"><a class="header-anchor" href="#_3-file-conf-registry-conf" aria-hidden="true">#</a> (3) file.conf &amp; registry.conf</h6><p>è·Ÿ2001çš„ä¸€æ¨¡ä¸€æ ·</p><h6 id="_4-domain" tabindex="-1"><a class="header-anchor" href="#_4-domain" aria-hidden="true">#</a> (4) domain</h6><p>######## Storage</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domian</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Storage</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">//äº§å“ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>

    <span class="token comment">//æ€»åº“å­˜</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> total<span class="token punctuation">;</span>

    <span class="token comment">//å·²ç”¨åº“å­˜</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> used<span class="token punctuation">;</span>

    <span class="token comment">//å‰©ä½™åº“å­˜</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> residue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## CommonResult</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_5-daoæ¥å£åŠå®ç°-sqlæ˜ å°„æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_5-daoæ¥å£åŠå®ç°-sqlæ˜ å°„æ–‡ä»¶" aria-hidden="true">#</a> (5) Daoæ¥å£åŠå®ç°(SQLæ˜ å°„æ–‡ä»¶)</h6><p>######## StorageDao</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageDao</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ‰£å‡åº“å­˜ï¼šæ ¹æ®äº§å“IDæ‰£é™¤</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## StorageMapper.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.dao.StorageDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>storage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.domian.Storage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>productId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INTEGER<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrease<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        update `t_storage`
        SET `used` = `used` + #{count}, `residue` = `residue` - #{count}
        WHERE `product_id` = #{productId};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_6-serviceæ¥å£åŠå®ç°" tabindex="-1"><a class="header-anchor" href="#_6-serviceæ¥å£åŠå®ç°" aria-hidden="true">#</a> (6) Serviceæ¥å£åŠå®ç°</h6><p>StorageService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * æ‰£å‡åº“å­˜
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>StorageServiceImpl</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">StorageDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">StorageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> LOGGER <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">StorageServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageDao</span> storageDao<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ‰£å‡åº“å­˜
     * <span class="token keyword">@param</span> <span class="token parameter">productId</span>
     * <span class="token keyword">@param</span> <span class="token parameter">count</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        log.info(&quot;--------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜&quot;);</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;--------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        storageDao<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_7-controller" tabindex="-1"><a class="header-anchor" href="#_7-controller" aria-hidden="true">#</a> (7) Controller</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domian<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">StorageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token comment">//RequestMappingé»˜è®¤GET POSTè¯·æ±‚éƒ½æ”¯æŒï¼Œæ ¹æ®å‰ç«¯è‡ªåŠ¨é€‚åº”</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/storage/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        storageService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æ‰£å‡åº“å­˜æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_8-configé…ç½®" tabindex="-1"><a class="header-anchor" href="#_8-configé…ç½®" aria-hidden="true">#</a> (8) configé…ç½®</h6><p>ä¸2001çš„ä¸€æ¨¡ä¸€æ ·</p><h6 id="_9-ä¸»å¯åŠ¨ç±»" tabindex="-1"><a class="header-anchor" href="#_9-ä¸»å¯åŠ¨ç±»" aria-hidden="true">#</a> (9) ä¸»å¯åŠ¨ç±»</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataStorageMainApp2002</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataStorageMainApp2002</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="å¯åŠ¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æµ‹è¯•" aria-hidden="true">#</a> å¯åŠ¨æµ‹è¯•</h6><p>å¯åŠ¨nacosã€seataã€2002ï¼›å¯åŠ¨æˆåŠŸï¼Œæ³¨å†Œè¿›nacosã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636875245112-c004268f-3305-4a0c-9ae3-c6932f034de0.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636875238158-59a99c9d-03ac-4563-bda8-9b9d755410a6.png" alt="img"></p><h5 id="_3-3-æ–°å»ºè´¦æˆ·account-moduleâ€”â€”seata-account-service2003" tabindex="-1"><a class="header-anchor" href="#_3-3-æ–°å»ºè´¦æˆ·account-moduleâ€”â€”seata-account-service2003" aria-hidden="true">#</a> 3.3 æ–°å»ºè´¦æˆ·Account-Moduleâ€”â€”seata-account-service2003</h5><h6 id="_1-pom-4" tabindex="-1"><a class="header-anchor" href="#_1-pom-4" aria-hidden="true">#</a> (1) pom</h6><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jdk8cloud2021<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-account-service2003<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nacos--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--seata--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- å› ä¸ºå…¼å®¹ç‰ˆæœ¬é—®é¢˜,æ‰€ä»¥éœ€è¦å‰”é™¤å®ƒè‡ªå¸¦çš„seataçš„åŒ… --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--feign--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web-actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mysql-druid--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-application-yml-2" tabindex="-1"><a class="header-anchor" href="#_2-application-yml-2" aria-hidden="true">#</a> (2) application.yml</h6><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2003</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>account<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span>
        <span class="token comment">#è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­file.confä¸­é…ç½®çš„äº‹åŠ¡ç»„IDå¯¹åº”</span>
        <span class="token comment">#vgroup_mapping.my_test_tx_group = &quot;my_group&quot;</span>
        <span class="token comment">#        tx-service-group: my_test_tx_group</span>
        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> my_group
    <span class="token comment">#        tx-service-group: default</span>
    <span class="token comment">#        tx-service-group: my_test_tx_group</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_account<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">10086</span>

<span class="token comment">#feign:</span>
<span class="token comment">#  hystrix:</span>
<span class="token comment">#    enabled: false</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info

<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token comment"># æ‰«æç±»è·¯å¾„ä¸‹mapperæ–‡ä»¶å¤¹ä¸‹çš„.xmlé…ç½®æ–‡ä»¶</span>
  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_3-file-conf-registry-conf-1" tabindex="-1"><a class="header-anchor" href="#_3-file-conf-registry-conf-1" aria-hidden="true">#</a> (3) file.conf &amp; registry.conf</h6><p>è·Ÿ2001ä¸€æ¨¡ä¸€æ ·</p><h6 id="_4-domain-1" tabindex="-1"><a class="header-anchor" href="#_4-domain-1" aria-hidden="true">#</a> (4) domain</h6><p>######## Account</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">//ç”¨æˆ·ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>

    <span class="token comment">//æ€»é¢åº¦</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> total<span class="token punctuation">;</span>

    <span class="token comment">//å·²ç”¨é¢åº¦</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> used<span class="token punctuation">;</span>

    <span class="token comment">//å‰©ä½™é¢åº¦</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> residue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## CommonResult</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_5-daoæ¥å£åŠå®ç°" tabindex="-1"><a class="header-anchor" href="#_5-daoæ¥å£åŠå®ç°" aria-hidden="true">#</a> (5) Daoæ¥å£åŠå®ç°</h6><p>######## AccountDao</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * æ‰£å‡è´¦æˆ·ä½™é¢
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## AccountMapper.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.dao.AccountDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BaseResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.cloudalibaba.domain.Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BIGINT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>used<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>residue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DECIMAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrease<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        UPDATE t_account
        SET `used` = `used` + #{money}, `residue` = `residue` - #{money}
        WHERE `user_id` = #{userId};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_6-serviceæ¥å£åŠå®ç°-1" tabindex="-1"><a class="header-anchor" href="#_6-serviceæ¥å£åŠå®ç°-1" aria-hidden="true">#</a> (6) Serviceæ¥å£åŠå®ç°</h6><p>######## AccountService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * æ‰£å‡è´¦æˆ·é‡‘é¢
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>  ç”¨æˆ·ID
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>  é‡‘é¢
     */</span>
    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## AccountServiceImpl</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">AccountDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AccountService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> LOGGER <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AccountServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ‰£å‡è´¦æˆ·ä½™é¢
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span> ç”¨æˆ·ID
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>  é‡‘é¢
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡å›æ»š</span>
        <span class="token comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span>
        <span class="token comment">//try { TimeUnit.SECONDS.sleep(30); } catch (InterruptedException e) { e.printStackTrace(); }</span>
        accountDao<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_7-controller-1" tabindex="-1"><a class="header-anchor" href="#_7-controller-1" aria-hidden="true">#</a> (7) Controller</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AccountService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ‰£å‡è´¦æˆ·ä½™é¢
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/account/decrease&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_8-configé…ç½®-1" tabindex="-1"><a class="header-anchor" href="#_8-configé…ç½®-1" aria-hidden="true">#</a> (8) configé…ç½®</h6><p>å’Œ2001ä¸€æ¨¡ä¸€æ ·</p><h6 id="_9-ä¸»å¯åŠ¨ç±»-1" tabindex="-1"><a class="header-anchor" href="#_9-ä¸»å¯åŠ¨ç±»-1" aria-hidden="true">#</a> (9) ä¸»å¯åŠ¨ç±»</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataAccountMainApp2003</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataAccountMainApp2003</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="å¯åŠ¨æµ‹è¯•-1" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æµ‹è¯•-1" aria-hidden="true">#</a> å¯åŠ¨æµ‹è¯•</h6><p>å¯åŠ¨nacosã€seataã€2003ï¼›å¯åŠ¨æˆåŠŸï¼ŒæˆåŠŸæ³¨å†Œè¿›nacos</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636876914165-bcd89219-515c-455d-82e0-2ad415e6259f.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636876923512-1ea962ff-f4c0-4d8a-add6-03b957213344.png" alt="img"></p><h5 id="å¡«å‘é«˜ç‰ˆæœ¬seata1-4-2clienté…ç½®" tabindex="-1"><a class="header-anchor" href="#å¡«å‘é«˜ç‰ˆæœ¬seata1-4-2clienté…ç½®" aria-hidden="true">#</a> ### å¡«å‘é«˜ç‰ˆæœ¬seata1.4.2clienté…ç½®</h5><p><a href="https://blog.csdn.net/weixin_44790046/article/details/106970822" target="_blank" rel="noopener noreferrer">seata1.2.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://blog.csdn.net/jixieguang/article/details/110621561" target="_blank" rel="noopener noreferrer">Seata1.4.0+nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä½¿ç”¨seata1.4.2 å„ä¸ªå¾®æœåŠ¡æ•´ä½“ä¸Šçš„ä»£ç æ˜¯å·®ä¸å¤šçš„ï¼ŒåŒºåˆ«çš„åœ°æ–¹åœ¨äº1.4.2æ”¯æŒymlã€propertiesæ–‡ä»¶é‡Œé…ç½®clientç«¯çš„seataï¼Œä¸å†éœ€è¦file.conf/registry.confæ–‡ä»¶ã€‚åŒæ—¶æ”¯æŒ**@EnableAutoDataSourceProxy**æ³¨è§£å¼€å¯æ•°æ®æºçš„è‡ªåŠ¨ä»£ç†ï¼ˆä¸éœ€è¦æ‰‹åŠ¨é…ç½®æ•°æ®æºï¼‰</p><h6 id="_1-ä¿®æ”¹çˆ¶å·¥ç¨‹ç‰ˆæœ¬æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_1-ä¿®æ”¹çˆ¶å·¥ç¨‹ç‰ˆæœ¬æ§åˆ¶" aria-hidden="true">#</a> â‘  ä¿®æ”¹çˆ¶å·¥ç¨‹ç‰ˆæœ¬æ§åˆ¶</h6><p>seataé«˜ç‰ˆæœ¬å„å¾®æœåŠ¡å¯ä»¥ç›´æ¥é€šè¿‡ymlã€propertiesæ¥é…ç½®seataï¼Œä¸éœ€è¦åœ¨å¾®æœåŠ¡ä¸­åŠ å…¥file.confå’Œregistry.confæ–‡ä»¶ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637067484131-41b3b3e5-e13c-43d7-a295-87f5629afb9a.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637067487583-f3020854-dec1-4ff4-9b33-b452be46bbfd.png" alt="img"></p><p>æ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œè¿™é‡Œè¦ä½¿ç”¨<strong>SpringCloud Hoxton.SR9+SpringCloud Alibaba 2.2.6.RELEASE+Spring Boot 2.3.2RELEASE+Nacos 1.4.2ï¼ˆæˆ‘ç”¨çš„2.0.3ï¼‰+Seata 1.3.0ï¼ˆæˆ‘ç”¨çš„1.4.2ï¼‰</strong>ã€‚</p><p>ä¿®æ”¹çˆ¶å·¥ç¨‹çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯è®©springbootã€SpringCloudã€SpringCloud alibabaç‰ˆæœ¬å¯¹åº”ã€‚</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--spring boot 2.3.2--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--spring cloud Hoxton.SR9--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Hoxton.SR9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--spring cloud alibaba 2.2.6.RELEASE--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-ä¿®æ”¹å¾®æœåŠ¡æ¨¡å—seataä¾èµ–pom" tabindex="-1"><a class="header-anchor" href="#_2-ä¿®æ”¹å¾®æœåŠ¡æ¨¡å—seataä¾èµ–pom" aria-hidden="true">#</a> â‘¡ ä¿®æ”¹å¾®æœåŠ¡æ¨¡å—seataä¾èµ–pom</h6><p>å®˜ç½‘ä¸Šå¯¹seataä¾èµ–æ˜¯è¿™ä¹ˆæè¿°çš„ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637081103185-526524eb-d9c6-45c4-86f7-75f35eb942dd.png" alt="img"></p><p>å®˜ç½‘æ¨èä¾èµ–é…ç½®æ–¹å¼ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637113871974-fb756b45-4fb4-4bf2-90be-f4a05f4eb303.png" alt="img"></p><p>ä½†æ˜¯ç»è¿‡æˆ‘æµ‹è¯•å‘ç°ï¼Œè¿˜æ˜¯éœ€è¦æ’é™¤æ‰spring-cloud-starter-alibaba-seataé‡Œé¢çš„seata-all</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--seata--&gt;</span>
<span class="token comment">&lt;!--seata-spring-boot-starter é›†æˆäº†seata-allï¼Œç‰ˆæœ¬å¯¹åº”--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- å› ä¸ºå…¼å®¹ç‰ˆæœ¬é—®é¢˜,æ‰€ä»¥éœ€è¦å‰”é™¤å®ƒè‡ªå¸¦çš„seataçš„åŒ… --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šæˆ‘æœ‰å¾®æœåŠ¡åªé…ç½®äº†seata-spring-boot-starterä¾èµ–ï¼Œspring-cloud-starter-alibaba-seataæ²¡æœ‰é…ç½®ï¼Œå¹¶ä¸å½±å“æ­£å¸¸ä½¿ç”¨ã€‚</p><h6 id="_3-ä¿®æ”¹å¾®æœåŠ¡application-yml" tabindex="-1"><a class="header-anchor" href="#_3-ä¿®æ”¹å¾®æœåŠ¡application-yml" aria-hidden="true">#</a> â‘¢ ä¿®æ”¹å¾®æœåŠ¡application.yml</h6><p>ç›´æ¥å°†seataçš„ç›¸å…³é…ç½®ï¼Œé…ç½®åˆ°application.ymlæ–‡ä»¶ä¸­ï¼Œå‡ ä¸ªå¾®æœåŠ¡çš„ymlç±»ä¼¼ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#  è¿™ä¸€å—æ˜¯é…ç½®seataçš„</span>
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">application-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
  <span class="token key atrule">enable-auto-data-source-proxy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#æ˜¯å¦å¼€å¯æ•°æ®æºè‡ªåŠ¨ä»£ç†,é»˜è®¤ä¸ºtrue</span>
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> my_test_tx_group  <span class="token comment">#è¦ä¸config.txté…ç½®æ–‡ä»¶ä¸­çš„vgroupMappingä¸€è‡´</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span> <span class="token comment">#registryæ ¹æ®seataæœåŠ¡ç«¯çš„registryé…ç½®</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos <span class="token comment">#é»˜è®¤ä¸ºfile</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server <span class="token comment">#é…ç½®è‡ªå·±çš„seataæœåŠ¡,ä¸registry.confä¸€è‡´</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos  <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> f0378218<span class="token punctuation">-</span>b129<span class="token punctuation">-</span>4fd8<span class="token punctuation">-</span>839c<span class="token punctuation">-</span>9bdfd010205b <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
      <span class="token key atrule">cluster</span><span class="token punctuation">:</span> default <span class="token comment"># é…ç½®è‡ªå·±çš„seataæœåŠ¡cluster, é»˜è®¤ä¸º default</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&quot;SEATA_GROUP&quot;</span> <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos <span class="token comment">#é…ç½®ä¸­å¿ƒè®¾ç½®ä¸ºnacosï¼Œç›´æ¥ä»nacosä¸Šè·å–é…ç½®</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>  <span class="token comment">#é…ç½®è‡ªå·±çš„nacosåœ°å€</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP  <span class="token comment">#é…ç½®è‡ªå·±çš„groupï¼Œè¿™é‡Œæˆ‘é…ç½®è·Ÿregistry.confä¸€æ ·</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos  <span class="token comment">#é…ç½®è‡ªå·±çš„username</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos  <span class="token comment">#é…ç½®è‡ªå·±çš„password</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> f0378218<span class="token punctuation">-</span>b129<span class="token punctuation">-</span>4fd8<span class="token punctuation">-</span>839c<span class="token punctuation">-</span>9bdfd010205b  <span class="token comment">#æ ¹æ®è‡ªå·±çš„seataæœåŠ¡é…ç½®</span>
      <span class="token comment"># dataIdå¦‚æœä¸ç”¨ï¼Œå°±ä¸éœ€è¦é…ç½®</span>
<span class="token comment">#      dataId: seataServer.properties  #é…ç½®è‡ªå·±çš„dataId,ç”±äºæ­å»ºæœåŠ¡ç«¯æ—¶æŠŠå®¢æˆ·ç«¯çš„é…ç½®ä¹Ÿå†™åœ¨äº†seataServer.properties,æ‰€ä»¥è¿™é‡Œç”¨äº†å’ŒæœåŠ¡ç«¯ä¸€æ ·çš„é…ç½®æ–‡ä»¶,å®é™…å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶åˆ†ç¦»å‡ºæ¥æ›´å¥½</span>


<span class="token comment"># è¿™é‡Œæ˜¯é…ç½®å¾®æœåŠ¡çš„ç«¯å£ã€æ³¨å†Œåˆ°å“ªã€æ•°æ®æºç­‰ç­‰</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>order<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment">#    alibaba:</span>
    <span class="token comment">#      seata:</span>
    <span class="token comment">#        #è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­file.confä¸­é…ç½®çš„äº‹åŠ¡ç»„IDå¯¹åº”</span>
    <span class="token comment">#        #vgroup_mapping.my_test_tx_group = &quot;my_group&quot;</span>
    <span class="token comment">#        tx-service-group: my_group</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/seata_order<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">10086</span>

<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">io</span><span class="token punctuation">:</span>
      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info

<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„å¯¹åº”å…³ç³»ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1637126855997-372aeee0-b262-4ec0-8207-57dc27013051.png" alt="img"></p><h6 id="_4-ä¿®æ”¹ä¸»å¯åŠ¨ç±»å’Œdatasourceproxyconfigç±»" tabindex="-1"><a class="header-anchor" href="#_4-ä¿®æ”¹ä¸»å¯åŠ¨ç±»å’Œdatasourceproxyconfigç±»" aria-hidden="true">#</a> â‘£ ä¿®æ”¹ä¸»å¯åŠ¨ç±»å’ŒDataSourceProxyConfigç±»</h6><p>######## ä¸»å¯åŠ¨ç±»</p><p>ä¸»å¯åŠ¨ç±»åŠ ä¸Š@EnableAutoDataSourceProxyæ³¨è§£ï¼Œè¿™é‡Œä»¥storageçš„å¾®æœåŠ¡ä¸ºä¾‹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">EnableAutoDataSourceProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token annotation punctuation">@EnableAutoDataSourceProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageMainApp2002</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">StorageMainApp2002</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>######## é…ç½®ç±»</p><p>ä½¿ç”¨**@EnableAutoDataSourceProxy<strong>æ³¨è§£åï¼Œä¸å†éœ€è¦DataSourceProxyConfigé…ç½®æ•°æ®æºä»£ç†ã€‚å¼ºè¡Œå†™ä¼šæŠ¥é”™ã€‚å¦‚æœéœ€è¦è‡ªå·±é…ç½®æ•°æ®æºä»£ç†çš„è¯ï¼Œåœ¨application.ymlä¸­è®¾ç½®</strong>seata.enable-auto-data-source-proxy<strong>ä¸º</strong>false**ï¼Œä¸»å¯åŠ¨ç±»ä¸Šå»æ‰**@EnableAutoDataSourceProxy**æ³¨è§£å³å¯ã€‚</p><p>######## å‚è€ƒåšå®¢</p><ol><li><a href="https://blog.csdn.net/ww_run/article/details/120099870?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link" target="_blank" rel="noopener noreferrer">Seata1.4.2+Nacosæ­å»ºä½¿ç”¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/potatoillusion/article/details/117827986?spm=1001.2101.3001.6650.3&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3.no_search_link" target="_blank" rel="noopener noreferrer">Seata1.4.2æ•´åˆSpringCloud Hâ€”â€”Seataå®‰è£…ä¸æ­å»º<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/ClearCiM/article/details/119953255" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/ClearCiM/article/details/119953255<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/tyvbpq/article/details/119703363?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-10-119703363.pc_agg_new_rank&amp;utm_term=dataid+nacos+seata+%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83&amp;spm=1000.2123.3001.4430" target="_blank" rel="noopener noreferrer">spring cloudä½¿ç”¨nacoså’Œseataï¼ˆwindowsç¯å¢ƒï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/hongtaolong/article/details/120144437?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-7-120144437.pc_agg_new_rank&amp;utm_term=dataid+nacos+seata+%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83&amp;spm=1000.2123.3001.4430" target="_blank" rel="noopener noreferrer">SEATAé…åˆnacosä½¿ç”¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><h3 id="å››ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#å››ã€æµ‹è¯•" aria-hidden="true">#</a> å››ã€æµ‹è¯•</h3><h5 id="seataå…¨å±€äº‹åŠ¡æ€ä¹ˆä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#seataå…¨å±€äº‹åŠ¡æ€ä¹ˆä½¿ç”¨" aria-hidden="true">#</a> Seataå…¨å±€äº‹åŠ¡æ€ä¹ˆä½¿ç”¨</h5><p>Springæä¾›çš„æœ¬åœ°äº‹åŠ¡ï¼š@Transactional</p><p>Seataæä¾›çš„å…¨å±€äº‹åŠ¡ï¼š@GlobalTransactional</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636880513744-d81289ab-be90-4832-b76c-facc47ef00d9.png" alt="img"></p><h5 id="_4-0-æ•°æ®åº“åˆå§‹æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#_4-0-æ•°æ®åº“åˆå§‹æƒ…å†µ" aria-hidden="true">#</a> 4.0 æ•°æ®åº“åˆå§‹æƒ…å†µ</h5><p>ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;æ‰£ä½™é¢-&gt;æ”¹(è®¢å•)çŠ¶æ€</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636880852242-f2460919-e326-4d4e-89b6-78c348c2eedd.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636880870145-b34edc59-33e6-415b-a2c5-b94c70955f73.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636880884317-f5faa635-ee75-457e-8c66-294a360f6083.png" alt="img"></p><h5 id="_4-1-æµ‹è¯•æ­£å¸¸ä¸‹å•" tabindex="-1"><a class="header-anchor" href="#_4-1-æµ‹è¯•æ­£å¸¸ä¸‹å•" aria-hidden="true">#</a> 4.1 æµ‹è¯•æ­£å¸¸ä¸‹å•</h5><p>å¯åŠ¨nacosã€seataã€2001ã€2002ã€2003ï¼›</p><p>æµ‹è¯•ï¼š<a href="http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100" target="_blank" rel="noopener noreferrer">http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h6 id="æŠ¥é”™" tabindex="-1"><a class="header-anchor" href="#æŠ¥é”™" aria-hidden="true">#</a> æŠ¥é”™</h6><p><strong>java.sql.SQLException:Failed to fetch schema of <code>t_order</code></strong></p><p>Connector/J 5.0.0ä»¥åçš„ç‰ˆæœ¬æœ‰ä¸€ä¸ªåä¸ºuseInformationSchemaçš„æ•°æ®åº“è¿æ¥å‚æ•°ï¼ŒConnector/J åœ¨mysql8.0ä¸­é»˜è®¤é…ç½®è¿æ¥å±æ€§useInformationSchemaä¸ºtrueï¼Œä½¿æŸ¥è¯¢tableä¿¡æ¯æ—¶æ›´ä¸ºæœ‰æ•ˆã€‚ç”¨æˆ·ä¾ç„¶å¯ä»¥é…ç½®useInformationSchemaä¸ºfalseï¼Œä½†æ˜¯åœ¨8.0.3åŠå…¶ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œç”±äºä¸èƒ½æ”¯æŒæ—©æœŸçš„ç‰¹æ€§ï¼ŒæŸäº›æ•°æ®å­—å…¸çš„æŸ¥è¯¢å¯èƒ½ä¼šå¤±è´¥ã€‚</p><p>useInformationSchemaé…ç½®ä¸ºfalseçš„æ—¶å€™ï¼Œä¹Ÿå¯èƒ½ä¼šé€ æˆREMARKSä¿¡æ¯ï¼ˆå¯¹åº”æ•°æ®åº“ä¸­å„å­—æ®µçš„commentï¼‰çš„ç¼ºå¤±ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636885157700-4b671044-f674-448a-b790-687be655d1c5.png" alt="img"></p><p>åœ¨å„å¾®æœåŠ¡çš„application.yml æ–‡ä»¶çš„spring.datasource.url åé¢åŠ ä¸Š<code>&amp;useInformationSchema=false</code>è®¾ç½®useInformationSchemaä¸ºfalseï¼Œå³å¯è§£å†³è¯¥é—®é¢˜ã€‚ å‚è€ƒï¼š<a href="https://www.jianshu.com/p/acc99f891e91" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/acc99f891e91<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h6 id="å†æ¬¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#å†æ¬¡æµ‹è¯•" aria-hidden="true">#</a> å†æ¬¡æµ‹è¯•</h6><p>è®¿é—®æˆåŠŸ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636885386660-f73be4c7-8f96-4436-928d-1b8924c3e812.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636886967312-d6cb850f-eef7-43bb-be02-6c9e46b69755.png" alt="img"></p><p>æ•°æ®åº“æƒ…å†µï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636885516045-e1f6a2a8-5637-4893-b021-97562e32d8cc.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636885537110-40bda427-d547-423d-9538-eff77ce3141d.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636885554249-edf1239b-27f2-4718-b529-1668c3229230.png" alt="img"></p><h5 id="_4-2-æµ‹è¯•è¶…æ—¶å¼‚å¸¸-ä¸åŠ -globaltransactional" tabindex="-1"><a class="header-anchor" href="#_4-2-æµ‹è¯•è¶…æ—¶å¼‚å¸¸-ä¸åŠ -globaltransactional" aria-hidden="true">#</a> 4.2 æµ‹è¯•è¶…æ—¶å¼‚å¸¸ï¼šä¸åŠ @GlobalTransactional</h5><h6 id="accountserviceimplæ·»åŠ è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#accountserviceimplæ·»åŠ è¶…æ—¶" aria-hidden="true">#</a> AccountServiceImplæ·»åŠ è¶…æ—¶ï¼š</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636887315777-49f3f304-95a5-4e84-84e1-db98d2063d0a.png" alt="img"></p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Openfeignï¼Œé»˜è®¤è¶…æ—¶æ—¶é•¿æ˜¯1sï¼Œè¿™é‡Œæˆ‘ä»¬å»¶è¿Ÿ30sã€‚</p><h6 id="æŠ¥é”™è¶…æ—¶å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#æŠ¥é”™è¶…æ—¶å¼‚å¸¸" aria-hidden="true">#</a> æŠ¥é”™è¶…æ—¶å¼‚å¸¸ï¼š</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636887516874-e984a427-fd14-49c6-a025-d8a2ec94f904.png" alt="img"></p><h6 id="æ•°æ®åº“æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“æƒ…å†µ" aria-hidden="true">#</a> æ•°æ®åº“æƒ…å†µï¼š</h6><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636887749627-98e85882-a208-4380-beb1-3f68531995d2.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636887791521-b7101ffd-ac2f-4d8c-9be1-aea20ea51d7c.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636887816708-5257dccc-a554-410a-8e0d-2f742a3e26cd.png" alt="img"></p><p>å½“åº“å­˜å’Œè´¦æˆ·é‡‘é¢æ‰£å‡åï¼Œè®¢å•çŠ¶æ€å¹¶æ²¡æœ‰è®¾ç½®ä¸ºå·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»é›¶æ”¹ä¸º1ï¼›è€Œä¸”ç”±äºfeignçš„é‡è¯•æœºåˆ¶ï¼Œè´¦æˆ·ä½™é¢è¿˜æœ‰å¯èƒ½è¢«å¤šæ¬¡æ‰£å‡ã€‚</p><h5 id="_4-3-æµ‹è¯•è¶…æ—¶å¼‚å¸¸-åŠ -globaltransactional" tabindex="-1"><a class="header-anchor" href="#_4-3-æµ‹è¯•è¶…æ—¶å¼‚å¸¸-åŠ -globaltransactional" aria-hidden="true">#</a> 4.3 æµ‹è¯•è¶…æ—¶å¼‚å¸¸ï¼šåŠ @GlobalTransactional</h5><p>OrderServiceImplæ·»åŠ **@GlobalTransactional**æ³¨è§£ï¼Œæ³¨æ„æ”¹æ³¨è§£åªèƒ½ç”¨åœ¨æ–¹æ³•ä¸Šï¼</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636888242942-a1c827b4-5ec0-4515-bf74-e1e6f358cdbf.png" alt="img"></p><ul><li>nameï¼šç»™å®šå…¨å±€äº‹åŠ¡å®ä¾‹çš„åç§°ï¼Œéšä¾¿å–ï¼Œå”¯ä¸€å³å¯</li><li>rollbackForï¼šå½“å‘ç”Ÿä»€ä¹ˆæ ·çš„å¼‚å¸¸æ—¶ï¼Œè¿›è¡Œå›æ»š</li><li>noRollbackForï¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„å¼‚å¸¸ä¸è¿›è¡Œå›æ»šã€‚</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">OrderDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AccountService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloudalibaba<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">StorageService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GlobalTransactional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€
     * ç®€å•è¯´ï¼š
     * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">//å…¨å±€äº‹åŠ¡ï¼Œå‘ç”Ÿå¼‚å¸¸è¿›è¡Œå›æ»š</span>
    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;lsp-create-order&quot;</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;ä¸‹å•å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æœ¬åº”ç”¨åˆ›å»ºè®¢å•</span>
        orderDao<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨åº“å­˜å¾®æœåŠ¡ï¼Œæ‰£å‡åº“å­˜å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        storageService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨åº“å­˜å¾®æœåŠ¡ï¼Œæ‰£å‡åº“å­˜ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨è´¦æˆ·å¾®æœåŠ¡ï¼Œæ‰£å‡ä½™é¢å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountService<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;è®¢å•å¾®æœåŠ¡è°ƒç”¨è´¦æˆ·å¾®æœåŠ¡ï¼Œå‡ä½™é¢ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿™é‡Œçš„è¯æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯orderIdï¼Ÿ</span>
        orderDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-------&gt;ä¸‹å•ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼š</p><p>ä¾ç„¶è¶…æ—¶å¼‚å¸¸</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636888529834-49d19c5c-0783-40b5-9200-801af4a1135e.png" alt="img"></p><p>æ•°æ®åº“ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636888594617-08abffce-914c-4c7e-812f-821a487cdac0.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636888612571-33a3fca6-5c67-4c45-ab54-07cb3beee91e.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636888631676-3966be70-025d-446f-99bc-77d1872131b9.png" alt="img"></p><p>æˆ‘ä»¬å‘ç°æ•°æ®åº“ä¸­çš„æ•°æ®æ ¹æœ¬å°±æ²¡æœ‰å˜åŒ–ï¼Œè®°å½•éƒ½æ·»åŠ ä¸è¿›æ¥ï¼Œè¯´æ˜å›æ»šæˆåŠŸï¼</p><h5 id="_4-4-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_4-4-å°ç»“" aria-hidden="true">#</a> 4.4 å°ç»“</h5><p>åšå¥½é…ç½®åï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€ä¸ª @GlobalTransactional(name = &quot;lsp-create-order&quot;, rollbackFor = Exception.class) æ”¾åœ¨ä¸šåŠ¡çš„å…¥å£ï¼Œå³å¯å®ç°æ§åˆ¶å…¨å±€çš„äº‹åŠ¡ã€‚æ³¨æ„è¯¥æ³¨è§£åªèƒ½æ”¾åœ¨æ–¹æ³•ä¸Šã€‚</p><h3 id="äº”ã€è¡¥å……è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#äº”ã€è¡¥å……è¯´æ˜" aria-hidden="true">#</a> äº”ã€è¡¥å……è¯´æ˜</h3><p>Seataï¼šSimple Extensible Autonomous Transaction Architectureï¼Œç®€å•å¯æ‰©å±•è‡ªæ²»äº‹åŠ¡æ¡†æ¶</p><p>0.9ä¸æ”¯æŒé›†ç¾¤ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨1.0ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚</p><h5 id="_5-0-undo-logè¡¨çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_5-0-undo-logè¡¨çš„ä½œç”¨" aria-hidden="true">#</a> 5.0 undo_logè¡¨çš„ä½œç”¨</h5><p>æ¨¡å—å†…æ–¹æ³•ä¹Ÿå¯ä»¥åŠ @Transactionalæ³¨è§£ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—çš„äº‹åŠ¡æäº¤äº†ï¼ŒSeataä¼šæŠŠæäº¤äº†å“ªäº›æ•°æ®è®°å½•åˆ°undo_logè¡¨ä¸­ï¼Œå¦‚æœè¿™æ—¶TCé€šçŸ¥å…¨å±€äº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆRMå°±ä»undo_logè¡¨ä¸­è·å–ä¹‹å‰ä¿®æ”¹äº†å“ªäº›èµ„æºï¼Œå¹¶æ ¹æ®è¿™ä¸ªè¡¨å›æ»šã€‚ï¼ˆæœ‰å¾…è€ƒè¯ï¼‰</p><h5 id="_5-1-å†çœ‹tc-tm-rmä¸‰å¤§ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_5-1-å†çœ‹tc-tm-rmä¸‰å¤§ç»„ä»¶" aria-hidden="true">#</a> 5.1 å†çœ‹TC/TM/RMä¸‰å¤§ç»„ä»¶</h5><p>TCï¼šseataæœåŠ¡å™¨ï¼› ï¼ˆæˆ‘ä»¬ç”µè„‘ä¸Šå¯åŠ¨çš„seata ï¼‰</p><p>TMï¼šäº‹ç‰©çš„å‘èµ·è€…ï¼Œä¸šåŠ¡çš„å…¥å£ã€‚ å“ªä¸ªå¾®æœåŠ¡ä½¿ç”¨äº†**@GlobalTransactional**å“ªä¸ªå°±æ˜¯TM</p><p>RMï¼šäº‹åŠ¡çš„å‚ä¸è€…ï¼Œä¸€ä¸ªæ•°æ®åº“å°±æ˜¯ä¸€ä¸ªRMã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636890980594-f9db0624-1c09-4055-8c65-5c087d16b36f.png" alt="img"></p><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œæµç¨‹ï¼š</p><ol><li>TM å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆTM å‘ TC æ³¨å†Œå…¨å±€äº‹åŠ¡è®°å½•ï¼‰ï¼›</li><li>æŒ‰ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’æ•°æ®åº“ã€æœåŠ¡ç­‰äº‹åŠ¡å†…èµ„æºï¼ˆRM å‘ TC æ±‡æŠ¥èµ„æºå‡†å¤‡çŠ¶æ€ ï¼‰ï¼›</li><li>TM ç»“æŸåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸï¼ˆTM é€šçŸ¥ TC æäº¤/å›æ»šåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ï¼›</li><li>TC æ±‡æ€»äº‹åŠ¡ä¿¡æ¯ï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼›</li><li>TC é€šçŸ¥æ‰€æœ‰ RM æäº¤/å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636890679040-20e2d483-549c-459a-b481-693caab0d239.png" alt="img"></p><h5 id="_5-2-atæ¨¡å¼-é»˜è®¤-å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥" tabindex="-1"><a class="header-anchor" href="#_5-2-atæ¨¡å¼-é»˜è®¤-å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥" aria-hidden="true">#</a> 5.2 ATæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥</h5><p>Seataæœ‰å››å¤§æ¨¡å¼ï¼šATï¼ˆé»˜è®¤ï¼‰ã€TCCã€SAGAã€XAã€‚ï¼ˆé˜¿é‡Œäº‘ä¸Šçš„ATå«åšGTSï¼Œæ”¶è´¹ï¼‰</p><p><a href="http://seata.io/zh-cn/docs/dev/mode/at-mode.html" target="_blank" rel="noopener noreferrer">ATæ¨¡å¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ATæ¨¡å¼ä¸¤é˜¶æ®µæäº¤åè®®çš„æ¼”å˜ï¼š</p><ul><li><p>ä¸€é˜¶æ®µï¼šä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œé‡Šæ”¾æœ¬åœ°é”å’Œè¿æ¥èµ„æºã€‚</p></li><li><p>äºŒé˜¶æ®µï¼š</p></li><li><ul><li>æäº¤å¼‚æ­¥åŒ–ï¼Œéå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚</li></ul></li><li><p>å›æ»šé€šè¿‡ä¸€é˜¶æ®µçš„å›æ»šæ—¥å¿—è¿›è¡Œåå‘è¡¥å¿ï¼ˆå‰é¢insertï¼Œåé¢å›æ»šæ—¶å°±deleteï¼‰ã€‚</p></li></ul><p>æ¯ä¸ªæ•°æ®åº“é™¤äº†è‡ªèº«å­˜å‚¨æ•°æ®çš„è¡¨ä»¥å¤–ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªäº‹åŠ¡å›æ»šè¡¨ï¼šundo_log</p><p>Seataåº“ä¸­å­˜åœ¨ï¼šbranch_table\global_table\lock_table\distributed_lock(é«˜ç‰ˆæœ¬æ‰æœ‰)è¿™æ ·ä¸€äº›è¡¨</p><h6 id="_5-2-1-ä¸€é˜¶æ®µåŠ è½½" tabindex="-1"><a class="header-anchor" href="#_5-2-1-ä¸€é˜¶æ®µåŠ è½½" aria-hidden="true">#</a> 5.2.1 ä¸€é˜¶æ®µåŠ è½½</h6><p>åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œ</p><p>1 è§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼ˆå‰ç½®é•œåƒï¼‰</p><p>2 æ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œ</p><p>3 å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚</p><p>ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636892157973-e4a5ccaf-71c5-481e-9417-6b64d389f36f.png" alt="img"></p><h6 id="_5-2-2-äºŒé˜¶æ®µæäº¤" tabindex="-1"><a class="header-anchor" href="#_5-2-2-äºŒé˜¶æ®µæäº¤" aria-hidden="true">#</a> 5.2.2 äºŒé˜¶æ®µæäº¤</h6><p>å› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨<strong>ä¸€é˜¶æ®µ</strong>å·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ<strong>äºŒé˜¶æ®µå¦‚æœé¡ºåˆ©æäº¤çš„è¯</strong>ï¼Œé‚£ä¹ˆSeataæ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636892304290-bd0f0263-9336-4877-bf03-59f5f86cfe87.png" alt="img"></p><h6 id="_5-2-3-äºŒé˜¶æ®µå›æ»š" tabindex="-1"><a class="header-anchor" href="#_5-2-3-äºŒé˜¶æ®µå›æ»š" aria-hidden="true">#</a> 5.2.3 äºŒé˜¶æ®µå›æ»š</h6><p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚</p><p>å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ã€‚å¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636892634620-1e6c1596-baba-4aed-b840-8afdfd320e05.png" alt="img"></p><h5 id="_5-3-debugæŸ¥çœ‹æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-3-debugæŸ¥çœ‹æµç¨‹" aria-hidden="true">#</a> 5.3 debugæŸ¥çœ‹æµç¨‹</h5><p>æœ€å¼€æ˜¯seataåº“ä¸­çš„ä¸‰å¼ è¡¨æ˜¯æ²¡æœ‰æ•°æ®çš„</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636892970332-138694e4-498e-4c57-82a3-9ed40feea4df.png" alt="img"></p><p>2003æ‰“ä¸Šæ–­ç‚¹ï¼Œdebugå¯åŠ¨</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636892865851-b541d0b7-3e91-463f-9bd2-628c25379099.png" alt="img"></p><p>è®¿é—®<a href="http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100ã€‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636893040133-6768d513-0c8a-4d32-a308-35c88331fce8.png" alt="img"></p><p>æ­¤æ—¶seataåº“ä¸­çš„ä¸‰ä¸ªè¡¨éƒ½æ˜¯æœ‰æ•°æ®çš„ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636893186504-d9e4f100-7ad0-4235-b27c-9b0565fefc9a.png" alt="img"></p><p>çœ‹ä¸€ä¸‹branch_tableï¼Œè®°å½•äº†å„ä¸ªRMçš„ä¿¡æ¯ï¼Œåˆ†åˆ«å¯¹åº”orderã€storageã€accountä¸‰ä¸ªå¾®æœåŠ¡</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636893708587-5f6e35c2-bed9-4c95-9927-6c3c45dd1856.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°xidè·Ÿglobal_tableä¸­çš„xidä¸€è‡´ã€‚</p><p>å†çœ‹global_tableï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636893900347-9735778c-ccf0-41a4-8b31-701541eb2db2.png" alt="img"></p><p>æŸ¥çœ‹lock_tableï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636894052476-c9a96333-e331-4d37-bdd1-28d92feadb68.png" alt="img"></p><p>æŸ¥çœ‹å„ä¸šåŠ¡ä¸­çš„undo_logè¡¨ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636894224215-644fbe92-cec7-4f64-b4d5-9a3aab5daf85.png" alt="img"></p><p>rollback_infoæ˜¯JSONå­—ç¬¦ä¸²ï¼Œå­˜å‚¨äº†beforeimageã€afterimageï¼š</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.undo.BranchUndoLog&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;xid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.190.1:8091:2090602861&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;branchId&quot;</span><span class="token operator">:</span> <span class="token number">2090602864</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sqlUndoLogs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;java.util.ArrayList&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.undo.SQLUndoLog&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sqlType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;tableName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`t_order`&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;beforeImage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>   
          <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.TableRecords$EmptyTableRecords&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;tableName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`t_order`&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;java.util.ArrayList&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;afterImage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.TableRecords&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;tableName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`t_order`&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;java.util.ArrayList&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Row&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">&quot;java.util.ArrayList&quot;</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PrimaryKey&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">-5</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">,</span>
                        <span class="token number">10</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">-5</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">,</span>
                        <span class="token number">1</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">-5</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">,</span>
                        <span class="token number">1</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;money&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;java.math.BigDecimal&quot;</span><span class="token punctuation">,</span>
                        <span class="token number">100</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                      <span class="token property">&quot;@class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.seata.rm.datasource.sql.struct.Field&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;keyType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹seata_storageåº“ä¸­çš„undo_logè¡¨çš„roobal_infoä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°beforeimageå’Œafterimageåˆ†åˆ«ä¿å­˜äº†ä¿®æ”¹å‰åçš„ä¿¡æ¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636894851233-f395aad7-5132-4491-a0fd-c90e401e134d.png" alt="img"></p><p>debugæ”¾è¡Œï¼Œseataåº“ä¸­è¡¨ä¸­çš„ä¸­é—´æ•°æ®å’Œundo_logè¡¨çš„æ•°æ®éƒ½åˆ é™¤äº†ã€‚ï¼ˆæˆ‘çš„seata_accountè¡¨çš„undo_logä¸­æ²¡æœ‰è¢«åˆ é™¤ï¼Œç­‰äº†åŠå¤©ä¹Ÿæ²¡æœ‰ã€‚ï¼‰å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚å°†å¼‚æ­¥å’Œæ‰¹é‡åœ°åˆ é™¤ç›¸åº”çš„undo_logè®°å½•ã€‚</p><p>å‘ç°account2003å¾®æœåŠ¡çš„æ—¥å¿—è·Ÿ2001å’Œ2002éƒ½ä¸ä¸€æ ·</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636895782328-2b4843e2-5f95-4114-9e67-f56109b324c1.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636895848770-086d3c08-3fec-4737-a06d-58f864bf1c7f.png" alt="img"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636895894922-459ce6b3-1c5a-4094-b894-2a6680d9b30c.png" alt="img"></p><h5 id="_5-4-æ•´ä½“æµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#_5-4-æ•´ä½“æµç¨‹å›¾" aria-hidden="true">#</a> 5.4 æ•´ä½“æµç¨‹å›¾</h5><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2541/1636895943341-66b19f9d-e125-4536-8882-5c4c1f26fd91.png" alt="img"></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/tt110617/edit/main/demo/src/backend/frame/springcloud/SpringCloudAibaba.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/8/20 16:50:53</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 1253728268@qq.com">hzz</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/myblog/backend/frame/springcloud/SpringCloud.html" class="nav-link prev" aria-label="SpringCloud"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->SpringCloud</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2022 åä¸€</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/myblog/assets/app.6a2d513d.js" defer></script>
  </body>
</html>
